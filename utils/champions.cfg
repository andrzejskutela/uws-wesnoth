#define QQUWS_APPLY_CHAMPION_BONUS
	[event]
		name=apply_champion_bonus
		first_time_only=no
		
		[set_variables]
			name=champion_keys
			mode=replace
			[split]
				list=$champion_settings_list
				key=key
				separator=":"
				remove_empty=yes
			[/split]
		[/set_variables]
		
		[set_variables]
			name=champion_container
			mode=replace
			[value]
				abilities_list=""
				hp=0 # % 
				dmg=0 # %
				melee_dmg=0
				ranged_dmg=0
				strikes=0 # literal
				melee_strikes=0
				ranged_strikes=0
				mp=0 # literal
				melee_accuracy=0
				ranged_accuracy=0
				melee_parry=0
				ranged_parry=0
				arcane=0
				blade=0
				cold=0
				fire=0
				impact=0
				pierce=0
				physical=0
				magical=0
				all_res=0
				flat=0
				frozen=0
				forest=0
				village=0
				swamp_water=0
				cave=0
				reef=0
				shallow_water=0
				deep_water=0
				fungus=0
				mountains=0
				hills=0
				castle=0
				sand=0
				everywhere=0
				movement_cost=0
			[/value]
		[/set_variables]
		
		[foreach]
			array=champion_keys
			variable=champion_buff
			readonly=yes
			
			[do]
				[if]
					[variable]
						name=champion_buff.key
						not_equals=""
					[/variable]
					[then]
						{VARIABLE register_uws_special ""}
						{APPLY_SINGLE_BONUS $champion_unit_id}
						
						[if]
							[variable]
								name=register_uws_special
								not_equals=""
							[/variable]
							[then]
								[fire_event]
									name=register_uws_event
								[/fire_event]
								{VARIABLE register_uws_special ""}
							[/then]
						[/if]
					[/then]
				[/if]
			[/do]
		[/foreach]
		
		{VARIABLE new_champion_description ""}
		[qquws_generate_champion_params]
			var=champion_params
			description_var=new_champion_description
			settings=champion_container
		[/qquws_generate_champion_params]
		
		{APPLY_CHAMPION_BONUS_TO_UNIT $champion_unit_id champion_display_type_id}
	[/event]
#enddef

#define APPLY_SINGLE_BONUS UNIT_ID
	[switch]
		variable=champion_buff.key
		[case]
			value=A1
			{VARIABLE_OP champion_container.dmg add "$(floor(28.6 + 1.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A2
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(16 + $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_strikes add "$(floor(1 + 0.1 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A3
			{VARIABLE_OP champion_container.dmg add "$(floor(18 + 1.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.all_res add "$(floor(12 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hp add "$(floor(10 + 1.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A4
			{VARIABLE_OP champion_container.hp add "$(floor(20 + 1.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.all_res add "$(floor(20 + 0.3 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A5
			{VARIABLE bonus_arg "$(floor(1 + 0.16 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Discouragement $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						[set_specials]
							mode=append
							[attacks]
								id=qqas_discouragement
								name= _ "discouragement $bonus_arg"
								description="When used in defense, this attack reduces the opponent's number of strikes by $bonus_arg|."
								sub=$bonus_arg
								active_on=defense
								apply_to=opponent
							[/attacks]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A6
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(20 + 0.6 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.village add "$(floor(10 + 0.25 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.castle add "$(floor(10 + 0.25 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A7
			{VARIABLE_OP champion_container.hp add "$(floor(12 + 0.8 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.all_res add "$(floor(16 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A8
			{VARIABLE_OP champion_container.physical add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.magical add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A9
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(16 + $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_accuracy add "$(floor(8 + 0.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A10
			{VARIABLE_OP champion_container.all_res add 24}
		[/case]
		[case]
			value=A11
			{VARIABLE_OP champion_container.hp add "$(floor(25 + 1.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.dmg add "$(floor(12 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A12
			{VARIABLE_OP champion_container.dmg add "$(floor(32 + 1.6 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A13
			{VARIABLE_OP champion_container.ranged_strikes add "$(floor(1 + 0.08 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.everywhere add "$(floor(6 + 0.25 * $bonus_strength_kval))"}
			[if]
				[variable]
					name=bonus_strength_kval
					greater_than=1
				[/variable]
				[then]
					{VARIABLE_OP champion_container.mp add 1}
					{VARIABLE_OP champion_container.movement_cost add 1}
				[/then]
			[/if]
		[/case]
		[case]
			value=A14
			{VARIABLE_OP champion_container.hp add "$(floor(35 + 1.75 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A15
			{VARIABLE_OP champion_container.melee_parry add "$(floor(12 + 0.7 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A16
			{VARIABLE_OP champion_container.dmg add "$(floor(40 + $bonus_strength_kval))"}
		[/case]
		[case]
			value=A17
			{VARIABLE bonus_arg "$(3 + floor($bonus_strength_kval / 1.5))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Pierce Impale $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					impale_armor_reduce=$bonus_arg
				[/variables]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						type=pierce
						[set_specials]
							mode=append
							[dummy]
								id=qquws_impale
								name="impale"
								description="When this weapon is used on offense and a hit lands, it permanently decreases enemy's pierce resistance by $bonus_arg once per engagement. Furthermore the opponent's damage and movement points are reduced by 33% for one turn. Reduced resistance cannot go below -15%."
								active_on=offense
							[/dummy]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "pierce_res_item"}
		[/case]
		[case]
			value=A18
			{VARIABLE_OP champion_container.dmg add "$(floor(25 + $bonus_strength_kval))"}
		[/case]
		[case]
			value=A19
			{VARIABLE_OP champion_container.magical add "$(floor(16 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A20
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(30 + 0.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_accuracy add "$(floor(14 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A21
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(20 + $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_strikes add "$(floor(2 + 0.08 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A22
			{VARIABLE_OP champion_container.hp add "$(floor(15 + 1.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A23
			{VARIABLE_OP champion_container.physical add "$(floor(20 + 0.25 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A24
			{VARIABLE_OP champion_container.melee_accuracy add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A25
			{VARIABLE bonus_arg "$(1.75 + 0.25 * floor(if($bonus_strength_kval > 12, 12, $bonus_strength_kval) / 4))"}
			# weird multi and divide to get around rounding rules of wesnoth formula
			{VARIABLE_OP bonus_arg multiply 100}
			{VARIABLE_OP bonus_arg divide 100}
			{VARIABLE bonus_2nd_arg "$(40 + 10 * floor(if($bonus_strength_kval > 12, 12, $bonus_strength_kval) / 4))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Steadfast x$bonus_arg|/$bonus_2nd_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[resistance]
								id=steadfast
								multiply=$bonus_arg
								max_value=$bonus_2nd_arg
								[filter_base_value]
									greater_than=0
									less_than=$bonus_2nd_arg
								[/filter_base_value]
								name="steadfast"
								description="This unitâ€™s physical resistances multiplied by x$bonus_arg, up to a maximum of $bonus_2nd_arg|%, when defending. Vulnerabilities are not affected."
								affect_self=yes
								active_on=defense
							[/resistance]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A26
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Immune to slow"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[status]
				     unslowable=yes
				[/status]
			[/modify_unit]
		[/case]
		[case]
			value=A27
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Final Showdown on berserk weapon"}

			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						special_id=berserk
						[set_specials]
							mode=append
							[dummy]
								id=qquws_final_showdown
								name="final showdown"
								description="When this weapon is used both the attacker and the defender increase their damage by 1 with each hit."
							[/dummy]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "final_showdown_special"}
		[/case]
		[case]
			value=A28
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Ranged First Strike"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=ranged
						remove_specials=firststrike
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_FIRSTSTRIKE}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A29
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
First Strike"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						remove_specials=firststrike
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_FIRSTSTRIKE}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A30
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Magical"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=magical
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_MAGICAL}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A31
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee First Strike"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=firststrike
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_FIRSTSTRIKE}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A32
			{VARIABLE_OP champion_container.everywhere add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A33
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Slow"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=slow
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_SLOW}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A34
			{VARIABLE bonus_arg "$(1.5 + 0.25 * floor($bonus_strength_kval / 5))"}
			{VARIABLE_OP bonus_arg round 2}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Backstab $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=backstab
						[set_specials]
							mode=append
							[damage]
								id=backstab
								name="backstab x$bonus_arg"
								description= _ "When used offensively, this attack deals $bonus_arg|x if there is an enemy of the target on the opposite side of the target, and that unit is not incapacitated (turned to stone or otherwise paralyzed)."
								multiply=$bonus_arg
								active_on=offense
								[filter_opponent]
								    formula="
									enemy_of(self, flanker) and not flanker.petrified
								    where
									flanker = unit_at(direction_from(loc, other.facing))
								    "
								[/filter_opponent]
							[/damage]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A35
			{VARIABLE bonus_arg "$(1.5 + 0.25 * floor($bonus_strength_kval / 5))"}
			{VARIABLE_OP bonus_arg round 2}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Ranged Backstab $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=ranged
						remove_specials=backstab
						[set_specials]
							mode=append
							[damage]
								id=backstab
								name="backstab x$bonus_arg"
								description= _ "When used offensively, this attack deals $bonus_arg|x if there is an enemy of the target on the opposite side of the target, and that unit is not incapacitated (turned to stone or otherwise paralyzed)."
								multiply=$bonus_arg
								active_on=offense
								[filter_opponent]
								    formula="
									enemy_of(self, flanker) and not flanker.petrified
								    where
									flanker = unit_at(direction_from(loc, other.facing))
								    "
								[/filter_opponent]
							[/damage]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A36
			{VARIABLE_OP champion_container.dmg add "$(floor(50 + 2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=A37
			{VARIABLE bonus_arg "$(20 + 5 * floor($bonus_strength_kval / 5))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Leadership $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[leadership]
								id=leadership
								value="($bonus_arg * (level - other.level))"
								cumulative=no
								name="leadership"
								description="All adjacent lower-level units from the same side deal $bonus_arg|% more damage for each difference in level."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
									[filter]
										formula="level < other.level"
									[/filter]
								[/affect_adjacent]
							[/leadership]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A38
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Ranged No Counter-Attack"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=ranged
						[set_specials]
							mode=append
							[attacks]
								id=AE_mag_nocounter
								name= _ "no counter-attack"
								description=_"The opponent has a 0% chance to hit, when this unit is attacking. Does not work on opponents with berserker frenzy."
								value=0
								cumulative=no
								active_on=offense
								apply_to=opponent

								[filter_opponent]
									[filter_weapon]
										[not]
											special=berserk
										[/not]
									[/filter_weapon]
								[/filter_opponent]
							[/attacks]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A39
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Ranged Poison"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=ranged
						remove_specials=poison
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_POISON}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A40
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Shatter the Bones on impact"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						type=impact
						damage=24-999
						remove_specials=qquws_shatter_the_bones,qquws_stun
						[set_specials]
							mode=append
							[dummy]
								id=qquws_shatter_the_bones
								name="shatter the bones"
								description="When this weapon is used on offense and a hit lands, the enemy gets 50% of strikes removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit."
								active_on=offense
							[/dummy]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "impact_res_item"}
		[/case]
		[case]
			value=A41
			{VARIABLE bonus_arg "$(floor(2 + 0.1 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Duel $bonus_arg on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    [set_specials]
					    	mode=append
					    	[berserk]
							id=berserk_duel2
							name="duel $bonus_arg"
							description="When attacking, this unit presses the engagement and can fight for $bonus_arg rounds."
							value=$bonus_arg
							active_on=offense
						[/berserk]
					    [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A42
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Precision on ranged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    remove_specials=magical,marksman
					    [set_specials]
					    	mode=append
						    [chance_to_hit]
							id=magical
							name="precision"
							description="This attack always has a 80% chance to hit regardless of the defensive ability of the unit being attacked."
							value=80
							cumulative=no
						    [/chance_to_hit]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A43
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Unavoidable on ranged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    remove_specials=magical,marksman
					    [set_specials]
					    	mode=append
						    [chance_to_hit]
							id=magical
							name="unavoidable"
							description="This attack always has a 90% chance to hit regardless of the defensive ability of the unit being attacked."
							value=90
							cumulative=no
						    [/chance_to_hit]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A44
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Always Hits on ranged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    remove_specials=magical,marksman
					    [set_specials]
					    	mode=append
						    [chance_to_hit]
							id=magical
							name="always hits"
							description="This attack always has a 100% chance to hit regardless of the defensive ability of the unit being attacked."
							value=100
							cumulative=no
						    [/chance_to_hit]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A45
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Precision on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    remove_specials=magical,marksman
					    [set_specials]
					    	mode=append
						    [chance_to_hit]
							id=magical
							name="precision"
							description="This attack always has a 80% chance to hit regardless of the defensive ability of the unit being attacked."
							value=80
							cumulative=no
						    [/chance_to_hit]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A46
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Unavoidable on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    remove_specials=magical,marksman
					    [set_specials]
					    	mode=append
						    [chance_to_hit]
							id=magical
							name="unavoidable"
							description="This attack always has a 90% chance to hit regardless of the defensive ability of the unit being attacked."
							value=90
							cumulative=no
						    [/chance_to_hit]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A47
			{VARIABLE bonus_arg "$(20 + 5 * floor($bonus_strength_kval / 3))"}
			{VARIABLE bonus_factor 100}
			{VARIABLE_OP bonus_factor sub $bonus_arg}
			{VARIABLE_OP bonus_factor divide 100}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Weaken $bonus_arg|% on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    [set_specials]
					    	mode=append
						    [damage]
							id=absorb
							name="weaken $bonus_arg|%"
							description="When used offensively this unit receives $bonus_arg|% less damage from enemy strikes."
							multiply=$bonus_factor
							apply_to=opponent
							active_on=offense
						    [/damage]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A48
			{VARIABLE bonus_arg "$(20 + 5 * floor($bonus_strength_kval / 3))"}
			{VARIABLE bonus_factor 100}
			{VARIABLE_OP bonus_factor sub $bonus_arg}
			{VARIABLE_OP bonus_factor divide 100}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Weaken $bonus_arg|% on ranged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    [set_specials]
					    	mode=append
						    [damage]
							id=absorb
							name="weaken $bonus_arg|%"
							description="When used offensively this unit receives $bonus_arg|% less damage from enemy strikes."
							multiply=$bonus_factor
							apply_to=opponent
							active_on=offense
						    [/damage]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A49
			{VARIABLE bonus_arg "$(15 + 5 * floor($bonus_strength_kval / 5))"}
			{VARIABLE bonus_factor 100}
			{VARIABLE_OP bonus_factor sub $bonus_arg}
			{VARIABLE_OP bonus_factor divide 100}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Absorb $bonus_arg|% on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    [set_specials]
					    	mode=append
						    [damage]
							id=absorb
							name="absorb $bonus_arg|%"
							description="This attack puts the unit in good defensive position, and it absorbs $bonus_arg|% of the damage dealt by an enemy strike."
							multiply=$bonus_factor
							apply_to=opponent
						    [/damage]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A50
			{VARIABLE bonus_arg "$(15 + 5 * floor($bonus_strength_kval / 5))"}
			{VARIABLE bonus_factor 100}
			{VARIABLE_OP bonus_factor sub $bonus_arg}
			{VARIABLE_OP bonus_factor divide 100}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Absorb $bonus_arg|% on ranged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    [set_specials]
					    	mode=append
						    [damage]
							id=absorb
							name="absorb $bonus_arg|%"
							description="This attack puts the unit in good defensive position, and it absorbs $bonus_arg|% of the damage dealt by an enemy strike."
							multiply=$bonus_factor
							apply_to=opponent
						    [/damage]
					     [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=A51
			{VARIABLE bonus_arg "$(40 + 10 * floor($bonus_strength_kval / 6))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Physical Endurance"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					qquws_endurance_types="blade,impact,pierce,insects"
					qquws_endurance_regen_factor=$bonus_arg
				[/variables]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_endurance
								name="physical endurance"
								description="This unit will instantly regenerate $bonus_arg|% of the damage dealt to it if it is physical damage and the strike would not otherwise kill."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "endurance_special"}
		[/case]
		[case]
			value=A52
			{VARIABLE bonus_arg "$(40 + 10 * floor($bonus_strength_kval / 6))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Magical Endurance"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					qquws_endurance_types="arcane,cold,fire,secret"
					qquws_endurance_regen_factor=$bonus_arg
				[/variables]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_endurance
								name="magical endurance"
								description="This unit will instantly regenerate $bonus_arg|% of the damage dealt to it if it is magical damage and the strike would not otherwise kill."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "endurance_special"}
		[/case]
		
		[case]
			value=B1
			{VARIABLE_OP champion_container.everywhere add "$(floor(8 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B2
			{VARIABLE_OP champion_container.melee_parry add "$(floor(10 + 0.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B3
			{VARIABLE bonus_arg "$(floor(2 + 0.1 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Duel $bonus_arg on ranged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    [set_specials]
					    	mode=append
					    	[berserk]
							id=berserk_duel2
							name="duel $bonus_arg"
							description="When attacking, this unit presses the engagement and can fight for $bonus_arg rounds."
							value=$bonus_arg
							active_on=offense
						[/berserk]
					    [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B4
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(35 + 1.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B5
			{VARIABLE_OP champion_container.mp add "$(floor(2 + 0.12 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.movement_cost add 1}
		[/case]
		[case]
			value=B6
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(20 + 0.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.mountains add "$(floor(12 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hills add "$(floor(12 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.cave add "$(floor(12 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.castle add "$(floor(8 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.village add "$(floor(8 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B7
			{VARIABLE bonus_arg "$(floor(12 + 0.6 * $bonus_strength_kval) / 10.0)"}
			{VARIABLE_OP bonus_arg round 1}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Ranged Retaliation $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=ranged
						[set_specials]
							mode=append
							[damage]
								id=qq_retaliation
								name="retaliation x$bonus_arg"
								description="When defending, this attack deals $bonus_arg|x damage to the attacker."
								multiply=$bonus_arg
								apply_to=self
								active_on=defense
							[/damage]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B8
			{VARIABLE_OP champion_container.mp add "$(floor(2 + 0.12 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hp add "$(floor(20 + 2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B9
			{VARIABLE_OP champion_container.melee_parry add "$(floor(15 + 0.66 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.physical add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B10
			{VARIABLE_OP champion_container.dmg add "$(floor(45 + 1.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B11
			{VARIABLE_OP champion_container.hp add "$(floor(30 + 1.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.dmg add "$(floor(15 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B12
			{VARIABLE_OP champion_container.hp add "$(floor(30 + 1.5 * $bonus_strength_kval))"}
			{VARIABLE bonus_arg "$(floor(6 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Regenerates $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=remove_ability
						[abilities]
							[regenerate]
								id=regenerates
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates4
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates6
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates8
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates12
							[/regenerate]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[regenerate]
								value=$bonus_arg
								id=regenerates
								name="regenerates $bonus_arg"
								description= _ "The unit will heal itself $bonus_arg HP per turn. If it is poisoned, it will remove the poison instead of healing."
								affect_self=yes
								poison=cured
							[/regenerate]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B13
			{VARIABLE_OP champion_container.ranged_accuracy add "$(floor(8 + 0.6 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B14
			{VARIABLE_OP champion_container.arcane add "$(floor(24 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.fire add "$(floor(16 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.cold add "$(floor(16 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.blade add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.impact add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.pierce add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B15
			{VARIABLE bonus_arg "$(floor(12 + $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Regenerates $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=remove_ability
						[abilities]
							[regenerate]
								id=regenerates
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates4
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates6
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates8
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates12
							[/regenerate]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[regenerate]
								value=$bonus_arg
								id=regenerates
								name="regenerates $bonus_arg"
								description= _ "The unit will heal itself $bonus_arg HP per turn. If it is poisoned, it will remove the poison instead of healing."
								affect_self=yes
								poison=cured
							[/regenerate]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B16
			{VARIABLE_OP champion_container.hp add "$(floor(25 + 2.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.dmg add "$(floor(25 + 1.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B17
			{VARIABLE_OP champion_container.mp add "$(floor(1 + 0.15 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.movement_cost add 1}
		[/case]
		[case]
			value=B18
			{VARIABLE bonus_arg "$(floor((60 + 1.25 * $bonus_strength_kval) / 5) * 5)"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Self Protection $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						[set_specials]
							mode=append
							[attacks]
								id=qq_att_self_protection
								name="self protection $bonus_protection_res"
								description="This unitâ€™s resitances are set to $bonus_arg whenever defending, however it can retaliate with only 1 strike."
								value=1
								active_on=defense
								apply_to=self
							[/attacks]
						[/set_specials]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[resistance]
								id=qq_self_protection
								value=$bonus_arg
								max_value=90
								name="self protection $bonus_arg"
								description="This unitâ€™s resitances are set to $bonus_arg whenever defending, however it can retaliate with only 1 strike."
								affect_self=yes
								active_on=defense
							[/resistance]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B19
			{VARIABLE_OP champion_container.hp add "$(floor(30 + 3 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B20
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee No Counter-Attack"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						[set_specials]
							mode=append
							[attacks]
								id=AE_mag_nocounter
								name= _ "no counter-attack"
								description=_"The opponent has a 0% chance to hit, when this unit is attacking. Does not work on opponents with berserker frenzy."
								value=0
								cumulative=no
								active_on=offense
								apply_to=opponent

								[filter_opponent]
									[filter_weapon]
										[not]
											special=berserk
										[/not]
									[/filter_weapon]
								[/filter_opponent]
							[/attacks]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B21
			{VARIABLE_OP champion_container.magical add "$(floor(8 + 0.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.physical add "$(floor(12 + 0.75 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B22
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Possessed by Blood"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_possessed_by_blood
								name="possessed by blood"
								description="With each engagement in fight, this unit's damage is increased by 15% for a duration of 1 turn"
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "possessed_by_blood_special"}
		[/case]
		[case]
			value=B23
			{VARIABLE_OP champion_container.melee_parry add "$(floor(5 + 0.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.physical add "$(floor(12 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B24
			{VARIABLE_OP champion_container.everywhere add "$(floor(10 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B25
			{VARIABLE_OP champion_container.magical add "$(floor(20 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B26
			{VARIABLE_OP champion_container.forest add "$(floor(14 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hills add "$(floor(14 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.mountains add "$(floor(10 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B27
			{VARIABLE_OP champion_container.arcane add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.fire add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.cold add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.blade add "$(floor(16 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.impact add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.pierce add "$(floor(16 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B28
			{VARIABLE_OP champion_container.ranged_parry add "$(floor(12 + 0.6 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.ranged_dmg add "$(floor(24 + 0.1 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B29
			{VARIABLE bonus_arg "$(35 + 10 * floor($bonus_strength_kval / 5))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Drains $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						remove_specials=drains
						[set_specials]
							mode=append
							[drains]
								id=drains
								name="drains $bonus_arg"
								value=$bonus_arg
								description="This unit drains health from living units, healing itself for $bonus_arg|% of the amount of damage it deals (rounded down)."
							[/drains]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B30
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(20 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_strikes add 1}
		[/case]
		[case]
			value=B31
			{VARIABLE_OP champion_container.mp add "$(floor(1 + 0.15 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.frozen add "$(floor(16 + 0.25 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hills add "$(floor(11 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.mountains add "$(floor(11 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.cave add "$(floor(11 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.movement_cost add 1}
		[/case]
		[case]
			value=B32
			{VARIABLE_OP champion_container.everywhere add "$(floor(8 + 0.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B33
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(28 + 0.6 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_parry add "$(floor(12 + 0.6 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B34
			{VARIABLE bonus_arg "$(floor(12 + 0.4 * $bonus_strength_kval) / 10.0)"}
			{VARIABLE_OP bonus_arg round 1}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Retaliation $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						[set_specials]
							mode=append
							[damage]
								id=qq_retaliation
								name="retaliation x$bonus_arg"
								description="When defending, this attack deals $bonus_arg|x damage to the attacker."
								multiply=$bonus_arg
								apply_to=self
								active_on=defense
							[/damage]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B35
			{VARIABLE_OP champion_container.dmg add "$(floor(30 + 2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.all_res add "$(floor(12 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B36
			{VARIABLE bonus_arg "$(14 + floor(0.4 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Terror $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=new_ability
					    [abilities]
						[leadership]
							id=qqas_fear
							value="($bonus_arg * if(level - other.level > 0, other.level - level, 0))"
							cumulative=no
							name="terror"
							description="This unit can lower adjacent enemies' morale and make them fight worse.

Adjacent enemies of will do less damage in battle. Damage reduction equals to $bonus_arg|% per level difference."
							affect_self=no
							affect_allies=no
							affect_enemies=yes
							[affect_adjacent]
							    adjacent=n,ne,se,s,sw,nw
							[/affect_adjacent]
						    [/leadership]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B37
			{VARIABLE bonus_arg "$(4 + floor(0.5 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Aura of Death $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					aura_of_death_damage=$bonus_arg
				[/variables]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=new_ability
					    [abilities]
							[dummy]
								id=qquws_aura_of_death
								name="aura of death $bonus_arg|"
								description="At the beginning of turn all enemies within 12 radius from this unit receive $bonus_arg arcane damage. Like poison, it will not kill."
							[/dummy]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "aura_of_death_special"}
		[/case]
		[case]
			value=B38
			{VARIABLE bonus_arg "$(50 + 15 * floor($bonus_strength_kval / 5))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Drains $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=drains
						[set_specials]
							mode=append
							[drains]
								id=drains
								name="drains $bonus_arg"
								value=$bonus_arg
								description="This unit drains health from living units, healing itself for $bonus_arg|% of the amount of damage it deals (rounded down)."
							[/drains]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B39
			{VARIABLE_OP champion_container.ranged_accuracy add "$(floor(10 + 0.25 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B40
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Infernal Possession"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_infernal_possession
								name="infernal possession"
								description="After killing an enemy, this unit receives 2mp and a chance to attack again."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "infernal_possession_special"}
		[/case]
		[case]
			value=B41
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Berserk"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    [set_specials]
					    	mode=append
					    	[berserk]
							id=berserk
							name="berserk"
							description="Whether used offensively or defensively, this attack presses the engagement until one of the combatants is slain, or 30 rounds of attacks have occurred."
							value=30
						[/berserk]
					    [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=B42
			{VARIABLE_OP champion_container.flat add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.village add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B43
			{VARIABLE_OP champion_container.shallow_water add "$(floor(16 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.sand add "$(floor(15 + 0.25 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.swamp_water add "$(floor(14 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B44
			{VARIABLE_OP champion_container.cave add "$(floor(16 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.mountains add "$(floor(10 + 0.25 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hills add "$(floor(12 + 0.25 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=B45
			{VARIABLE_OP champion_container.arcane add 80}
			{VARIABLE_OP champion_container.fire add 20}
			{VARIABLE_OP champion_container.cold add 20}
		[/case]
		[case]
			value=B46
			{VARIABLE_OP champion_container.arcane add 20}
			{VARIABLE_OP champion_container.fire add 80}
			{VARIABLE_OP champion_container.cold add 20}
		[/case]
		[case]
			value=B47
			{VARIABLE_OP champion_container.arcane add 20}
			{VARIABLE_OP champion_container.fire add 20}
			{VARIABLE_OP champion_container.cold add 80}
		[/case]
		[case]
			value=B48
			{VARIABLE_OP champion_container.blade add 80}
			{VARIABLE_OP champion_container.impact add 20}
			{VARIABLE_OP champion_container.pierce add 20}
		[/case]
		[case]
			value=B49
			{VARIABLE_OP champion_container.blade add 20}
			{VARIABLE_OP champion_container.impact add 80}
			{VARIABLE_OP champion_container.pierce add 20}
		[/case]
		[case]
			value=B50
			{VARIABLE_OP champion_container.blade add 20}
			{VARIABLE_OP champion_container.impact add 20}
			{VARIABLE_OP champion_container.pierce add 80}
		[/case]
		[case]
			value=B51
			{VARIABLE bonus_arg "$(if($bonus_strength_kval < 25, floor(26 - 0.4 * $bonus_strength_kval), 16))"}
			{VARIABLE second_bonus_arg "$(if($bonus_strength_kval < 18, floor(2 + 0.175 * $bonus_strength_kval), 5))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Mind Raid -$second_bonus_arg|/$bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					mind_raid_steal_per_hit=$second_bonus_arg
					mind_raid_threshold=$bonus_arg
					mind_raid_stolen_xp=0
				[/variables]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[dummny]
								id=qquws_mind_raid
								name="mind raid -$second_bonus_arg|/$bonus_arg"
								description="With each hit this unit removes $second_bonus_arg|xp from the opponent. The xp level of the opponent can go below 0. When the total stolen amount exceeds $bonus_arg this unit receives permanent +15% bonus to all damage and the counter starts over."
							[/dummny]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "mind_raid_special"}
		[/case]
		[case]
			value=B52
			{VARIABLE bonus_arg "$(floor(4 + 2.25 * $bonus_strength_kval))"}
			{VARIABLE second_bonus_arg "$(floor(6 + 1.2 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Explodes below $second_bonus_arg|($bonus_arg|)"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					explodes_damage=$bonus_arg
					explodes_threshold=$second_bonus_arg
				[/variables]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[dummny]
								id=qquws_explodes
								name="explodes below $second_bonus_arg|($bonus_arg|)"
								description="If at any point this unit's hitpoints drop below $second_bonus_arg (but still above 0) then this unit suicides causing $bonus_arg impact damage to all units surrounding it. The explosion can be avoided if the unit is killed without it's hp going below the threshold."
							[/dummny]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "explodes_special"}
		[/case]
		[case]
			value=B53
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Sickness"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    special_id=poison
					    remove_specials=poison
					    [set_specials]
					    	mode=append
					    	[dummy]
							id=qquws_sickness
							name="sickness"
							description="When this attack lands a hit it infects the unit's nervous system. The unit becomes slowed, poisoned, unhealable and receives 25% more damage from all sources for the next 3 turns until the effect wears off."
						[/dummy]
					    [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "sickness_special"}
		[/case]
		[case]
			value=B54
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Astral Imprisonment on magical ranged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    special_id=magical
					    remove_specials=qquws_astral_imprisonment
					    [set_specials]
					    	mode=append
					    	[dummy]
							id=qquws_astral_imprisonment
							name="astral imprisonment"
							description="When used offensively this attack strips the defendor of all weapons upon the hit. If the unit survives, it's hp is reduced to one and is turned to stone for 2 turns."
						[/dummy]
					    [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "astral_imprisonment_special"}
		[/case]
		[case]
			value=B55
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Retribution on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[status]
					qquws_retribution=no
				[/status]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    remove_specials=qquws_retribution
					    [set_specials]
					    	mode=append
					    	[chance_to_hit]
							id=qquws_retribution
							name="retribution"
							description="When defending and receiving a hit, it temporarily increases the chance to hit to 100% for one strike."
							value=100
							cumulative=no
							active_on=defense
							apply_to=self
							[filter_self]
								status=qquws_retribution
							[/filter_self]
						[/chance_to_hit]
					    [/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "retribution_special"}
		[/case]
		
		[case]
			value=C1
			{VARIABLE_OP champion_container.hp add "$(floor(40 + 4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C2
			{VARIABLE_OP champion_container.hp add "$(floor(50 + 5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C3
			{VARIABLE_OP champion_container.hp add "$(floor(60 + 5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C4
			{VARIABLE_OP champion_container.hp add "$(floor(70 + 5.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C5
			{VARIABLE_OP champion_container.hp add "$(floor(80 + 6 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C6
			{VARIABLE_OP champion_container.hp add "$(floor(100 + 7.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C7
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(32 + 0.6 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C8
			{VARIABLE_OP champion_container.ranged_dmg add "$(floor(32 + 0.6 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C9
			{VARIABLE_OP champion_container.everywhere add "$(floor(12 + 0.25 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C10
			{VARIABLE_OP champion_container.dmg add "$(floor(25 + 0.25 * $bonus_strength_kval))"}
			{VARIABLE bonus_arg "$(floor(25 + 0.75 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Sound of War $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=remove_ability
						[abilities]
							[leadership]
								id=leadership
							[/leadership]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[leadership]
								id=leadership
								value=$bonus_arg
								cumulative=no
								name="sound of war"
								description="This unit makes ally units enter battle trance if they are next to it. Affects units of the same or lower level increasing their damage by $bonus_arg|%."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
									[filter]
										formula="level <= other.level"
									[/filter]
								[/affect_adjacent]
							[/leadership]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C11
			{VARIABLE_OP champion_container.hp add "$(floor(20 + 1.1 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.forest add "$(floor(10 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.swamp_water add "$(floor(10 + 0.25 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.cave add "$(floor(12 + 0.25 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C12
			{VARIABLE_OP champion_container.melee_accuracy add "$(floor(10 + 0.22 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C13
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Aura of Corrosion"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=new_ability
						[abilities]
							[resistance]
								id=ignore_resistance
								sub=10
								divide=2
								max_value=50
								[filter_base_value]
									greater_than=9
								[/filter_base_value]
								name="aura of corrosion"
								description="Enemies surrounding this unit have their resistances greatly reduced."
								affect_self=no
								affect_enemies=yes
								[affect_adjacent]
									adjacent=n,ne,se,s,sw,nw
								[/affect_adjacent]
							[/resistance]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C14
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(16 + 0.6 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_strikes add "$(floor(1 + 0.08 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C15
			{VARIABLE_OP champion_container.ranged_accuracy add "$(floor(14 + 0.7 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C16
			{VARIABLE_OP champion_container.hp add "$(floor(30 + 1.25 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.dmg add "$(floor(30 + 1.25 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C17
			{VARIABLE_OP champion_container.pierce add "$(floor(24 + $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.blade add "$(floor(12 + $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.impact add "$(floor(12 + $bonus_strength_kval))"}
		[/case]
		[case]
			value=C18
			{VARIABLE_OP champion_container.hp add "$(floor(75 + 2.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C19
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(15 + 1.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_accuracy add "$(floor(4 + 0.2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_parry add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C20
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(15 + 0.5 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hp add "$(floor(30 + 0.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C21
			{VARIABLE_OP champion_container.all_res add "$(floor(12 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.hp add "$(floor(30 + 1.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C22
			{VARIABLE_OP champion_container.hp add "$(floor(40 + 2.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C23
			{VARIABLE_OP champion_container.melee_accuracy add "$(floor(10 + 0.4 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C24
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Stun on Charged"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						special_id=charge
						[set_specials]
							mode=append
							[dummy]
								id=qquws_stun
								name="stun"
								description="This attack puts enormous pressure on the enemy, disrupting his ZOC if a hit is landed. Not active on defense."
								active_on=offense
							[/dummy]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "impact_res_item"}
		[/case]
		[case]
			value=C25
			{VARIABLE_OP champion_container.hp add "$(floor(40 + 2 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(20 + 0.2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C26
			{VARIABLE_OP champion_container.ranged_dmg add "$(floor(20 + $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.ranged_accuracy add "$(floor(8 + 0.1 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C27
			{VARIABLE_OP champion_container.melee_parry add "$(floor(8 + 0.4 * $bonus_strength_kval))"}
			{VARIABLE_OP champion_container.melee_dmg add "$(floor(22 + 2 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C28
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Ranged Slow"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=ranged
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_SLOW}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C29
			{VARIABLE_OP champion_container.dmg add "$(floor(33 + $bonus_strength_kval))"}
		[/case]
		[case]
			value=C30
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Adrenaline Rush"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						[set_specials]
							mode=append
							[attacks]
								id=adrenaline
								name="adrenaline rush"
								description="This unit gains strikes as it's health goes down."
								multiply="(1 + ((((1.099999 * max_hitpoints) + 0.0) - hitpoints) / max_hitpoints))"
							[/attacks]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C31
			{VARIABLE bonus_arg "$(15 + 5 * floor($bonus_strength_kval / 4))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Defensive Stance $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=new_ability
					    [abilities]
						[resistance]
							id=defensive_stance
							add=$bonus_arg
							max_value=70
							name="defensive stance $bonus_arg"
							description="This unitâ€™s gains extra $bonus_arg resistance whenever defending, up to maximum 70."
							affect_self=yes
							active_on=defense
						[/resistance]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C32
			{VARIABLE bonus_arg "$(10 + 5 * floor($bonus_strength_kval / 4))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Offensive Stance $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=new_ability
					    [abilities]
						[resistance]
							id=offensive_stance
							add=$bonus_arg
							max_value=70
							name="offensive stance $bonus_arg"
							description="This unitâ€™s gains extra $bonus_arg resistance when attacking, up to maximum 70."
							affect_self=yes
							active_on=offense
						[/resistance]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C33
			{VARIABLE_OP champion_container.hp add "$(floor(40 + 2 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Immune to Poison"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[status]
				     unpoisonable=yes
				[/status]	
				[object]
		 			silent=yes
		 			
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_unpoisonable
								name="unpoisonable"
								description="This unit cannot be poisoned."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C34
			{VARIABLE_OP champion_container.hp add "$(floor(40 + 2 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Skirmisher"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
						apply_to=remove_ability
						[abilities]
							[skirmisher]
								id=skirmisher
							[/skirmisher]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							{ABILITY_SKIRMISHER}
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C35
			{VARIABLE_OP champion_container.hp add "$(floor(140 + 2.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C36
			{VARIABLE bonus_arg "$(8 + floor(0.2 * $bonus_strength_kval))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Armor Destruction"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					armor_destruction_factor=$bonus_arg
				[/variables]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
					     apply_to=attack
					     range=melee
					     damage=20-999
					     [set_specials]
					    	  mode=append
					     	  [dummy]
							id=qquws_enemy_only_armor_destruction
							name="armor destruction"
							description="Each landing hit permanently destroys enemy's resistance to this weapon's damage type by amount equals to $bonus_arg|% of dealt damage. Resistance cannot go lower than -15. Works only on offense."
							active_on=offense
						  [/dummy]
					     [/set_specials]
					 [/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "armor_destruction_item"}
		[/case]
		[case]
			value=C37
			{VARIABLE bonus_arg "$(6 + $bonus_strength_kval)"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Heals +$bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
						apply_to=remove_ability
						[abilities]
							[heals]
								id=healing
							[/heals]
						[/abilities]
					[/effect]
		 			[effect]
						apply_to=new_ability
						[abilities]
							[heals]
								value=$bonus_arg
								id=healing
								affect_allies=yes
								name="heals +$bonus_arg"
								description="This unit can heal adjacent units by $bonus_arg HP per turn, or cure from poison."
								affect_self=no
								poison=cured
								[affect_adjacent]
								[/affect_adjacent]
							[/heals]
						[/abilities]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C38
			{VARIABLE_OP champion_container.magical add "$(floor(20 + 0.5 * $bonus_strength_kval))"}
		[/case]
		[case]
			value=C39
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Melee Poison"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=poison
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_POISON}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C40
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Overwhelm on melee blade"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						type=blade
						damage=16-999
						number=4-99
						[set_specials]
							mode=append
							[dummy]
								id=qquws_enemy_overwhelm
								name="overwhelm"
								description="When this weapon is used on offense each landing hit increases the damage by 3, while simultaneously decreases opponent's damage by 3(1) if current damage is above 67%(33%)."
								active_on=offense
							[/dummy]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "enemy_overwhelm_special"}
		[/case]
		[case]
			value=C41
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Marksman on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=marksman
						[set_specials]
							mode=append
							[chance_to_hit]
								id=marksman
								name= _ "marksman"
								description= _ "When used offensively, this attack always has at least a 60% chance to hit."
								value=60
								cumulative=yes
								active_on=offense
						        [/chance_to_hit]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C42
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Charge on melee"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						range=melee
						remove_specials=charge
						[set_specials]
							mode=append
							[damage]
								id=charge
								name="charge"
								description="When used offensively, this attack deals double damage to the target. It also causes this unit to take double damage from the targetâ€™s counterattack."
								multiply=2
								apply_to=both
								active_on=offense
							[/damage]
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C43
			{VARIABLE bonus_arg "$(20 + 5 * floor($bonus_strength_kval / 5))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Reflects $bonus_arg|% damage"}

			{VARIABLE reflects_factor $bonus_arg}
			{VARIABLE_OP reflects_factor divide 100}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					reflects_factor=$reflects_factor
				[/variables]
					
				[object]
		 			silent=yes
		 			
					[effect]
					    apply_to=new_ability
					    [abilities]
						[dummny]
							id=qquws_reflects_damage
							name="reflects $bonus_arg|%"
							description="When defending, $bonus_arg|% of received damage is reflected back to the attacker."
						[/dummny]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "golden_armor_item"}
		[/case]
		[case]
			value=C44
			{VARIABLE bonus_arg "$(floor(2 + floor(($bonus_strength_kval ^ 2) / 3) / 3.33))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Burns Enemies $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
					    apply_to=new_ability
					    [abilities]
						[heals]
							id=qqas_burns_enemies
							name= _ "burns enemies $bonus_arg"
							description=  _ "Burns adjacent enemies at the beginning of each turn for $bonus_arg|hp (does not kill)."
							value=-$bonus_arg
							affect_enemies=yes
							affect_allies=no
							affect_self=no
							[affect_adjacent]
							[/affect_adjacent]
						[/heals]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=halo
					    halo="halo/uws/burns.png"
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C45
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Extra Strikes"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
					     apply_to=attack
					     remove_specials=qquws_extra_strikes
					     [set_specials]
					    	  mode=append
					     	  [attacks]
							id=qquws_extra_strikes
							name="extra strikes"
							description="This unit gains 1 strike when it's hp drops below 67% and another one if hp goes below 33%."
							add="(if(hitpoints < 0.67 * max_hitpoints, if(hitpoints < 0.33 * max_hitpoints, 2, 1), 0))"
							apply_to=self
							cumulative=yes
							[filter_self]
								formula="if(hitpoints < 0.67 * max_hitpoints, 1, 0)"
							[/filter_self]
						  [/attacks]
					     [/set_specials]
					 [/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C46
			{VARIABLE bonus_arg "$(1 + floor($bonus_strength_kval / 12))"}
			{VARIABLE bonus_strikes "$(40 + 5 * floor($bonus_strength_kval / 3))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Strikes +$bonus_strikes|%
Swarm (min $bonus_arg|)"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
					     apply_to=attack
					     increase_attacks="$bonus_strikes|%"
					     [set_specials]
					    	  mode=append
					     	      	[swarm]
								id=swarm
								name="swarm (min $bonus_arg|)"
								description= _ "The number of strikes of this attack decreases when the unit is wounded. Minimum of $bonus_arg strikes."
								swarm_attacks_min=$bonus_arg
							[/swarm]
					     [/set_specials]
					 [/effect]
				[/object]
			[/modify_unit]
		[/case]
		[case]
			value=C47
			{VARIABLE bonus_arg "$(30 + 10 * floor($bonus_strength_kval / 5))"}
			{VARIABLE trickstery_factor $bonus_arg}
			{VARIABLE_OP trickstery_factor divide 100}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Arcane Trickstery $bonus_arg|%"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					arcane_trickstery_factor=$trickstery_factor
				[/variables]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
					    apply_to=new_ability
					    [abilities]
						[dummy]
							id=qquws_arcane_trickstery
							name="arcane trickstery $bonus_arg|%"
							description="$bonus_arg|% of all damage received is randomly redirected either as arcane damage to enemies or healing to allies. Units within radius 3 are affected."
						[/dummy]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "arcane_trickstery_special"}
		[/case]
		[case]
			value=C48
			{VARIABLE bonus_arg "$(if($bonus_strength_kval < 18, 1 + floor($bonus_strength_kval / 4), 5))"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Daze weapon $bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
						apply_to=new_attack
						name=qquws_w_mirror_daze
						description="daze"
						type=arcane
						range=ranged
						icon="attacks/staff-magic.png"
						damage=2
						number=$bonus_arg
						attack_weight=0
						[specials]
							[dummy]
								id=qquws_interrupt
								name="interrupt"
								description="When a unit is hit with an interrupting attack, combat is immediately stopped. Champions and The Butcher of Wesnoth are immune."
							[/dummy]
							[dummy]
								id=qquws_defense_only
								name="defense only"
								description="This attack can only be used on defense."
							[/dummy]
							[firststrike]
								id=firststrike
								name="first strike"
								description="This unit always strikes first with this attack, even if they are defending."
							[/firststrike]
						[/specials]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "interrupts_special"}
		[/case]
		[case]
			value=C49
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Medusa Gaze"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
					    apply_to=new_ability
					    [abilities]
						[dummy]
							id=qquws_medusa_spirit
							name="medusa gaze"
							description="When this unit defends, upon the first received hit it slows the opponent. When the opponent is already slowed and hits again, then it is turned into stone for two turns."
						[/dummy]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "medusa_spirit_special"}
		[/case]
		[case]
			value=C50
			{VARIABLE bonus_arg "$(3 + $bonus_strength_kval)"}
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Carnage +$bonus_arg"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					carnage_heal_amount=$bonus_arg
				[/variables]
					
				[object]
		 			silent=yes
		 			
		 			[effect]
					    apply_to=new_ability
					    [abilities]
						[dummy]
							id=qquws_carnage
							name="carnage +$bonus_arg"
							description="When this unit kills another, it heals for $bonus_arg hp, removes slow and poison and gets it's damage increased by 15%."
						[/dummy]
					    [/abilities]
					[/effect]
				[/object]
			[/modify_unit]
			
			{VARIABLE register_uws_special "carnage_special"}
		[/case]
		
		# bonuses below are NOT part of the random system and are (mainly?) used for minions
		[case]
			value=D1
			{VARIABLE champion_container.abilities_list "$champion_container.abilities_list
Slow
Poison"}
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
						apply_to=attack
						remove_specials=poison,slow
						[set_specials]
							mode=append
							{WEAPON_SPECIAL_POISON}
							{WEAPON_SPECIAL_SLOW}
						[/set_specials]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
	[/switch]
#enddef

#define APPLY_CHAMPION_BONUS_TO_UNIT UNIT_ID DISPLAY_TYPE_VAR
	[if]
		[variable]
			name=champion_params[0].exists
			boolean_equals=yes
		[/variable]
		[then]
			{VARIABLE scale_bulky_from_value $champion_params[0].hp}
			
			[fire_event]
				name=get_unit_main_image_dimensions
			[/fire_event]
				
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[variables]
					image_base_w=$bulky_image_width
					image_base_h=$bulky_image_height
				[/variables]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=hitpoints
					    increase="$champion_params[0].hp|%"
					    increase_total="$champion_params[0].hp|%"
					[/effect]
					
					[effect]
						apply_to=image_mod
						add="~SCALE_INTO_SHARP($bulky_image_width,$bulky_image_height)"
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]
	
	[if]
		[variable]
			name=champion_params[1].exists
			boolean_equals=yes
		[/variable]
		[then]
			{VARIABLE blend_amount 0}
			[if]
				[variable]
					name=champion_params[1].dmg
					greater_than=0
				[/variable]
				[then]
					{VARIABLE blend_amount 0.12}
					[if]
						[variable]
							name=champion_params[1].dmg
							greater_than=38
						[/variable]
						[then]
							{VARIABLE blend_amount 0.2}
						[/then]
					[/if]
				[/then]
			[/if]
				
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    increase_damage="$champion_params[1].dmg|%"
					    increase_attacks=$champion_params[1].strikes
					[/effect]
					[effect]
						apply_to=image_mod
						add="~BLEND(250,45,45,$blend_amount)"
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]
	
	[if]
		[variable]
			name=champion_params[2].exists
			boolean_equals=yes
		[/variable]
		[then]
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=melee
					    increase_damage="$champion_params[2].melee_dmg|%"
					    increase_attacks=$champion_params[2].melee_strikes
					    increase_accuracy=$champion_params[2].melee_accuracy
					    increase_parry=$champion_params[2].melee_parry
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]
	
	[if]
		[variable]
			name=champion_params[3].exists
			boolean_equals=yes
		[/variable]
		[then]
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=attack
					    range=ranged
					    increase_damage="$champion_params[3].ranged_dmg|%"
					    increase_attacks=$champion_params[3].ranged_strikes
					    increase_accuracy=$champion_params[3].ranged_accuracy
					    increase_parry=$champion_params[3].ranged_parry
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]
	
	[if]
		[variable]
			name=champion_params[4].exists
			boolean_equals=yes
		[/variable]
		[then]
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=movement
					    increase=$champion_params[4].mp
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]
	
	[if]
		[variable]
			name=champion_params[5].exists
			boolean_equals=yes
		[/variable]
		[then]
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=capped_champion_resistance
					    [resistance]
						arcane=$champion_params[5].arcane
						cold=$champion_params[5].cold
						fire=$champion_params[5].fire
						blade=$champion_params[5].blade
						impact=$champion_params[5].impact
						pierce=$champion_params[5].pierce
					    [/resistance]
					[/effect]
					[effect]
						apply_to=image_mod
						add="~RC(magenta>rails)"
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]
	
	[if]
		[variable]
			name=champion_params[6].exists
			boolean_equals=yes
		[/variable]
		[then]
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=capped_champion_defense
					    [defense]
							flat=-$champion_params[6].flat
							frozen=-$champion_params[6].frozen
							forest=-$champion_params[6].forest
							village=-$champion_params[6].village
							swamp_water=-$champion_params[6].swamp_water
							cave=-$champion_params[6].cave
							reef=-$champion_params[6].reef
							shallow_water=-$champion_params[6].shallow_water
							deep_water=-$champion_params[6].deep_water
							fungus=-$champion_params[6].fungus
							hills=-$champion_params[6].hills
							mountains=-$champion_params[6].mountains
							castle=-$champion_params[6].castle
							sand=-$champion_params[6].sand
					    [/defense]
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]

	[if]
		[variable]
			name=champion_params[7].exists
			boolean_equals=yes
		[/variable]
		[then]
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=movement_costs
					    replace=no
					    [movement_costs]
							flat=-$champion_params[7].movement_cost
							frozen=-$champion_params[7].movement_cost
							forest=-$champion_params[7].movement_cost
							village=-$champion_params[7].movement_cost
							swamp_water=-$champion_params[7].movement_cost
							cave=-$champion_params[7].movement_cost
							reef=-$champion_params[7].movement_cost
							shallow_water=-$champion_params[7].movement_cost
							deep_water=-$champion_params[7].movement_cost
							fungus=-$champion_params[7].movement_cost
							hills=-$champion_params[7].movement_cost
							mountains=-$champion_params[7].movement_cost
							castle=-$champion_params[7].movement_cost
							sand=-$champion_params[7].movement_cost
					    [/movement_costs]
					[/effect]
				[/object]
			[/modify_unit]
		[/then]
	[/if]
	
	[switch]
		variable={DISPLAY_TYPE_VAR}
		
		[case]
			value=champion
			
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[status]
					unplagueable=yes
				[/status]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=new_ability
					    [abilities]
					    	[dummy]
					    		id=is_champion
							name="champion"
							description="This is a war hardened warrior, a tough nut to crack.

$new_champion_description

$champion_settings_list (modifier x$uws_game.buff_modifier|)"
					    	[/dummy]
					    [/abilities]
					[/effect]
					
					[effect]
						apply_to=max_experience
						set=999
					[/effect]

					[effect]
					    apply_to=halo
					    halo="halo/uws/champion1.png"
					[/effect]
					
					[effect]
						apply_to=new_animation
						id="uws_champion_idle_anim"
						[animation]
							apply_to=idling
							[frame]
								halo="halo/uws/champion1.png:40"
								halo_x=0
								halo_y=0
							[/frame]
							[frame]
								halo="halo/uws/champion1.png:200"
								halo_x=0
								halo_y=0
							[/frame]
							[frame]
								halo="halo/uws/champion[3~10].png:100"
								halo_x=0
								halo_y=0
							[/frame]
						[/animation]
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
		
		[case]
			value=minion
			
			[modify_unit]
				[filter]
					id={UNIT_ID}
				[/filter]
				
				[object]
					silent=yes
					
					[effect]
					    apply_to=new_ability
					    [abilities]
					    	[dummy]
					    		id=is_minion
							name="minion"
							description="This is a strong fighter, an obedient minion that serves his master.

$new_champion_description

$champion_settings_list (modifier x$uws_game.buff_modifier|)"
					    	[/dummy]
					    [/abilities]
					[/effect]

					[effect]
					    apply_to=halo
					    halo="halo/uws/minion1.png"
					[/effect]
				[/object]
			[/modify_unit]
		[/case]
	[/switch]
#enddef

