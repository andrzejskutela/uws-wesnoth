#define QQUWS_APPLY_UWS_AMLA_MODIFICATION
	[event]
		name=post advance
		first_time_only=no

		[filter]
			side=$uws_game.filter_human_sides
			[not]
				[filter_wml]
					[variables]
						has_uws_amla_defined=yes
					[/variables]
				[/filter_wml]
			[/not]
		[/filter]

		[fire_event]
			name=apply_uws_amla_mod
			[primary_unit]
				id=$unit.id
			[/primary_unit]
		[/fire_event]
	[/event]

	[event]
		name=apply_uws_amla_mod
		first_time_only=no

		[if]
			[have_unit]
				id=$unit.id
				formula="if(level > 1 and not advances_to, 1, 0)"
			[/have_unit]
			[then]
				{UWS_AMLA_PRECHECK_UNIT}
				{ADD_DEFAULT_UWS_AMLA}

				[qquws_generate_random_amla_list]
					list_var=uws_amla_list
				[/qquws_generate_random_amla_list]

				[set_variables]
					name=amla_keys
					mode=replace
					[split]
						list=$uws_amla_list
						key=key
						separator=","
						remove_empty=yes
					[/split]
				[/set_variables]

				[foreach]
					array=amla_keys
					variable=amla_buff
					readonly=yes
					
					[do]
						[if]
							[variable]
								name=amla_buff.key
								not_equals=""
							[/variable]
							[then]
								{VARIABLE register_uws_special ""}
								{ADD_UWS_AMLA_MOD}

								[if]
									[variable]
										name=register_uws_special
										not_equals=""
									[/variable]
									[then]
										[fire_event]
											name=register_uws_event
										[/fire_event]
										{VARIABLE register_uws_special ""}
									[/then]
								[/if]
							[/then]
						[/if]
					[/do]
				[/foreach]
			[/then]
		[/if]
	[/event]
#enddef

#define UWS_AMLA_PRECHECK_UNIT
	[set_variables]
		name=qquws_amla_data
		mode=replace
		[value]
			level=$unit.level
			has_ranged_attack=no
			has_melee_attack=no
			has_magical_melee=no
			has_magical_ranged=no
			has_op_magical_ranged=no
			has_steadfast=no
			has_poison=no
			has_drains=no
			is_fast=no
			has_default_regenerates=no
			is_strong=no
			is_dextrous=no
			is_quick=no
			is_resilient=no
			is_intelligent=no
			is_healthy=no
			is_undead=no
			is_mechanical=no
			is_elemental=no
			is_human=no
		[/value]
	[/set_variables]
	
	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				formula="if(range='ranged' and damage * number > 13, 1, 0)"
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_ranged_attack yes}
		[/then]
	[/if]
	
	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				formula="if(range='melee' and damage * number > 13, 1, 0)"
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_melee_attack yes}
		[/then]
	[/if]
	
	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				range=melee
				special_id=magical
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_magical_melee yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				range=ranged
				special_id=magical
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_magical_ranged yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				range=ranged
				special_id=AE_mag_alwayshits,AE_fut_ubiquitous,eoma_alwayshits
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_op_magical_ranged yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			ability=steadfast
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_steadfast yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				special_id=poison
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_poison yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				special_id=drains
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_drains yes}
		[/then]
	[/if]

	[if]
		[variable]
			name=unit.max_moves
			greater_than=8
		[/variable]
		[then]
			{VARIABLE qquws_amla_data.is_fast yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			ability=regenerates,AE_mag_regenerates8,eoma_regenerates8
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_default_regenerates yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=strong
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_strong yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=dextrous
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_dextrous yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=quick
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_quick yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=resilient
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_resilient yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=intelligent
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_intelligent yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=healthy
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_healthy yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=undead,AE_arc_phantom
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_undead yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=mechanical
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_mechanical yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			trait=elemental,magical
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_elemental yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=human,dunefolk,AE_arc_race_human_primevalist,AE_arc_race_south_seas_human,AE_arc_race_ukian,AE_bem_calydonians_race,AE_efm_dalefolk,AE_efm_dalefolk,AE_efm_darklanders,AE_fut_welkin,AE_efm_freemen_race,AE_efm_highlanders_race,AE_efm_imperialists_race,AE_efm_seastates_race,AE_efm_whites,AE_ele_viking,AE_feu_ceresians_race,AE_fut_race_Nordhris,AE_imp_arendians_race,AE_imp_lavinian_race,AE_imp_marauder_race,AE_imp_nemidian_race,AE_imp_sidhe_race,AE_mag_summoner,AE_mie_thelian,AE_mrc_cult_race,AE_mrc_emperors_guard_race,AE_mrc_enchanters_race,AE_mrc_equestrians_race,AE_mrc_fanatics_race,AE_mrc_holy_order_race,AE_mrc_mercenaries_race,AE_mrc_oracles_race,AE_mrc_refugees_race,AE_mrc_slavers_race,AE_mrc_tribe_race,AE_myh_windsong,AE_RHY_human,AE_stf_eltireans_race,Altaris,pirat,tubylec,eoma_summoner,farengar,empfinn,mauvilien,nordian,rovahrien,galien
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_human yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=elf,AE_chs_aragwaith,AE_chs_faerie,AE_feu_high_elves_race,AE_imp_issaelfr_race,AE_mie_faerie,AE_RHY_elyser,AE_RHY_vixen,driada,amazon
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_elf yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=dwarf,AE_chs_elvish_spirits,AE_feu_clockwork_dwarf,AE_fut_brungar_race,AE_imp_cavernei_race,AE_RHY_dwarf,AE_mrc_highlanders_race,farNain,morken,darfen
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_dwarf yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=ogre,troll,AE_mag_cyclops,AE_RHY_giant,eoma_cyclops
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_troll yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=wose,AE_mie_treefolk
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_wose yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=drake
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_drake yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=lizard,AE_mag_salamander,AE_stf_free_saurians,eoma_salamander
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_saurian yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=orc,AE_arc_race_north_orc,AE_imp_Orcei_Gladiatores_race,AE_stf_minotaurs_race,AE_stf_minotaurs_Gnoll_race,AE_FL_bloodelf_Minotaur
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_orc yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=merman,naga,AE_arc_race_dogukian,AE_arc_race_south_seas_human,AE_ext_monsters_seacreatures,AE_myh_dryad,AE_RHY_aquana,AE_stf_triththa_cuttlefish
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_fish yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=goblin,gobmon
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_goblin yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=AE_ele_centaur,AE_mie_centaur
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_centaur yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=AE_arc_race_primeval,AE_arc_magnellian,AE_roswellian,AE_arc_race_khthon
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_allien yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=AE_bem_anakes_race,AE_chs_demon,AE_chs_shaxthal,AE_ele_fallen,AE_ext_chaos_demon_race,AE_mrc_infernai_race,AE_chs_imps
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_demon yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=AE_dep_deep_elf,AE_efm_pygmies,AE_ext_dark_elves_race,AE_FGTNL_mrocznyelf,AE_mag_tharis,AE_RHY_darkelf,eoma_tharis,AE_mie_vampire
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_dark_elf yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=bats,horse,gryphon,monster,wolf,AE_arc_race_dogukian,AE_ext_dark_elves_wyrm_race,AE_ext_monsters_monster,AE_ext_monsters_seacreatures,AE_imp_Sidhe_Bear,AE_mag_roc,AE_mrc_equestrians_race,AE_RHY_roc,AE_RHY_animal,jastrzab,krokodyl,eoma_roc
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_animal yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=bats,gryphon,AE_mag_roc,AE_RHY_roc,jastrzab,eoma_roc,AE_fut_welkin,AE_mrc_avians_race,AE_RHY_angel,AE_agl_harpy
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_aerial yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=AE_mrc_hive_race
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_insect yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			race=wolf,AE_myh_warg
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.is_warg yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			[has_attack]
				special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive,marksman,AE_mag_marksman_greater,AE_mag_skilled,AE_chs_aimed
			[/has_attack]
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_cth_special yes}
		[/then]
	[/if]

	[if]
		[have_unit]
			id=$unit.id
			ability=AE_mrc_bloodlust,AE_mag_bloodlust2,AE_mag_bloodlust3,AE_mag_bloodlust4,AE_mag_bloodlust5,AE_mag_bloodlust6,AE_mag_bloodlust8,eoma_bloodlust3,eoma_bloodlust4,eoma_bloodlust5,eoma_bloodlust6,eoma_bloodlust8
			count=1
		[/have_unit]
		[then]
			{VARIABLE qquws_amla_data.has_bloodlust yes}
		[/then]
	[/if]
#enddef

#define ADD_UWS_AMLA_MOD
	[switch]
		variable=amla_buff.key
		[case]
			value=REGEN
			
			{AMLA_MOD_UNIT uws_amla_regen_1 1 30 "Regen +10" "icons/herb-bag.png" (
				[effect]
					apply_to=remove_ability
					[abilities]
						[regenerate]
							id=regenerates
						[/regenerate]
						[regenerate]
							id=AE_mag_regenerates8
						[/regenerate]
						[regenerate]
							id=eoma_regenerates8
						[/regenerate]
					[/abilities]
				[/effect]
				[effect]
				    apply_to=new_ability
				    [abilities]
						[regenerate]
							value=10
							id=amla_regenerates
							name="regenerates 10"
							description="The unit will heal itself 10hp per turn. If it is poisoned, it will remove the poison instead of healing."
							affect_self=yes
							poison=cured
						[/regenerate]
				    [/abilities]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_regen_2 1 60 "Regen +12" "icons/herb-bag.png" (
				require_amla=uws_amla_regen_1
				[effect]
					apply_to=remove_ability
					[abilities]
						[regenerate]
							id=amla_regenerates
						[/regenerate]
					[/abilities]
				[/effect]
				[effect]
				    apply_to=new_ability
				    [abilities]
						[regenerate]
							value=12
							id=amla_regenerates
							name="regenerates 12"
							description="The unit will heal itself 12hp per turn. If it is poisoned, it will remove the poison instead of healing."
							affect_self=yes
							poison=cured
						[/regenerate]
				    [/abilities]
				[/effect]
			)}
		[/case]

		[case]
			value=MINI_REG
			
			{AMLA_MOD_UNIT uws_amla_mini_regen 1 30 "Regen +4" "icons/herb-bag.png" (
				[effect]
					apply_to=remove_ability
					[abilities]
						[regenerate]
							id=regenerates
						[/regenerate]
						[regenerate]
							id=AE_mag_regenerates8
						[/regenerate]
						[regenerate]
							id=eoma_regenerates8
						[/regenerate]
					[/abilities]
				[/effect]
				[effect]
				    apply_to=new_ability
				    [abilities]
						[regenerate]
							value=4
							id=amla_mini_regenerates
							name="regenerates 4"
							description="The unit will heal itself 4hp per turn. If it is poisoned, it will remove the poison instead of healing."
							affect_self=yes
							poison=cured
						[/regenerate]
				    [/abilities]
				[/effect]
			)}
		[/case]

		[case]
			value=R_DMG
			
			{AMLA_MOD_UNIT uws_amla_ranged_dmg 3 30 "Ranged damage +10%" "icons/hat-huntsman.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    increase_damage=10%
				[/effect]
			)}
		[/case]

		[case]
			value=R_STR
			
			{AMLA_MOD_UNIT uws_amla_ranged_strike_1 1 50 "Ranged strike (defense)" "icons/hat-huntsman.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    [set_specials]
				    	mode=append
						[attacks]
							id=qquws_fast_reflex
							name="fast reflex"
							description="Adds 1 strike when defending."
							active_on=defense
							add=1
						[/attacks]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_ranged_strike_2 1 75 "Ranged strike (always)" "icons/hat-huntsman.png" (
				require_amla=uws_amla_ranged_strike_1
				[effect]
				    apply_to=attack
				    range=ranged
				    remove_specials=qquws_fast_reflex
				    increase_attacks=1
				[/effect]
			)}
		[/case]

		[case]
			value=R_MAG_ACC
			
			{AMLA_MOD_UNIT uws_amla_ranged_mag_acc_1 1 40 "Ranged magical 75%" "icons/ring_gold.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    special_id=magical
				    remove_specials=magical
				    [set_specials]
				    	mode=append
						[chance_to_hit]
					        id=magical
					        name="magical 75%"
					        description="This attack always has a 75% chance to hit regardless of the defensive ability of the unit being attacked."
					        value=75
					        cumulative=no
					    [/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_ranged_mag_acc_2 1 80 "Ranged magical 80%" "icons/ring_gold.png" (
				require_amla=uws_amla_ranged_mag_acc_1
				[effect]
				    apply_to=attack
				    range=ranged
				    special_id=magical
				    remove_specials=magical
				    [set_specials]
				    	mode=append
						[chance_to_hit]
					        id=magical
					        name="magical 80%"
					        description="This attack always has a 80% chance to hit regardless of the defensive ability of the unit being attacked."
					        value=80
					        cumulative=no
					    [/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=R_ACC
			
			{AMLA_MOD_UNIT uws_amla_ranged_acc_1 1 35 "Ranged accuracy +5%" "icons/hat-huntsman.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_accuracy=5
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_ranged_mag_acc_2 1 60 "Ranged accuracy +10%" "icons/hat-huntsman.png" (
				require_amla=uws_amla_ranged_acc_1
				[effect]
				    apply_to=attack
				    range=ranged
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_accuracy=5
				[/effect]
			)}
		[/case]

		[case]
			value=R_PAR
			
			{AMLA_MOD_UNIT uws_amla_ranged_parry 1 30 "Ranged parry +5%" "icons/hat-huntsman.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_parry=5
				[/effect]
				[effect]
				    apply_to=attack
				    range=ranged
				    special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [set_specials]
				    	mode=append
				    	[chance_to_hit]
							id=qquws_magical_fog
							sub=5
							name="mind fog"
							description="When this attack is used, opponent's magical chance to hit is reduced by 5%."
							apply_to=opponent
							cumulative=no
							[filter_opponent]
								[filter_weapon]
									special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
								[/filter_weapon]
							[/filter_opponent]
						[/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=M_DMG
			
			{AMLA_MOD_UNIT uws_amla_melee_dmg 3 30 "Melee damage +10%" "icons/crossed_sword_and_hammer.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    increase_damage=10%
				[/effect]
			)}
		[/case]

		[case]
			value=M_STR
			
			{AMLA_MOD_UNIT uws_amla_melee_strike_1 1 70 "Melee strike (defense)" "icons/crossed_sword_and_hammer.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    [set_specials]
				    	mode=append
						[attacks]
							id=qquws_fast_reflex
							name="fast reflex"
							description="Adds 1 strike when defending."
							active_on=defense
							add=1
						[/attacks]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_strike_2 1 40 "Melee strike (always)" "icons/crossed_sword_and_hammer.png" (
				require_amla=uws_amla_melee_strike_1
				[effect]
				    apply_to=attack
				    range=melee
				    remove_specials=qquws_fast_reflex
				    increase_attacks=1
				[/effect]
			)}
		[/case]

		[case]
			value=M_MAG_ACC
			
			{AMLA_MOD_UNIT uws_amla_melee_mag_acc_1 1 40 "Melee magical 75%" "icons/crossed_sword_and_hammer.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    special_id=magical
				    remove_specials=magical
				    [set_specials]
				    	mode=append
						[chance_to_hit]
					        id=magical
					        name="magical 75%"
					        description="This attack always has a 75% chance to hit regardless of the defensive ability of the unit being attacked."
					        value=75
					        cumulative=no
					    [/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_mag_acc_2 1 60 "Melee magical 80%" "icons/crossed_sword_and_hammer.png" (
				require_amla=uws_amla_melee_mag_acc_1
				[effect]
				    apply_to=attack
				    range=melee
				    special_id=magical
				    remove_specials=magical
				    [set_specials]
				    	mode=append
						[chance_to_hit]
					        id=magical
					        name="magical 80%"
					        description="This attack always has a 80% chance to hit regardless of the defensive ability of the unit being attacked."
					        value=80
					        cumulative=no
					    [/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_mag_acc_3 1 80 "Melee magical 85%" "icons/crossed_sword_and_hammer.png" (
				require_amla=uws_amla_melee_mag_acc_2
				[effect]
				    apply_to=attack
				    range=melee
				    special_id=magical
				    remove_specials=magical
				    [set_specials]
				    	mode=append
						[chance_to_hit]
					        id=magical
					        name="magical 85%"
					        description="This attack always has a 85% chance to hit regardless of the defensive ability of the unit being attacked."
					        value=85
					        cumulative=no
					    [/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=M_ACC
			
			{AMLA_MOD_UNIT uws_amla_melee_acc_1 1 40 "Melee accuracy +5%" "icons/crossed_sword_and_hammer.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_accuracy=5
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_acc_2 1 70 "Melee accuracy +10%" "icons/crossed_sword_and_hammer.png" (
				require_amla=uws_amla_melee_acc_1
				[effect]
				    apply_to=attack
				    range=melee
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_accuracy=5
				[/effect]
			)}
		[/case]

		[case]
			value=M_PAR
			
			{AMLA_MOD_UNIT uws_amla_melee_parry_1 1 30 "Melee parry +5%" "icons/crossed_sword_and_hammer.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_parry=5
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_parry_2 1 50 "Melee parry +10%" "icons/crossed_sword_and_hammer.png" (
				require_amla=uws_amla_melee_parry_1
				[effect]
				    apply_to=attack
				    range=melee
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_parry=5
				[/effect]
			)}
		[/case]

		[case]
			value=SMALL_SPEED
			
			{AMLA_MOD_UNIT uws_amla_small_speed 1 15 "Movement costs -1" "icons/boots_elven.png" (
				[effect]
				    apply_to=movement_costs
				    replace=no
				    [movement_costs]
						flat=-1
						frozen=-1
						forest=-1
						hills=-1
						mountains=-1
						village=-1
						swamp_water=-1
						shallow_water=-1
						deep_water=-1
						reef=-1
						castle=-1
						cave=-1
						sand=-1
						fungus=-1
				    [/movement_costs]
				[/effect]
			)}
		[/case]

		[case]
			value=SPEED
			
			# speed is always presented with small_speed due to the rules
			{AMLA_MOD_UNIT uws_amla_speed_2 1 25 "MP +1" "icons/boots_elven.png" (
				require_amla=uws_amla_small_speed
				[effect]
				    apply_to=movement
				    increase=1
				[/effect]
			)}
		[/case]

		[case]
			value=EXTRA_MP
			
			{AMLA_MOD_UNIT uws_amla_extra_mp 2 25 "MP +1" "icons/boots_elven.png" (
				[effect]
				    apply_to=movement
				    increase=1
				[/effect]
			)}
		[/case]

		[case]
			value=LOW_XP
			
			{AMLA_MOD_UNIT uws_amla_max_xp_reduction 1 "-40%" "" "icons/letter_and_ale.png" ()}
		[/case]

		[case]
			value=PHYS_RES
			
			{AMLA_MOD_UNIT uws_amla_phys_res 2 15 "Physical resistance +5%" "icons/shield_tower_merfolk.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						blade=-5
						impact=-5
						pierce=-5
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=ARCANE_RES
			
			{AMLA_MOD_UNIT uws_amla_arcane_res 2 25 "Arcane resistance +15%" "icons/skull_ring.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						arcane=-15
				    [/resistance]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_arcane_res_x 1 25 "Arcane and Secret resistance +10%" "icons/skull_ring.png" (
			require_amla=uws_amla_arcane_res
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						arcane=-10
						secret=-10
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=NIGHT_EXTRA_DMG
			
			{AMLA_MOD_UNIT uws_amla_night_dmg_1 1 25 "Night damage +15% on offense" "icons/uws/cloak_black.png" (
				[effect]
				    apply_to=attack
				    remove_specials=qquws_evil_attack
				    [set_specials]
				    	mode=append
						[damage]
					        id=qquws_evil_attack
					        name="evil 15%"
					        description="This attack deals additional 15% damage on offense when used at nighttime."
					        multiply=1.15
					        apply_to=self
					        active_on=offense
					        [filter_self]
					        	[filter_location]
					        		time_of_day=chaotic
					        	[/filter_location]
					        [/filter_self]
					    [/damage]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_night_dmg_2 1 60 "Night damage +30% on offense" "icons/uws/cloak_black.png" (
				require_amla=uws_amla_night_dmg_1
				[effect]
				    apply_to=attack
				    remove_specials=qquws_evil_attack
				    [set_specials]
				    	mode=append
						[damage]
					        id=qquws_evil_attack
					        name="evil 30%"
					        description="This attack deals additional 30% damage on offense when used at nighttime."
					        multiply=1.3
					        apply_to=self
					        active_on=offense
					        [filter_self]
					        	[filter_location]
					        		time_of_day=chaotic
					        	[/filter_location]
					        [/filter_self]
					    [/damage]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=ELEM_RES
			
			{AMLA_MOD_UNIT uws_amla_elem_res 2 20 "Fire and Cold resistance +10%" "icons/jewelry_necklace_amber.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						fire=-10
						cold=-10
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=ELEM_HEAL_ON_HIT
			
			{AMLA_MOD_UNIT uws_amla_elem_hoh_1 1 25 "Heal on hit +1" "icons/ankh_necklace.png" (
				[effect]
				     apply_to=attack
				     remove_specials=qquws_amla_heals_on_hit
				     [set_specials]
				    	  mode=append
				     	  [heal_on_hit]
							id=qquws_amla_heals_on_hit
							name="heals on hit +1"
							description="Each landing hit causes this unit to heal 1 hitpoint."
							value=1
							apply_to=self
						  [/heal_on_hit] 
				     [/set_specials]
				 [/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_elem_hoh_2 1 70 "Heal on hit +2" "icons/ankh_necklace.png" (
				require_amla=uws_amla_elem_hoh_1
				[effect]
				     apply_to=attack
				     remove_specials=qquws_amla_heals_on_hit
				     [set_specials]
				    	  mode=append
				     	  [heal_on_hit]
							id=qquws_amla_heals_on_hit
							name="heals on hit +2"
							description="Each landing hit causes this unit to heal 2 hitpoints."
							value=2
							apply_to=self
						  [/heal_on_hit] 
				     [/set_specials]
				 [/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_elem_hoh_3 1 90 "Heal on hit +3" "icons/ankh_necklace.png" (
				require_amla=uws_amla_elem_hoh_2
				[effect]
				     apply_to=attack
				     remove_specials=qquws_amla_heals_on_hit
				     [set_specials]
				    	  mode=append
				     	  [heal_on_hit]
							id=qquws_amla_heals_on_hit
							name="heals on hit +3"
							description="Each landing hit causes this unit to heal 3 hitpoints."
							value=3
							apply_to=self
						  [/heal_on_hit] 
				     [/set_specials]
				 [/effect]
			)}
		[/case]

		[case]
			value=VIL_CASTLE_DEF
			
			{AMLA_MOD_UNIT uws_amla_hum_def 2 10 "Village and Castle defense +5%" "icons/uws/shield_kite.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						village=-5
						castle=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=FOREST_DEF
			
			{AMLA_MOD_UNIT uws_amla_forest_def 1 25 "Forest defense +5%" "icons/uws/armor_dragon.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						forest=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=ELF_R_ACC
			
			{AMLA_MOD_UNIT uws_amla_ranged_mag_acc_3 2 15 "Elvish ranged accuracy +5%" "icons/uws/bow.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_accuracy=5
				[/effect]
			)}
		[/case]

		[case]
			value=ELF_M_ACC
			
			{AMLA_MOD_UNIT uws_amla_melee_mag_acc_3 1 10 "Elvish melee accuracy +5%" "icons/crossed_sword_and_hammer.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_accuracy=5
				[/effect]
			)}
		[/case]

		[case]
			value=ELF_R_PAR
			
			{AMLA_MOD_UNIT uws_amla_ranged_parry 3 5 "Elvish ranged parry +5%" "icons/hat-huntsman.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    [not]
				    	special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
				    [/not]
				    increase_parry=5
				[/effect]
			)}
		[/case]

		[case]
			value=CAVE_MOUNT_DEF
			
			{AMLA_MOD_UNIT uws_amla_dwarf_def 2 5 "Mountains and Caves defense +5%" "icons/stone_ring.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						cave=-5
						mountains=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=DWARF_DMG
			
			{AMLA_MOD_UNIT uws_amla_dwarf_dmg 1 35 "Melee damage +20%" "icons/uws/dwarf_juice.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    increase_damage=20%
				[/effect]
			)}
		[/case]

		[case]
			value=CAVE_HILLS_DEF
			
			{AMLA_MOD_UNIT uws_amla_troll_def 2 10 "Caves and Hills defense +5%" "icons/bag.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						cave=-5
						hills=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=TROLL_DMG
			
			{AMLA_MOD_UNIT uws_amla_troll_dmg 1 40 "Damage +20%" "icons/uws/charm.png" (
				[effect]
				    apply_to=attack
				    increase_damage=20%
				[/effect]
			)}
		[/case]

		[case]
			value=IMPACT_RES
			
			{AMLA_MOD_UNIT uws_amla_impact_res 2 10 "Impact resistance +15%" "icons/shield_tower.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						impact=-15
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=BLADE_RES
			
			{AMLA_MOD_UNIT uws_amla_blade_res 2 10 "Blade resistance +15%" "icons/orc_roundshield.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						blade=-15
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=IMPACT_PIERCE_RES
			
			{AMLA_MOD_UNIT uws_amla_wose_res 2 15 "Impact and Pierce resistance +10%" "icons/jewelry_necklace_amber.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						impact=-10
						pierce=-10
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=WOSE_DMG
			
			{AMLA_MOD_UNIT uws_amla_wose_dmg 2 30 "Melee damage +15%" "icons/uws/charm.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    increase_damage=15%
				[/effect]
			)}
		[/case]

		[case]
			value=SAND_CASTLE_DEF
			
			{AMLA_MOD_UNIT uws_amla_drake_def 2 5 "Sand and Castle defense +5%" "icons/circlet_winged.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						sand=-5
						castle=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=PIERCE_RES
			
			{AMLA_MOD_UNIT uws_amla_pierce_res 2 15 "Pierce resistance +15%" "icons/cuirass_muscled.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						pierce=-15
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=SWAMP_FLAT_DEF
			
			{AMLA_MOD_UNIT uws_amla_saurian_def 2 20 "Flat and Swamp defense +5%" "icons/shield_polished.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						flat=-5
						swamp_water=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=COLD_RES
			
			{AMLA_MOD_UNIT uws_amla_cold_res 2 15 "Cold resistance +15%" "icons/tunic_green.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						cold=-15
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=NIGHT_EXTRA_STRIKE
			
			{AMLA_MOD_UNIT uws_amla_night_strike 1 70 "Night +1 strike (offense)" "icons/uws/axe_rusty.png" (
				[effect]
				    apply_to=attack
				    [set_specials]
				    	mode=append
						[attacks]
							id=qquws_vicious
							name="barbarous"
							description="Adds 1 strike when attacking during nighttime."
							active_on=offense
							apply_to=self
							add=1
							[filter_self]
								[filter_location]
									time_of_day_id=first_watch,midnight,second_watch
								[/filter_location]
							[/filter_self]
						[/attacks]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=NIGHT_EXTRA_MP
			
			{AMLA_MOD_UNIT uws_amla_night_mp 1 30 "Night +2mp" "icons/uws/boots_officer.png" (
				[effect]
				    apply_to=new_ability
				    [abilities]
						[dummy]
							id=qquws_night_instigator
							name="instigator"
							description="This unit gains one extra two movement points during nighttime."
						[/dummy]
				    [/abilities]
				[/effect]
			)}

			{VARIABLE register_uws_special "night_instigator_special"}
		[/case]

		[case]
			value=WATER_DEF
			
			{AMLA_MOD_UNIT uws_amla_water_def 2 10 "Water defense +5%" "icons/orc_roundshield.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						shallow_water=-5
						deep_water=-5
						reef=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=FISH_FLAT_DEF
			
			{AMLA_MOD_UNIT uws_amla_fish_flat_def 3 15 "Flat defense +5%" "icons/uws/cuirass_fiber.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						flat=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=HILLS_MOUNT_DEF
			
			{AMLA_MOD_UNIT uws_amla_goblin_def 2 15 "Hills and Mountains defense +5%" "icons/goblin_def.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						hills=-5
						mountains=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=FLAT_HILLS_DEF
			
			{AMLA_MOD_UNIT uws_amla_centaur_def 2 15 "Flat and Hills defense +5%" "attacks/hoof.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						hills=-5
						flat=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=R_HIT_AND_RUN_1
			
			{AMLA_MOD_UNIT uws_amla_ranged_har 1 40 "Hit and Run +1 on ranged" "attacks/bow-short.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    [set_specials]
				    	mode=append
						[dummy]
							id=qquws_weapon_hit_and_run
							name="hit and run +1"
							description="After attacking this unit can move back. If the unit already has hit and run ability then using this weapon adds another movement point after attacking."
						[/dummy]
				    [/set_specials]
				[/effect]
			)}

			{VARIABLE register_uws_special "weapon_hit_and_run_special"}
		[/case]

		[case]
			value=ARCANE_SECRET_RES
			
			{AMLA_MOD_UNIT uws_amla_alien_res 4 15 "Arcane and Secret resistance +10%" "icons/uws/secret_charm.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						arcane=-10
						secret=-10
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=M_CTH_MARKSMAN
			
			{AMLA_MOD_UNIT uws_amla_melee_skilled 1 50 "Melee marksman" "attacks/gaze.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    [not]
				    	special_id=magical,AE_mag_skilled,marksman,eoma_skilled
				    [/not]
				    [set_specials]
				    	mode=append
						[chance_to_hit]
					        id=marksman
					        name="marksman"
					        description="When used offensively, this attack always has at least a 60% chance to hit."
					        value=60
					        cumulative=yes
					        active_on=offense
					    [/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=R_CTH_MARKSMAN
			
			{AMLA_MOD_UNIT uws_amla_ranged_skilled 1 60 "Ranged marksman" "attacks/gaze.png" (
				[effect]
				    apply_to=attack
				    range=ranged
				    [not]
				    	special_id=magical,AE_mag_skilled,marksman,eoma_skilled
				    [/not]
				    [set_specials]
				    	mode=append
						[chance_to_hit]
					        id=marksman
					        name="marksman"
					        description="When used offensively, this attack always has at least a 60% chance to hit."
					        value=60
					        cumulative=yes
					        active_on=offense
					    [/chance_to_hit]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=COLD_ARCANE_RES
			
			{AMLA_MOD_UNIT uws_amla_demon_cold_arcane_res 2 20 "Arcane and Cold resistance +10%" "attacks/magic-missile.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						arcane=-10
						cold=-10
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=BLOODLUST
			
			{AMLA_MOD_UNIT uws_amla_bloodlust_1 1 40 "Bloodlust +3" "icons/uws/bloodlust.png" (
				[effect]
				    apply_to=new_ability
				    [abilities]
						[dummy]
					        id=qquws_bloodlust3
					        name="bloodlust +3"
					        description="This unit gains 3 hitpoints added to its current health whenever it kills a living unit."
					    [/dummy]
				    [/abilities]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_bloodlust_2 1 40 "Bloodlust +6" "icons/uws/bloodlust.png" (
				require_amla=uws_amla_bloodlust_1
				[effect]
					apply_to=remove_ability
					[abilities]
						[dummy]
							id=qquws_bloodlust3
						[/dummy]
					[/abilities]
				[/effect]
				[effect]
				    apply_to=new_ability
				    [abilities]
						[dummy]
					        id=qquws_bloodlust6
					        name="bloodlust +6"
					        description="This unit gains 6 hitpoints added to its current health whenever it kills a living unit."
					    [/dummy]
				    [/abilities]
				[/effect]
			)}

			{VARIABLE register_uws_special "bloodlust_special"}
		[/case]

		[case]
			value=BIG_BLOODLUST
			
			{AMLA_MOD_UNIT uws_amla_big_bloodlust_1 1 40 "Bloodlust +6" "icons/uws/bloodlust.png" (
				[effect]
					apply_to=remove_ability
					[abilities]
						[dummy]
							id=AE_mag_bloodlust3
						[/dummy]
						[dummy]
							id=AE_mag_bloodlust4
						[/dummy]
						[dummy]
							id=AE_mag_bloodlust5
						[/dummy]
					[/abilities]
				[/effect]
				[effect]
				    apply_to=new_ability
				    [abilities]
						[dummy]
					        id=qquws_bloodlust6
					        name="bloodlust +6"
					        description="This unit gains 6 hitpoints added to its current health whenever it kills a living unit."
					    [/dummy]
				    [/abilities]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_big_bloodlust_2 1 70 "Bloodlust +9" "icons/uws/bloodlust.png" (
				require_amla=uws_amla_big_bloodlust_1
				[effect]
					apply_to=remove_ability
					[abilities]
						[dummy]
							id=qquws_bloodlust6
						[/dummy]
					[/abilities]
				[/effect]
				[effect]
				    apply_to=new_ability
				    [abilities]
						[dummy]
					        id=qquws_bloodlust9
					        name="bloodlust +9"
					        description="This unit gains 9 hitpoints added to its current health whenever it kills a living unit."
					    [/dummy]
				    [/abilities]
				[/effect]
			)}

			{VARIABLE register_uws_special "bloodlust_special"}
		[/case]

		[case]
			value=BIG_HITPOINTS
			
			{AMLA_MOD_UNIT uws_amla_big_hp 2 50 "Hitpoints +20%" "icons/ankh_necklace.png" (
				[effect]
					apply_to=hitpoints
					heal_full=yes
					increase_total=20%
				[/effect]
			)}
		[/case]

		[case]
			value=MINI_DEF_EVERYWHERE
			
			{AMLA_MOD_UNIT uws_amla_all_def 1 75 "Defense everywhere +5%" "icons/jewelery_butterfly_pin.png" (
				[effect]
					apply_to=defense
					replace=no
					[defense]
						flat=-5
						frozen=-5
						forest=-5
						hills=-5
						mountains=-5
						village=-5
						swamp_water=-5
						shallow_water=-5
						deep_water=-5
						reef=-5
						castle=-5
						cave=-5
						sand=-5
						fungus=-5
					[/defense]
				[/effect]
			)}
		[/case]

		[case]
			value=FIRE_RES
			
			{AMLA_MOD_UNIT uws_amla_fire_res 2 15 "Fire resistance +15%" "icons/potion_red_small.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						fire=-15
				    [/resistance]
				[/effect]
			)}
		[/case]

		[case]
			value=M_RABID_ATTACK

			{AMLA_MOD_UNIT uws_amla_melee_rabid_1 1 15 "Melee Poison" "attacks/fangs.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    remove_specials=poison
				    [set_specials]
				    	mode=append
						[poison]
					        id=poison
					        name="poison"
					        description="This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit."
					    [/poison]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_rabid_2 1 40 "Melee Rabid 5%" "attacks/fangs.png" (
				require_amla=uws_amla_melee_rabid_1
				[effect]
				    apply_to=attack
				    range=melee
				    [set_specials]
				    	mode=append
						[damage]
			                id=qquws_rabid
			                name="rabid 5%"
			                description="The more wounded this unit is the more damage this attack deals. Damage dealt is 5% higher per every 10% hitpoints missing."
			                multiply="( 1.0 + 0.05 * floor( 10.0 * (self.max_hitpoints - self.hitpoints + 0.5) / self.max_hitpoints ) )"
			                apply_to=self
			            [/damage]
				    [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_rabid_3 1 70 "Melee Rabid 9%" "attacks/fangs.png" (
				require_amla=uws_amla_melee_rabid_2
				[effect]
				    apply_to=attack
				    range=melee
				    remove_specials=qquws_rabid
				    [set_specials]
				    	mode=append
						[damage]
			                id=qquws_rabid
			                name="rabid 9%"
			                description="The more wounded this unit is the more damage this attack deals. Damage dealt is 9% higher per every 10% hitpoints missing."
			                multiply="( 1.0 + 0.09 * floor( 10.0 * (self.max_hitpoints - self.hitpoints + 0.5) / self.max_hitpoints ) )"
			                apply_to=self
			            [/damage]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=DWARF_DEFENSIVE_STANCE
			
			{AMLA_MOD_UNIT uws_amla_dwarf_defensive_stance 1 50 "Defensive stance 10%" "icons/shield_tower.png" (
				[effect]
				    apply_to=new_ability
				    [abilities]
						[resistance]
							id=amla_defensive_stance
							add=10
							max_value=50
							name="defensive stance 10"
							description="This unit’s gains extra 10% physical resistance whenever defending, up to maximum 50%."
							affect_self=yes
							active_on=defense
							apply_to=blade,impact,pierce
						[/resistance]
				    [/abilities]
				[/effect]
			)}
		[/case]

		[case]
			value=MELEE_VISCIOUS

			{AMLA_MOD_UNIT uws_amla_melee_viscious_1 1 30 "Melee viscious +10%" "attacks/fist-troll.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    [set_specials]
				    	mode=append
					    [damage]
			                id=qquws_viscious_damage
			                name="viscious 10%"
			                description="When attacking this unit deals 10% more damage."
			                multiply=1.1
			                apply_to=attacker
			                active_on=offense
			            [/damage]
				     [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_viscious_2 1 50 "Melee viscious +20%" "attacks/fist-troll.png" (
				require_amla=uws_amla_melee_viscious_1
				[effect]
				    apply_to=attack
				    remove_specials=qquws_viscious_damage
				    range=melee
				    [set_specials]
				    	mode=append
					    [damage]
			                id=qquws_viscious_damage
			                name="viscious 20%"
			                description="When attacking this unit deals 20% more damage."
			                multiply=1.2
			                apply_to=attacker
			                active_on=offense
			            [/damage]
				     [/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_melee_viscious_3 1 60 "Melee viscious +30%" "attacks/fist-troll.png" (
				require_amla=uws_amla_melee_viscious_2
				[effect]
				    apply_to=attack
				    remove_specials=qquws_viscious_damage
				    range=melee
				    [set_specials]
				    	mode=append
					    [damage]
			                id=qquws_viscious_damage
			                name="viscious 30%"
			                description="When attacking this unit deals 30% more damage."
			                multiply=1.3
			                apply_to=attacker
			                active_on=offense
			            [/damage]
				     [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=ATTACK_OFFENSIVE_STANCE
			
			{AMLA_MOD_UNIT uws_amla_attack_defensive_stance 1 60 "Offensive stance 15%" "attacks/hammer-troll.png" (
				[effect]
				    apply_to=new_ability
				    [abilities]
						[resistance]
							id=amla_offensive_stance
							add=15
							max_value=65
							name="offensive stance 15"
							description="This unit’s gains extra 15% physical resistance whenever attacking, up to maximum 65%."
							affect_self=yes
							active_on=offense
							apply_to=blade,impact,pierce
						[/resistance]
				    [/abilities]
				[/effect]
			)}
		[/case]

		[case]
			value=SLOW_IMMUNE
			
			{AMLA_MOD_UNIT uws_amla_slow_immune 1 40 "Immune to slow" "icons/jewelry_butterfly_pin.png" (
				[effect]
					apply_to=new_ability
					[abilities]
						[dummy]
							id=qquws_unslowable
							name="unslowable"
							description="This unit cannot be slowed."
						[/dummy]
					[/abilities]
				[/effect]
				[effect]
					apply_to=status
 					add=unslowable
  				[/effect]
			)}
		[/case]

		[case]
			value=QUICK_FIGHT_RECOVERY
			
			{AMLA_MOD_UNIT uws_amla_quick_recovery 1 90 "Fight recovery" "icons/herb-bag.png" (
				[effect]
				    apply_to=new_ability
				    [abilities]
						[dummy]
				            id=qquws_amla_fight_recovery
				            name="fight recovery"
				            description="Each time this unit comes out of a fight it removes poison, slow and petrified debuffs."
				        [/dummy]
				    [/abilities]
				[/effect]
			)}

			{VARIABLE register_uws_special "amla_fight_recovery_special"}
		[/case]

		[case]
			value=BACKSTAB_RANGED
			
			{AMLA_MOD_UNIT uws_amla_backstab_ranged_1 1 40 "Ranged backstab x1.35" "attacks/stinger-dragonfly.png" (
				[effect]
					apply_to=attack
					range=ranged
					[set_specials]
						mode=append
						[damage]
							id=amla_backstab
							name="backstab x1.35"
							description="When used offensively, this attack deals 35% more damage if there is an enemy of the target on the opposite side of the target, and that unit is not incapacitated (turned to stone or otherwise paralyzed)."
							multiply=1.35
							active_on=offense
							[filter_opponent]
							    formula="
								enemy_of(self, flanker) and not flanker.petrified
							    where
								flanker = unit_at(direction_from(loc, other.facing))
							    "
							[/filter_opponent]
						[/damage]
					[/set_specials]
				[/effect]
			)}

			{AMLA_MOD_UNIT uws_amla_backstab_ranged_2 1 90 "Ranged backstab x1.75" "attacks/stinger-dragonfly.png" (
			require_amla=uws_amla_backstab_ranged_1
				[effect]
					apply_to=attack
					range=ranged
					remove_specials=amla_backstab
					[set_specials]
						mode=append
						[damage]
							id=amla_backstab
							name="backstab x1.75"
							description="When used offensively, this attack deals 75% more damage if there is an enemy of the target on the opposite side of the target, and that unit is not incapacitated (turned to stone or otherwise paralyzed)."
							multiply=1.75
							active_on=offense
							[filter_opponent]
							    formula="
								enemy_of(self, flanker) and not flanker.petrified
							    where
								flanker = unit_at(direction_from(loc, other.facing))
							    "
							[/filter_opponent]
						[/damage]
					[/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=STRONG_POISON
			
			{AMLA_MOD_UNIT uws_amla_strong_poison 1 60 "Debilitating poison" "attacks/staff-green.png" (
				[effect]
					apply_to=attack
					special_id=poison
					[set_specials]
				    	mode=append
				    	[dummy]
							id=qquws_debilitating_poison
							name="debilitating poison"
							description="This type of poison removes the affected unit's ability to regenerate and heal other units for one turn. It can still be cured by other units. Active only in offense."
						[/dummy]
				    [/set_specials]
				[/effect]
			)}

			{VARIABLE register_uws_special "debilitating_poison_special"}
		[/case]

		[case]
			value=MELEE_DUEL
			
			{AMLA_MOD_UNIT uws_amla_melee_duel 1 120 "Melee duel" "attacks/sword-human.png" (
				[effect]
				    apply_to=attack
				    range=melee
				    [set_specials]
				    	mode=append
				    	[berserk]
							id=berserk_duel2
							name="duel 2"
							description="When attacking, this unit presses the engagement and can fight for two rounds."
							value=2
							active_on=offense
						[/berserk]
				    [/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=SMALL_DRAINS
			
			{AMLA_MOD_UNIT uws_amla_small_drains 1 80 "Drains 25% on offense" "attacks/touch-undead.png" (
				[effect]
					apply_to=attack
					[not]
						special_id=drains
					[/not]
					[set_specials]
						mode=append
						[drains]
							id=amla_drains
							name="drains 25%"
							value=25
							description="This unit drains health from living units, healing itself for 25% of the amount of damage it deals (rounded down)."
							active_on=offense
						[/drains]
					[/set_specials]
				[/effect]
			)}
		[/case]

		[case]
			value=BLADE_FIRE_RES
			
			{AMLA_MOD_UNIT uws_amla_elem_res 1 15 "Fire and Blade resistance +10%" "icons/jewelry_necklace_amber.png" (
				[effect]
				    apply_to=resistance
				    replace=no
				    [resistance]
						fire=-10
						blade=-10
				    [/resistance]
				[/effect]
			)}
		[/case]
	[/switch]
#enddef

#define AMLA_MOD_UNIT UWS_AMLA_ID MAX_TIMES XP_CHANGE DESCRIPTION IMAGE EFFECT_WML
	{VARIABLE max_exp_value {XP_CHANGE}}
	{VARIABLE max_exp_text ". max experience <span color='#e39286'>+$max_exp_value</span>"}

	[if]
		[variable]
			name=max_exp_value
			contains="%"
		[/variable]
		[then]
			{VARIABLE max_exp_text "Reduce max experience <span color='#96e386'>$max_exp_value</span>"}
		[/then]
	[/if]

	[modify_unit]
		[filter]
			id=$unit.id
		[/filter]

		[object]
			silent=yes

			[effect]
				apply_to=new_advancement
				replace=no
				[advancement]
					id={UWS_AMLA_ID}
					always_display=yes
					description={DESCRIPTION}"$max_exp_text
"
					image={IMAGE}
					max_times={MAX_TIMES}
					strict_amla=yes
					major_amla=no
					{EFFECT_WML}
					[effect]
						apply_to=hitpoints
						heal_full=yes
					[/effect]
					[effect]
						apply_to=max_experience
						increase={XP_CHANGE}
					[/effect]
					[effect]
			            apply_to=status
			            remove=poisoned
			        [/effect]
			        [effect]
			            apply_to=status
			            remove=slowed
			        [/effect]
				[/advancement]
			[/effect]
		[/object]
	[/modify_unit]
#enddef

#define ADD_DEFAULT_UWS_AMLA
	[modify_unit]
		[filter]
			id=$unit.id
		[/filter]

		[variables]
			has_uws_amla_defined=yes
		[/variables]

		[object]
			silent=yes

			[effect]
				apply_to=remove_advancement
				amlas=amla_default
			[/effect]

			[effect]
				apply_to=new_advancement
				replace=no
				[advancement]
					id=uws_default_amla
					always_display=no
					description="Max hp <span color='#96e386'>+10%</span>, max experience <span color='#e39286'>+20%</span>
"
					image="icons/amla-default.png"
					max_times=-1
					strict_amla=yes
					major_amla=no
					[effect]
						apply_to=hitpoints
						heal_full=yes
						increase_total=10%
					[/effect]
					[effect]
						apply_to=max_experience
						increase=20%
					[/effect]
					[effect]
			            apply_to=status
			            remove=poisoned
			        [/effect]
			        [effect]
			            apply_to=status
			            remove=slowed
			        [/effect]
				[/advancement]
			[/effect]
		[/object]
	[/modify_unit]
#enddef
