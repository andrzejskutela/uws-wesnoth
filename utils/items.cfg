#define INIT_ITEMS_DATA
	[set_variables]
		name=items_steps
		mode=replace
		[value] # steps
			magic_res="5/5/5/5/5/10"
			cold_res="10/10/15/15/15/20"
			phys_res="5/5/5/5/5/10"
			impact_res="10/10/15/15/15/20"
			fire_res="10/10/15/15/15/20"
			arcane_res="10/10/15/15/15/20"
			blade_res="10/10/15/15/15/20"
			pierce_res="10/10/15/15/15/20"
			hp_low="5/15/25/30/40/50"
			hp_med="10/20/30/40/50/60"
			hp_high="15/25/35/45/60/75"
			steadfast="25/40/50/55/65/75"
			regen="2/4/8/12/16/24"
			melee_dmg="7/15/25/33/40/50"
			ranged_dmg="7/15/25/33/40/50"
			ranged_acc="3/2/2/2/3/3"
			melee_parry="3/2/2/2/3/3"
			melee_poison="0/2/1/1/1/0"
			melee_slow="1/0/0/0/0/0"
			mp="1/0/1/0/1/2"
			feeding="1/1/1/1/1/2"
			leadership="1/0/0/0/0/0"
			drain="20/35/50/55/65/75"
			defense="0/0/0/1/1/1"
			skirm="1/0/0/0/0/0"
			first_strike="1/0/0/0/0/0"
			fear="1/0/0/0/0/0"
			discouragement="1/0/0/0/0/0"
			burns="2/4/8/12/16/20"
			golden_armor="3/3/4/3/3/4"
			heal="2/4/8/8/10/12"
			freezing_gem="1/2/3/4/6/8"
			field_disruption="10/15/20/25/30/35"
			armor_destruction="1/2/3/4/6/8"
			protection="10/15/20/25/30/35"
			double_attack="8/7/6/5/4/3"
			hitn_run="1/0/0/1/0/0"
			extra_strikes="40/50/60/70/80/100"
			rat_pack="7/6/5/4/3/2"
			icewind_aura="1/2/3/5/7/9"
			book="1/0/0/0/0/0"
			dragon_protection="1/2/3/4/5/6"
		[/value]
		[value] # name
			magic_res="Magic Mastery"
			cold_res="Cold Mastery"
			phys_res="Physical Mastery"
			impact_res="Impact Mastery"
			fire_res="Fire Mastery"
			arcane_res="Arcane Mastery"
			blade_res="Blade Mastery"
			pierce_res="Pierce Mastery"
			hp_low="Flask of the Alchemist"
			hp_med="Ring of Endurance"
			hp_high="Talisman of Vitality"
			steadfast="Amulet of Devotion"
			regen="Charm of Regeneration"
			melee_dmg="War Sword"
			ranged_dmg="Crystal Bow"
			ranged_acc="Elven Ring of Accuracy"
			melee_parry="Battle Staff"
			melee_poison="Assassin's Dagger"
			melee_slow="Chronomancer's Staff"
			mp="Potion of Swiftness"
			feeding="Necronomicon"
			leadership="Celestial Hammer"
			drain="Staff of Dark Sorcery"
			defense="Potion of Agility"
			skirm="Potion of Dexterity"
			first_strike="Ceremonial Spear"
			fear="Necromancer's Bane"
			discouragement="Potion of Hindrance"
			burns="Torch of the Secret Fire"
			golden_armor="Golden Armor"
			heal="Potion of Rejuvenation"
			freezing_gem="Gem of Hoarfrost"
			field_disruption="Sorcerer's Battle Armor"
			armor_destruction="The Scythe"
			protection="Talisman of Protection"
			double_attack="Elven Royal Bow"
			hitn_run="Hitman's Cloak"
			extra_strikes="Battle Gauntlets"
			rat_pack="Rodent Breeder"
			icewind_aura="IceLord's Protection"
			book="White Book of Wesnoth"
			dragon_protection="Dragon's Protection"
		[/value]
		[value] # step labels for display
			magic_res="+5% magic res/+10% magic res/+15% magic res/+20% magic res, 5% negation/+25% magic res, 15% negation/+35% magic res, 25% negation"
			cold_res="+10% cold/+20% cold/+35% cold/+50% cold + decent weapon/+65% cold + powerful weapon/+85% cold, element mastery + mythical weapon"
			phys_res="+5% phys res/+10% phys res/+15% phys res/+20% phys res, 5% reduction/+25% phys res, 15% reduction/+35% phys res, 25% reduction"
			impact_res="+10% impact/+20% impact/+35% impact/+50% impact + decent weapon/+65% impact + powerful weapon/+85% impact, element mastery + mythical weapon"
			fire_res="+10% fire/+20% fire/+35% fire/+50% fire + decent weapon/+65% fire + powerful weapon/+85% fire, element mastery + mythical weapon"
			arcane_res="+10% arcane/+20% arcane/+35% arcane/+50% arcane + decent weapon and ability/+65% arcane + powerful weapon/+85% arcane, element mastery + mythical ability"
			blade_res="+10% blade/+20% blade/+35% blade/+50% blade + decent weapon/+65% blade + powerful weapon/+85% blade, element mastery + mythical weapon"
			pierce_res="+10% pierce/+20% pierce/+35% pierce/+50% pierce + decent weapon/+65% pierce + powerful weapon/+85%, element mastery pierce + mythical weapon"
			hp_low="+5% hp/+15% hp/+25% hp, cures/+30% hp, cures, immune to poison, concoction 33, toxic fumes 1/+40% hp, poison knowledge, concoction 67, toxic fumes 3, alcohol fumes 5/+50% hp, poison knowledge, concoction 100, toxic fumes 5, alcohol fumes 10"
			hp_med="+10% hp/+20% hp/+30% hp/+40% hp, undrainable, melee endurance 20/+50% hp, undrainable aura, melee endurance 30/+60% hp, undrainable aura, melee endurance 40"
			hp_high="+15% hp/+25% hp/+35% hp/+45% hp, bloodline 10/+60% hp, bloodline 20/+75% hp, bloodline 30, treats wounded"
			steadfast="x1.5 25% max/x1.75 40% max/x2 50% max/x2 55% max, shield master 20(14%)/x2.25 65% max, shield master 40(17%)/x2.5 75% max, shield master 70(21%)"
			regen="+2/+4/+8/+12 (village +16, fight +4)/+16 (village +24, fight +8)/+24 (village +32, fight +12)"
			melee_dmg="+7% melee dmg/+15% melee dmg/+25% melee dmg/+33% melee dmg, fury +10%/+40% melee dmg, fury +17%/+50% melee dmg, fearless, fury +24%"
			ranged_dmg="+7% ranged dmg/+15% ranged dmg/+25% ranged dmg/+33% ranged dmg, ruthless/+40% ranged dmg, +1 ranged strike/+50% ranged dmg, +1 ranged strike, merciless"
			ranged_acc="ranged +2(1) accuracy, +1 dmg/ranged +5(3) accuracy, +1 dmg/ranged +8(5) accuracy, +1 dmg/ranged +12(7) accuracy, assassination x1.5, +2 dmg/ranged +16(10) accuracy, assassination x2, +2 dmg/ranged +20(15) accuracy, assassination x2.5, +3 dmg"
			melee_parry="+3 melee parry/+5 melee parry/+7 melee parry/+9 melee parry, counterbalance 30/+12 melee parry, counterbalance 40/+15 melee parry, counterbalance 50, peaceful warrior"
			melee_poison="melee poison (lower lvl only)/melee poison (same and lower lvl only)/melee poison/melee poison, +2 acc, 1.25x backstab/melee poison, +3 acc, 1.5x backstab/melee poison, +5 acc, 2x backstab"
			melee_slow="day only melee slow/day, dawn and dusk melee slow/melee slow/melee slow, slow aura/melee slow, slow aura, lesser chronosphere/melee slow, slow aura, chronosphere"
			mp="+1 mp/+1 mp/+2 mp/+2 mp, slow immunity/+3 mp, slow immunity aura/+4 mp, motility mastery"
			feeding="deluminates -5/deluminates -15/deluminates -25/deluminates -25, 15% to summon lvl0/deluminates -30, 17% to summon lvl1, feeding +1/deluminates -35, 19% to summon lvl2, feeding +1"
			leadership="leadership 5%/leadership 15%/leadership 25%/leadership 25%, leads by example 15%/leadership 30%, leads by example 25%, great leader 25%/leadership 35%, leads by example 35%, great leader 50%, fearless"
			drain="20%/35%/50%/55%(20%), wicked x1.15/65%(30%), wicked x1.25/75%(40%), unholy x1.35"
			defense="+1% def/+3% def/+5% def/+7% def, -1mc/+10% def, -2mc, terrain knowledge/+10% def, -3mc, cartography"
			skirm="nighttime only skirmisher/dawn, dusk and night skirmisher/skirmisher/skirmisher, +1 mp/skirmisher +2 mp, battle fervor +1/skirmisher, +2 mp, battle fervor +2, enemy control"
			first_strike="melee first strike (lower levels only)/melee first strike/first strike/first strike, preemptive 50%/first strike, preemptive 75%/first strike, initiative, eagerness aura"
			fear="5% attack, 0%(10%) lvl0(r1)/5% attack, 5%(10%) lvl1(r1)/10% attack, 5%(15%) lvl2(r2)/15% attack, 10%(20%) lvl3(r3), +1 heal on hit/20% attack, 10%(25%) lvl4(r4), +2 heal on hit/25% attack, 15%(30%) lvl5(r5), +3 heal on hit, fearless"
			discouragement="melee dishearten -10%/melee dishearten -15%/dishearten -20%/dishearten -20%, melee discourage -1/dishearten -25%, discourage -1/dishearten -30%, discourage -1, corrupts"
			burns="secret fire 2, +5% fire res/secret fire 4, +5% fire res/secret fire 8, +5% fire res/secret fire 12(8), +15% fire res, +1 fire vision/secret fire 16(12), +15% fire res, +2 fire vision/secret fire 20(16), +25% fire res, +3 fire vision"
			golden_armor="+3% res/+6% res/+10% res/+13% res, reflects 15%/+16% res, reflects 30%/+20% res, reflects 50%"
			heal="heals +2, +5% arcane res/heals +4, +5% arcane res/heals +8, +5% arcane res/heals +8, heals all +2, +15% arcane res/heals +10, heals all +4, +15% arcane res/heals +12, restores all +8, +25% arcane res, distinguished"
			freezing_gem="freezing touch -1, +5% cold res/freezing touch -2, +5% cold res/freezing touch -3, +5% cold res/freezing touch -4, icy shackles, +15% cold res/freezing touch -6, icy shackles, +15% cold res/freezing touch -8, icy shackles, +25% cold res"
			field_disruption="field -10/field -15/field -20/field -25, phase 5(5)/field -30, phase 15(10)/field -35, phase 25(15)"
			armor_destruction="-1 res per hit, +1 dmg/-2 res per hit, +1 dmg/-3 res per hit, +1 dmg/-4 res per hit, +2 dmg, bloodseeker 5/-6 res per hit, +2 dmg, bloodseeker 7.5/-8 res per hit, +3 dmg, bloodseeker 10, bloodlust +9"
			protection="protection +10/protection +15/protection +20/protection +25, defensive wall 1.2/protection +30, defensive wall 1.4/protection +35, impenetrable wall 1.5"
			double_attack="8 to charge/7 to charge/6 to charge/5 to charge, sharpshooter 30%/4 to charge, sharpshooter 50%/3 to charge, sharpshooter 70%"
			hitn_run="nightstalk/nightstalk, kill +1/nightstalk, kill +2/nightstalk, hit +1(3)/nightstalk, hit +2(4)/nightstalk, hit +3(5), cover of the night"
			extra_strikes="below 50%/below 65% and 30%/always +1/always +1, extra below 50%, accuracy +2/always +1, extra below 65% and 30%, accuracy +3/always +2, extra below 50%, accuracy +5"
			rat_pack="spawn every 6 turns/spawn every 5 turns/spawn every 4 turns/spawn every 4 turns, 50% special/spawn every 3 turns, 75% special, rat ambassador/special spawn every 2 turns, rat ambassador"
			icewind_aura="1 radius/2 radius/3 radius/5 radius, 2 cold damage, defenses -2%/7 radius, 4 cold damage, defenses -5%/9 radius, 8 cold damage, defenses -10%"
			book="kill +15% xp/kill +25% xp/kill +40% xp/kill +40%(15%) xp, intelligent, combat teacher +1/kill +40%(25%) xp, intelligent, combat teacher +2/kill +40%(40%) xp, combat teacher +3, all intelligent"
			dragon_protection="lvl 1, restores 1hp, res +5%(15%)/lvl 2, restores 3 hp, res +5%(15%)/lvl 3, restores 5hp, res +5%(15%)/lvl 4, restores 20% hp, res +10%(25%)/lvl 5, restores 35% hp, res +10%(25%)/lvl 6, restores 50% hp, res +15%(35%)"
		[/value]
		[value] # image
			magic_res="items/ball-magenta.png"
			cold_res="items/ball-blue.png"
			phys_res="items/ball-green.png"
			impact_res="items/uws/plate.png"
			fire_res="items/ring-red.png"
			arcane_res="items/talisman-bone.png"
			blade_res="items/buckler.png"
			pierce_res="items/armor.png"
			hp_low="items/potion-red.png"
			hp_med="items/ring-brown.png"
			hp_high="items/ankh-necklace.png"
			steadfast="items/necklace-stone.png"
			regen="items/ankh-necklace2.png"
			melee_dmg="items/flame-sword-bare.png"
			ranged_dmg="items/bow-crystal-2.png"
			ranged_acc="items/ring-silver.png"
			melee_parry="items/staff-plain.png"
			melee_poison="items/dagger-poison.png"
			melee_slow="items/staff-magic-2.png"
			mp="items/potion-yellow.png"
			feeding="items/book5.png"
			leadership="items/hammer-runic.png"
			drain="items/staff.png"
			defense="items/potion-grey.png"
			skirm="items/potion-blue.png"
			first_strike="items/spear-fancy-2.png"
			fear="items/sword-wraith.png"
			discouragement="items/potion-poison.png"
			burns="items/torch.png"
			golden_armor="items/armor-golden.png"
			heal="items/holy-water.png"
			freezing_gem="items/uws/freezing_gem.png"
			field_disruption="items/uws/disruptor.png"
			armor_destruction="items/uws/cutter.png"
			protection="items/uws/protection.png"
			double_attack="items/bow-elven.png"
			hitn_run="items/uws/cloak.png"
			extra_strikes="items/uws/gauntlets.png"
			rat_pack="items/leather-pack.png"
			icewind_aura="items/uws/icewind.png"
			book="items/book3.png"
			dragon_protection="items/uws/armor-dragon.png"
		[/value]
		[value] # long description when unit picks the item
			magic_res="Adds resistance to magical attack types.
			
<span color='#5b8742'>Negates Magic</span>: improves magical resistance of all allied units on the map by certain amount."

			cold_res="Adds cold resistance.

<span color='#7375e6'>Time Lock</span>: attack only, both the attacker and defender go into the time lock. For a duration of one turn the defender gets all defenses set to 25% and strikes on all weapons to 1. In addition to that, all adjacent enemies to the attacked unit receive 4 cold damage and get slowed. The attacker gets all defenses set to 25% and all weapons removed. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Infinity Lock</span>: attack only, both the attacker and defender go into the infinity lock. For a duration of one turn the defender can't move, gets all defenses set to 15% and all weapons removed. In addition to that, all enemies within radius 5 from the attacked unit receive 8 cold damage and get slowed. The attacker gets all weapons removed. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Cold Mastery</span>: improves cold resistance and cold damage of all allied units on the map."

			phys_res="Adds resistance to physical attack types.
			
<span color='#5b8742'>Armor Science</span>: reduces physical resistances of all enemies within the vision range from the scientist by certain amount."

			impact_res="Adds impact resistance.

<span color='#7375e6'>Stun</span>: attack only, disrupts enemy's ZOC upon a hit.

<span color='#7375e6'>Crushing Blow</span>: attack only, upon a hit the enemy gets one strike removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Shatter the Bones</span>: attack only, upon a hit the enemy gets 50% of strikes removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Impact Mastery</span>: improves impact resistance and impact damage of all allied units on the map."

			fire_res="Adds fire resistance.

<span color='#7375e6'>Burning Passion</span>: attack only, after killing an enemy this unit gets possessed by burning passion, gets damage increased by 1 point and a chance to attack another enemy. After the turn is finished, all attacks get disabled and all resistances(except fire) and movement drop to 0 for a duration of one turn.

<span color='#7375e6'>Burning Possession</span>: attack only, after killing an enemy this unit gets possessed by infernal passion, receives extra 2 movement points, gets damage increased by 2 points and a chance to attack another enemy. After the turn is finished, all attacks get disabled, all resistances(except fire) drop to 0 and movement is reduced to 3 points for a duration of one turn.

<span color='#5b8742'>Fire Mastery</span>: improves fire resistance and fire damage of all allied units on the map."

			arcane_res="Adds arcane resistance.

<span color='#5b8742'>Mind Tricks</span>: once a fight is finished if both units are still alive then some percentage of the damage received is reflected back onto the enemy as arcane damage. Equally, the same amount is used to heal the wounds received during the fight. Champions and The Butcher of Wesnoth are immune. Active only on offense.

<span color='#7375e6'>Reversed Polarity</span>: attack only, upon a hit the attacker and the defender swap their locations. This stops the attack. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Drains</span>: the unit can drain health from living units, healing itself for a percentage of the amount of damage it deals (rounded down).

<span color='#5b8742'>Arcane Mastery</span>: improves arcane resistance and arcane damage of all allied units on the map."

			blade_res="Adds blade resistance.

<span color='#7375e6'>Duel 2</span>: attack only, fight lasts for an extra round.

<span color='#7375e6'>Battle Trance</span>: attack only, each landing hit increases the damage by 1. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Overwhelm</span>: attack only, each landing hit increases the damage by 1, while simultaneously decreases opponent's damage by 2(1) if current damage is above 67%(33%). After the attack, opponent's defense and attack accuracy are reduced by 10% for one turn. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Blade Mastery</span>: improves blade resistance and blade damage of all allied units on the map."

			pierce_res="Adds pierce resistance.

<span color='#7375e6'>Impale</span>: attack only, ignores the enemy's pierce resistance. Upon successful hit, the opponent's damage and movement points are reduced by 33% for one turn.

<span color='#7375e6'>No Counter-Attack</span>: attack only, the opponent has a 0% chance of retaliation. Champions, the Butcher of Wesnoth and berserker frenzy units are immune.

<span color='#5b8742'>Pierce Mastery</span>: improves pierce resistance and pierce damage of all allied units on the map."

			hp_low="Provides low hitpoints bonus.

<span color='#5b8742'>Cures</span>: this unit is able to cure all surrounding units of poison at the beginning of it's turn

<span color='#5b8742'>Immune to Poison</span>: the unit becomes unpoisonable (no effect on undead, mechanical and magical units, etc).

<span color='#5b8742'>Poison Knowledge</span>: all allies become immune to poison.

<span color='#5b8742'>Toxic Fumes</span>: at the beginning of the unit's turn all enemies withing certain radius get poisoned. Non-living units are immune.

<span color='#5b8742'>Alcohol Fumes</span>: whenever defending, before the first strike this unit is able to release delirious alcohol fumes, causing the enemy to worsen it's defense and accuracy.

<span color='#5b8742'>Unstable Concoction</span>: when dying this unit can drop a very unstable concoction causing a massive explosion and harming all surrounding units, enemies and allies alike."

			hp_med="Provides medium hitpoints bonus.

<span color='#5b8742'>Immune to Drains</span>: the unit becomes undrainable (no effect on undead, mechanical and magical units, etc).

<span color='#5b8742'>Drains Immunity Aura</span>: all allies become immune to drain.

<span color='#5b8742'>Melee Endurance</span>: each time this unit is hit in melee combat, it immediately regenerates part of the damage."

			hp_high="Provides high hitpoints bonus.

<span color='#5b8742'>Bloodline</span>: increases hitpoints of all allied units on the map.	

<span color='#5b8742'>Treats Wounded</span>: any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow."

			steadfast="Adds steadfast and shield master abilities.

<span color='#5b8742'>Steadfast</span> the unit’s resistances are multiplied by a specific factor, up to a maximum value when defending. Vulnerabilities are not affected.

<span color='#5b8742'>Shield Master</span> this unit has a small chance to significantly raise it's own, and adjacent allies' resistances each time they defend."

			regen="Adds regenerates ability.

<span color='#5b8742'>Regenerates</span>: the unit will heal itself some HP amount each turn. If it is poisoned, it will remove the poison instead of healing. In addition to normal healing, the rate of regeneration can be increased if the unit is stationed in a village. There is also a small amount healed when the unit comes out of a fight."

			melee_dmg="Increases damage output on melee weapons.

<span color='#5b8742'>Fearless</span>: fights normally during unfavorable times of day/night.

<span color='#7375e6'>Battle Fury</span>: with each successful hit the damage increases by given amount. If the unit gets hit, the counter is reset. Active only on offense."

			ranged_dmg="Increases damage output on ranged weapons.

<span color='#7375e6'>Ruthless</span>: adds 1 ranged strike against enemies with no ranged attacks. Attack only.

<span color='#7375e6'>Merciless</span>: adds 3 ranged strikes against enemies with no ranged attacks. Attack only."

			ranged_acc="Increases accuracy of ranged weapons. The first number indicates the increase in accuracy of non-magical weapons, whereas the number in parenthesis indicates the increase in accuracy of magical weapons.

<span color='#7375e6'>Assassination</span>: when used offensively, this attack deals significantly more damage if a single hit can eliminate the opponent."

			melee_parry="Improves parry on melee weapons and adds counterbalance on melee.

<span color='#7375e6'>Counterbalance</span>: when defending, each time this unit dodges a melee attack it has a chance to retaliate multiple times before enemy can attack again. Retaliations deal 50% of the base damage and all weapon specials are disabled.

<span color='#5b8742'>Peaceful Warrior</span>: when defending this unit will never deal the fatal blow and kill the enemy. Instead it will disarm them by leaving 1hp and removing all weapons for a duration of one turn."

			melee_poison="Adds poison, accuracy and backstab to melee weapons.

<span color='#7375e6'>Poison</span>: the attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit.

<span color='#7375e6'>Backstab</span>: when used offensively, this attack deals more damage if there is an enemy of the target on the opposite side of the target."

			melee_slow="Adds slow and heal on hit on melee weapons.

<span color='#7375e6'>Slow</span>: the attack slows the target until it ends a turn. Slow halves the damage caused by attacks and the movement cost for a slowed unit is doubled.

<span color='#5b8742'>Slow Aura</span>: all surounding enemies are slowed at the beginning of your turn.

<span color='#5b8742'>Lesser Chronosphere</span>: when defending against melee attacks, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Chronosphere</span>: when defending, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."

			mp="Increases movement points.

<span color='#5b8742'>Slow Immunity</span>: the unit becomes unslowable.

<span color='#5b8742'>Slow Immunity Aura</span>: all allies become immune to slow.

<span color='#5b8742'>Motility Mastery</span>: this unit and all allies become immune to slow. In addition to that at the beginning of this unit's turn all surrounding enemies become immobilised. Affected units lose their zone of control. Champions, the Butcher of Wesnoth and unslowable units are immune."

			feeding="Adds delumination, magical feeding and raises the undead abilities. Changes the unit's alignment to chaotic.

<span color='#5b8742'>Deluminates</span>: This unit obscures the surrounding area, making chaotic units fight better, and lawful units fight worse.

<span color='#5b8742'>Magical Feeding</span>: the unit gains extra hitpoints whenever it kills a unit, regardless of it's living status. The number of hitpoints added depends on the level of the unit killed capped with the maximum allowed.

<span color='#5b8742'>Raises the Undead</span>: at the beginning of the turn, this unit has a chance to summon an undead minion. The strength of the summoned units is somewhat random, while the level and the chance depend on the promotion rank."

			leadership="Adds leadership ability.

<span color='#5b8742'>Leadership</span>: the unit can lead ally units that are next to it, making them fight better. Affects units of the same or lower level increasing their damage by the same percentage regardless of their level difference.

<span color='#5b8742'>Leads by Example</span>: whenever this unit attacks a champion, or a regular enemy of the same or higher level with more than 50% hitpoints, then all units of the same side that haven't attacked yet receive +1mp and a damage bonus until the end of the turn.

<span color='#5b8742'>Great Leader</span>: whenever this unit kills an enemy all surrounding allied units receive experience points based on the level of the killed unit and the skill of the leader.

<span color='#5b8742'>Fearless</span>: fights normally during unfavorable times of day/night."

			drain="Adds drains on ranged. Does not negatively impact xp mod costs.

<span color='#7375e6'>Drains</span>: the unit can drain health from living units, healing itself for a percentage of the amount of damage it deals (rounded down). On higher ranks it can also drain energy from non-living units.

<span color='#7375e6'>Wicked</span>: when used offensively at nighttime, this attack deals more damage to living units.

<span color='#7375e6'>Unholy</span>: when used at nighttime, this attack deals more damage to living units. Active on all weapons, both in offense and defense."

			defense="Increases defense on all terrain types and improves movement costs.

<span color='#5b8742'>Terrain Knowledge</span>: all ally units gain +5% defense everywhere.

<span color='#5b8742'>Cartography</span>: all ally units gain +10% defense everywhere and improve movement costs by 1."

			skirm="Adds skirmisher ability and movement points.

<span color='#5b8742'>Skirmisher</span>: the unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control.

<span color='#5b8742'>Battle Fervor</span>: increases the movement points of all ally units.

<span color='#5b8742'>Enemy Control</span>: all allied units learn how to ignore enemies' zones of control."

			first_strike="Adds first strike ability.

<span color='#7375e6'>First Strike</span>: always strikes first, even when defending.

<span color='#7375e6'>Preemptive Strike</span>: when attacking you strike twice before the enemy can retaliate. Champions and the Butcher of Wesnoth are immune.

<span color='#7375e6'>Initiative</span>: when attacking and defending you strike twice before the enemy. Champions and the Butcher of Wesnoth are immune.

<span color='#5b8742'>Eagerness Aura</span>: all surrounding allies gain first strike on all attacks."

			fear="Adds necromancer's bane ability.

<span color='#5b8742'>Necromancer's Bane</span>: when attacking, the defender retaliates with reduced damage. After the fight is over enemies up to a certain level within defined range have their damage reduced for one turn. The damage reduction is higher if the opponent dies during the fight. Champions, Butcher of Wesnoth, fearless units, and leaders receive half of the damage reduction.

<span color='#5b8742'>Fearless</span>: fights normally during unfavorable times of day/night.

<span color='#7375e6'>Heal on Hit</span>: each landing hit restores some small amount of hp."

			discouragement="Reduces the attacker's damage output.

<span color='#7375e6'>Dishearten</span>: this attack reduces the opponent's damage. Champions and the Butcher of Wesnoth are immune.

<span color='#7375e6'>Discourage</span>: when defending reduces opponent's strikes. Champions and the Butcher of Wesnoth are immune.

<span color='#5b8742'>Corrupts</span>: adds corruption weapon, 1x1 always hits. When used the enemy will either change sides or become enraged and it's damage will increase by 40%. The chance of conversion depends on the difference in levels between the corrupting and the corrupted unit. If the levels are the same it's 50% - 50%. Each point of difference in levels affects the chances by 20%. Champions, the Butcher of Wesnoth and recruiting units are immune. Available only on offense. Number of owned corrupted units is limited to 1."

			burns="Adds Secret Fire and Fire Sight abilities and increases fire resistance.

<span color='#5b8742'>Secret Fire</span>: deals fire damage to all surrounding enemies at the beginning of your turn. Deals additional damage to the attacker when defending. The amount of damage dealt depends on the Time of Day bonus according to the item keeper's alignment.

<span color='#5b8742'>Fire Vision</span>: increases vision points of all allied units."

			golden_armor="Provides extra resistance.

<span color='#5b8742'>Reflects</span>: when defending, some percentage of received damage is reflected back to the attacker."

			heal="Adds heals and treat wounded abilities, small arcane resistance bonus and distinguished trait.

<span color='#5b8742'>Heals</span>: all surrounding allies are healed and poison removed at the beginning of this unit's turn.

<span color='#5b8742'>Heals All</span> at the beginning of the turn, this unit heals all ally units on the map. Stacks with regular healing.

<span color='#5b8742'>Restores All</span> at the beginning of the turn, this unit not only heals all ally units on the map, but also cures, removes slow and unpetrifies them. Stacks with regular healing.

<span color='#5b8742'>Distinguished</span>: this unit can become a new side leader if one dies, even if the leader cannot die according to the game settings."

			freezing_gem="Improves cold resistance and adds freezing touch special on melee.

<span color='#7375e6'>Freezing Touch</span>: with each successful hit, opponent's defense is reduced by given amount for one turn. Minimum defense is 10%. Melee only.

<span color='#7375e6'>Icy Shackles</span>: at the end of the fight, the opponent's strikes and movement are reduced for a duration of one turn. The level of reduction depends on the difference in defense before and after the fight. Active only on offense."

			field_disruption="Adds field disruption and phase disruption abilities.

<span color='#5b8742'>Field Disruption</span>: all surrounding enemies have their magic resistances reduced by given amount. Champions receive half the effect.

<span color='#5b8742'>Phase Disruption</span>: surrounding non-champion enemies have their magical damage and chance to hit reduced. Conversely surrounding ally units have their magical damage and chance to hit increased by the same amount."

			armor_destruction="Improves melee damage and adds adds melee armor destruction special.

<span color='#7375e6'>Armor Destruction</span>: with each successful hit, opponent's resistance to the weapons type is permanently decreased by given amount. Melee only.

<span color='#7375e6'>Bloodseeker</span>: the more wounded the opponent is, the higher melee damage this weapon does. Active only on offense.

<span color='#5b8742'>Bloodlust</span>: upon a successful kill this unit regenerates some hitpoints."

			protection="Adds protection, defensive wall and impenetrable wall abilities.

<span color='#5b8742'>Protection</span>: surrounding allied units have their physical resistances improved by given amount.

<span color='#5b8742'>Defensive Wall</span>: surrounding allied units deal higher melee damage when defending.

<span color='#5b8742'>Impenetrable Wall</span>: surrounding allied units deal higher damage when defending."

			double_attack="Adds double attack on ranged.

<span color='#7375e6'>Double Attack</span>: the unit can fire ranged attacks twice in single turn, once the ability is charged. Each offensive use of double-attack weapon adds a single charge.

<span color='#7375e6'>Sharpshooter</span>: when used offensively each attack has a chance to pierce through the enemy and deal damage to the enemy behind. Champions and the Butcher of Wesnoth are immune."

			hitn_run="Adds nightstalk, kill and run, hit and run and cover of the night abilities and specials.

<span color='#5b8742'>Nighstalk</span>: the unit is invisible to the enemies during nighttime.

<span color='#5b8742'>Kill and Run</span>: this unit gains extra movement point(s) after killing an enemy.

<span color='#5b8742'>Hit and Run</span>: this unit gains extra movement point(s) after attacking an enemy. If the enemy is eliminated the unit gains more movement points.

<span color='#7375e6'>Cover of the Night</span>: when used during the night against a distracted enemy then the damage is increased by 50% and the enemy cannot retaliate. Champions and the Butcher of Wesnoth are immune and so are opponents with berserker frenzy. This attack to be available requires the move points to be below the maximum move points."

			extra_strikes="Adds extra strikes and small non-magical accuracy bonus.

<span color='#7375e6'>Extra Strikes</span>: increases number of strikes based on the promotion rank and unit's hitpoints."

			rat_pack="Adds breeds rats ability.

<span color='#5b8742'>Breeds Rats</span>: spawns an allied rat next to the breeder once every few turns. On higher ranks there is a chance of spawning a special rat and the item ensures that there is always at least one pedigree rat. Maximum of 4 bred rats at a time. Have fun.

<span color='#5b8742'>Rat Ambassador</span>: this unit's stats improve along the title of the highest ranking rat alive."

			icewind_aura="Adds icewind aura ability.

<span color='#5b8742'>Icewind Aura</span>: at the beginning of your turn all enemies within radius get their mp reduced by 30%, defenses by a small amount and also receive damage.
Applies only to units of the same or lower level as the unit wearing this item.
Movement points cannot drop below 3."

			book="Adds battle study and combat teacher abilities and provides intelligent trait to all allies.

<span color='#5b8742'>Battle Study</span>: increases the amount of experience gained from killing enemies. On higher ranks also increases the experience that allied adjacent units gain from killing enemies.

<span color='#5b8742'>Combat Teacher</span>: at the beginning of the turn all adjacent allies get xp points.

<span color='#5b8742'>Intelligence Increase</span>: all allied units receive intelligent trait."

			dragon_protection="Adds dragon's protection ability.

<span color='#5b8742'>Dragon's Protection</span>: when this unit is dying the Dragon's Protection revives it, restoring some hitpoints. Works only if the unit is killed by an enemy of low enough level. A unit can only be revived once per turn (the counter refreshes at the beginning of the player's turn). Passively increases resistance to all common weapon types and provides extra resistance against secret attacks."

		[/value]
		[value] # short description for all items menu
			magic_res="Provides extra resistance to magical attack types.
Adds Negates Magic ability."
			cold_res="Provides extra cold resistance.
Adds Time Dilation weapon.
Adds Cold Mastery ability."
			phys_res="Provides extra resistance to physical attack types.
Adds Armor Science ability."
			impact_res="Provides extra impact resistance.
Adds Crush Their Souls weapon.
Adds Impact Mastery ability."
			fire_res="Provides extra fire resistance.
Adds Wrath of Fire weapon.
Adds Fire Mastery ability."
			arcane_res="Provides extra arcane resistance.
Adds Unknown Force weapon.
Adds Mind Tricks ability.
Adds Arcane Mastery ability."
			blade_res="Provides extra blade resistance.
Adds Berserker's Fury weapon.
Adds Blade Mastery ability."
			pierce_res="Provides extra pierce resistance.
Adds Atrocious Impalement weapon.
Adds Pierce Mastery ability."
			hp_low="Provides low hitpoints bonus.
Adds Poison Knowledge ability.
Adds Poisonous Fumes ability.
Adds Alcohol Fumes ability.
Adds Unstable Concoction ability."
			hp_med="Provides medium hitpoints bonus.
Adds draining immunity aura.
Adds melee endurance."
			hp_high="Provides high hitpoints bonus.
Adds Bloodline ability.
Adds Treats Wounded ability."
			steadfast="Adds Steadfast ability.
Adds Shield Master ability."
			regen="Adds Regenerates ability."
			melee_dmg="Increases damage output on melee weapons.
Adds Battle Fury on melee.
Adds Fearless trait."
			ranged_dmg="Increases damage output on ranged weapons.
Adds Ruthless on ranged.
Adds Merciless on ranged."
			ranged_acc="Increases accuracy of ranged weapons.
Adds Assassination on ranged."
			melee_parry="Improves parry on melee weapons.
Adds Counterbalance on melee.
Adds Peaceful Warrior ability."
			melee_poison="Adds poison, accuracy and backstab on melee."
			melee_slow="Adds slow on melee.
Adds Chronosphere ability."
			mp="Adds movement points.
Adds motility mastery."
			feeding="Adds Delumination ability.
Adds Magical Feeding ability.
Adds Raises the Undead ability."
			leadership="Adds Leadership ability.
Adds Leads by Example ability.
Adds Great Leader ability.
Adds Fearless trait."
			drain="Adds Drain on ranged.
Adds Wicked on ranged.
Adds Unholy on all attacks."
			defense="Improves defense and movement costs.
Adds Terrain Knowledge ability.
Adds Cartography ability."
			skirm="Adds skirmisher ability.
Adds movement points.
Adds Battle Fervor ability.
Adds Enemy Control ability."
			first_strike="Adds First Strike special.
Adds Preemptive Strike special.
Adds Initive special.
Adds Eagerness Aura special."
			fear="Adds Necromancer's Bane ability.
Adds Fearless trait.
Adds Heal on Hit on melee."
			discouragement="Adds Dishearten special.
Adds Discourage special.
Adds Corrupts special."
			burns="Adds small fire resistance.
Adds Secret Fire ability.
Adds Fire Vision ability."
			golden_armor="Provides extra resistance.
Adds Reflects ability."
			heal="Adds Heals ability.
Adds Heals All ability.
Adds Protects All ability.
Adds Distinguished trait."
			freezing_gem="Adds Freezing Touch special on melee.
Adds Icy Shackles on melee."
			field_disruption="Adds Field Disruption ability.
Adds Phase Disruption ability"
			armor_destruction="Adds Armor Destruction on melee.
Adds Bloodseeker on melee.
Adds Bloodlust ability."
			protection="Adds Protection ability.
Adds Defensive Wall ability.
Adds Impenetrable Wall ability."
			double_attack="Adds Double Attack special on ranged.
Adds Sharpshooter special on ranged."
			hitn_run="Adds Kill and Run ability on lower ranks.
Adds Hit and Run ability on higher ranks.
Adds Nighstalk ability.
Adds Cover of the Night weapon special."
			extra_strikes="Adds Extra Strikes ability."
			rat_pack="Adds Breeds Rats ability.
Adds Rat Ambassador ability."
			icewind_aura="Adds Icewind Aura ability."
			book="Adds Battle Study ability.
Adds Combat Teacher ability.
Adds Intelligent trait to all allied units."
			dragon_protection="Adds Dragon's Protection ability."

		[/value]
		[value] # steps description when unit picks the item
			magic_res="$band_none_text +5 magic resistance
$band_initiated_text +10 magic resistance
$band_proven_text +15 magic resistance
$band_notable_text +20 magic resistance, <span color='#5b8742'>negates magic 5</span>
$band_significant_text +25 magic resistance, <span color='#5b8742'>negates magic 15</span>
$band_epic_text +35 magic resistance, <span color='#5b8742'>negates magic 25</span>"

			cold_res="$band_none_text +10 cold resistance
$band_initiated_text +20 cold resistance
$band_proven_text +35 cold resistance
$band_notable_text +50 cold resistance, 6x2 ranged weapon (<span color='#7375e6'>slow, magical</span>)
$band_significant_text +65 cold resistance, 7x3 ranged weapon (<span color='#7375e6'>slow, magical, time lock</span>)
$band_epic_text +85 cold resistance, <span color='#5b8742'>cold mastery</span>, 11x3 ranged weapon (<span color='#7375e6'>slow, magical, infinity lock</span>)"

			phys_res="$band_none_text +5 physical resistance
$band_initiated_text +10 physical resistance
$band_proven_text +15 physical resistance
$band_notable_text +20 physical resistance, <span color='#5b8742'>armor science 5</span>
$band_significant_text +25 physical resistance, <span color='#5b8742'>armor science 15</span>
$band_epic_text +35 physical resistance, <span color='#5b8742'>armor science 25</span>"

			impact_res="$band_none_text +10 impact resistance
$band_initiated_text +20 impact resistance
$band_proven_text +35 impact resistance
$band_notable_text +50 impact resistance, 16x2 melee weapon (<span color='#7375e6'>stun</span>)
$band_significant_text +65 impact resistance, 24x2 melee weapon (<span color='#7375e6'>crushing blow</span>)
$band_epic_text +85 impact resistance, <span color='#5b8742'>impact mastery</span>, 36x2 melee weapon (<span color='#7375e6'>shatter the bones</span>)"

			fire_res="$band_none_text +10 fire resistance
$band_initiated_text +20 fire resistance
$band_proven_text +35 fire resistance
$band_notable_text +50 fire resistance, 9x3 melee weapon (<span color='#7375e6'>magical</span>)
$band_significant_text +65 fire resistance, 10x4 melee weapon (<span color='#7375e6'>magical, burning passion</span>)
$band_epic_text +85 fire resistance, <span color='#5b8742'>fire mastery</span>, 11x5 melee weapon (<span color='#7375e6'>magical, burning possession</span>)"

			arcane_res="$band_none_text +10 arcane resistance
$band_initiated_text +20 arcane resistance
$band_proven_text +35 arcane resistance
$band_notable_text +50 arcane resistance, 12x2 melee weapon (<span color='#7375e6'>magical</span>), potent ability (<span color='#5b8742'>mind tricks 20%</span>)
$band_significant_text +65 arcane resistance, 14x2 melee weapon (<span color='#7375e6'>precission, reversed polarity, drains 50%</span>), strong ability (<span color='#5b8742'>mind tricks 35%</span>)
$band_epic_text +85 arcane resistance, <span color='#5b8742'>arcane mastery</span>, 16x2 melee weapon (<span color='#7375e6'>unavoidable, reversed polarity, drains 100%</span>), powerful ability (<span color='#5b8742'>mind tricks 50%</span>)"

			blade_res="$band_none_text +10 blade resistance
$band_initiated_text +20 blade resistance
$band_proven_text +35 blade resistance
$band_notable_text +50 blade resistance, 6x5 melee weapon (<span color='#7375e6'>marksman, duel 2</span>)
$band_significant_text +65 blade resistance, 7x6 melee weapon (<span color='#7375e6'>marksman, duel 2, battle trance</span>)
$band_epic_text +85 blade resistance, <span color='#5b8742'>blade mastery</span>, 8x7 melee weapon (<span color='#7375e6'>marksman, duel 2, overwhelm</span>)"

			pierce_res="$band_none_text +10 pierce resistance
$band_initiated_text +20 pierce resistance
$band_proven_text +35 pierce resistance
$band_notable_text +50 pierce resistance, 13x2 melee weapon (<span color='#7375e6'>charge</span>)
$band_significant_text +65 pierce resistance, 16x2 melee weapon (<span color='#7375e6'>charge, impale</span>)
$band_epic_text +85 pierce resistance, <span color='#5b8742'>pierce mastery</span>, 18x2 melee weapon (<span color='#7375e6'>charge, impale, no counter-attack</span>)"

			hp_low="$band_none_text hp +5%
$band_initiated_text hp +15%
$band_proven_text hp +25%, <span color='#5b8742'>cures</span>
$band_notable_text hp +30%, <span color='#5b8742'>cures</span>, <span color='#5b8742'>immune to poison</span>, <span color='#5b8742'>concoction 33</span>, <span color='#5b8742'>toxic fumes 1</span>
$band_significant_text hp +40%, <span color='#5b8742'>poison knowledge</span>, <span color='#5b8742'>concoction 67</span>, <span color='#5b8742'>toxic fumes 3</span>, <span color='#5b8742'>alcohol fumes 5</span>
$band_epic_text hp +50%, <span color='#5b8742'>poison knowledge</span>, <span color='#5b8742'>concoction 100</span>, <span color='#5b8742'>toxic fumes 5</span>, <span color='#5b8742'>alcohol fumes 10</span>"

			hp_med="$band_none_text hp +10%
$band_initiated_text hp +20%
$band_proven_text hp +30%
$band_notable_text hp +40%, <span color='#5b8742'>immune to drains</span>, <span color='#5b8742'>melee endurance 20</span>
$band_significant_text hp +50%, <span color='#5b8742'>drains immunity aura</span>, <span color='#5b8742'>melee endurance 30</span>
$band_epic_text hp +60%, <span color='#5b8742'>drains immunity aura</span>, <span color='#5b8742'>melee endurance 40</span>"

			hp_high="$band_none_text hp +15%
$band_initiated_text hp +25%
$band_proven_text hp +35%
$band_notable_text hp +45%, <span color='#5b8742'>bloodline 10%</span>
$band_significant_text hp +60%, <span color='#5b8742'>bloodline 20%</span>
$band_epic_text hp +75%, <span color='#5b8742'>bloodline 30%, treats wounded</span>"

			steadfast="$band_none_text x1.5 25% max
$band_initiated_text x1.75 40% max
$band_proven_text x2 50% max
$band_notable_text x2 55% max, <span color='#5b8742'>shield master 20(14%)</span>
$band_significant_text x2.25 65% max, <span color='#5b8742'>shield master 40(17%)</span>
$band_epic_text x2.5 75% max, <span color='#5b8742'>shield master 70(21%)</span>"

			regen="$band_none_text regen +2
$band_initiated_text regen +4
$band_proven_text regen +8
$band_notable_text regen +12 (village +16, fight +4)
$band_significant_text regen +16 (village +24, fight +8)
$band_epic_text regen +24 (village +32, fight +12)"

			melee_dmg="$band_none_text melee dmg +7%
$band_initiated_text melee dmg +15%
$band_proven_text melee dmg +25%
$band_notable_text melee dmg +33%, <span color='#7375e6'>battle fury +10%</span>
$band_significant_text melee dmg +40%, <span color='#7375e6'>battle fury +17%</span>
$band_epic_text melee dmg +50%, <span color='#5b8742'>fearless</span>, <span color='#7375e6'>battle fury +24%</span>"

			ranged_dmg="$band_none_text ranged dmg +7%
$band_initiated_text ranged dmg +15%
$band_proven_text ranged dmg +25%
$band_notable_text ranged dmg +33%, <span color='#7375e6'>ruthless</span>
$band_significant_text ranged dmg +40%, +1 ranged strike
$band_epic_text ranged dmg +50%, +1 ranged strike, <span color='#7375e6'>merciless</span>"

			ranged_acc="$band_none_text ranged accuracy +2(1), +1 dmg
$band_initiated_text ranged accuracy +5(3), +1 dmg
$band_proven_text ranged accuracy +8(5), +1 dmg
$band_notable_text ranged accuracy +12(7), <span color='#7375e6'>assassination x1.5</span>, +2 dmg
$band_significant_text ranged accuracy +16(10), <span color='#7375e6'>assassination x2</span>, +2 dmg
$band_epic_text ranged accuracy +20(15), <span color='#7375e6'>assassination x2.5</span>, +3 dmg"

			melee_parry="$band_none_text melee parry +3
$band_initiated_text melee parry +5
$band_proven_text melee parry +7
$band_notable_text melee parry +9, <span color='#7375e6'>counterbalance 30</span>
$band_significant_text melee parry +12, <span color='#7375e6'>counterbalance 40</span>
$band_epic_text melee parry +15, <span color='#7375e6'>counterbalance 50</span>, <span color='#5b8742'>peaceful warrior</span>"

			melee_poison="$band_none_text melee <span color='#7375e6'>poison</span> (lower level only)
$band_initiated_text melee <span color='#7375e6'>poison</span> (same and lower level only)
$band_proven_text melee <span color='#7375e6'>poison</span>
$band_notable_text melee accuracy +2, <span color='#7375e6'>poison, backstab x1.25</span>
$band_significant_text melee accuracy +3, <span color='#7375e6'>poison, backstab x1.5</span>
$band_epic_text melee accuracy +5, <span color='#7375e6'>poison, backstab x2</span>"

			melee_slow="$band_none_text melee <span color='#7375e6'>slow</span> (day only)
$band_initiated_text melee <span color='#7375e6'>slow</span> (day, dawn and dusk)
$band_proven_text melee <span color='#7375e6'>slow</span>
$band_notable_text melee <span color='#7375e6'>slow</span>, <span color='#5b8742'>slow aura</span>
$band_significant_text melee <span color='#7375e6'>slow</span>, <span color='#5b8742'>slow aura, lesser chronosphere</span>
$band_epic_text melee <span color='#7375e6'>slow</span>, <span color='#5b8742'>slow aura, chronosphere</span>"

			mp="$band_none_text +1mp
$band_initiated_text +1mp
$band_proven_text +2mp
$band_notable_text +2mp, <span color='#5b8742'>slow immunity</span>
$band_significant_text +3mp, <span color='#5b8742'>slow immunity aura</span>
$band_epic_text +4mp, <span color='#5b8742'>motility mastery</span>"

			feeding="$band_none_text deluminates -5
$band_initiated_text deluminates -15
$band_proven_text deluminates -25
$band_notable_text deluminates -25, 15% to summon lvl0 undead
$band_significant_text deluminates -30, 17% to summon lvl1 undead, feeding +1hp
$band_epic_text deluminates -35, 19% to summon lvl2 undead, feeding +1hp"

			leadership="$band_none_text leadership 5%
$band_initiated_text leadership 15%
$band_proven_text leadership 25%
$band_notable_text leadership 25%, <span color='#5b8742'>leads by example 15%</span>
$band_significant_text leadership 30%, <span color='#5b8742'>leads by example 25%, great leader 25%</span>
$band_epic_text leadership 35%, <span color='#5b8742'>leads by example 35%, great leader 50%, fearless</span>"

			drain="$band_none_text drains 20%
$band_initiated_text drains 35%
$band_proven_text drains 50%
$band_notable_text drains 55%(20% non-living), <span color='#7375e6'>wicked x1.15</span>
$band_significant_text drains 65%(30% non-living), <span color='#7375e6'>wicked x1.25</span>
$band_epic_text drains 75%(40% non-living), <span color='#7375e6'>unholy x1.35</span>"

			defense="$band_none_text defense +1%
$band_initiated_text defense +3%
$band_proven_text defense +5%
$band_notable_text defense +7%, -1 movement cost
$band_significant_text defense +10%, -2 movement cost, <span color='#5b8742'>terrain knowledge</span>
$band_epic_text defense +10%, -3 movement cost, <span color='#5b8742'>cartography</span>"

			skirm="$band_none_text nighttime only skirmisher
$band_initiated_text dawn, dusk and night skirmisher
$band_proven_text skirmisher
$band_notable_text skirmisher, +1mp
$band_significant_text skirmisher, +2mp, <span color='#5b8742'>battle fervor +1</span>
$band_epic_text skirmisher, +2mp, <span color='#5b8742'>battle fervor +2</span>, <span color='#5b8742'>enemy control</span>"

			first_strike="$band_none_text melee first strike against lower level units
$band_initiated_text melee first strike
$band_proven_text first strike
$band_notable_text first strike, <span color='#7375e6'>preemptive strike 50%</span>
$band_significant_text first strike, <span color='#7375e6'>preemptive strike 75%</span>
$band_epic_text first strike, <span color='#7375e6'>initiative</span>, <span color='#5b8742'>eagerness aura</span>"

			fear="$band_none_text 5% attack, 0%(10%) adjacent lvl0
$band_initiated_text 5% attack, 5%(10%) adjacent max lvl1
$band_proven_text 10% attack, 5%(15%) radius 2 max lvl2
$band_notable_text 15% attack, 10%(20%) radius 3 max lvl3, melee <span color='#7375e6'>+1 heal on hit</span>
$band_significant_text 20% attack, 10%(25%) radius 4 max lvl4, melee <span color='#7375e6'>+2 heal on hit</span>
$band_epic_text 25% attack, 15%(30%) radius 5 max lvl5, melee <span color='#7375e6'>+3 heal on hit</span>, <span color='#5b8742'>fearless</span>"

			discouragement="$band_none_text melee dishearten -10%
$band_initiated_text melee dishearten -15%
$band_proven_text dishearten -20%
$band_notable_text dishearten -20%, <span color='#7375e6'>melee discourage -1</span>
$band_significant_text dishearten -25%, <span color='#7375e6'>discourage -1</span>
$band_epic_text dishearten -30%, <span color='#7375e6'>discourage -1</span>, <span color='#5b8742'>corrupts</span>"

			burns="$band_none_text secret fire 2, 5% fire res
$band_initiated_text secret fire 4, 5% fire res
$band_proven_text secret fire 8, 5% fire res
$band_notable_text secret fire 12(8), <span color='#5b8742'>fire vision +1</span>, 15% fire res
$band_significant_text secret fire 16(12), <span color='#5b8742'>fire vision +2</span>, 15% fire res
$band_epic_text secret fire 20(16), <span color='#5b8742'>fire vision +3</span>, 25% fire res"

			golden_armor="$band_none_text all resistance +3
$band_initiated_text all resistance +6
$band_proven_text all resistance +10
$band_notable_text all resistance +13, <span color='#5b8742'>reflects 15%</span>
$band_significant_text all resistance +16, <span color='#5b8742'>reflects 30%</span>
$band_epic_text all resistance +20, <span color='#5b8742'>reflects 50%</span>"

			heal="$band_none_text heals +2, +5% arcane res
$band_initiated_text heals +4, +5% arcane res
$band_proven_text heals +8, +5% arcane res
$band_notable_text heals +8, +15% arcane res, <span color='#5b8742'>heals all +2</span>
$band_significant_text heals +10, +15% arcane res, <span color='#5b8742'>heals all +4</span>
$band_epic_text heals +12, +25% arcane res, <span color='#5b8742'>restores all +8, distinguished</span>"

			freezing_gem="$band_none_text <span color='#7375e6'>freezing touch -1</span>, +5% cold resistance
$band_initiated_text <span color='#7375e6'>freezing touch -2</span>, +5% cold resistance
$band_proven_text <span color='#7375e6'>freezing touch -3</span>, +5% cold resistance
$band_notable_text <span color='#7375e6'>freezing touch -4</span>, <span color='#7375e6'>icy shackles</span>, +15% cold resistance
$band_significant_text <span color='#7375e6'>freezing touch -6</span>, <span color='#7375e6'>icy shackles</span>, +15% cold resistance
$band_epic_text <span color='#7375e6'>freezing touch -8</span>, <span color='#7375e6'>icy shackles</span>, +25% cold resistance"

			field_disruption="$band_none_text field -10
$band_initiated_text field -15
$band_proven_text field -20
$band_notable_text field -25, <span color='#5b8742'>phase 5(5)</span>
$band_significant_text field -30, <span color='#5b8742'>phase 15(10)</span>
$band_epic_text field -35, <span color='#5b8742'>phase 25(15)</span>"

			armor_destruction="$band_none_text <span color='#7375e6'>armor destruction -1</span>, +1 melee damage
$band_initiated_text <span color='#7375e6'>armor destruction -2</span>, +1 melee damage
$band_proven_text <span color='#7375e6'>armor destruction -3</span>, +1 melee damage
$band_notable_text <span color='#7375e6'>armor destruction -4</span>, <span color='#7375e6'>bloodseeker 5</span>, +2 melee damage
$band_significant_text <span color='#7375e6'>armor destruction -6</span>, <span color='#7375e6'>bloodseeker 7.5</span>, +2 melee damage
$band_epic_text <span color='#7375e6'>armor destruction -8</span>, <span color='#7375e6'>bloodseeker 10</span>, +3 melee damage, <span color='#5b8742'>bloodlust +9</span>"

			protection="$band_none_text protection +10
$band_initiated_text protection +15
$band_proven_text protection +20
$band_notable_text protection +25, <span color='#5b8742'>defensive wall x1.2</span>
$band_significant_text protection +30, <span color='#5b8742'>defensive wall x1.4</span>
$band_epic_text protection +35, <span color='#5b8742'>impenetrable wall x1.5</span>"

			double_attack="$band_none_text 8 to charge
$band_initiated_text 7 to charge
$band_proven_text 6 to charge
$band_notable_text 5 to charge, <span color='#7375e6'>sharpshooter 30%</span>
$band_significant_text 4 to charge, <span color='#7375e6'>sharpshooter 50%</span>
$band_epic_text 3 to charge, <span color='#7375e6'>sharpshooter 70%</span>"

			hitn_run="$band_none_text nightstalk
$band_initiated_text nightstalk, <span color='#5b8742'>kill and run +1</span>
$band_proven_text nightstalk, <span color='#5b8742'>kill and run +2</span>
$band_notable_text nightstalk, <span color='#5b8742'>hit and run +1(3)</span>
$band_significant_text nightstalk, <span color='#5b8742'>hit and run +2(4)</span>
$band_epic_text nightstalk, <span color='#5b8742'>hit and run +3(5)</span>, <span color='#7375e6'>cover of the night</span>"

			extra_strikes="$band_none_text extra strike below 50% hp
$band_initiated_text extra strikes below 65% and 30% hp
$band_proven_text +1 strike
$band_notable_text +1 strike, extra below 50% hp, +2 accuracy
$band_significant_text +1 strike, extra below 65% and 30% hp, +3 accuracy
$band_epic_text +2 strikes, extra below 50%, +5 accuracy"

			rat_pack="$band_none_text a rat spawns every 6 turns
$band_initiated_text a rat spawns every 5 turns
$band_proven_text a rat spawns every 4 turns
$band_notable_text a rat spawns every 4 turns, 50% chance to be a special rat
$band_significant_text a rat spawns every 3 turns, 75% to be a special rat, <span color='#5b8742'>rat ambassador</span>
$band_epic_text a special rat spawns every 2 turns, <span color='#5b8742'>rat ambassador</span>"

			icewind_aura="$band_none_text adjacent units only
$band_initiated_text within 2 radius
$band_proven_text within 3 radius
$band_notable_text within 5 radius, passive 2 cold damage, defenses -2%
$band_significant_text within 7 radius, passive 4 cold damage, defenses -5%
$band_epic_text within 9 radius, passive 8 cold damage, defenses -10%"

			book="$band_none_text battle study +15% xp
$band_initiated_text battle study +25% xp
$band_proven_text battle study +40% xp
$band_notable_text battle study +40%(15%) xp, intelligent, <span color='#5b8742'>combat teacher +1</span>
$band_significant_text battle study +40%(25%) xp, intelligent, <span color='#5b8742'>combat teacher +2</span>
$band_epic_text battle study +40%(40%) xp, <span color='#5b8742'>combat teacher +3</span>, all intelligent"

			dragon_protection="$band_none_text max lvl 1, restores 1hp, res +5%(15%)
$band_initiated_text max lvl 2, restores 3hp, res +5%(15%)
$band_proven_text max lvl 3, restores 5hp, res +5%(15%)
$band_notable_text max lvl 4, restores 20% hp, res +10%(25%)
$band_significant_text max lvl 5, restores 35% hp, res +10%(25%)
$band_epic_text always max lvl 6, restores 50% hp, res +15%(35%)"
		[/value]
	[/set_variables]
#enddef

#define SHOW_ITEM_PICKUP_MESSAGE ITEM_ID IMAGE TEXT
	[message]
		speaker=narrator
		message={TEXT}
		image={IMAGE}

		[option]
			label="Yes"

			[command]
				{VARIABLE item_append_id {ITEM_ID}}

				[if]
					[variable]
						name=item_append_id
						not_equals=""
					[/variable]
					[then]
						[fire_event]
							name=append_item_variables
							[primary_unit]
								x,y=$x1,$y1
							[/primary_unit]
						[/fire_event]

						[fire_event]
							name=promote_unit
							[primary_unit]
								x,y=$x1,$y1
							[/primary_unit]
						[/fire_event]
					[/then]
				[/if]

				[remove_item]
					x,y=$x1,$y1
					image={IMAGE}
				[/remove_item]
				
				{VARIABLE allow_undo no}
				{CLEAR_VARIABLE scrollable_items[$item_list_key]}
				{VARIABLE_OP item_list_key sub 1}
			[/command]
		[/option]

		[option]
			label="No"

			[command][/command]
		[/option]
	[/message]
#enddef

#define QQUWS_ITEMS
	[event]
		name=drop_new_item
		first_time_only=no
		
		{VARIABLE drop_item_image $items_steps[3].$item_type_id}
		[if]
			[variable]
				name=overwrite_item_image
				not_equals=""
			[/variable]
			[then]
				{VARIABLE drop_item_image $overwrite_item_image}
			[/then]
		[/if]

		{VARIABLE render_dropped_item yes}
		
		[if]
			[variable]
				name=render_new_item
				boolean_equals=yes
			[/variable]
			[then]
				{VARIABLE place_item yes}
				[if]
					[variable]
						name=uws_game.mode
						equals=scroll
					[/variable]
					[then]
						[if]
							[variable]
								name=item_y
								less_than=4
							[/variable]
							[or]
								[variable]
									name=item_y
									greater_than=18
								[/variable]
							[/or]
							[then]
								{VARIABLE place_item no}
							[/then]
						[/if]
					[/then]
				[/if]

				[if]
					[variable]
						name=place_item
						boolean_equals=yes
					[/variable]
					[then]
						[item]
							x,y=$item_x,$item_y
							image=$drop_item_image
						[/item]
					[/then]
				[/if]
			[/then]
			[else]
				{VARIABLE render_dropped_item no}
			[/else]
		[/if]

		[set_variables]
			name=scrollable_items
			mode=append
			[value]
				cat=item
				x=$item_x
				y=$item_y
				image=$drop_item_image
				type=$item_type_id
				render=$render_dropped_item
				object_id=$drop_object_id
			[/value]
		[/set_variables]
		
		{CLEAR_VARIABLE overwrite_item_image}
	[/event]
	
	[event]
		name=add_extra_item_gold
		first_time_only=no
		
		[store_gold]
			side=$side_number
			variable=gold
		[/store_gold]
		
		[if]
			[variable]
				name=gold
				less_than=0
			[/variable]
			[then]
				[set_variable]
					name=gold
					multiply=-1
				[/set_variable]
				[gold]
					side=$side_number
					amount=$gold
				[/gold]
			[/then]
		[/if]
		
	        [gold]
	     	   side=$side_number
	     	   amount=25
	        [/gold]
	[/event]
#enddef

#define QQUWS_PROMOTE_UNIT
	[event]
		name=generate_promotion_rank_variables
		first_time_only=no
		
		{VARIABLE promotion_label none}
		{VARIABLE promotion_level 0}
		{VARIABLE promotion_def_suffix "/$threshold_initiated"}
		{VARIABLE promotion_colour $rank_none_color}
		{VARIABLE next_promo_label " / next level"}
		{VARIABLE promo_bonus_dmg 0}
		{VARIABLE unit_items_names ""}

		[if]
			[variable]
				name=unit.variables.kills
				greater_than_equal_to=$threshold_epic
			[/variable]
			[then]
				{VARIABLE promotion_label epic}
				{VARIABLE promotion_level 5}
				{VARIABLE promotion_def_suffix ""}
				{VARIABLE promotion_colour $rank_epic_color}
				{VARIABLE next_promo_label ""}
				{VARIABLE promo_bonus_dmg 65}
			[/then]
			[else]
				[if]
					[variable]
						name=unit.variables.kills
						greater_than_equal_to=$threshold_significant
					[/variable]
					[then]
						{VARIABLE promotion_label significant}
						{VARIABLE promotion_level 4}
						{VARIABLE promotion_def_suffix "/$threshold_epic"}
						{VARIABLE promotion_colour $rank_significant_color}
						{VARIABLE promo_bonus_dmg 45}
					[/then]
					[else]
						[if]
							[variable]
								name=unit.variables.kills
								greater_than_equal_to=$threshold_notable
							[/variable]
							[then]
								{VARIABLE promotion_label notable}
								{VARIABLE promotion_level 3}
								{VARIABLE promotion_def_suffix "/$threshold_significant"}
								{VARIABLE promotion_colour $rank_notable_color}
								{VARIABLE promo_bonus_dmg 33}
							[/then]
							[else]
								[if]
									[variable]
										name=unit.variables.kills
										greater_than_equal_to=$threshold_proven
									[/variable]
									[then]
										{VARIABLE promotion_label proven}
										{VARIABLE promotion_level 2}
										{VARIABLE promotion_def_suffix "/$threshold_notable"}
										{VARIABLE promotion_colour $rank_proven_color}
										{VARIABLE promo_bonus_dmg 20}
									[/then]
									[else]
										[if]
											[variable]
												name=unit.variables.kills
												greater_than_equal_to=$threshold_initiated
											[/variable]
											[then]
												{VARIABLE promotion_label initiated}
												{VARIABLE promotion_level 1}
												{VARIABLE promotion_def_suffix "/$threshold_proven"}
												{VARIABLE promotion_colour $rank_initiated_color}
												{VARIABLE promo_bonus_dmg 10}
											[/then]
										[/if]
									[/else]
								[/if]
							[/else]
						[/if]
					[/else]
				[/if]
			[/else]
		[/if]
		
		[if]
			[variable]
				name=promotion_level
				greater_than=0
			[/variable]
			[or]
				[variable]
					name=unit.variables.items_picked_up
					not_equals=""
				[/variable]
			[/or]
			[then]
				{VARIABLE current_promotion_level $unit.variables.promotion_level}
				{VARIABLE unit_items_info "yet"}
				{VARIABLE items_count "No"}
				[if]
					[variable]
						name=unit.variables.items_picked_up
						not_equals=""
					[/variable]
					[then]
						{VARIABLE unit_items_info " (<span color='$promotion_colour'>$promotion_label</span>$next_promo_label|):"}
						
						[set_variables]
							name=unit_items_ids
							mode=replace
							[split]
								list=$unit.variables.items_picked_up
								key=item
								separator=","
							[/split]
						[/set_variables]
						
						{VARIABLE items_count "$unit_items_ids.length|/$uws_game.max_items_per_unit"}
						
						[for]
							variable=i
							array=unit_items_ids
							[do]
								{VARIABLE array_key $unit_items_ids[$i].item}
								
								[set_variables]
									name=steps_readable
									mode=replace
									[split]
										list=$items_steps[2].$array_key
										key=step
										separator="/"
									[/split]
								[/set_variables]
								
								{VARIABLE step_value_now $steps_readable[$promotion_level].step}
								{VARIABLE step_value_next ""}
								
								[if]
									[variable]
										name=promotion_level
										less_than=5
									[/variable]
									[then]
										{VARIABLE tmp_next_level $promotion_level}
										{VARIABLE_OP tmp_next_level add 1}
										{VARIABLE step_value_next "/ $steps_readable[$tmp_next_level].step"}
									[/then]
								[/if]
								
								{VARIABLE unit_items_names "$items_steps[1].$array_key|, $unit_items_names"}
								{VARIABLE unit_items_info "$unit_items_info
$items_steps[1].$array_key|: <span color='$promotion_colour|'>$step_value_now|</span> $step_value_next"}
							[/do]
						[/for]
					[/then]
				[/if]
				
				{VARIABLE unit_kills_info $unit.variables.kills}
				[if]
					[variable]
						name=unit_kills_info
						equals=""
					[/variable]
					[then]
						{VARIABLE unit_kills_info 0}
					[/then]
				[/if]
				
				{VARIABLE display_rank_info yes}
			[/then]
		[/if]
	[/event]
	
	[event]
		name=promote_unit
		first_time_only=no
		
		{VARIABLE display_rank_info no}
		
		[fire_event]
			name=generate_promotion_rank_variables
			[primary_unit]
				id=$unit.id
			[/primary_unit]
		[/fire_event]
		
		[if]
			[variable]
				name=display_rank_info
				boolean_equals=yes
			[/variable]
			[then]
				[remove_trait]
					id=$unit.id
					trait_id=qquws_promotion_rank_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						promotion_level=$promotion_level
					[/variables]

					[trait]
						id=qquws_promotion_rank_trait
						name="<span color='$promotion_colour'>$promotion_label</span>"
						description="Promotion rank, provides +$promo_bonus_dmg|% dmg and affects item specials ($unit_kills_info|$promotion_def_suffix| kills)
								
$items_count items picked up $unit_items_info"
					[/trait]
				[/modify_unit]
				
				[if]
					[variable]
						name=promotion_level
						greater_than=$current_promotion_level
					[/variable]
					[then]
						[fire_event]
							name=upgrade_item_specials
							[primary_unit]
							    id=$second_unit.id
							[/primary_unit]
						[/fire_event]
					[/then]
				[/if]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=recalculate_items_count_for_unit
		first_time_only=no
		
		{VARIABLE items_count 0}
		{VARIABLE unit_item_list ""}
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				[set_variables]
					name=tmp_unit_items_array
					mode=replace
					[split]
						list=$unit.variables.items_picked_up
						key=item
						separator=","
					[/split]
				[/set_variables]
				
				{VARIABLE items_count $tmp_unit_items_array.length}
				{VARIABLE unit_item_list $unit.variables.items_picked_up}
			[/then]
		[/if]
	[/event]
	
	[event]
		name=append_item_variables
		first_time_only=no
		
		{VARIABLE already_applied ""}
		{VARIABLE current_promotion_level $unit.variables.promotion_level}
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				{VARIABLE already_applied "$unit.variables.items_picked_up|,"}
			[/then]
		[/if]
		
		{VARIABLE items_count $unit_items_ids.length}
		
		[if]
			[variable]
				name=unit.variables.promotion_level
				equals=""
			[/variable]
			[then]
				{VARIABLE current_promotion_level 0}
			[/then]
		[/if]
		
		[modify_unit]
			[filter]
				id=$unit.id
			[/filter]
			
			[variables]
				items_picked_up="$already_applied|$item_append_id"
				promotion_level=$current_promotion_level
			[/variables]
		[/modify_unit]
		
		{VARIABLE item_key $item_append_id}
		[set_variables]
			name=current_item_steps
			mode=replace
			[split]
				list=$items_steps[0].$item_key
				key=step_value
				separator="/"
			[/split]
		[/set_variables]
		
		[for]
			variable=use_promotion_level
			start=0
			end=$current_promotion_level
			step=1
			[do]
				{VARIABLE item_step $current_item_steps[$use_promotion_level].step_value}
				
				[fire_event]
					name=upgrade_single_item_promotion
					[primary_unit]
					    id=$unit.id
					[/primary_unit]
				[/fire_event]
			[/do]
		[/for]
	[/event]
	
	[event]
		name=upgrade_item_specials
		first_time_only=no

		[remove_trait]
			id=$unit.id
			trait_id=qquws_promotion_effect_trait
		[/remove_trait]

		[if]
			[variable]
				name=promo_bonus_dmg
				greater_than=0
			[/variable]
			[then]
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_promotion_effect_trait

						[effect]
						    apply_to=attack
						    increase_damage="$promo_bonus_dmg|%"
						[/effect]
					[/trait]
				[/modify_unit]
			[/then]
		[/if]		
		
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				[set_variables]
					name=current_unit_items_set
					mode=replace
					[split]
						list=$unit.variables.items_picked_up
						key=item_id
						separator=","
					[/split]
				[/set_variables]
				
				[for]
					variable=i
					array=current_unit_items_set
					[do]
						{VARIABLE item_key $current_unit_items_set[$i].item_id}
						[set_variables]
							name=current_item_steps
							mode=replace
							[split]
								list=$items_steps[0].$item_key
								key=step_value
								separator="/"
							[/split]
						[/set_variables]
						
						{VARIABLE item_step $current_item_steps[$unit.variables.promotion_level].step_value}
						{VARIABLE use_promotion_level $unit.variables.promotion_level}
						[fire_event]
							name=upgrade_single_item_promotion
							[primary_unit]
							    id=$unit.id
							[/primary_unit]
						[/fire_event]
					[/do]
				[/for]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=upgrade_single_item_promotion
		first_time_only=no

		{VARIABLE item_promotion_unit_id $unit.id}
		{VARIABLE item_promotion_unit_side $unit.side}
		
		[switch]
			variable=item_key
			[case]
				value=magic_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							arcane=-$item_step
							cold=-$item_step
							fire=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE negates_magic_value 5}
					[/case]
					[case]
						value=4
						{VARIABLE negates_magic_value 15}
					[/case]
					[case]
						value=5
						{VARIABLE negates_magic_value 25}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=negates_magic_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								negates_magic_value=$negates_magic_value
							[/variables]
						[/modify_unit]
					
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_negates_magic
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_negates_magic
										name="negates magic $negates_magic_value"
										description="All allied units receive $negates_magic_value|% bonus to magic resistances."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_magic_negation_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=cold_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							cold=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes

							[effect]
								apply_to=new_attack
								name=qquws_w_time_dilation
								description="time dilation"
								type=cold
								range=ranged
								icon="attacks/staff-magic.png"
								damage=6
								number=2
								[specials]
									{WEAPON_SPECIAL_SLOW}
									{WEAPON_SPECIAL_MAGICAL}
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_time_dilation
								increase_damage=1
								increase_attacks=1
								[set_specials]
									mode=append
									[dummy]
										id=qquws_time_lock
										name="time lock"
										description="When this weapon is used on offense, upon successful hit, both the attacker and defender go into the time lock. For a duration of one turn the defender gets all defenses set to 25% and strikes on all weapons to 1. In addition to that, all adjacent enemies to the attacked unit receive 4 cold damage and get slowed. The attacker gets all defenses set to 25% and all weapons removed. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_time_dilation
								increase_damage=4
								remove_specials=qquws_time_lock
								[set_specials]
									mode=append
									[dummy]
										id=qquws_infinity_lock
										name="infinity lock"
										description="When this weapon is used on offense, upon successful hit, both the attacker and defender go into the infinity lock. For a duration of one turn the defender can't move, gets all defenses set to 15% and all weapons removed. In addition to that, all enemies within radius 5 from the attacked unit receive 8 cold damage and get slowed. The attacker gets all weapons removed. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_cold_mastery_aura
										name="cold mastery"
										description="Improves cold resistance of all allied units by 15% and increases their cold damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=phys_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
							impact=-$item_step
							pierce=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE res_reduction_value 5}
					[/case]
					[case]
						value=4
						{VARIABLE res_reduction_value 15}
					[/case]
					[case]
						value=5
						{VARIABLE res_reduction_value 25}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=res_reduction_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								armor_science_value=$res_reduction_value
							[/variables]
						[/modify_unit]
					
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_armor_science
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_armor_science
										name="armor science $res_reduction_value"
										description="Reduces physical resistances of all enemies within the vision range from the scientist by $res_reduction_value|%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=impact_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							impact=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_crush_their_souls
								description="crush their souls"
								type=impact
								range=melee
								icon="attacks/hammer-troll.png"
								damage=16
								number=2
								[specials]
									[dummy]
										id=qquws_stun
										name="stun"
										description="This attack puts enormous pressure on the enemy, disrupting his ZOC if a hit is landed. Not active on defense."
										active_on=offense
									[/dummy]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_crush_their_souls
								increase_damage=8
								remove_specials=qquws_stun
								[set_specials]
									mode=append
									[dummy]
										id=qquws_crushing_blow
										name="crushing blow"
										description="When this weapon is used on offense and a hit lands, the enemy gets one strike removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_crush_their_souls
								increase_damage=12
								remove_specials=qquws_crushing_blow
								[set_specials]
									mode=append
									[dummy]
										id=qquws_shatter_the_bones
										name="shatter the bones"
										description="When this weapon is used on offense and a hit lands, the enemy gets 50% of strikes removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_impact_mastery_aura
										name="impact mastery"
										description="Improves impact resistance of all allied units by 15% and increases their impact damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=fire_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							fire=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_wrath_of_fire
								description="wrath of fire"
								type=fire
								range=melee
								icon="attacks/claws-fire-elemental.png"
								damage=9
								number=3
								[specials]
									[chance_to_hit]
										id=magical
										name="magical"
										description="This attack has a 70% chance to hit regardless of the defensive ability of the unit being attacked."
										value=70
										cumulative=no
									[/chance_to_hit]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_wrath_of_fire
								increase_damage=1
								increase_attacks=1
								[set_specials]
									mode=append
									[dummy]
										id=qquws_burning_passion
										name="burning passion"
										description="When this weapon is used on offense, after killing an enemy this unit gets possessed by burning passion, gets damage increased by 1 points and a chance to attack another enemy. After the turn is finished, all attacks get disabled and all resistances(except fire) and movement drop to 0 for a duration of one turn."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_wrath_of_fire
								increase_damage=1
								increase_attacks=1
								remove_specials=qquws_burning_passion
								[set_specials]
									mode=append
									[dummy]
										id=qquws_burning_possession
										name="burning possession"
										description="When this weapon is used on offense, after killing an enemy this unit gets possessed by infernal passion, receives extra 2 movement points, gets damage increased by 2 points and a chance to attack another enemy. After the turn is finished, all attacks get disabled, all resistances(except fire) drop to 0 and movement is reduced to 3 points for a duration of one turn."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_fire_mastery_aura
										name="fire mastery"
										description="Improves fire resistance of all allied units by 15% and increases their fire damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=arcane_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							arcane=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								mind_tricks_factor=0.2
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=new_attack
									name=qquws_w_unknown_force
									description="unknown force"
									type=arcane
									range=melee
									icon="attacks/touch-faerie.png"
									damage=12
									number=2
									[specials]
										[chance_to_hit]
											id=magical
											name="magical (attack-only)"
											description="This attack has a 70% chance to hit offensively regardless of the defensive ability of the unit being attacked."
											value=70
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[dummy]
											id=qquws_block_specials
										[/dummy]
									[/specials]
								[/effect]
								
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_mind_tricks
											name="mind tricks 20%"
											description="Once a fight is finished if both units are still alive then 20% of the damage received is reflected back onto the enemy as arcane damage and 20% of the wounds are healed up. Champions and The Butcher of Wesnoth are immune. Active only on offense."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								mind_tricks_factor=0.35
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=attack
									name=qquws_w_unknown_force
									increase_damage=2
									remove_specials=magical
									[set_specials]
										mode=append
										[dummy]
											id=qquws_reversed_polarity
											name="reversed polarity"
											description="When this weapon is used on offense, once a successful hit lands, the attacker and the defender swap their locations. This stops the attack. Champions and The Butcher of Wesnoth are immune."
											active_on=offense
										[/dummy]
										[chance_to_hit]
											id=magical
											name="precision (attack-only)"
											description="This attack has a 80% chance to hit offensively regardless of the defensive ability of the unit being attacked."
											value=80
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[drains]
											id=qquws_drains
											name="drains 50%"
											description="This unit drains health from living units, healing itself for 50% the amount of damage it deals (rounded down)."
											value=50
										[/drains]
									[/set_specials]
								[/effect]
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_mind_tricks
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_mind_tricks
											name="mind tricks 35%"
											description="Once a fight is finished if both units are still alive then 35% of the damage received is reflected back onto the enemy as arcane damage and 35% of the wounds are healed up. Champions and The Butcher of Wesnoth are immune. Active only on offense."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								mind_tricks_factor=0.5
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=attack
									name=qquws_w_unknown_force
									increase_damage=2
									remove_specials=magical,qquws_drains
									[set_specials]
										mode=append
										[chance_to_hit]
											id=magical
											name="unavoidable (attack-only)"
											description="This attack has a 90% chance to hit offensively regardless of the defensive ability of the unit being attacked."
											value=90
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[drains]
											id=qquws_drains
											name="drains 100%"
											description="This unit drains health from living units, healing itself for 100% the amount of damage it deals."
											value=100
										[/drains]
									[/set_specials]
								[/effect]
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_mind_tricks
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
									[dummy]
										id=qquws_mind_tricks
										name="mind tricks 50%"
										description="Once a fight is finished if both units are still alive then 50% of the damage received is reflected back onto the enemy as arcane damage and 50% of the wounds are healed up. Champions and The Butcher of Wesnoth are immune. Active only on offense."
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_arcane_mastery_aura
											name="arcane mastery"
											description="Improves arcane resistance of all allied units by 15% and increases their arcane damage by 15%."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=blade_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							silent=yes
							 
							[effect]
								apply_to=new_attack
								name=qquws_w_berserkers_fury
								description="berserker's fury"
								type=blade
								range=melee
								icon="attacks/battleaxe-undead.png"
								damage=6
								number=5
								[specials]
									{WEAPON_SPECIAL_MARKSMAN}
									[berserk]
										id=berserk_duel2
										name="duel 2"
										description="When attacking this unit presses the engagement and can fight for an extra round."
										value=2
										active_on=offense
									[/berserk]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_berserkers_fury
								increase_damage=1
								increase_attacks=1
								[set_specials]
									mode=append
									[dummy]
										id=qquws_battle_trance
										name="battle trance"
										description="When this weapon is used on offense each landing hit increases the damage by 1. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_berserkers_fury
								increase_damage=1
								increase_attacks=1
								remove_specials=qquws_battle_trance
								[set_specials]
									mode=append
									[dummy]
										id=qquws_overwhelm
										name="overwhelm"
										description="When this weapon is used on offense each landing hit increases the damage by 1, while simultaneously decreases opponent's damage by 2(1) if current damage is above 67%(33%). After the attack, opponent's defense and attack accuracy are reduced by 10% for one turn. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_blade_mastery_aura
										name="blade mastery"
										description="Improves blade resistance of all allied units by 15% and increases their blade damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=pierce_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							pierce=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_atrocious_impalement
								description="atrocious impalement"
								type=pierce
								range=melee
								icon="attacks/trident2-pierce.png"
								damage=13
								number=2
								[specials]
									[damage]
										id=charge
										name="charge"
										description="When used offensively, this attack deals double damage to the target. It also causes this unit to take double damage from the target’s counterattack."
										multiply=2
										apply_to=both
										active_on=offense
									[/damage]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								impale_armor_reduce=25
							[/variables]
							
							[object]
								 silent=yes
								 
								 [effect]
									apply_to=attack
									name=qquws_w_atrocious_impalement
									increase_damage=3
									[set_specials]
										mode=append
										[dummy]
											id=qquws_impale
											name="impale"
											description="When this weapon is used on offense and a hit lands, it permanently decreases enemy's pierce resistance by 25 once per engagement. Furthermore the opponent's damage and movement points are reduced by 33% for one turn. Champions and The Butcher of Wesnoth are immune. Reduced resistance cannot go below -15%."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_atrocious_impalement
								increase_damage=2
								[set_specials]
									mode=append
									[attacks]
										id=AE_mag_nocounter
										name="no counter-attack"
										description="The opponent has a 0% chance of retaliation when this unit is attacking. Champions and The Butcher of Wesnoth are immune and so are opponents with berserker frenzy."
										value=0
										cumulative=no
										active_on=offense
										apply_to=opponent

										[filter_opponent]
											[filter_weapon]
												[not]
													special_id=berserk
												[/not]
											[/filter_weapon]
			
											[not]
												trait=immune_to_specials
											[/not]
										[/filter_opponent]
									[/attacks]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_pierce_mastery_aura
										name="pierce mastery"
										description="Improves pierce resistance of all allied units by 15% and increases their pierce damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_low

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_low_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_low_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]

				[switch]
					variable=use_promotion_level

					[case]
						value=2

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[heals]
											id=curing
										[/heals]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[heals]
									        affect_allies=yes
									        id=curing
									        name="cures"
									        description="A curer can cure a unit of poison, although that unit will receive no additional healing on the turn it is cured of the poison."
									        affect_self=no
									        poison=cured
									        [affect_adjacent]
									        [/affect_adjacent]
									    [/heals]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]

					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								poison_aura_radius=1
								poison_aura_dmg=1
								damage_on_death_tn_factor=0.33
							[/variables]

							[trait]
								id=qquws_unpoisonable_trait
								name="immune to poison"
								description="This unit cannot be poisoned."

								[effect]
									apply_to=status
									add=unpoisonable
								[/effect]
							[/trait]

							[object]
					 			silent=yes
					 			
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_poison_aura
											name="poisonous fumes 1"
											description="At the beginning of this unit's turn, all adjacent enemies get poisoned and receive 1dmg. Non-living units are immune."
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
											name="unstable concoction 33%"
											description="Upon death this unit drops a flask of a very unstable mixture causing a massive explosion causing impact damage to all surrounding units, friends and foes alike. Damage dealt is equal to 33% value of the current turn number and although the explosion is immense, it does not kill."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								poison_aura_radius=3
								poison_aura_dmg=2
								damage_on_death_tn_factor=0.67
								alcohol_fumes_reduction=5
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[heals]
											id=curing
										[/heals]
										[dummy]
											id=qquws_poison_aura
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_unpoisonable_aura
											name="poison knowledge"
											description="All allied units receive poison immunity."
										[/dummy]
										[dummy]
											id=qquws_poison_aura
											name="poisonous fumes 3"
											description="At the beginning of this unit's turn, all enemies within radius 3 get poisoned and receive 2dmg. Non-living units are immune."
										[/dummy]
										[dummy]
											id=qquws_alcohol_fumes
											name="alcohol fumes 5"
											description="When defending, before the first strike the attacker is engulfed with a cloud of alcohol fumes causing -5% defense and -5% accuracy on all weapons for a duration of one turn."
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
											name="unstable concoction 67"
											description="Upon death this unit drops a flask of a very unstable mixture causing a massive explosion causing impact damage to all surrounding units, friends and foes alike. Damage dealt is equal to 67% value of the current turn number and although the explosion is immense, it does not kill."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_unpoisonable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								poison_aura_radius=5
								poison_aura_dmg=4
								damage_on_death_tn_factor=1
								alcohol_fumes_reduction=10
							[/variables]

							[object]
					 			silent=yes
					 			
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_poison_aura
										[/dummy]
										[dummy]
											id=qquws_alcohol_fumes
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_poison_aura
											name="poisonous fumes 5"
											description="At the beginning of this unit's turn, all enemies within radius 5 get poisoned and receive 4dmg. Non-living units are immune."
										[/dummy]
										[dummy]
											id=qquws_alcohol_fumes
											name="alcohol fumes 10"
											description="When defending, before the first strike the attacker is engulfed with a cloud of alcohol fumes causing -10% defense and -10% accuracy on all weapons for a duration of one turn."
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
											name="unstable concoction 100"
											description="Upon death this unit drops a flask of a very unstable mixture causing a massive explosion causing impact damage to all surrounding units, friends and foes alike. Damage dealt is equal to 100% value of the current turn number and although the explosion is immense, it does not kill."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_med
				
				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_med_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_med_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								melee_endurance_reduction=20
							[/variables]

							[trait]
								id=qquws_undrainable_trait
								name="immune to drain"
								description="This unit's health cannot be drained."

								[effect]
									apply_to=status
									add=undrainable
								[/effect]
							[/trait]

							[object]
					 			silent=yes
					 			
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_melee_endurance
											name="melee endurance 20"
											description="Each time this unit is hit in melee combat, it immediately regenerates 20% of the received damage unless the attack type is secret or the hits otherwise kills the unit."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								melee_endurance_reduction=30
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_melee_endurance
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_undrainable_aura
											name="drains immunity aura"
											description="All allied units receive drains immunity."
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_melee_endurance
											name="melee endurance 30"
											description="Each time this unit is hit in melee combat, it immediately regenerates 30% of the received damage unless the attack type is secret or the hits otherwise kills the unit."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_undrainable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								melee_endurance_reduction=40
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_melee_endurance
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_melee_endurance
											name="melee endurance 40"
											description="Each time this unit is hit in melee combat, it immediately regenerates 40% of the received damage unless the attack type is secret or the hits otherwise kills the unit."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_high
				
				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_high_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_high_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								bloodline_increase=10
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_bloodline
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_bloodline
											name="bloodline 10"
											description="Increases the hitpoints of all allied units on the map by 10%."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_bloodline_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_bloodline_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								bloodline_increase=20
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_bloodline
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_bloodline
											name="bloodline 20"
											description="Increases the hitpoints of all allied units on the map by 20%."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_bloodline_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_bloodline_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								bloodline_increase=30
								treats_wounded_hospital_cost=20
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_bloodline
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_bloodline
											name="bloodline 30"
											description="Increases the hitpoints of all allied units on the map by 30%."
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
											name="treats wounded"
											description="Any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow. Units sent to the recall list do NOT drop items."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_bloodline_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_bloodline_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
			[/case]
			[case]
				value=steadfast
				
				{VARIABLE shield_master_chance 0}
				{VARIABLE shield_master_increase 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE steadfast_factor 1.5}
					[/case]
					[case]
						value=1
						{VARIABLE steadfast_factor 1.75}
					[/case]
					[case]
						value=2
						{VARIABLE steadfast_factor 2}
					[/case]
					[case]
						value=3
						{VARIABLE steadfast_factor 2}
						{VARIABLE shield_master_chance 14}
						{VARIABLE shield_master_increase 20}
					[/case]
					[case]
						value=4
						{VARIABLE steadfast_factor 2.25}
						{VARIABLE shield_master_chance 17}
						{VARIABLE shield_master_increase 40}
					[/case]
					[case]
						value=5
						{VARIABLE steadfast_factor 2.5}
						{VARIABLE shield_master_chance 21}
						{VARIABLE shield_master_increase 70}
					[/case]
				[/switch]
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
						[resistance]
							id=steadfast
						[/resistance]
					    [/abilities]
					[/effect]
					 [effect]
					    apply_to=new_ability
					    [abilities]
						[resistance]
							id=steadfast
							multiply=$steadfast_factor
							max_value=$item_step
							[filter_base_value]
							    greater_than=0
							    less_than=$item_step
							[/filter_base_value]
							name="steadfast"
							description="This unit’s resistances are multiplied by a factor of $steadfast_factor|, up to a maximum of $item_step|%, when defending. Vulnerabilities are not affected."
							affect_self=yes
							active_on=defense
						[/resistance]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=shield_master_chance
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								qquws_shield_master_chance=$shield_master_chance
							[/variables]

							[status]
								qquws_shield_master_active=no
							[/status]

							[object]
								 silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
									[resistance]
										id=qquws_shield_master
									[/resistance]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[resistance]
											id=qquws_shield_master
											add=$shield_master_increase
											max_value=100
											name="shield master $shield_master_increase($shield_master_chance|%)"
											description="This unit has a $shield_master_chance|% chance to raise it's own and adjacent allies' resistances by $shield_master_increase|% each time they defend."
											affect_enemies=no
											affect_allies=yes
											affect_self=yes
											[affect_adjacent]
											[/affect_adjacent]
											active_on=defense
											[filter]
								            	status=qquws_shield_master_active
								            [/filter]
										[/resistance]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=regen
				
				{VARIABLE village_regen 0}
				{VARIABLE extra_description ""}
				{VARIABLE extra_info ""}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE village_regen 16}
						{VARIABLE extra_info "/16"}
						{VARIABLE extra_description " (16hp when stationing in a village)"}
						{VARIABLE fight_regen 4}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 4 hit points."}
					[/case]
					[case]
						value=4
						{VARIABLE village_regen 24}
						{VARIABLE extra_info "/24"}
						{VARIABLE extra_description " (24hp when stationing in a village)"}
						{VARIABLE fight_regen 8}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 8 hit points."}
					[/case]
					[case]
						value=5
						{VARIABLE village_regen 32}
						{VARIABLE extra_info "/32"}
						{VARIABLE extra_description " (32 when stationing in a village)"}
						{VARIABLE fight_regen 12}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 12 hit points."}
					[/case]
				[/switch]
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[regenerate]
								id=regenerates
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates6
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates8
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates10
							[/regenerate]
							[regenerate]
								id=eoma_regenerates6
							[/regenerate]
							[regenerate]
								id=eoma_regenerates8
							[/regenerate]
							[regenerate]
								id=eoma_regenerates10
							[/regenerate]
							[regenerate]
								id=qquws_regenerates
							[/regenerate]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[regenerate]
								value=$item_step
								id=qquws_regenerates
								name="regenerates $item_step|$extra_info"
								description="The unit will heal itself $item_step HP per turn$extra_description|. If it is poisoned, it will remove the poison instead of healing.$fight_r_description"
								affect_self=yes
								poison=cured
							[/regenerate]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=village_regen
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								qquws_fight_regen_amount=$fight_regen
							[/variables]
							
							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[regenerate]
											id=qquws_village_regen
										[/regenerate]
										[dummy]
											id=qquws_fight_regen
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[regenerate]
											value=$village_regen
											id=qquws_village_regen
											affect_self=yes
											poison=cured
											[filter_self]
												[filter_location]
													terrain=*^V*
												[/filter_location]
											[/filter_self]
										[/regenerate]
										[dummy]
											id=qquws_fight_regen
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
				
				{CLEAR_VARIABLE extra_description,extra_info,village_regen,fight_r_description,fight_regen}
			[/case]
			[case]
				value=melee_dmg

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_melee_dmg_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_melee_dmg_trait

						[effect]
						    apply_to=attack
						    range=melee
						    increase_damage="$item_step|%"
						[/effect]
					[/trait]
				[/modify_unit]
				
				{VARIABLE fury_amount 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE fury_amount 10}
					[/case]
					[case]
						value=4
						{VARIABLE fury_amount 17}
					[/case]
					[case]
						value=5
						{VARIABLE fury_amount 24}
						
						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=fury_amount
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								fury_amount=$fury_amount
							[/variables]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_battle_fury
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_battle_fury
											name="battle fury +$fury_amount|%"
											description="With each successful hit the damage increases by $fury_amount|%. If the unit gets hit, the counter is reset. Active only on offense."
											active_on=offense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=ranged_dmg

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_ranged_dmg_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_ranged_dmg_trait

						[effect]
						    apply_to=attack
						    range=ranged
						    increase_damage="$item_step|%"
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    [set_specials]
								    	mode=append
										[attacks]
											id=qquws_ruthless
											name="ruthless"
											description="Adds 1 strike against enemies with no ranged attacks. Attack only."
											active_on=offense
											add=1
											[filter_opponent]
												[not]
													[has_attack]
														range=ranged
													[/has_attack]
												[/not]
											[/filter_opponent]
										[/attacks]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    
								    increase_attacks=1
								    remove_specials=qquws_ruthless
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    [set_specials]
								    	mode=append
									[attacks]
										id=qquws_merciless
										name="merciless"
										description="Adds 3 strikes against enemies with no ranged attacks. Attack only."
										active_on=offense
										add=3
										[filter_opponent]
											[not]
												[has_attack]
													range=ranged
												[/has_attack]
											[/not]
										[/filter_opponent]
									[/attacks]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=ranged_acc

				{VARIABLE assassination_factor 0}
				{VARIABLE regular_cth_cumulative 0}
				{VARIABLE magical_cth 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						{VARIABLE regular_cth_cumulative 2}
						{VARIABLE magical_cth 1}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    increase_damage=1
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=1
						{VARIABLE regular_cth_cumulative 3}
						{VARIABLE magical_cth 3}
					[/case]
					[case]
						value=2
						{VARIABLE regular_cth_cumulative 3}
						{VARIABLE magical_cth 5}
					[/case]
					[case]
						value=3
						{VARIABLE assassination_factor 0.5}
						{VARIABLE assassination_value 1.5}
						{VARIABLE assassination_readable "50%"}
						{VARIABLE regular_cth_cumulative 4}
						{VARIABLE magical_cth 7}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    increase_damage=1
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						{VARIABLE assassination_factor 1}
						{VARIABLE assassination_value 2}
						{VARIABLE assassination_readable "100%"}
						{VARIABLE regular_cth_cumulative 4}
						{VARIABLE magical_cth 10}
					[/case]
					[case]
						value=5
						{VARIABLE assassination_factor 1.5}
						{VARIABLE assassination_value 2.5}
						{VARIABLE assassination_readable "150%"}
						{VARIABLE regular_cth_cumulative 4}
						{VARIABLE magical_cth 15}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    increase_damage=1
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]

				[object]
					 silent=yes

					[effect]
					    apply_to=attack
					    range=ranged
					    [not]
					    	special_id=qquws_block_specials,magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
					    [/not]

					    increase_accuracy=$regular_cth_cumulative
					[/effect]
					[effect]
					    apply_to=attack
					    range=ranged
					    special_id=qquws_block_specials,magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
					    remove_specials=qquws_magical_cth
					    [set_specials]
					    	mode=append
							[chance_to_hit]
								id=qquws_magical_cth
								name="concentrated magic +$magical_cth"
								description="The magical chance to hit on this attack is improved by $magical_cth|%."
								add=$magical_cth
								cumulative=no
								active_on=offense
							[/chance_to_hit]
					    [/set_specials]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=assassination_factor
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								assassination_factor=$assassination_factor
							[/variables]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    remove_specials=qquws_assassination
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_assassination
											name="assassination x$assassination_value"
											description="This attack can deal up to $assassination_readable more damage if a single hit eliminates the opponent. Attack only."
											active_on=offense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_parry

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[object]
						 silent=yes

						[effect]
						    apply_to=attack
						    range=melee
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    increase_parry=$item_step
						[/effect]
					[/object]
				[/modify_unit]

				{VARIABLE counterbalance_settings ""}
				[switch]
					variable=use_promotion_level

					[case]
						value=3

						{VARIABLE counterbalance_settings "70,90"}
						{VARIABLE counterbalance_info 30}
					[/case]
					[case]
						value=4

						{VARIABLE counterbalance_settings "60,85,95"}
						{VARIABLE counterbalance_info 40}
					[/case]
					[case]
						value=5

						{VARIABLE counterbalance_settings "50,80,90,95"}
						{VARIABLE counterbalance_info 50}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes

								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_peaceful_warrior
											name="peaceful warrior"
											description="When defending this unit will never deal the fatal blow and kill the enemy. Instead it will disarm them by leaving 1hp and removing all weapons for a duration of one turn."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]

				[if]
					[variable]
						name=counterbalance_settings
						not_equals=""
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								counterbalance_list=$counterbalance_settings
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_counterbalance
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_counterbalance
											name="counterbalance $counterbalance_info"
											description="When defending, each time this unit dodges a melee attack it has $counterbalance_info|% chance to retaliate multiple times before enemy can attack again. Retaliations deal 50% of the base damage and all weapon specials are disabled."
											active_on=defense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_poison
				
				{VARIABLE backstab_factor 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	[poison]
								        id=poison
								        name="poison (lower level only)"
								        description="This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit. Affects only enemies of lower level."
								    	[filter_opponent]
								    		formula="if(level < other.level, 1, 0)"
								    	[/filter_opponent]
								    [/poison]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	[poison]
								        id=poison
								        name="poison (same and lower level only)"
								        description="This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit. Affects only enemies of the same or lower level."
								    	[filter_opponent]
								    		formula="if(level <= other.level, 1, 0)"
								    	[/filter_opponent]
								    [/poison]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	{WEAPON_SPECIAL_POISON}
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						{VARIABLE backstab_factor 1.25}
						{VARIABLE acc_increase 2}
					[/case]
					[case]
						value=4
						{VARIABLE backstab_factor 1.5}
						{VARIABLE acc_increase 1}
					[/case]
					[case]
						value=5
						{VARIABLE backstab_factor 2}
						{VARIABLE acc_increase 2}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=backstab_factor
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=backstab
							    increase_accuracy=$acc_increase
							    [set_specials]
							    	mode=append
							        [damage]
										id=backstab
										name="backstab x$backstab_factor"
										description="When used offensively, this attack deals x$backstab_factor damage if there is an enemy of the target on the opposite side of the target."
										multiply=$backstab_factor
										active_on=offense
										[filter_opponent]
										    formula="
											enemy_of(self, flanker) and not flanker.petrified
										    where
											flanker = unit_at(direction_from(loc, other.facing))
										    "
										[/filter_opponent]
									[/damage]
							    [/set_specials]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_slow
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
										id=slow
										name="slows (day only)"
										description="This attack slows the target until it ends a turn. Active only during a day."
										[filter_self]
											[filter_location]
												time_of_day_id=morning,midday,afternoon
											[/filter_location]
										[/filter_self]
									[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
									id=slow
									name="slows (day, dawn and dusk)"
									description="This attack slows the target until it ends a turn. Active only during a day, dawn and dusk."
									[filter_self]
										[filter_location]
											time_of_day_id=dawn,morning,midday,afternoon,dusk
										[/filter_location]
									[/filter_self]
								[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							   	[not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
										id=slow
										name="slows"
										description="This attack slows the target until it ends a turn."
									[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								slow_aura_damage=1
							[/variables]
						
							[object]
								silent=yes
								
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_slow_aura
											name="slow aura"
											description="At the beginning of the turn all surrounding enemies receive small cold damage and get slowed. This ability in and of itself does not kill."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								slow_aura_damage=2
							[/variables]
						
							[object]
								silent=yes
								
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_lesser_chronosphere
											name="lesser chronosphere"
											description="When defending against melee attacks, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								slow_aura_damage=4
							[/variables]
						
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_lesser_chronosphere
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_chronosphere
											name="chronosphere"
											description="When defending, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=mp
				[object]
					 silent=yes

					[effect]
					    apply_to=movement
					    increase=$item_step
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[trait]
								id=qquws_unslowable_trait
								name="slow immunity"
								description="This unit can not be slowed."

								[effect]
									apply_to=status
									add=unslowable
								[/effect]
							[/trait]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[object]
				 			silent=yes
				 			
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_unslowable_aura
										name="slow immunity aura"
										description="All allied units receive slow immunity."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_unslowable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[object]
				 			silent=yes
				 			
							[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_unslowable_aura
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										# id must stay the same
										id=qquws_unslowable_aura
										name="motility mastery"
										description="This unit and all allies become immune to slow. In addition to that at the beginning of this unit's turn all surrounding enemies become immobilised. Affected units lose their zone of control. Champions, the Butcher of Wesnoth and unslowable units are immune."
									[/dummy]
									[dummy]
										id=qquws_motility_aoe
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=feeding
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 5}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=halo
								    halo="halo/uws/deluminates.png"
								[/effect]
								[effect]
									apply_to=alignment
									set=chaotic
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=1
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 15}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=2
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 25}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=3
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 15}
						{VARIABLE summons_lvl 0}
						{VARIABLE summons_ageless "Walking Corpse,AE_arc_phantom_Mummy,AE_arc_despair_Wisp"}
						{VARIABLE summons_default "Walking Corpse"}
						{VARIABLE deluminates_value 25}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=4
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 17}
						{VARIABLE summons_lvl 1}
						{VARIABLE summons_ageless "Skeleton,Ghost,QQ_enslaved_soul,Skeleton Archer,AE_arc_despair_Spearman,AE_arc_despair_Fright,AE_mrc_Blight_Charred_Zombie"}
						{VARIABLE summons_default "Skeleton,Ghost,QQ_enslaved_soul,Skeleton Archer"}
						{VARIABLE deluminates_value 30}
						{VARIABLE deluminates_limit 30}
						{VARIABLE feeding_cap 1}
					[/case]
					[case]
						value=5
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 19}
						{VARIABLE summons_lvl 2}
						{VARIABLE summons_ageless "Shadow,Wraith,Revenant,Death Squire,AE_mrc_Blight_Dismembered,AE_arc_despair_Black_Shadow"}
						{VARIABLE summons_default "Shadow,Wraith,Revenant,Death Squire"}
						{VARIABLE deluminates_value 35}
						{VARIABLE deluminates_limit 35}
						{VARIABLE feeding_cap 1}
					[/case]
				[/switch]
				
				{VARIABLE summons_list $summons_default}
				[if]
					[variable]
						name=random_pool.allow_ae
						boolean_equals=yes
					[/variable]
					[then]
						{VARIABLE summons_list $summons_ageless}
					[/then]
				[/if]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[object]
						silent=yes
						
						[effect]
						    apply_to=remove_ability
						    [abilities]
								[illuminates]
									id=qquws_delumination
								[/illuminates]
						    [/abilities]
						[/effect]
						[effect]
						    apply_to=new_ability
						    [abilities]
								[illuminates]
							        id=qquws_delumination
							        value=-$deluminates_value
							        min_value=-$deluminates_limit
							        max_value=0
							        cumulative=no
							        name="deluminates $deluminates_value"
							        description="This unit obscures the surrounding area, making chaotic units fight better, and lawful units fight worse."
							        affect_self=yes
							    [/illuminates]
						    [/abilities]
						[/effect]
					[/object]
				[/modify_unit]
				
				[if]
					[variable]
						name=feeding_cap
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								feeding_cap=$feeding_cap
							[/variables]

							[object]
								silent=yes
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_feeding
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
									[dummy]
										id=qquws_feeding
										name="magical feeding"
										description="This unit gains extra hitpoints whenever it kills a unit. The number added depends on the level of the unit killed (cap $feeding_cap|)."
									[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=summons_enabled
						boolean_equals=yes
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								summons_chance=$summons_chance
								summons_list=$summons_list
							[/variables]

							[object]
								silent=yes
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_raises_undead
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_raises_undead
											name="raises the undead"
											description="At the beginning of it's turn, this unit has $summons_chance|% chance to summon a level $summons_lvl undead minion. The strength of the summoned units varies."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=leadership

				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE leadership_amount 5}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=1
						{VARIABLE leadership_amount 15}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=2
						{VARIABLE leadership_amount 25}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=3
						{VARIABLE leadership_amount 25}
						{VARIABLE leads_by_example_value 15}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=4
						{VARIABLE leadership_amount 30}
						{VARIABLE leads_by_example_value 25}
						{VARIABLE great_leader_value 25}
					[/case]
					[case]
						value=5
						{VARIABLE leadership_amount 35}
						{VARIABLE leads_by_example_value 35}
						{VARIABLE great_leader_value 50}

						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]

				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[leadership]
								id=leadership
							[/leadership]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[leadership]
								id=leadership
								value=$leadership_amount
								cumulative=no
								name="leadership"
								description="This unit can lead your own units that are next to it, making them fight better. Affects units of the same or lower level increasing their damage by $leadership_amount|% regardless of their level difference."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
								    [filter]
									formula="level <= other.level"
								    [/filter]
								[/affect_adjacent]
							[/leadership]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=leads_by_example_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								qquws_leads_by_example_buff=$leads_by_example_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_leads_by_example
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_leads_by_example
											name="leads by example $leads_by_example_value|%"
											description="Whenever this unit attacks a champion, or a regular enemy of the same or higher level with more than 50% hitpoints, then all units of the same side that haven't made a move yet receive +1mp and a $qquws_leads_by_example|% damage bonus until the end of the turn."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=great_leader_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								qquws_great_leader_teaching_rate=$great_leader_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_great_leader
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_great_leader
											name="great leader $great_leader_value|%"
											description="Whenever this unit kills an enemy all surrounding allied units receive $great_leader_value|% experience points of the kill as teachings and explanations from the leader."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=drain

				{VARIABLE drains_extra_label ""}
				{VARIABLE drains_extra_text ""}
				{VARIABLE drains_non_living_percentage 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=ranged
								[not]
							    	special_id=qquws_block_specials
							    [/not]

								[set_specials]
									 mode=append
									[damage]
										id=qquws_evil
										name="wicked"
										description="When used offensively at nighttime, this attack deals 15% more damage to living units."
										multiply=1.15
										active_on=offense
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
									[dummy]
										id=qquws_non_living_drains
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/20%"}
						{VARIABLE drains_non_living_percentage 20}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 20% of the damage dealt."}
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=ranged
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_evil
								[set_specials]
									 mode=append
									 [damage]
										id=qquws_evil
										name="wicked"
										description="When used offensively at nighttime, this attack deals 25% more damage to living units."
										multiply=1.25
										active_on=offense
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/30%"}
						{VARIABLE drains_non_living_percentage 30}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 30% of the damage dealt."}
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_evil
								[set_specials]
									 mode=append
									 [damage]
										id=qquws_evil
										name="unholy"
										description="When used at nighttime, this attack deals 35% more damage to living units."
										multiply=1.35
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/40%"}
						{VARIABLE drains_non_living_percentage 40}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 40% of the damage dealt."}
					[/case]
				[/switch]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[variables]
						non_living_drains=$drains_non_living_percentage
					[/variables]

					[object]
						silent=yes

						[effect]
						    apply_to=attack
						    range=ranged
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    remove_specials=drains,qquws_drains
						    [set_specials]
						    	mode=append
						    	[drains]
									id=qquws_drains
									name="drains $item_step|%$drains_extra_label"
									description="This unit drains health from living units, healing itself for $item_step|% the amount of damage it deals (rounded down).$drains_extra_text"
									value=$item_step
								[/drains]
						    [/set_specials]
						[/effect]
					[/object]
				[/modify_unit]
			[/case]
			[case]
				value=defense
				[object]
					 silent=yes

					[effect]
					    apply_to=movement_costs
					    replace=no
					    [movement_costs]
							flat=-$item_step
							frozen=-$item_step
							forest=-$item_step
							hills=-$item_step
							mountains=-$item_step
							village=-$item_step
							swamp_water=-$item_step
							shallow_water=-$item_step
							deep_water=-$item_step
							reef=-$item_step
							castle=-$item_step
							cave=-$item_step
							sand=-$item_step
							fungus=-$item_step
					    [/movement_costs]
					[/effect]
				[/object]
				
				{VARIABLE improve_defense 0}
				[switch]
					variable=use_promotion_level

					[case]
						value=0
						{VARIABLE improve_defense 1}
					[/case]
					[case]
						value=1
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=2
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=3
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=4
						{VARIABLE improve_defense 3}

						[object]
							silent=yes

							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_terrain_knowledge
										name="terrain knowledge"
										description="This unit mastered the different terrains. All allied units improve defense by 5% on all terrains."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_terrain_knowledge_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						{VARIABLE improve_defense 0}
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_terrain_knowledge
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_terrain_mastery
										name="cartography"
										description="All allied units receive +10% defense everywhere and improve their movement costs by 1."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_terrain_knowledge_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_terrain_mastery_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=improve_defense
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
								apply_to=defense
								replace=no
								[defense]
									flat=-$improve_defense
									frozen=-$improve_defense
									forest=-$improve_defense
									hills=-$improve_defense
									mountains=-$improve_defense
									village=-$improve_defense
									swamp_water=-$improve_defense
									shallow_water=-$improve_defense
									deep_water=-$improve_defense
									reef=-$improve_defense
									castle=-$improve_defense
									cave=-$improve_defense
									sand=-$improve_defense
									fungus=-$improve_defense
								[/defense]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=skirm
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher (nighttime only)"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control. Active only during nighttime."
										affect_self=yes
										[filter_self]
											[filter_location]
												time_of_day_id=first_watch,midnight,second_watch
											[/filter_location]
										[/filter_self]
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher (dusk, nighttime and dawn)"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control. Active only during dusk, nighttime and dawn."
										affect_self=yes
										[filter_self]
											[filter_location]
												time_of_day_id=dusk,first_watch,midnight,second_watch,dawn
											[/filter_location]
										[/filter_self]
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control."
										affect_self=yes
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
							    apply_to=movement
							    increase=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								battle_fervor_mp=1
							[/variables]
							
							[object]
								silent=yes

								[effect]
								    apply_to=movement
								    increase=1
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
											name="battle fervor +1"
											description="Increases movement points of all ally units by 1."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
						
						[fire_event]
							name=apply_battle_fervor_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								battle_fervor_mp=2
							[/variables]
							
							[object]
								silent=yes

								[effect]
									apply_to=remove_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
											name="battle fervor +2"
											description="Increases movement points of all ally units by 2."
										[/dummy]
										[dummy]
											id=qquws_enemy_control
											name="enemy control"
											description="All allied units learn how to ignore enemies' zones of control."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
						
						[fire_event]
							name=apply_battle_fervor_to_all_allies
						[/fire_event]
						
						[fire_event]
							name=apply_enemy_control_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
			[/case]
			[case]
				value=first_strike
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 [firststrike]
								        id=firststrike
								        name="first strike (lower levels only)"
								        description="This unit always strikes first with this attack against enemies of lower level."
								        [filter_opponent]
								    		formula="if(level < other.level, 1, 0)"
								    	[/filter_opponent]
								    [/firststrike]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 {WEAPON_SPECIAL_FIRSTSTRIKE}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 {WEAPON_SPECIAL_FIRSTSTRIKE}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								preemptive_strike_chance=50
								preemptive_strike_damage=50
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									[set_specials]
										 mode=append
										 
										 [dummy]
										 	id=qquws_preemptive_strike
											name="preemptive strike 50%"
											description="When attacking you strike twice before the enemy can retaliate. The first strike deals 50% normal damage, has always 50% chance to hit and all specials disabled. Champions and the Butcher of Wesnoth are immune."
											active_on=offense
										 [/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								preemptive_strike_chance=60
								preemptive_strike_damage=75
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_preemptive_strike
									[set_specials]
										 mode=append
										 
										 [dummy]
										 	id=qquws_preemptive_strike
											name="preemptive strike 75%"
											description="When attacking you strike twice before the enemy can retaliate. The first strike deals 75% normal damage, has always 60% chance to hit and all specials disabled. Champions and the Butcher of Wesnoth are immune."
											active_on=offense
										 [/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_preemptive_strike
								[set_specials]
									 mode=append
									 [dummy]
									 	id=qquws_initiative
										name="initiative"
										description="When attacking and defending you strike twice before the enemy. The first strike deals 125% normal damage, has always 70% chance to hit and all specials disabled. Champions and the Butcher of Wesnoth are immune."
									 [/dummy]
								[/set_specials]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
							    	[firststrike]
										id=qquws_eagerness_aura
										name="eagerness aura"
										description="All surrounding allies gain first strike on all weapons."
										affect_enemies=no
										affect_allies=yes
										affect_self=no
										[affect_adjacent]
										[/affect_adjacent]
									[/firststrike]
							    [/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=fear

				{VARIABLE fear_reduction 0}
				{VARIABLE fear_radius 0}
				{VARIABLE fear_heal_on_hit 0}
				{VARIABLE fear_max_lvl 0}
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE fear_reduction 0}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 5}
						{VARIABLE fear_radius 1}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=1
						{VARIABLE fear_reduction 5}
						{VARIABLE fear_kill_reduction 5}
						{VARIABLE fear_attack_reduction 5}
						{VARIABLE fear_radius 1}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=2
						{VARIABLE fear_reduction 5}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 10}
						{VARIABLE fear_radius 2}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=3
						{VARIABLE fear_reduction 10}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 15}
						{VARIABLE fear_radius 3}
						{VARIABLE fear_heal_on_hit 1}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=4
						{VARIABLE fear_reduction 10}
						{VARIABLE fear_kill_reduction 15}
						{VARIABLE fear_attack_reduction 20}
						{VARIABLE fear_radius 4}
						{VARIABLE fear_heal_on_hit 2}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=5
						{VARIABLE fear_reduction 15}
						{VARIABLE fear_kill_reduction 15}
						{VARIABLE fear_attack_reduction 25}
						{VARIABLE fear_radius 5}
						{VARIABLE fear_heal_on_hit 3}
						{VARIABLE fear_lvl_inc 0}
						
						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]
				
				{VARIABLE fear_kill_total_reduction $fear_reduction}
				{VARIABLE_OP fear_kill_total_reduction add $fear_kill_reduction}
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						fear_reduction=$fear_reduction
						fear_kill_reduction=$fear_kill_reduction
						fear_radius=$fear_radius
						fear_increase_max_level=$fear_lvl_inc
					[/variables]
					
					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_necromancers_bane
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_necromancers_bane
									name="necromancer's bane"
									description="Each time this unit attacks, the defender retaliates with $fear_attack_reduction|% damage reduction. Furthermore all enemies level of the unit killed + 1 and less within range $fear_radius from this unit receive $fear_reduction|% damage reduction ($fear_kill_total_reduction|% if the unit is killed) at the end of the fight for a duration of one turn. Champions, Butcher of Wesnoth, fearless units, and leaders receive half of the reduction."
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
						    apply_to=attack
						    remove_specials=qquws_necro_bane_dmg
						    [set_specials]
					    	  	mode=append
					     		[damage]
									id=qquws_necro_bane_dmg
									name=""
									description=""
									active_on=offense
									apply_to=opponent
									multiply="( (100.0 - if(defender.traits.immune_to_specials or defender.traits.fearless or defender.canrecruit, $fear_attack_reduction / 2.0, $fear_attack_reduction)) / 100.0 )"
								[/damage]
						    [/set_specials]
						 [/effect]
					[/object]
				[/modify_unit]
				
				[if]
					[variable]
						name=fear_heal_on_hit
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_heals_on_hit
								[set_specials]
								  mode=append
									  [heal_on_hit]
										id=qquws_heals_on_hit
										name="heals on hit +$fear_heal_on_hit"
										description="Each landing hit causes this unit to heal $fear_heal_on_hit hitpoint(s)."
										value=$fear_heal_on_hit
										apply_to=self
									  [/heal_on_hit] 
								[/set_specials]
							 [/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=discouragement
				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     range=melee
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 10%"
										description="When used defensively this attack reduces the opponent's damage by 10%."
										multiply=0.9
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=1

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     range=melee
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 15%"
										description="When used defensively this attack reduces the opponent's damage by 15%."
										multiply=0.85
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=2

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 20%"
										description="When used defensively this attack reduces the opponent's damage by 20%."
										multiply=0.8
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=3

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     range=melee
							     [set_specials]
							    		mode=append
							     	  	[attacks]
											id=qquws_discouragement
											name="discourage"
											description="When used in defense, this attack reduces the opponent's number of strikes by 1."
											sub=1
											active_on=defense
											apply_to=opponent
									 	[/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=4

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten,qquws_discouragement
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 25%"
										description="When used defensively this attack reduces the opponent's damage by 25%."
										multiply=0.75
										apply_to=opponent
										active_on=defense
								    [/damage]
								    [attacks]
										id=qquws_discouragement
										name="discourage"
										description="When used in defense, this attack reduces the opponent's number of strikes by 1."
										sub=1
										active_on=defense
										apply_to=opponent
								 	[/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 30%"
										description="When used defensively this attack reduces the opponent's damage by 30%."
										multiply=0.7
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
							 [effect]
								apply_to=new_attack
								name=qquws_w_corruption
								description="corruption"
								type=corruption
								range=corruption
								icon="attacks/wail.png"
								damage=1
								number=1
								[specials]
									[dummy]
										id=qquws_corruption
										name="corrupts"
										description="When used the enemy unit will either change sides or become enraged and it's damage will increase by 40%. The chance of conversion depends on the difference in levels between the corrupting and the corrupted unit. If the levels are the same it's 50% - 50%. Each point of difference in levels affects the chances by 20%. Champions, the Butcher of Wesnoth and recruiting units are immune. Available only on offense. Number of owned corrupted units is limited to 1."
										active_on=offense
									[/dummy]
									[chance_to_hit]
										id=magical
										name="always hits"
										description="This attack has always a 100% chance to hit regardless of the defensive ability of the unit being attacked."
										value=100
										cumulative=no
									[/chance_to_hit]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=burns

				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[object]
							silent=yes

							[effect]
							    apply_to=halo
							    halo="halo/uws/burns.png"
							[/effect]
						[/object]

						{VARIABLE secret_fire_adjacent 2}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "2"}
						{VARIABLE fire_vision_bonus 0}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-5
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1

						{VARIABLE secret_fire_adjacent 4}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "4"}
						{VARIABLE fire_vision_bonus 0}
					[/case]
					[case]
						value=2

						{VARIABLE secret_fire_adjacent 8}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "8"}
						{VARIABLE fire_vision_bonus 0}
					[/case]
					[case]
						value=3

						{VARIABLE secret_fire_adjacent 12}
						{VARIABLE secret_fire_defending 8}
						{VARIABLE secret_fire_message " Additionally it deals 8 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 15%."}
						{VARIABLE secret_fire_name_info "12(8)"}
						{VARIABLE fire_vision_bonus 1}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4

						{VARIABLE secret_fire_adjacent 16}
						{VARIABLE secret_fire_defending 12}
						{VARIABLE secret_fire_message " Additionally it deals 12 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 15%."}
						{VARIABLE secret_fire_name_info "16(12)"}
						{VARIABLE fire_vision_bonus 2}
					[/case]
					[case]
						value=5
						
						{VARIABLE secret_fire_adjacent 20}
						{VARIABLE secret_fire_defending 16}
						{VARIABLE secret_fire_message " Additionally it deals 16 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 25%."}
						{VARIABLE secret_fire_name_info "20(16)"}
						{VARIABLE fire_vision_bonus 3}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
				[/switch]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						secret_fire_adjacent=$secret_fire_adjacent
						secret_fire_defending=$secret_fire_defending
					[/variables]

					[object]
						 silent=yes

						[effect]
						    apply_to=remove_ability
						    [abilities]
								[dummy]
									id=qquws_secret_fire
								[/dummy]
						    [/abilities]
						[/effect]
						[effect]
						    apply_to=new_ability
						    [abilities]
								[dummy]
									id=qquws_secret_fire
									name="secret fire $secret_fire_name_info"
									description="Burns adjacent enemies at the beginning of each turn dealing $secret_fire_adjacent base fire damage (affected by time of day bonus according to the unit's alignment).$secret_fire_message"
								[/dummy]
						    [/abilities]
						[/effect]
					[/object]
				[/modify_unit]

				[if]
					[variable]
						name=fire_vision_bonus
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								fire_vision_bonus=$fire_vision_bonus
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_fire_vision
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_fire_vision
											name="fire vision +$fire_vision_bonus"
											description="All allied units receive +$fire_vision_bonus bonus vision points."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_fire_vision_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_fire_vision_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=golden_armor
				
				{VARIABLE reflects_value 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=3
						{VARIABLE reflects_value 15}
						{VARIABLE golden_armour_value 13}
					[/case]
					[case]
						value=4
						{VARIABLE reflects_value 30}
						{VARIABLE golden_armour_value 16}
					[/case]
					[case]
						value=5
						{VARIABLE reflects_value 50}
						{VARIABLE golden_armour_value 20}
					[/case]
				[/switch]

				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
							impact=-$item_step
							pierce=-$item_step
							arcane=-$item_step
							cold=-$item_step
							fire=-$item_step
							secret=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=reflects_value
						greater_than=0
					[/variable]
					[then]
						[object]
							 silent=yes

							[effect]
							    apply_to=remove_ability
							    [abilities]
								[dummny]
									id=qquws_reflects_damage
								[/dummny]
							    [/abilities]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
								[dummny]
									id=qquws_reflects_damage
									name="reflects damage"
									description="When defending, $reflects_value|% of received damage is reflected back to the attacker. Passively increases all resistances by $golden_armour_value|%."
								[/dummny]
							    [/abilities]
							[/effect]
						[/object]
						
						{VARIABLE_OP reflects_value divide 100}
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								reflects_factor=$reflects_value
							[/variables]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=heal

				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[heals]
								id=healing
							[/heals]
							[heals]
								id=curing
							[/heals]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[heals]
								value=$item_step
								id=healing
								affect_allies=yes
								name="heals +$item_step"
								description="This unit combines herbal remedies with magic to heal units more quickly than is normally possible on the battlefield."
								affect_self=no
								poison=cured
								[affect_adjacent]
									adjacent=n,ne,se,s,sw,nw
								[/affect_adjacent]
							[/heals]
					    [/abilities]
					[/effect]
				[/object]

				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								silent=yes

								[effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-5
								    [/resistance]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]

					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=2
								heals_restore_statuses=no
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-10
								    [/resistance]
								[/effect]
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_global_heals
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_global_heals
											name="heals all +2"
											description="At the beginning of it's turn, this unit heals all ally units on the map. Healing amount is 2 hitpoints."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=4
								heals_restore_statuses=no
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_heals
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_global_heals
											name="heals all +4"
											description="At the beginning of it's turn, this unit heals all ally units on the map. Healing amount is 4 hitpoints."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=8
								heals_restore_statuses=yes
							[/variables]

							[trait]
								id=qquws_distinguished
								name=distinguished
								description="Distinguished units can assume the role of a new leader in an unfortunate situation where one dies."
							[/trait]
							
							[object]
								 silent=yes

								 [effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-10
								    [/resistance]
								[/effect]
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_heals
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_global_heals
											name="restores all +8"
											description="At the beginning of it's turn, this unit not only heals all ally units on the map, but also cures, removes slow and unpetrifies them. Healing amount is 8 hitpoins."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=freezing_gem
				
				{VARIABLE freezing_touch_amount 0}
				{VARIABLE freezing_touch_cold 5}
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE freezing_touch_amount 1}
						{VARIABLE freezing_touch_cold 5}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-5
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						{VARIABLE freezing_touch_amount 2}
						{VARIABLE freezing_touch_cold 5}
					[/case]
					[case]
						value=2
						{VARIABLE freezing_touch_amount 3}
						{VARIABLE freezing_touch_cold 5}
					[/case]
					[case]
						value=3
						{VARIABLE freezing_touch_amount 4}
						{VARIABLE freezing_touch_cold 15}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-10
							    [/resistance]
							[/effect]
							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    [set_specials]
									mode=append
									[dummy]
										id=qquws_icy_shackles
										name="icy shackles"
										description="At the end of the fight, the opponent's strikes and movement are reduced for a duration of one turn. The level of reduction depends on the difference in defense before and after the fight. Active only on offense."
									[/dummy]
							    [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=4
						{VARIABLE freezing_touch_amount 6}
						{VARIABLE freezing_touch_cold 15}
					[/case]
					[case]
						value=5
						{VARIABLE freezing_touch_amount 8}
						{VARIABLE freezing_touch_cold 25}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=freezing_touch_amount
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								freezing_touch_amount=$freezing_touch_amount
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_freezing_gem
								    [set_specials]
										mode=append
										[dummy]
											id=qquws_freezing_gem
											name="freezing touch $freezing_touch_amount"
											description="Each landing hit of this weapon decreases enemy's defense ability by $freezing_touch_amount for 1 turn. Passively increases cold resistance by $freezing_touch_cold"
										[/dummy]
								    [/set_specials]
								 [/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=field_disruption

				{VARIABLE half_value "$( floor($item_step * 0.5) )"}
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[resistance]
								id=qquws_field_disruption
							[/resistance]
							[resistance]
								id=qquws_field_disruption_champions
							[/resistance]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[resistance]
								id=qquws_field_disruption
								sub=$item_step
								max_value=100
								apply_to=arcane,cold,fire
								name="field disruption"
								description="Enemies standing next to this unit have their arcane, cold and fire resistances reduced by $item_step|. Champions receive half the effect."
								affect_self=no
								affect_allies=no
								affect_enemies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
									[filter]
										[not]
											trait=immune_to_specials
										[/not]
									[/filter]
								[/affect_adjacent]
							[/resistance]
							[resistance]
								id=qquws_field_disruption_champions
								sub=$half_value
								max_value=100
								apply_to=arcane,cold,fire
								affect_self=no
								affect_allies=no
								affect_enemies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
									[filter]
										trait=immune_to_specials
									[/filter]
								[/affect_adjacent]
							[/resistance]
					    [/abilities]
					[/effect]
				[/object]

				{VARIABLE phase_disruption 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						{VARIABLE phase_disruption 5}
						{VARIABLE phase_damage 0.05}
						{VARIABLE phase_damage_info 5}
						{VARIABLE phase_min_base_dmg 13}
					[/case]
					[case]
						value=4
						{VARIABLE phase_disruption 10}
						{VARIABLE phase_damage 0.15}
						{VARIABLE phase_damage_info 15}
						{VARIABLE phase_min_base_dmg 9}
					[/case]
					[case]
						value=5
						{VARIABLE phase_disruption 15}
						{VARIABLE phase_damage 0.25}
						{VARIABLE phase_damage_info 25}
						{VARIABLE phase_min_base_dmg 4}
					[/case]
				[/switch]

				[if]
					[variable]
						name=phase_disruption
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
							    apply_to=remove_ability
							    [abilities]
									[chance_to_hit]
										id=qquws_phase_disruption
									[/chance_to_hit]
									[chance_to_hit]
										id=qquws_phase_disruption_ally
									[/chance_to_hit]
							    [/abilities]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
									[chance_to_hit]
										id=qquws_phase_disruption
										sub=$phase_disruption
										name="phase disruption $phase_disruption|($phase_damage_info|)"
										description="Surrounding non-champion enemies have their magical damage reduced by chance to hit reduced by $phase_damage_info|% and chance to hit by$phase_disruption|%. Conversely surrounding ally units have their magical damage and chance to hit increased by the corresponding amount."
										affect_self=no
										affect_allies=no
										affect_enemies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_student]
									[/chance_to_hit]
									[damage]
										id=qquws_phase_damage_disruption
										multiply="$( 1.0 - $phase_damage )"
										affect_self=no
										affect_allies=no
										affect_enemies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_student]
										[filter_base_value]
											greater_than=$phase_min_base_dmg
										[/filter_base_value]
									[/damage]
									[chance_to_hit]
										id=qquws_phase_disruption_ally
										add=$phase_disruption
										affect_self=no
										affect_allies=yes
										affect_enemies=no
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]
										[/filter_student]
									[/chance_to_hit]
									[damage]
										id=qquws_phase_damage_disruption_ally
										multiply="$( 1.0 + $phase_damage )"
										affect_self=no
										affect_allies=yes
										affect_enemies=no
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_student]
										[filter_base_value]
											greater_than=$phase_min_base_dmg
										[/filter_base_value]
									[/damage]
							    [/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=armor_destruction

				{VARIABLE damage_increase_txt 1}
				{VARIABLE bloodseeker_factor 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						{VARIABLE damage_increase_txt 1}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						{VARIABLE damage_increase_txt 1}
					[/case]
					[case]
						value=2
						
						{VARIABLE damage_increase_txt 1}
					[/case]
					[case]
						value=3
						
						{VARIABLE damage_increase_txt 2}
						{VARIABLE bloodseeker_factor 5}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						{VARIABLE damage_increase_txt 2}
						{VARIABLE bloodseeker_factor 7.5}
					[/case]
					[case]
						value=5
						
						{VARIABLE damage_increase_txt 3}
						{VARIABLE bloodseeker_factor 10}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
									[dummy]
										id=qquws_bloodlust9
										name="bloodlust +9"
										description="This unit gains 9 hitpoints added to its current health whenever it kills a living unit."
									[/dummy]
							    [/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=item_step
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								armor_destruction_amount=$item_step
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									range=melee
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_armor_destruction
									[set_specials]
										mode=append
										[dummy]
											id=qquws_armor_destruction
											name="armor destruction $item_step"
											description="Each landing hit permanently decreases enemy's resistance to this weapon's damage type by $item_step|. Resistance cannot go lower than -15. Works only on offense. Passively increases melee damage by $damage_increase_txt"
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=bloodseeker_factor
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									range=melee
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_bloodseeker
									[set_specials]
										mode=append
										[damage]
							                id=qquws_bloodseeker
							                name="bloodseeker $bloodseeker_factor"
							                description="The more wounded the opponent is the more damage this attack deals. Damage dealt is $bloodseeker_factor|% higher per every 10% hitpoints missing. Active only on offense."
							                multiply="( 1.0 + 0.01 * $bloodseeker_factor * if(defender.max_hitpoints > 0, floor( 10.0 * (defender.max_hitpoints - defender.hitpoints + 0.5) / defender.max_hitpoints ), 0) )"
							                apply_to=attacker
							                active_on=offense
							            [/damage]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=protection
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[resistance]
								id=qquws_protection
							[/resistance]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[resistance]
								id=qquws_protection
								add=$item_step
								max_value=75
								apply_to=blade,impact,pierce
								name="protection"
								description="Friendly warriors standing next to this unit have their blade, impact and pierce resistances increased by $item_step up to maximum of 75."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
								[/affect_adjacent]
							[/resistance]
					    [/abilities]
					[/effect]
				[/object]

				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
										multiply=1.2
										active_on=defense
										name="defensive wall"
										description="Friendly warriors standing next to this unit deal 20% more melee damage when defending."
										affect_self=no
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_defender]
											[filter_weapon]
												range=melee
											[/filter_weapon]
										[/filter_defender]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
										multiply=1.4
										active_on=defense
										name="defensive wall"
										description="Friendly warriors standing next to this unit deal 40% more melee damage when defending."
										affect_self=no
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_defender]
											[filter_weapon]
												range=melee
											[/filter_weapon]
										[/filter_defender]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_impenetrable_wall
										multiply=1.5
										active_on=defense
										name="impenetrable wall"
										description="Friendly warriors standing next to this unit deal 50% more damage when defending."
										affect_self=no
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=double_attack
				
				{VARIABLE attacks_done $unit.variables.double_attack_bank}
				{VARIABLE is_second_attack $unit.variables.is_second_attack}
				[if]
					[variable]
						name=attacks_done
						equals=""
					[/variable]
					[then]
						{VARIABLE attacks_done 0}
						{VARIABLE is_second_attack no}
					[/then]
				[/if]

				[remove_object]
					find_in=unit
					object_id=qquws_double_attack_item_object
				[/remove_object]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						double_attack_required=$item_step
						double_attack_bank=$attacks_done
						is_second_attack=$is_second_attack
					[/variables]

					[object]
						id=qquws_double_attack_item_object
						take_only_once=no
						silent=yes

						[effect]
						    apply_to=attack
						    range=ranged
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    [set_specials]
						    	mode=append
						     	[dummy]
									id=qquws_double_attack
									name="double attack ($attacks_done|\$item_step|)"
									description="When charged, this unit can attack twice in a single turn."
									active_on=offense
							 	[/dummy]
						    [/set_specials]
						[/effect]
					[/object]
				[/modify_unit]

				{VARIABLE sharpshooter_value 0}
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						{VARIABLE sharpshooter_value 30}
						{VARIABLE sharpshooter_chance 50}
					[/case]
					[case]
						value=4
						{VARIABLE sharpshooter_value 50}
						{VARIABLE sharpshooter_chance 60}
					[/case]
					[case]
						value=5
						{VARIABLE sharpshooter_value 70}
						{VARIABLE sharpshooter_chance 70}
					[/case]
				[/switch]

				[if]
					[variable]
						name=sharpshooter_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								sharpshooter_chance=$sharpshooter_chance
								sharpshooter_fraction=$sharpshooter_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_sharpshooter
								    [set_specials]
								    	mode=append
								     	[dummy]
											id=qquws_sharpshooter
											name="sharpshooter"
											description="When used offensively, this attack has $sharpshooter_chance|% chance to pierce through the enemy and deal $sharpshooter_value|% damage to the enemy behind it. It does not deal damage to friendly units. Champions and the Butcher of Wesnoth are immune to the piercing effect, but can still be harmed if behind a regular enemy."
											active_on=offense
									 	[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=hitn_run
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0

						[object]
							 silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=nightstalk
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									{ABILITY_NIGHTSTALK}
								[/abilities]
							[/effect]
						[/object]

						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 0}
					[/case]
					[case]
						value=1
						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run yes}
						{VARIABLE hit_and_run_amount 1}
					[/case]
					[case]
						value=2
						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run yes}
						{VARIABLE hit_and_run_amount 2}
					[/case]
					[case]
						value=3
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 1}
					[/case]
					[case]
						value=4
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 2}
					[/case]
					[case]
						value=5
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 3}
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=berserk,qquws_block_specials
							    [/not]
							    
							    [set_specials]
							    	mode=append
							    	[attacks]
										id=qq_cover_of_the_night
										name="cover of the night"
										description="If used during the night against a distracted enemy, then the damage is increased by 50% and the enemy cannot retaliate. Champions and the Butcher of Wesnoth are immune and so are opponents with berserker frenzy. This attack to be available requires the move points to be below the maximum move points."
										value=0
										cumulative=no
										active_on=offense
										apply_to=opponent
										
										[filter_self]
											[filter_location]
												time_of_day_id=first_watch,midnight,second_watch
											[/filter_location]
											
											formula="moves < max_moves"
										[/filter_self]
										[filter_opponent]
											formula="
												enemy_of(self, flanker) and not flanker.petrified
											where
												flanker = unit_at(direction_from(loc, other.facing))
											"

											[filter_weapon]
												[not]
													special_id=berserk
												[/not]
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_opponent]
									[/attacks]
									[damage]
										id=qq_cover_of_the_night_dmg
										multiply=1.5
										active_on=offense
										apply_to=self
										
										[filter_self]
											[filter_location]
												time_of_day_id=first_watch,midnight,second_watch
											[/filter_location]
											
											formula="moves < max_moves"
										[/filter_self]
										[filter_opponent]
											formula="
												enemy_of(self, flanker) and not flanker.petrified
											where
												flanker = unit_at(direction_from(loc, other.facing))
											"

											[filter_weapon]
												[not]
													special_id=berserk
												[/not]
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_opponent]
									[/damage]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=hit_and_run
						boolean_equals=yes
					[/variable]
					[or]
						[variable]
							name=kill_and_run
							boolean_equals=yes
						[/variable]
					[/or]
					[then]
						[if]
							[variable]
								name=hit_and_run
								boolean_equals=yes
							[/variable]
							[then]
								{VARIABLE ability_id "qquws_hit_and_run"}
								{VARIABLE ability_name "hit and run +$hit_and_run_amount"}
								{VARIABLE ability_description "This unit gains additional moves back after attacking, but cannot attack again. If the enemy is eliminated the unit gets more movement points."}
							[/then]
							[else]
								{VARIABLE ability_id "qquws_kill_and_run"}
								{VARIABLE ability_name "kill and run +$hit_and_run_amount"}
								{VARIABLE ability_description "This unit gains additional moves back after eliminating an opponent, but cannot attack again."}
							[/else]
						[/if]
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								hit_and_run=$hit_and_run
								kill_and_run=$kill_and_run
								hit_and_run_amount=$hit_and_run_amount
								hit_and_run_kill_amount="$( $hit_and_run_amount + 2 )"
							[/variables]
							
							moves=1 # fixes issue when kill and run gets replaced with hit and run
						[/modify_unit]
						
						[object]
							 silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_hit_and_run
									[/dummy]
									[dummy]
										id=qquws_kill_and_run
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=$ability_id
										name=$ability_name
										description=$ability_description
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=extra_strikes

				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 50%."
										add="( if(hitpoints < 0.5 * max_hitpoints, 1, 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 65% and another one below 30%."
										add="( if(hitpoints < 0.65 * max_hitpoints, if(hitpoints < 0.3 * max_hitpoints, 2, 1), 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.65 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    increase_attacks=1
							    remove_specials=qquws_extra_strikes
							 [/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     increase_accuracy=2
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 50%. Passively increases strikes by 1 and non-magical accuracy by 2."
										add="( if(hitpoints < 0.5 * max_hitpoints, 1, 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     increase_accuracy=1
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 65% and another one below 30%. Passively increases strikes by 1 and non-magical accuracy by 3."
										add="( if(hitpoints < 0.65 * max_hitpoints, if(hitpoints < 0.3 * max_hitpoints, 2, 1), 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.65 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     increase_accuracy=2
							     increase_attacks=1
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 50%. Passively increases strikes by 2 and non-magical accuracy by 5."
										add="( if(hitpoints < 0.5 * max_hitpoints, 1, 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=rat_pack

				{VARIABLE chance_special 0}
				{VARIABLE chance_special_text ""}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE rats_frequency 6}
					[/case]
					[case]
						value=1
						{VARIABLE rats_frequency 5}
					[/case]
					[case]
						value=2
						{VARIABLE rats_frequency 4}
					[/case]
					[case]
						value=3
						{VARIABLE rats_frequency 4}
						{VARIABLE chance_special 50}
						{VARIABLE chance_special_text " 50% chance to breed a special rat."}
					[/case]
					[case]
						value=4
						{VARIABLE rats_frequency 3}
						{VARIABLE chance_special 75}
						{VARIABLE chance_special_text " 75% chance to breed a special rat."}

						[object]
							silent=yes
							
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_rat_ambassador
										name="rat ambassador"
										description="This unit's stats improve along the title of the highest ranking rat alive."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						{VARIABLE rats_frequency 2}
						{VARIABLE chance_special 100}
						{VARIABLE chance_special_text " Always breeds a special rat."}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[status]
					     spawns_rats=yes
					[/status]
					
					[variables]
						rats_frequency=$rats_frequency
						rats_special_chance=$chance_special
						rats_extra_info=$chance_special_text
					[/variables]

					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_breeds_rats
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_breeds_rats
									name="breeds rats"
									description="This unit is able to breed tasty rats once every $rats_frequency turn(s) (max 4 bred rats).$chance_special_text"
								[/dummy]
							[/abilities]
						[/effect]
					[/object]
				[/modify_unit]
			[/case]
			[case]
				value=icewind_aura
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE icewind_radius 1}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=1
						{VARIABLE icewind_radius 2}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=2
						{VARIABLE icewind_radius 3}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=3
						{VARIABLE icewind_radius 5}
						{VARIABLE icewind_damage 2}
						{VARIABLE icewind_defense 2}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
					[case]
						value=4
						{VARIABLE icewind_radius 7}
						{VARIABLE icewind_damage 4}
						{VARIABLE icewind_defense 5}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
					[case]
						value=5
						{VARIABLE icewind_radius 9}
						{VARIABLE icewind_damage 8}
						{VARIABLE icewind_defense 10}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						icewind_radius=$icewind_radius
						icewind_damage=$icewind_damage
						icewind_defense=$icewind_defense
					[/variables]
				[/modify_unit]
			
				[object]
					silent=yes

					[effect]
						apply_to=remove_ability
						[abilities]
							[dummy]
								id=qquws_icewind_aura
							[/dummy]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_icewind_aura
								name="icewind aura $icewind_defense|,$icewind_damage|/$icewind_radius"
								description="At the beginning of your turn all enemies within $icewind_radius radius from this unit get their mp reduced by 30%$icewind_text. Affects units of the same or lower level as the item keeper."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/case]
			[case]
				value=book
				
				{VARIABLE battle_study_adjacent 0}
				{VARIABLE bs_adjacent_text ""}
				{VARIABLE bs_adjacent_info ""}
				{VARIABLE combat_teacher 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE battle_study_self 15}
					[/case]
					[case]
						value=1
						{VARIABLE battle_study_self 25}
					[/case]
					[case]
						value=2
						{VARIABLE battle_study_self 40}
					[/case]
					[case]
						value=3
						{VARIABLE battle_study_self 40}
						{VARIABLE battle_study_adjacent 15}
						{VARIABLE combat_teacher 1}
						{VARIABLE bs_adjacent_text " Additionally, all adjacent allies receive +15% xp whenever they kill an enemy."}
						{VARIABLE bs_adjacent_info "(15%)"}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_study_adjacent_enabled
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[modify_unit]
							[filter]
								id=$unit.id
								[not]
									trait=intelligent
								[/not]
							[/filter]
							
							{TRAIT_INTELLIGENT}
						[/modify_unit]
					[/case]
					[case]
						value=4
						{VARIABLE battle_study_self 40}
						{VARIABLE battle_study_adjacent 25}
						{VARIABLE combat_teacher 2}
						{VARIABLE bs_adjacent_text " Additionally, all adjacent allies receive +25% xp whenever they kill an enemy."}
						{VARIABLE bs_adjacent_info "(25%)"}
					[/case]
					[case]
						value=5
						{VARIABLE battle_study_self 40}
						{VARIABLE battle_study_adjacent 40}
						{VARIABLE combat_teacher 3}
						{VARIABLE bs_adjacent_text " Additionally, all adjacent allies also receive +40% xp whenever they kill an enemy."}
						{VARIABLE bs_adjacent_info "(40%)"}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_intelligence_increase
											name="all intelligent"
											description="All ally units receive intelligent trait."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_intelligent_trait_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						battle_study_self=$battle_study_self
						battle_study_adjacent=$battle_study_adjacent
					[/variables]

					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_battle_study
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_battle_study
									name="battle study +$battle_study_self|%$bs_adjacent_info"
									description="Whenever this unit kills an enemy it receives additional $battle_study_self|% xp.$bs_adjacent_text"
								[/dummy]
							[/abilities]
						[/effect]
					[/object]
				[/modify_unit]
			
				[if]
					[variable]
						name=combat_teacher
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								combat_teacher_amount=$combat_teacher
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=remove_ability
									[abilities]
										[dummy]
											id=qquws_combat_teacher
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_combat_teacher
											name="combat teacher +$combat_teacher"
											description="At the beginning of each turn all adjacent allied units receive +$combat_teacher|xp."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=dragon_protection
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									blade=-5
									impact=-5
									pierce=-5
									arcane=-5
									cold=-5
									fire=-5
									secret=-15
							    [/resistance]
							[/effect]
						[/object]
						
						{VARIABLE dragon_protection_restore_amount 1}
						{VARIABLE dragon_protection_is_fraction no}
						{VARIABLE dragon_protection_common 5}
						{VARIABLE dragon_protection_secret 15}
						{VARIABLE dragon_protection_info "1hp"}
					[/case]
					[case]
						value=1
						
						{VARIABLE dragon_protection_restore_amount 3}
						{VARIABLE dragon_protection_is_fraction no}
						{VARIABLE dragon_protection_common 5}
						{VARIABLE dragon_protection_secret 15}
						{VARIABLE dragon_protection_info "3hp"}
					[/case]
					[case]
						value=2
						
						{VARIABLE dragon_protection_restore_amount 5}
						{VARIABLE dragon_protection_is_fraction no}
						{VARIABLE dragon_protection_common 5}
						{VARIABLE dragon_protection_secret 15}
						{VARIABLE dragon_protection_info "5hp"}
					[/case]
					[case]
						value=3

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									blade=-5
									impact=-5
									pierce=-5
									arcane=-5
									cold=-5
									fire=-5
									secret=-10
							    [/resistance]
							[/effect]
						[/object]
						
						{VARIABLE dragon_protection_restore_amount 0.2}
						{VARIABLE dragon_protection_is_fraction yes}
						{VARIABLE dragon_protection_common 10}
						{VARIABLE dragon_protection_secret 25}
						{VARIABLE dragon_protection_info "20% hp"}
					[/case]
					[case]
						value=4
						
						{VARIABLE dragon_protection_restore_amount 0.35}
						{VARIABLE dragon_protection_is_fraction yes}
						{VARIABLE dragon_protection_common 10}
						{VARIABLE dragon_protection_secret 25}
						{VARIABLE dragon_protection_info "35% hp"}
					[/case]
					[case]
						value=5

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									blade=-5
									impact=-5
									pierce=-5
									arcane=-5
									cold=-5
									fire=-5
									secret=-10
							    [/resistance]
							[/effect]
						[/object]
						
						{VARIABLE dragon_protection_restore_amount 0.5}
						{VARIABLE dragon_protection_is_fraction yes}
						{VARIABLE dragon_protection_common 15}
						{VARIABLE dragon_protection_secret 35}
						{VARIABLE dragon_protection_info "50% hp"}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						dragon_protection_max_lvl=$item_step
						dragon_protection_counter=1
						dragon_restore_amount=$dragon_protection_restore_amount
						dragon_restore_is_fraction=$dragon_protection_is_fraction
					[/variables]
				[/modify_unit]
			
				[object]
					silent=yes

					[effect]
						apply_to=remove_ability
						[abilities]
							[dummy]
								id=qquws_dragon_protection
							[/dummy]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_dragon_protection
								name="dragon's protection"
								description="When this unit is dying the Dragon's Protection revives it, restoring $dragon_protection_info|. Because of how much magical energy this requires, this can only trigger when the unit's hp is below certain point. A unit can only be revived once per turn (the counter refreshes at the beginning of the player's turn). Passively increases resistance to all common weapon types by $dragon_protection_common|% and against the secret attacks by $dragon_protection_secret|%."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/case]
		[/switch]
	[/event]
#enddef

