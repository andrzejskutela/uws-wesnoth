#define INIT_ITEMS_DATA
	[set_variables]
		name=items_steps
		mode=replace
		[value] # steps
			magic_res="5/5/5/5/5/10"
			cold_res="10/10/15/15/15/20"
			phys_res="5/5/5/5/5/10"
			impact_res="10/10/15/15/15/20"
			impact_weapon="1/0/0/0/0/0"
			fire_res="10/10/15/15/15/20"
			fire_weapon="1/0/0/0/0/0"
			arcane_res="10/10/15/15/15/20"
			arcane_weapon="1/0/0/0/0/0"
			blade_res="10/10/15/15/15/20"
			blade_weapon="10/10/15/15/15/20"
			pierce_res="10/10/15/15/15/20"
			hp_low="5/15/25/30/40/50"
			hp_med="10/20/30/40/50/60"
			hp_high="15/25/35/45/60/75"
			steadfast="25/40/50/55/65/75"
			regen="2/4/8/12/16/24"
			melee_dmg="7/15/25/33/40/50"
			ranged_dmg="7/15/25/33/40/50"
			ranged_acc="3/2/2/2/3/3"
			melee_parry="3/2/2/2/3/3"
			melee_poison="0/2/1/1/1/0"
			melee_slow="1/0/0/0/0/0"
			mp="1/0/1/0/1/2"
			feeding="1/1/1/1/1/2"
			leadership="1/0/0/0/0/0"
			drain="20/35/50/55/65/75"
			defense="0/0/0/1/1/1"
			skirm="1/0/0/0/0/0"
			first_strike="1/0/0/0/0/0"
			fear="1/0/0/0/0/0"
			discouragement="1/0/0/0/0/0"
			burns="2/4/8/12/16/20"
			golden_armor="3/3/4/3/3/4"
			heal="2/4/8/8/10/12"
			freezing_gem="1/2/3/4/5/7"
			field_disruption="10/15/20/25/30/35"
			armor_destruction="1/2/3/4/5/6"
			protection="10/15/20/25/30/35"
			double_attack="8/7/6/5/4/3"
			hitn_run="1/0/0/1/0/0"
			extra_strikes="40/50/60/70/80/100"
			rat_pack="7/6/5/4/3/2"
			icewind_aura="1/2/3/5/7/9"
			book="1/0/0/0/0/0"
			dragon_protection="0/1/2/3/4/6"
		[/value]
		[value] # name
			magic_res="Magic Mastery"
			cold_res="Cold Mastery"
			phys_res="Physical Mastery"
			impact_res="Chimera's Leather"
			impact_weapon="Thunderhammer"
			fire_res="Perkele's Undying Ember"
			fire_weapon="Eternal Flame of Anganor"
			arcane_res="Dragon's Tooth"
			arcane_weapon="Consecrated Blade"
			blade_res="Durinn's Buckler"
			blade_weapon="Guardians of Mania"
			pierce_res="Pierce Mastery"
			hp_low="Flask of the Alchemist"
			hp_med="Ring of Endurance"
			hp_high="Talisman of Vitality"
			steadfast="Amulet of Devotion"
			regen="Charm of Regeneration"
			melee_dmg="War Sword"
			ranged_dmg="Crystal Bow"
			ranged_acc="Elven Ring of Accuracy"
			melee_parry="Battle Staff"
			melee_poison="Assassin's Dagger"
			melee_slow="Chronomancer's Staff"
			mp="Potion of Swiftness"
			feeding="Necronomicon"
			leadership="Celestial Hammer"
			drain="Staff of Dark Sorcery"
			defense="Potion of Agility"
			skirm="Potion of Dexterity"
			first_strike="Ceremonial Spear"
			fear="Necromancer's Bane"
			discouragement="Potion of Hindrance"
			burns="Torch of the Secret Fire"
			golden_armor="Golden Armor"
			heal="Potion of Rejuvenation"
			freezing_gem="Gem of Hoarfrost"
			field_disruption="Sorcerer's Battle Armor"
			armor_destruction="The Scythe"
			protection="Talisman of Protection"
			double_attack="Elven Royal Bow"
			hitn_run="Hitman's Cloak"
			extra_strikes="Battle Gauntlets"
			rat_pack="Rodent Breeder"
			icewind_aura="IceLord's Protection"
			book="White Book of Wesnoth"
			dragon_protection="Dragon's Protection"
		[/value]
		[value] # step labels for display
			magic_res="+5% magic res/+10% magic res/+15% magic res/+20% magic res, 5% negation/+25% magic res, 15% negation/+35% magic res, 25% negation"
			cold_res="+10% cold/+20% cold/+35% cold/+50% cold + decent weapon/+65% cold + powerful weapon/+85% cold, element mastery + mythical weapon"
			phys_res="+5% phys res/+10% phys res/+15% phys res/+20% phys res, 5% reduction/+25% phys res, 15% reduction/+35% phys res, 25% reduction"
			impact_res="+10% impact/+20% impact/+35% impact/+50% impact, impact mastery 10%/+65% impact, impact mastery 20%, leather cover 2/+85% impact, impact mastery 30%, leather cover 4"
			impact_weapon="very weak impact weapons/weak impact weapons/average impact weapons/strong impact weapons/fearful impact weapons/mystical impact weapons"
			fire_res="+10% fire res/+20% fire res/+35% fire res/+50% fire res, fire mastery 10%/+65% fire res, fire mastery 20%, familiar master/+85% fire res, fire mastery 30%, fiery familiar master"
			fire_weapon="very weak fire weapons/weak fire weapons/average fire weapons/strong fire weapons/fearful fire weapons/mystical fire weapons"
			arcane_res="+10% arcane res/+20% arcane res/+35% arcane res/+50% arcane res, arcane mastery 10%/+65% arcane res, arcane mastery 20%, pride of the drakes/+85% arcane res, arcane mastery 30%, pride of the dragons"
			arcane_weapon="very weak arcane weapons/weak arcane weapons/average arcane weapons/strong arcane weapons/fearful arcane weapons/mystical arcane weapons"
			blade_res="+10% blade res/+20% blade res/+35% blade res/+50% blade res, blade mastery 10%/+65% blade res, blade mastery 20%, battle cry 4/+85% blade res, blade mastery 30%, battle cry 12"
			blade_weapon="very weak blade weapons/weak blade weapons/average blade weapons/strong blade weapons/fearful blade weapons/mystical blade weapons"
			pierce_res="+10% pierce/+20% pierce/+35% pierce/+50% pierce + decent weapon/+65% pierce + powerful weapon/+85%, element mastery pierce + mythical weapon"
			hp_low="+5% hp/+15% hp/+25% hp, cures/+30% hp, cures, immune to poison, concoction 33, toxic fumes 1/+40% hp, poison knowledge, concoction 67, toxic fumes 3, alcohol fumes 5/+50% hp, poison knowledge, concoction 100, toxic fumes 5, alcohol fumes 10"
			hp_med="+10% hp/+20% hp/+30% hp/+40% hp, undrainable, aoe drains 4, melee endurance 20/+50% hp, undrainable aura, aoe drains 6, melee endurance 30/+60% hp, undrainable aura, aoe drains 8, melee endurance 40"
			hp_high="+15% hp/+25% hp/+35% hp/+45% hp, bloodline 10/+60% hp, bloodline 20/+75% hp, bloodline 30, treats wounded"
			steadfast="x1.5 25% max/x1.75 40% max/x2 50% max/x2 55% max, shield master 20(16%)/x2.25 65% max, shield master 40(19%)/x2.5 75% max, shield master 70(22%)"
			regen="+2/+4/+8/+12 (village +16, fight +2)/+16 (village +24, fight +4)/+24 (village +32, fight +8)"
			melee_dmg="+7% melee dmg/+15% melee dmg/+25% melee dmg/+33% melee dmg, fury +8%/+40% melee dmg, fury +16%/+50% melee dmg, fearless, fury +24%"
			ranged_dmg="+7% ranged dmg/+15% ranged dmg/+25% ranged dmg/+33% ranged dmg, ruthless/+40% ranged dmg, +1 ranged strike/+50% ranged dmg, +1 ranged strike, merciless"
			ranged_acc="ranged +2(1) accuracy, +1 dmg/ranged +5(3) accuracy, +1 dmg/ranged +8(5) accuracy, +1 dmg/ranged +12(7) accuracy, assassination x1.5, +2 dmg/ranged +16(10) accuracy, assassination x2, +2 dmg/ranged +20(15) accuracy, assassination x2.5, +3 dmg"
			melee_parry="+3 melee parry/+5 melee parry/+7 melee parry/+9 melee parry, counterbalance 30/+12 melee parry, counterbalance 40/+15 melee parry, counterbalance 50, peaceful warrior"
			melee_poison="melee poison (lower lvl only)/melee poison (same and lower lvl only)/melee poison/melee poison 10, +2 acc, 1.5x backstab/melee poison 12, +3 acc, 2x backstab/melee poison 16, +5 acc, 2.5x backstab"
			melee_slow="day only melee slow/day, dawn and dusk melee slow/melee slow/melee slow, slow aura/melee slow, slow aura, lesser chronosphere/melee slow, slow aura, chronosphere"
			mp="+1 mp/+1 mp/+2 mp/+2 mp, slow immunity/+3 mp, slow immunity aura/+4 mp, motility mastery"
			feeding="deluminates -5/deluminates -15/deluminates -25/deluminates -25, 15% to summon lvl0/deluminates -30, 16% to summon lvl1, feeding +1/deluminates -35, 17% to summon lvl2, feeding +1"
			leadership="leadership 5%/leadership 15%/leadership 25%/leadership 25%, leads by example 15%/leadership 30%, leads by example 25%, great leader 25%/leadership 35%, leads by example 35%, great leader 50%, fearless"
			drain="20%/35%/50%/55%(20%), wicked x1.15/65%(30%), wicked x1.25/75%(40%), unholy x1.35"
			defense="+1% def/+3% def/+5% def/+7% def, -1mc/+10% def, -2mc, terrain knowledge/+10% def, -3mc, cartography"
			skirm="nighttime only skirmisher/dawn, dusk and night skirmisher/skirmisher/skirmisher, +1 mp/skirmisher +2 mp, battle fervor +1/skirmisher, +2 mp, battle fervor +2, enemy control"
			first_strike="melee first strike (lower levels only)/melee first strike/first strike/first strike, preemptive 50%/first strike, preemptive 75%/first strike, initiative, eagerness aura"
			fear="5% attack, 0%(10%) lvl0(r1)/5% attack, 5%(10%) lvl1(r1)/10% attack, 5%(15%) lvl2(r2)/15% attack, 10%(20%) lvl3(r3), +1 heal on hit/20% attack, 10%(25%) lvl4(r4), +2 heal on hit/25% attack, 15%(30%) lvl5(r5), +3 heal on hit, fearless"
			discouragement="melee dishearten -10%/melee dishearten -15%/dishearten -20%/dishearten -20%, melee discourage -1/dishearten -25%, discourage -1/dishearten -30%, discourage -1, corrupts"
			burns="secret fire 2, +5% fire res/secret fire 4, +5% fire res/secret fire 8, +5% fire res/secret fire 12(8), +15% fire res, +1 fire vision/secret fire 16(12), +15% fire res, +2 fire vision/secret fire 20(16), +25% fire res, +3 fire vision"
			golden_armor="+3% res/+6% res/+10% res/+13% res, reflects 20%(10%)/+16% res, reflects 40%(20%)/+20% res, reflects 60%(30%)"
			heal="heals +2, +5% arcane res/heals +4, +5% arcane res/heals +8, +5% arcane res/heals +8, heals all +2, +15% arcane res/heals +10, heals all +4, +15% arcane res/heals +12, restores all +8, +25% arcane res, distinguished"
			freezing_gem="freezing touch -1, +5% cold res/freezing touch -2, +5% cold res/freezing touch -3, +5% cold res/freezing touch -4, icy shackles x1.5, +15% cold res/freezing touch -5, icy shackles x1.65, +15% cold res/freezing touch -6, icy shackles x1.8, +25% cold res"
			field_disruption="field -10/field -15/field -20/field -25, phase 5(5)/field -30, phase 15(10)/field -35, phase 25(15)"
			armor_destruction="-1 res per hit, +1 dmg/-2 res per hit, +1 dmg/-3 res per hit, +1 dmg/-4 res per hit, +2 dmg, bloodseeker 4/-5 res per hit, +2 dmg, bloodseeker 6/-6 res per hit, +3 dmg, bloodseeker 8, duel 2"
			protection="protection +10/protection +15/protection +20/protection +25, defensive wall 1.2/protection +30, defensive wall 1.4/protection +35, impenetrable wall 1.5"
			double_attack="8 to charge/7 to charge/6 to charge/5 to charge, sharpshooter 30%/4 to charge, sharpshooter 50%/3 to charge, sharpshooter 70%"
			hitn_run="nightstalk/nightstalk, kill +1/nightstalk, kill +2/nightstalk, hit +1(3), assassin's strike x1.5/nightstalk, hit +2(4), assassin's strike x2/nightstalk, hit +3(5), assassin's strike x2.5, successful operation"
			extra_strikes="below 33%/below 67%/always +1/always +1, extra below 50%, marksman 50/always +1, extra below 67% and 33%, marksman 60/always +2, extra below 50%, marksman 65"
			rat_pack="spawn every 6 turns/spawn every 5 turns/spawn every 4 turns/spawn every 4 turns, 50% special/spawn every 3 turns, 75% special, rat ambassador/special spawn every 2 turns, rat ambassador"
			icewind_aura="1 radius/2 radius/3 radius/5 radius, 2 cold damage, defenses -2%/7 radius, 4 cold damage, defenses -5%/9 radius, 8 cold damage, defenses -10%, damage +15%"
			book="kill +15% xp/kill +25% xp/kill +40% xp/kill +40%(15%) xp, intelligent, combat teacher +1/kill +40%(25%) xp, intelligent, combat teacher +2/kill +40%(40%) xp, combat teacher +3, all intelligent"
			dragon_protection="lvl 0, restores 1hp, res +5%(15%)/lvl 1, restores 3 hp, res +5%(15%)/lvl 2, restores 5hp, res +5%(15%)/lvl 3, restores 20% hp, res +10%(25%)/lvl 4, restores 35% hp, res +10%(25%)/lvl 6, restores 50% hp, res +15%(35%)"
		[/value]
		[value] # image
			magic_res="items/ball-magenta.png"
			cold_res="items/ball-blue.png"
			phys_res="items/ball-green.png"
			impact_res="items/uws/impact_leather.png"
			impact_weapon="items/uws/thunderhammer.png"
			fire_res="items/ring-red.png"
			fire_weapon="items/flame-sword.png"
			arcane_res="items/talisman-bone.png"
			arcane_weapon="items/sword-holy.png"
			blade_res="items/buckler.png"
			blade_weapon="items/uws/axes.png"
			pierce_res="items/armor.png"
			hp_low="items/potion-red.png"
			hp_med="items/ring-brown.png"
			hp_high="items/ankh-necklace.png"
			steadfast="items/necklace-stone.png"
			regen="items/ankh-necklace2.png"
			melee_dmg="items/flame-sword-bare.png"
			ranged_dmg="items/bow-crystal-2.png"
			ranged_acc="items/ring-silver.png"
			melee_parry="items/staff-plain.png"
			melee_poison="items/dagger-poison.png"
			melee_slow="items/staff-magic-2.png"
			mp="items/potion-yellow.png"
			feeding="items/book5.png"
			leadership="items/hammer-runic.png"
			drain="items/staff.png"
			defense="items/potion-grey.png"
			skirm="items/potion-blue.png"
			first_strike="items/spear-fancy-2.png"
			fear="items/sword-wraith.png"
			discouragement="items/potion-poison.png"
			burns="items/torch.png"
			golden_armor="items/armor-golden.png"
			heal="items/holy-water.png"
			freezing_gem="items/uws/freezing_gem.png"
			field_disruption="items/uws/disruptor.png"
			armor_destruction="items/uws/cutter.png"
			protection="items/uws/protection.png"
			double_attack="items/bow-elven.png"
			hitn_run="items/uws/cloak.png"
			extra_strikes="items/uws/gauntlets.png"
			rat_pack="items/leather-pack.png"
			icewind_aura="items/uws/icewind.png"
			book="items/book3.png"
			dragon_protection="items/uws/armor-dragon.png"
		[/value]
		[value] # long description when unit picks the item
			magic_res="Adds resistance to magical attack types.
			
<span color='#9dc9c3'>Negates Magic</span>: improves magical resistance of all allied units on the map by certain amount."

			cold_res="Adds cold resistance.

<span color='#d194e3'>Time Lock</span>: attack only, both the attacker and defender go into the time lock. For a duration of one turn the defender gets all defenses set to 25% and strikes on all weapons to 1. In addition to that, all adjacent enemies to the attacked unit receive 4 cold damage and get slowed. The attacker gets all defenses set to 25% and all weapons removed. Champions and The Butcher of Wesnoth are immune.

<span color='#d194e3'>Infinity Lock</span>: attack only, both the attacker and defender go into the infinity lock. For a duration of one turn the defender can't move, gets all defenses set to 15% and all weapons removed. In addition to that, all enemies within radius 5 from the attacked unit receive 8 cold damage and get slowed. The attacker gets all weapons removed. Champions and The Butcher of Wesnoth are immune.

<span color='#9dc9c3'>Cold Mastery</span>: improves cold resistance and cold damage of all allied units on the map."

			phys_res="Adds resistance to physical attack types.
			
<span color='#9dc9c3'>Armor Science</span>: reduces physical resistances of all enemies within the vision range from the scientist by certain amount."

			impact_res="Adds impact resistance.

<span color='#9dc9c3'>Impact Mastery</span>: improves impact damage of all allied units on the map.

<span color='#9dc9c3'>Leather Cover</span>: all allies on the map receive damage reduction to all attack types except arcane and secret."

			impact_weapon="Gives elementary impact weapons. Damage output depends on the promotion rank and the unit level (n value). For example 8(+1.5n) means that lvl 1 unit will deal 9 damage and lvl 2 unit 11.

<span color='#d194e3'>Stun</span>: attack only, disrupts enemy's ZOC upon a hit.

<span color='#d194e3'>Crushing Blow</span>: attack only, upon a hit the enemy gets one strike removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit.

<span color='#d194e3'>Shatter the Bones</span>: attack only, upon a hit the enemy gets 50% of strikes removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit.

<span color='#d194e3'>No Counter-Attack</span>: attack only, the opponent has a 0% chance of retaliation. Units with berserker frenzy units are immune."

			fire_res="Adds fire resistance.

<span color='#9dc9c3'>Fire Mastery</span>: improves fire damage of all allied units on the map.

<span color='#9dc9c3'>Familiar Master</span>: each time the item keeper levels up or amlas it summons a familiar minion. The level of the familiar is always 1 less than the item keeper. Only one familiar is allowed at a time.

<span color='#9dc9c3'>Fiery Familiar Master</span>: each time the item keeper levels up or amlas it summons a powerful familiar. Whenever the familiar kills an enemy, the item master receives half of the xp. The level of the familiar is always 1 less than the item keeper. Only one familiar is allowed at a time."

			fire_weapon="Gives elementary fire weapons. Damage output depends on the promotion rank and the unit level (n value). For example 8(+1.5n) means that lvl 1 unit will deal 9 damage and lvl 2 unit 11.

<span color='#d194e3'>Fiery Attack</span>: This attack's chance to hit has always a high minimum value.

<span color='#d194e3'>Fire Cleave</span>: when used on offense the enemies adjacent to both the attacker and defender receive a fraction of the dealt fire damage. The chance to hit additional enemies depends on their defense value and is irrespective of whether the primary target is hit.

<span color='#d194e3'>Blinding Sparks</span>: each successful hit of this weapon decreases the ability of the other unit to hit by certain value. The effect lasts one turn."

			arcane_res="Adds arcane resistance.

<span color='#9dc9c3'>Arcane Mastery</span>: improves arcane damage of all allied units on the map.

<span color='#9dc9c3'>Pride of the Drakes</span>: whenever this unit is defending then each time it receives damage, there is a 6-54% chance (the less hp the higher the chance) to instantly heal random 20-150% of received damage.

<span color='#9dc9c3'>Pride of the Dragons</span>: whenever this unit is defending then each time it receives damage, there is a 8-72% chance (the less hp the higher the chance) to instantly heal random 35-200% of received damage. Additionally, this unit gets one chance of turning into stone for one turn upon receiving a fatal blow, therefore avoiding death."

			arcane_weapon="Gives elementary arcane weapons. Damage output depends on the promotion rank and the unit level (n value). For example 8(+1.5n) means that lvl 1 unit will deal 9 damage and lvl 2 unit 11.

<span color='#d194e3'>Discerning Blade</span>: this weapon can deal secret type of damage if the enemy's resistance to arcane damage is too high.

<span color='#d194e3'>Test of Faith</span>: when used offensively, each successful hit deals 3 points more damage.

<span color='#d194e3'>Reversed Polarity</span>: attack only, upon a hit the attacker and the defender swap their locations. This stops the attack.

<span color='#d194e3'>Drains</span>: the unit can drain health from living units, healing itself for a percentage of the amount of damage it deals (rounded down)."

			blade_res="Adds blade resistance.

<span color='#9dc9c3'>Blade Mastery</span>: improves blade damage of all allied units on the map.

<span color='#9dc9c3'>Battle Cry</span>: all allies on the map belonging to this unit's side deal final damage to all surrounding enemies upon dying. The damage dealt is equal to 50%/100% of the unit's  kill count or 4/12 (whichever is higher). Like poison, this damage cannot kill. If the dying unit is to be revived (dragon's protection or awake ability) then it is revived AFTER the battle cry, causing the damage to surrounding enemies as if the unit was to die regardless."

			blade_weapon="Gives elementary blade weapons. Damage output depends on the promotion rank and the unit level (n value). For example 8(+1.5n) means that lvl 1 unit will deal 9 damage and lvl 2 unit 11.

<span color='#d194e3'>Duel</span>: attack only, fight lasts extra round(s).

<span color='#d194e3'>Overpower</span>: when attacking, the enemy retaliates with less strikes.

<span color='#d194e3'>Battle Trance</span>: attack only, each landing hit increases the damage by 1.

<span color='#d194e3'>Overwhelm</span>: attack only, each landing hit increases the damage by 1, while simultaneously decreases opponent's damage by 2(1) if current damage is above 67%(33%). After the attack, opponent's defense and attack accuracy are reduced by 10% for one turn."

			pierce_res="Adds pierce resistance.

<span color='#d194e3'>Impale</span>: attack only, ignores the enemy's pierce resistance. Upon successful hit, the opponent's damage and movement points are reduced by 33% for one turn.

<span color='#d194e3'>No Counter-Attack</span>: attack only, the opponent has a 0% chance of retaliation. Champions, the Butcher of Wesnoth and berserker frenzy units are immune.

<span color='#9dc9c3'>Pierce Mastery</span>: improves pierce resistance and pierce damage of all allied units on the map."

			hp_low="Provides low hitpoints bonus.

<span color='#9dc9c3'>Cures</span>: this unit is able to cure all surrounding units of poison at the beginning of it's turn

<span color='#9dc9c3'>Immune to Poison</span>: the unit becomes unpoisonable (no effect on undead, mechanical and magical units, etc).

<span color='#9dc9c3'>Poison Knowledge</span>: all allies become immune to poison.

<span color='#9dc9c3'>Toxic Fumes</span>: at the beginning of the unit's turn all enemies withing certain radius get poisoned. Non-living units are immune.

<span color='#9dc9c3'>Alcohol Fumes</span>: whenever defending, before the first strike this unit is able to release delirious alcohol fumes, causing the enemy to worsen it's defense and accuracy.

<span color='#9dc9c3'>Unstable Concoction</span>: when dying this unit can drop a very unstable concoction causing a massive explosion and harming all surrounding units, enemies and allies alike."

			hp_med="Provides medium hitpoints bonus.

<span color='#9dc9c3'>Immune to Drains</span>: the unit becomes undrainable (no effect on undead, mechanical and magical units, etc).

<span color='#9dc9c3'>Drains Immunity Aura</span>: all allies become immune to drain.

<span color='#9dc9c3'>AoE Drains</span>: at the beginning of each turn this unit can drain energy from adjacent enemies.

<span color='#9dc9c3'>Melee Endurance</span>: each time this unit is hit in melee combat, it immediately regenerates part of the damage."

			hp_high="Provides high hitpoints bonus.

<span color='#9dc9c3'>Bloodline</span>: increases hitpoints of all allied units on the map.	

<span color='#9dc9c3'>Treats Wounded</span>: any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow."

			steadfast="Adds steadfast and shield master abilities.

<span color='#9dc9c3'>Steadfast</span> the unit’s resistances are multiplied by a specific factor, up to a maximum value when defending. Vulnerabilities are not affected.

<span color='#9dc9c3'>Shield Master</span> this unit has a small chance to significantly raise it's own, and adjacent allies' resistances each time they defend."

			regen="Adds regenerates ability.

<span color='#9dc9c3'>Regenerates</span>: the unit will heal itself some HP amount each turn. If it is poisoned, it will remove the poison instead of healing. In addition to normal healing, the rate of regeneration can be increased if the unit is stationed in a village. There is also a small amount healed when the unit comes out of a fight."

			melee_dmg="Increases damage output on melee weapons.

<span color='#2d8a7f'>Fearless</span>: fights normally during unfavorable times of day/night.

<span color='#d194e3'>Battle Fury</span>: with each successful hit the damage increases by given amount. If the unit gets hit, the counter is reset. Active only on offense."

			ranged_dmg="Increases damage output on ranged weapons.

<span color='#d194e3'>Ruthless</span>: adds 1 ranged strike against enemies with no ranged attacks. Attack only.

<span color='#d194e3'>Merciless</span>: adds 3 ranged strikes against enemies with no ranged attacks. Attack only."

			ranged_acc="Increases accuracy of ranged weapons. The first number indicates the increase in accuracy of non-magical weapons, whereas the number in parenthesis indicates the increase in accuracy of magical weapons.

<span color='#d194e3'>Assassination</span>: when used offensively, this attack deals significantly more damage if a single hit can eliminate the opponent."

			melee_parry="Improves parry on melee weapons and adds counterbalance on melee.

<span color='#d194e3'>Counterbalance</span>: when defending, each time this unit dodges a melee attack it has a chance to retaliate multiple times before enemy can attack again. Retaliations deal 50% of the base damage and all weapon specials are disabled.

<span color='#2d8a7f'>Peaceful Warrior</span>: when defending this unit will never deal the fatal blow and kill the enemy. Instead it will disarm them by leaving 1hp and removing all weapons for a duration of one turn."

			melee_poison="Adds poison, accuracy and backstab to melee weapons.

<span color='#d194e3'>Poison</span>: the attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit.

<span color='#d194e3'>Backstab</span>: when used offensively, this attack deals more damage if there is an enemy of the target on the opposite side of the target."

			melee_slow="Adds slow and heal on hit on melee weapons.

<span color='#d194e3'>Slow</span>: the attack slows the target until it ends a turn. Slow halves the damage caused by attacks and the movement cost for a slowed unit is doubled.

<span color='#9dc9c3'>Slow Aura</span>: all surounding enemies are slowed at the beginning of your turn.

<span color='#9dc9c3'>Lesser Chronosphere</span>: when defending against melee attacks, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune.

<span color='#9dc9c3'>Chronosphere</span>: when defending, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."

			mp="Increases movement points.

<span color='#9dc9c3'>Slow Immunity</span>: the unit becomes unslowable.

<span color='#9dc9c3'>Slow Immunity Aura</span>: all allies become immune to slow.

<span color='#9dc9c3'>Motility Mastery</span>: this unit and all allies become immune to slow. In addition to that at the beginning of this unit's turn all surrounding enemies become immobilised. Affected units lose their zone of control. Champions, the Butcher of Wesnoth and unslowable units are immune."

			feeding="Adds delumination, magical feeding and raises the undead abilities. Changes the unit's alignment to chaotic.

<span color='#9dc9c3'>Deluminates</span>: This unit obscures the surrounding area, making chaotic units fight better, and lawful units fight worse.

<span color='#9dc9c3'>Magical Feeding</span>: the unit gains extra hitpoints whenever it kills a unit, regardless of it's living status. The number of hitpoints added depends on the level of the unit killed capped with the maximum allowed.

<span color='#9dc9c3'>Raises the Undead</span>: at the beginning of the turn, this unit has a chance to summon an undead minion. The strength of the summoned units is somewhat random, while the level and the chance depend on the promotion rank."

			leadership="Adds leadership ability.

<span color='#9dc9c3'>Leadership</span>: the unit can lead ally units that are next to it, making them fight better. Affects units of the same or lower level increasing their damage by the same percentage regardless of their level difference.

<span color='#9dc9c3'>Leads by Example</span>: whenever this unit attacks a champion, or a regular enemy of the same or higher level with more than 50% hitpoints, then all units of the same side that haven't attacked yet receive +1mp and a damage bonus until the end of the turn.

<span color='#9dc9c3'>Great Leader</span>: whenever this unit kills an enemy all surrounding allied units receive experience points based on the level of the killed unit and the skill of the leader.

<span color='#2d8a7f'>Fearless</span>: fights normally during unfavorable times of day/night."

			drain="Adds drains on ranged. Does not negatively impact xp mod costs.

<span color='#d194e3'>Drains</span>: the unit can drain health from living units, healing itself for a percentage of the amount of damage it deals (rounded down). On higher ranks it can also drain energy from non-living units.

<span color='#d194e3'>Wicked</span>: when used offensively at nighttime, this attack deals more damage to living units.

<span color='#d194e3'>Unholy</span>: when used at nighttime, this attack deals more damage to living units. Active on all weapons, both in offense and defense."

			defense="Increases defense on all terrain types and improves movement costs.

<span color='#9dc9c3'>Terrain Knowledge</span>: all ally units gain +5% defense everywhere.

<span color='#9dc9c3'>Cartography</span>: all ally units gain +10% defense everywhere and improve movement costs by 1."

			skirm="Adds skirmisher ability and movement points.

<span color='#9dc9c3'>Skirmisher</span>: the unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control.

<span color='#9dc9c3'>Battle Fervor</span>: increases the movement points of all ally units.

<span color='#9dc9c3'>Enemy Control</span>: all allied units learn how to ignore enemies' zones of control."

			first_strike="Adds first strike ability.

<span color='#d194e3'>First Strike</span>: always strikes first, even when defending.

<span color='#d194e3'>Preemptive Strike</span>: when attacking you strike twice before the enemy can retaliate.

<span color='#d194e3'>Initiative</span>: when attacking and defending you strike twice before the enemy.

<span color='#9dc9c3'>Eagerness Aura</span>: all surrounding allies gain first strike on all attacks."

			fear="Adds necromancer's bane ability.

<span color='#9dc9c3'>Necromancer's Bane</span>: when attacking, the defender retaliates with reduced damage. After the fight is over enemies up to a certain level within defined range have their damage reduced for one turn. The damage reduction is higher if the opponent dies during the fight. Champions, Butcher of Wesnoth, fearless units, and leaders receive half of the damage reduction.

<span color='#9dc9c3'>Fearless</span>: fights normally during unfavorable times of day/night.

<span color='#d194e3'>Heal on Hit</span>: each landing hit restores some small amount of hp."

			discouragement="Reduces the attacker's damage output.

<span color='#d194e3'>Dishearten</span>: this attack reduces the opponent's damage. Champions and the Butcher of Wesnoth are immune.

<span color='#d194e3'>Discourage</span>: when defending reduces opponent's strikes. Champions and the Butcher of Wesnoth are immune.

<span color='#d94848'>Corrupts</span>: adds corruption weapon, 1x1 always hits. When used the enemy will either change sides or become enraged and it's damage will increase by 40%. The chance of conversion depends on the difference in levels between the corrupting and the corrupted unit. If the levels are the same it's 50% - 50%. Each point of difference in levels affects the chances by 20%. Champions, the Butcher of Wesnoth and recruiting units are immune. Available only on offense. Number of owned corrupted units is limited to 1."

			burns="Adds Secret Fire and Fire Sight abilities and increases fire resistance.

<span color='#9dc9c3'>Secret Fire</span>: deals fire damage to all surrounding enemies at the beginning of your turn. Deals additional damage to the attacker when defending. The amount of damage dealt depends on the Time of Day bonus according to the item keeper's alignment.

<span color='#9dc9c3'>Fire Vision</span>: increases vision points of all allied units."

			golden_armor="Provides extra resistance.

<span color='#9dc9c3'>Reflects</span>: each time this unit is attacked it reflects back some percentage of the received damage."

			heal="Adds heals and treat wounded abilities, small arcane resistance bonus and distinguished trait.

<span color='#9dc9c3'>Heals</span>: all surrounding allies are healed and poison removed at the beginning of this unit's turn.

<span color='#9dc9c3'>Heals All</span> at the beginning of the turn, this unit heals all ally units on the map. Stacks with regular healing.

<span color='#9dc9c3'>Restores All</span> at the beginning of the turn, this unit not only heals all ally units on the map, but also cures, removes slow and unpetrifies them. Stacks with regular healing.

<span color='#2d8a7f'>Distinguished</span>: this unit can become a new side leader if one dies, even if the leader cannot die according to the game settings."

			freezing_gem="Improves cold resistance and adds freezing touch special on melee.

<span color='#d194e3'>Freezing Touch</span>: with each successful hit, opponent's defense is reduced by given amount for one turn. Minimum defense is 10%. Melee only.

<span color='#d194e3'>Icy Shackles</span>: at the end of the fight, the opponent's strikes and movement are reduced for a duration of one turn. The level of reduction depends on the difference in defense before and after the fight. Active only on offense."

			field_disruption="Adds field disruption and phase disruption abilities.

<span color='#9dc9c3'>Field Disruption</span>: all surrounding enemies have their magic resistances reduced by given amount. Champions receive half the effect.

<span color='#9dc9c3'>Phase Disruption</span>: surrounding non-champion enemies have their magical damage and chance to hit reduced. Conversely surrounding ally units have their magical damage and chance to hit increased by the same amount."

			armor_destruction="Improves melee damage and adds adds melee armor destruction special.

<span color='#d194e3'>Armor Destruction</span>: with each successful hit, opponent's resistance to the weapons type is permanently decreased by given amount. Melee only.

<span color='#d194e3'>Bloodseeker</span>: the more wounded the opponent is, the higher melee damage this weapon does. Active only on offense.

<span color='#d194e3'>Duel</span>: when attacking, this unit presses the engagement and can fight for an extra round. Melee only, applies only to weapons that don't already have berserk special."

			protection="Adds protection, defensive wall and impenetrable wall abilities.

<span color='#9dc9c3'>Protection</span>: surrounding allied units have their physical resistances improved by given amount.

<span color='#9dc9c3'>Defensive Wall</span>: this unit and all surrounding allied units deal higher melee damage when defending.

<span color='#9dc9c3'>Impenetrable Wall</span>: this unit and all surrounding allied units deal higher damage when defending."

			double_attack="Adds double attack on ranged.

<span color='#d194e3'>Double Attack</span>: the unit can fire ranged attacks twice in single turn, once the ability is charged. Each offensive use of double-attack weapon adds a single charge.

<span color='#d194e3'>Sharpshooter</span>: when used offensively each attack has a chance to pierce through the enemy and deal damage to the enemy behind. Champions and the Butcher of Wesnoth are immune."

			hitn_run="Adds nightstalk, kill and run, hit and run and cover of the night abilities and specials.

<span color='#9dc9c3'>Nighstalk</span>: the unit is invisible to the enemies during nighttime.

<span color='#9dc9c3'>Kill and Run</span>: this unit gains extra movement point(s) after killing an enemy.

<span color='#9dc9c3'>Hit and Run</span>: this unit gains extra movement point(s) after attacking an enemy. If the enemy is eliminated the unit gains more movement points.

<span color='#d194e3'>Assassin's Strike</span>: when used offensively at nighttime then the very first strike deals much higher damage if lands. Inactive against enemies with first strike special.

<span color='#9dc9c3'>Successful Operation</span>: if you eliminate an enemy with assassin's strike then this unit can attack again during the same turn."

			extra_strikes="Adds extra strikes and marksman special.

<span color='#d194e3'>Extra Strikes</span>: increases number of strikes based on the promotion rank and unit's hitpoints.

<span color='#d194e3'>Marksman</span>: when used offensively, this attack always has at a fixed minimum chance to hit. This special will only be applied to weapons that *<span color='#ff0000'>DO NOT</span>* already have any chance_to_hit specials already, ie. magical, skilled, marksman, etc."

			rat_pack="Adds breeds rats ability.

<span color='#9dc9c3'>Breeds Rats</span>: spawns an allied rat next to the breeder once every few turns. On higher ranks there is a chance of spawning a special rat and the item ensures that there is always at least one pedigree rat. Maximum of 4 bred rats at a time. Have fun.

<span color='#9dc9c3'>Rat Ambassador</span>: this unit's stats improve along the title of the highest ranking rat alive."

			icewind_aura="Adds icewind aura ability.

<span color='#9dc9c3'>Icewind Aura</span>: at the beginning of your turn all enemies within radius get their mp reduced by 30%, defenses by a small amount and also receive damage. On epic rank it also increases the damage the enemies receive in defense.
Applies only to units of the same or lower level as the unit wearing this item.
Movement points cannot drop below 3."

			book="Adds battle study and combat teacher abilities and provides intelligent trait to all allies.

<span color='#9dc9c3'>Battle Study</span>: increases the amount of experience gained from killing enemies. On higher ranks also increases the experience that allied adjacent units gain from killing enemies.

<span color='#9dc9c3'>Combat Teacher</span>: at the beginning of the turn all adjacent allies get xp points.

<span color='#9dc9c3'>Intelligence Increase</span>: all allied units receive intelligent trait."

			dragon_protection="Adds dragon's protection ability.

<span color='#9dc9c3'>Dragon's Protection</span>: when this unit is dying the Dragon's Protection revives it, restoring some hitpoints. Works only if the unit is killed by an enemy of low enough level. A unit can only be revived once per turn (the counter refreshes at the beginning of the player's turn). Passively increases resistance to all common weapon types and provides extra resistance against secret attacks."

		[/value]
		[value] # short description for all items menu
# res 			#d6d685
# weapon 		#d94848
# damage 		#cf467a
# accuracy 		#94bf6f
# parry 		#a4b874
# ability 		#9dc9c3
# weapon special #d194e3
# defense 		#8dadb0
# mp 			#6b71e3
# hp 			#dba493
# trait 		#2d8a7f
# strikes 		#c2986e
			magic_res="<span color='#d6d685'>Magical Resistance</span>
<span color='#9dc9c3'>Negates Magic</span>
"
			cold_res="<span color='#d6d685'>Cold Resistance</span>
<span color='#d94848'>Cold Weapon</span>
<span color='#9dc9c3'>Cold Mastery</span>
"
			phys_res="<span color='#d6d685'>Physical Resistance</span>
<span color='#9dc9c3'>Armor Science</span>
"
			impact_res="<span color='#d6d685'>Impact Resistance</span>
<span color='#9dc9c3'>Impact Mastery</span>, <span color='#9dc9c3'>Leather Cover</span>
"
			impact_weapon="<span color='#d94848'>Impact Weapons</span>
"
			fire_res="<span color='#d6d685'>Fire Resistance</span>
<span color='#9dc9c3'>Fire Mastery</span>, <span color='#9dc9c3'>Familiar Master</span>
"
			fire_weapon="<span color='#d94848'>Fire Weapons</span>
"
			arcane_res="<span color='#d6d685'>Arcane Resistance</span>
<span color='#9dc9c3'>Arcane Mastery</span>, <span color='#9dc9c3'>Pride of the Dragons</span>
"
			arcane_weapon="<span color='#d94848'>Arcane Weapons</span>
"
			blade_res="<span color='#d6d685'>Blade Resistance</span>
<span color='#9dc9c3'>Blade Mastery</span>, <span color='#9dc9c3'>Battle Cry</span>
"
			blade_weapon="<span color='#d94848'>Blade Weapons</span>
"
			pierce_res="<span color='#d6d685'>Pierce Resistance</span>
<span color='#d94848'>Pierce Weapon</span>
<span color='#9dc9c3'>Pierce Mastery</span>
"
			hp_low="<span color='#dba493'>Small hp bonus</span>
<span color='#9dc9c3'>Poison Knowledge</span>, <span color='#9dc9c3'>Poisonous Fumes</span>,
<span color='#9dc9c3'>Alcohol Fumes</span>, <span color='#9dc9c3'>Unstable Concoction</span>
"
			hp_med="<span color='#dba493'>Medium hp bonus</span>
<span color='#9dc9c3'>Drain Immunity</span>, <span color='#9dc9c3'>AoE drains</span>,
<span color='#9dc9c3'>Melee Endurance</span>
"
			hp_high="<span color='#dba493'>Big hp bonus</span>
<span color='#9dc9c3'>Bloodline</span>, <span color='#9dc9c3'>Treats Wounded</span>
"
			steadfast="<span color='#9dc9c3'>Steadfast</span>, <span color='#9dc9c3'>Shield Master</span>
"
			regen="<span color='#9dc9c3'>Regenerates</span>
"
			melee_dmg="<span color='#cf467a'>Melee Damage</span>
<span color='#d194e3'>Battle Fury (m)</span>
<span color='#2d8a7f'>Fearless</span>
"
			ranged_dmg="<span color='#cf467a'>Ranged Damage</span>
<span color='#d194e3'>Ruthless (r)</span>, <span color='#d194e3'>Merciless (r)</span>
<span color='#c2986e'>Ranged Strikes</span>
"
			ranged_acc="<span color='#94bf6f'>Ranged Accuracy</span>
<span color='#cf467a'>Small ranged damage</span>
<span color='#d194e3'>Assassination (r)</span>
"
			melee_parry="<span color='#a4b874'>Melee Parry</span>
<span color='#d194e3'>Counterbalance (m)</span>
<span color='#9dc9c3'>Peaceful Warrior</span>
"
			melee_poison="<span color='#d194e3'>Melee Poison</span>
<span color='#d194e3'>Melee Backstab</span>
<span color='#94bf6f'>Melee Accuracy</span>
"
			melee_slow="<span color='#d194e3'>Melee Slow</span>
<span color='#9dc9c3'>Slow Aura</span>, <span color='#9dc9c3'>Chronosphere</span>
"
			mp="<span color='#6b71e3'>Movement Points</span>
<span color='#9dc9c3'>Slow Immunity Aura</span>, <span color='#9dc9c3'>Motility Mastery</span>
"
			feeding="<span color='#9dc9c3'>Delumination</span>
<span color='#9dc9c3'>Raises the Undead</span>, <span color='#9dc9c3'>Feeding</span>
"
			leadership="<span color='#9dc9c3'>Leadership</span>
<span color='#9dc9c3'>Leads by Example</span>, <span color='#9dc9c3'>Great Leader</span>
<span color='#2d8a7f'>Fearless</span>
"
			drain="<span color='#d194e3'>Drains (r)</span>
<span color='#d194e3'>Wicked (r)</span>, <span color='#d194e3'>Unholy</span>
"
			defense="<span color='#8dadb0'>Terrain Defense</span>
<span color='#6b71e3'>Movement Costs</span>
<span color='#9dc9c3'>Terrain Knowledge</span>, <span color='#9dc9c3'>Cartography</span>
"
			skirm="<span color='#9dc9c3'>Skirmisher</span>
<span color='#9dc9c3'>Battle Fervor</span>, <span color='#9dc9c3'>Enemy Control</span>
<span color='#6b71e3'>Movement Points</span>
"
			first_strike="<span color='#d194e3'>First Strike</span>
<span color='#d194e3'>Preemptive Strike</span>, <span color='#d194e3'>Initive</span>
<span color='#9dc9c3'>Eagerness Aura</span>
"
			fear="<span color='#9dc9c3'>Necromancer's Bane</span>
<span color='#d194e3'>Heal on Hit (m)</span>
<span color='#2d8a7f'>Fearless</span>
"
			discouragement="<span color='#d194e3'>Dishearten</span>
<span color='#d194e3'>Discourage</span>
<span color='#d94848'>Corruption Weapon</span>
"
			burns="<span color='#9dc9c3'>Secret Fire</span>
<span color='#d6d685'>Small Fire Resistance</span>
<span color='#9dc9c3'>Fire Vision</span>
"
			golden_armor="<span color='#d6d685'>All Resistance</span>
<span color='#9dc9c3'>Reflects</span>
"
			heal="<span color='#9dc9c3'>Heals</span>
<span color='#d6d685'>Small Arcane Resistance</span>
<span color='#9dc9c3'>Heals All</span>, <span color='#9dc9c3'>Restores All</span>
<span color='#2d8a7f'>Distinguished</span>
"
			freezing_gem="<span color='#d194e3'>Freezing Touch (m)</span>
<span color='#d6d685'>Small Cold Resistance</span>
<span color='#d194e3'>Icy Shackles (m)</span>
"
			field_disruption="<span color='#9dc9c3'>Field Disruption</span>
<span color='#9dc9c3'>Phase Disruption</span>
"
			armor_destruction="<span color='#d194e3'>Armor Destruction (m)</span>
<span color='#d194e3'>Bloodseeker (m)</span>, <span color='#d194e3'>Duel (m)</span>
"
			protection="<span color='#9dc9c3'>Protection</span>
<span color='#9dc9c3'>Defensive Wall</span>, <span color='#9dc9c3'>Impenetrable Wall</span>
"
			double_attack="<span color='#d194e3'>Double Attack (r)</span>
<span color='#d194e3'>Sharpshooter (r)</span>
"
			hitn_run="<span color='#9dc9c3'>Nighstalk</span>
<span color='#9dc9c3'>Kill and Run</span>, <span color='#9dc9c3'>Hit and Run</span>
<span color='#d194e3'>Assassin's Strike</span>, <span color='#d194e3'>Successful Operation</span>
"
			extra_strikes="<span color='#d194e3'>Extra Strikes</span>
<span color='#d194e3'>Marksman</span>
<span color='#c2986e'>Passive Extra Strikes</span>
"
			rat_pack="<span color='#9dc9c3'>Breeds Rats</span>
<span color='#9dc9c3'>Rat Ambassador</span>
"
			icewind_aura="<span color='#9dc9c3'>Icewind Aura</span>
"
			book="<span color='#9dc9c3'>Battle Study</span>
<span color='#9dc9c3'>Combat Teacher</span>
<span color='#2d8a7f'>Intelligent</span>
"
			dragon_protection="<span color='#d6d685'>All Resistance</span>
<span color='#9dc9c3'>Dragon's Protection</span>
"

		[/value]
		[value] # steps description when unit picks the item
# res 			#d6d685
# weapon 		#d94848
# damage 		#cf467a
# accuracy 		#94bf6f
# parry 		#a4b874
# ability 		#9dc9c3
# weapon special #d194e3
# defense 		#8dadb0
# mp 			#6b71e3
# hp 			#dba493
# trait 		#2d8a7f
# strikes 		#c2986e
			magic_res="$band_none_text <span color='#d6d685'>+5 magic resistance</span>
$band_initiated_text <span color='#d6d685'>+10 magic resistance</span>
$band_proven_text <span color='#d6d685'>+15 magic resistance</span>
$band_notable_text <span color='#d6d685'>+20 magic resistance</span>, <span color='#9dc9c3'>negates magic 5</span>
$band_significant_text <span color='#d6d685'>+25 magic resistance</span>, <span color='#9dc9c3'>negates magic 15</span>
$band_epic_text <span color='#d6d685'>+35 magic resistance</span>, <span color='#9dc9c3'>negates magic 25</span>"

			cold_res="$band_none_text <span color='#d6d685'>+10 cold resistance</span>
$band_initiated_text <span color='#d6d685'>+20 cold resistance</span>
$band_proven_text <span color='#d6d685'>+35 cold resistance</span>
$band_notable_text <span color='#d6d685'>+50 cold resistance</span>, 6x2 ranged weapon (<span color='#d194e3'>slow, magical</span>)
$band_significant_text <span color='#d6d685'>+65 cold resistance</span>, 7x3 ranged weapon (<span color='#d194e3'>slow, magical, time lock</span>)
$band_epic_text <span color='#d6d685'>+85 cold resistance</span>, <span color='#9dc9c3'>cold mastery</span>, 11x3 ranged weapon (<span color='#d194e3'>slow, magical, infinity lock</span>)"

			phys_res="$band_none_text <span color='#d6d685'>+5 physical resistance</span>
$band_initiated_text <span color='#d6d685'>+10 physical resistance</span>
$band_proven_text <span color='#d6d685'>+15 physical resistance</span>
$band_notable_text <span color='#d6d685'>+20 physical resistance</span>, <span color='#9dc9c3'>armor science 5</span>
$band_significant_text <span color='#d6d685'>+25 physical resistance</span>, <span color='#9dc9c3'>armor science 15</span>
$band_epic_text <span color='#d6d685'>+35 physical resistance</span>, <span color='#9dc9c3'>armor science 25</span>"

			impact_res="$band_none_text <span color='#d6d685'>+10 impact resistance</span>
$band_initiated_text <span color='#d6d685'>+20 impact resistance</span>
$band_proven_text <span color='#d6d685'>+35 impact resistance</span>
$band_notable_text <span color='#d6d685'>+50 impact resistance</span>, <span color='#9dc9c3'>impact mastery 10%</span>
$band_significant_text <span color='#d6d685'>+65 impact resistance</span>, <span color='#9dc9c3'>impact mastery 20%</span>, <span color='#9dc9c3'>leather cover 2</span>
$band_epic_text <span color='#d6d685'>+85 impact resistance</span>, <span color='#9dc9c3'>impact mastery 30%</span>, <span color='#9dc9c3'>leather cover 4</span>"

			impact_weapon="$band_none_text melee 8(<span color='#9d9da3'>+0.75n</span>)x1
                   ranged 6x1
$band_initiated_text melee 11(<span color='#9d9da3'>+1.25n</span>)x1
                   ranged 8x1, <span color='#d194e3'>magical</span>
$band_proven_text melee 13(<span color='#9d9da3'>+1.5n</span>)x2
                   ranged 11(<span color='#9d9da3'>+0.75n</span>)x1, <span color='#d194e3'>magical 75%</span>
$band_notable_text melee 16(<span color='#9d9da3'>+2n</span>)x2, <span color='#d194e3'>stun</span>
                   ranged 14(<span color='#9d9da3'>+1.25n</span>)x1, <span color='#d194e3'>stun, magical 80%</span>
$band_significant_text melee 20(<span color='#9d9da3'>+3n</span>)x2, <span color='#d194e3'>crushing blow</span>
                   ranged 17(<span color='#9d9da3'>+1.75n</span>)x1, <span color='#d194e3'>stun, no counter-attack, magical 85%</span>
$band_epic_text melee 26(<span color='#9d9da3'>+4n</span>)x3, <span color='#d194e3'>shatter the bones</span>
                   ranged 20(<span color='#9d9da3'>+2.5n</span>)x2, <span color='#d194e3'>crushing blow, no counter-attack, magical 90%</span>"

			fire_res="$band_none_text <span color='#d6d685'>+10 fire resistance</span>
$band_initiated_text <span color='#d6d685'>+20 fire resistance</span>
$band_proven_text <span color='#d6d685'>+35 fire resistance</span>
$band_notable_text <span color='#d6d685'>+50 fire resistance</span>, <span color='#9dc9c3'>fire mastery 10%</span>
$band_significant_text <span color='#d6d685'>+65 fire resistance</span>, <span color='#9dc9c3'>fire mastery 20%</span>, <span color='#9dc9c3'>familiar master</span>
$band_epic_text <span color='#d6d685'>+85 fire resistance</span>, <span color='#9dc9c3'>fire mastery 30%</span>, <span color='#9dc9c3'>fiery familiar master</span>"

			fire_weapon="$band_none_text melee 4(<span color='#9d9da3'>+0.5n</span>)x3
                   ranged 1x3, <span color='#d194e3'>swarm</span>
$band_initiated_text melee 6(<span color='#9d9da3'>+0.75n</span>)x3
                   ranged 2x4, <span color='#d194e3'>swarm</span>
$band_proven_text melee 8(<span color='#9d9da3'>+1n</span>)x3, <span color='#d194e3'>fiery attack 60</span>
                   ranged 2x5, <span color='#d194e3'>swarm, magical</span>
$band_notable_text melee 9(<span color='#9d9da3'>+1.25n</span>)x4, <span color='#d194e3'>fiery attack 65, fire cleave 25%</span>
                   ranged 3x5, <span color='#d194e3'>swarm, magical, blinding sparks 3</span>
$band_significant_text melee 12(<span color='#9d9da3'>+1.75n</span>)x4, <span color='#d194e3'>fiery attack 70, fire cleave 40%</span>
                   ranged 3x6, <span color='#d194e3'>swarm, magical, blinding sparks 4</span>
$band_epic_text melee 13(<span color='#9d9da3'>+2n</span>)x5, <span color='#d194e3'>fiery attack 75, fire cleave 65%</span>
                   ranged 4x7, <span color='#d194e3'>swarm, magical, blinding sparks 5</span>"

			arcane_res="$band_none_text <span color='#d6d685'>+10 arcane resistance</span>
$band_initiated_text <span color='#d6d685'>+20 arcane resistance</span>
$band_proven_text <span color='#d6d685'>+35 arcane resistance</span>
$band_notable_text <span color='#d6d685'>+50 arcane resistance</span>, <span color='#9dc9c3'>arcane mastery 10%</span>
$band_significant_text <span color='#d6d685'>+65 arcane resistance</span>, <span color='#9dc9c3'>arcane mastery 20%</span>, <span color='#9dc9c3'>pride of the drakes</span>
$band_epic_text <span color='#d6d685'>+85 arcane resistance</span>, <span color='#9dc9c3'>arcane mastery 30%</span>, <span color='#9dc9c3'>pride of the dragons</span>"

			arcane_weapon="$band_none_text melee 3(<span color='#9d9da3'>+0.5n</span>)x3
                   ranged 4x1
$band_initiated_text melee 5(<span color='#9d9da3'>+0.75n</span>)x3
                   ranged 9x1
$band_proven_text melee 9(<span color='#9d9da3'>+1n</span>)x4, <span color='#d194e3'>enchanted</span>
                   ranged 15x1, <span color='#d194e3'>magical (attack)</span>
$band_notable_text melee 11(<span color='#9d9da3'>+1n</span>)x4, <span color='#d194e3'>magical, discerning blade</span>
                   ranged 22x1, <span color='#d194e3'>precision (attack), drains 40% (attack)</span>
$band_significant_text melee 14(<span color='#9d9da3'>+1n</span>)x5, <span color='#d194e3'>precision, discerning blade</span>
                   ranged 30x1, <span color='#d194e3'>unavoidable (attack), drains 70% (attack), reversed polarity</span>
$band_epic_text melee 16(<span color='#9d9da3'>+1n</span>)x5, <span color='#d194e3'>unavoidable, discerning blade, test of faith</span>
                   ranged 40x1, <span color='#d194e3'>always hits (attack), drains 100% (attack), reversed polarity</span>"

			blade_res="$band_none_text <span color='#d6d685'>+10 blade resistance</span>
$band_initiated_text <span color='#d6d685'>+20 blade resistance</span>
$band_proven_text <span color='#d6d685'>+35 blade resistance</span>
$band_notable_text <span color='#d6d685'>+50 blade resistance</span>, <span color='#9dc9c3'>blade mastery 10%</span>
$band_significant_text <span color='#d6d685'>+65 blade resistance</span>, <span color='#9dc9c3'>blade mastery 20%</span>, <span color='#9dc9c3'>battle cry 4</span>
$band_epic_text <span color='#d6d685'>+85 blade resistance</span>, <span color='#9dc9c3'>blade mastery 30%</span>, <span color='#9dc9c3'>battle cry 12</span>"

			blade_weapon="$band_none_text melee 4(<span color='#9d9da3'>+0.4n</span>)x4
                   ranged 5(<span color='#9d9da3'>+0.7n</span>)x2
$band_initiated_text melee 6(<span color='#9d9da3'>+0.6</span>)x4
                   ranged 6(<span color='#9d9da3'>+1n</span>)x2 <span color='#94bf6f'>+4 acc</span>
$band_proven_text melee 6(<span color='#9d9da3'>+0.8n</span>)x5
                   ranged 9(<span color='#9d9da3'>+1.3n</span>)x3, <span color='#94bf6f'>+8 acc</span>
$band_notable_text melee 6(<span color='#9d9da3'>+1n</span>)x6, <span color='#d194e3'>duel 2</span>
                   ranged 12(<span color='#9d9da3'>+1.6n</span>)x3, <span color='#94bf6f'>+12 acc</span>, <span color='#d194e3'>overpower 1</span>
$band_significant_text melee 8(<span color='#9d9da3'>+1.2n</span>)x6, <span color='#d194e3'>duel 2, battle trance</span>
                   ranged 14(<span color='#9d9da3'>+1.9n</span>)x3 <span color='#94bf6f'>+16 acc</span>, <span color='#d194e3'>overpower 2</span>
$band_epic_text melee 9(<span color='#9d9da3'>+1.4n</span>)x7, <span color='#d194e3'>duel 3, overwhelm</span>
                   ranged 15(<span color='#9d9da3'>+2.2n</span>)x4 <span color='#94bf6f'>+20 acc</span>, <span color='#d194e3'>duel 2, overpower 2</span>"

			pierce_res="$band_none_text <span color='#d6d685'>+10 pierce resistance</span>
$band_initiated_text <span color='#d6d685'>+20 pierce resistance</span>
$band_proven_text <span color='#d6d685'>+35 pierce resistance</span>
$band_notable_text <span color='#d6d685'>+50 pierce resistance</span>, 13x2 melee weapon (<span color='#d194e3'>charge</span>)
$band_significant_text <span color='#d6d685'>+65 pierce resistance</span>, 16x2 melee weapon (<span color='#d194e3'>charge, impale</span>)
$band_epic_text <span color='#d6d685'>+85 pierce resistance</span>, <span color='#9dc9c3'>pierce mastery</span>, 18x2 melee weapon (<span color='#d194e3'>charge, impale, no counter-attack</span>)"

			hp_low="$band_none_text <span color='#dba493'>hp +5%</span>
$band_initiated_text <span color='#dba493'>hp +15%</span>
$band_proven_text <span color='#dba493'>hp +25%</span>, <span color='#9dc9c3'>cures</span>
$band_notable_text <span color='#dba493'>hp +30%</span>, <span color='#9dc9c3'>cures</span>, <span color='#9dc9c3'>immune to poison</span>, <span color='#9dc9c3'>concoction 33</span>, <span color='#9dc9c3'>toxic fumes 1</span>
$band_significant_text <span color='#dba493'>hp +40%</span>, <span color='#9dc9c3'>poison knowledge</span>, <span color='#9dc9c3'>concoction 67</span>, <span color='#9dc9c3'>toxic fumes 3</span>, <span color='#9dc9c3'>alcohol fumes 5</span>
$band_epic_text <span color='#dba493'>hp +50%</span>, <span color='#9dc9c3'>poison knowledge</span>, <span color='#9dc9c3'>concoction 100</span>, <span color='#9dc9c3'>toxic fumes 5</span>, <span color='#9dc9c3'>alcohol fumes 10</span>"

			hp_med="$band_none_text <span color='#dba493'>hp +10%</span>
$band_initiated_text <span color='#dba493'>hp +20%</span>
$band_proven_text <span color='#dba493'>hp +30%</span>
$band_notable_text <span color='#dba493'>hp +40%</span>, <span color='#9dc9c3'>immune to drains</span>, <span color='#9dc9c3'>aoe drains 4</span>, <span color='#9dc9c3'>melee endurance 20</span>
$band_significant_text <span color='#dba493'>hp +50%</span>, <span color='#9dc9c3'>drains immunity aura</span>, <span color='#9dc9c3'>aoe drains 6</span>, <span color='#9dc9c3'>melee endurance 30</span>
$band_epic_text <span color='#dba493'>hp +60%</span>, <span color='#9dc9c3'>drains immunity aura</span>, <span color='#9dc9c3'>aoe drains 8</span>, <span color='#9dc9c3'>melee endurance 40</span>"

			hp_high="$band_none_text <span color='#dba493'>hp +15%</span>
$band_initiated_text <span color='#dba493'>hp +25%</span>
$band_proven_text <span color='#dba493'>hp +35%</span>
$band_notable_text <span color='#dba493'>hp +45%</span>, <span color='#9dc9c3'>bloodline 10%</span>
$band_significant_text <span color='#dba493'>hp +60%</span>, <span color='#9dc9c3'>bloodline 20%</span>
$band_epic_text <span color='#dba493'>hp +75%</span>, <span color='#9dc9c3'>bloodline 30%, treats wounded</span>"

			steadfast="$band_none_text <span color='#9dc9c3'>steadfast x1.5 25% max</span>
$band_initiated_text <span color='#9dc9c3'>steadfast x1.75 40% max</span>
$band_proven_text <span color='#9dc9c3'>steadfast x2 50% max</span>
$band_notable_text <span color='#9dc9c3'>steadfast x2 55% max</span>, <span color='#9dc9c3'>shield master 20(16%)</span>
$band_significant_text <span color='#9dc9c3'>steadfast x2.25 65% max</span>, <span color='#9dc9c3'>shield master 40(19%)</span>
$band_epic_text <span color='#9dc9c3'>steadfast x2.5 75% max</span>, <span color='#9dc9c3'>shield master 70(22%)</span>"

			regen="$band_none_text <span color='#9dc9c3'>regenerates +2</span>
$band_initiated_text <span color='#9dc9c3'>regenerates +4</span>
$band_proven_text <span color='#9dc9c3'>regenerates +8</span>
$band_notable_text <span color='#9dc9c3'>regenerates +12 (village +16, fight +2)</span>
$band_significant_text <span color='#9dc9c3'>regenerates +16 (village +24, fight +4)</span>
$band_epic_text <span color='#9dc9c3'>regenerates +24 (village +32, fight +8)</span>"

			melee_dmg="$band_none_text <span color='#cf467a'>melee dmg +7%</span>
$band_initiated_text <span color='#cf467a'>melee dmg +15%</span>
$band_proven_text <span color='#cf467a'>melee dmg +25%</span>
$band_notable_text <span color='#cf467a'>melee dmg +33%</span>, <span color='#d194e3'>battle fury +8% (m)</span>
$band_significant_text <span color='#cf467a'>melee dmg +40%</span>, <span color='#d194e3'>battle fury +16% (m)</span>
$band_epic_text <span color='#cf467a'>melee dmg +50%</span>, <span color='#d194e3'>battle fury +24% (m)</span>, <span color='#2d8a7f'>fearless</span>"

			ranged_dmg="$band_none_text <span color='#cf467a'>ranged dmg +7%</span>
$band_initiated_text <span color='#cf467a'>ranged dmg +15%</span>
$band_proven_text <span color='#cf467a'>ranged dmg +25%</span>
$band_notable_text <span color='#cf467a'>ranged dmg +33%</span>, <span color='#d194e3'>ruthless (r)</span>
$band_significant_text <span color='#cf467a'>ranged dmg +40%</span>, <span color='#c2986e'>+1 ranged strike</span>
$band_epic_text <span color='#cf467a'>ranged dmg +50%</span>, <span color='#c2986e'>+1 ranged strike</span>, <span color='#d194e3'>merciless (r)</span>"

			ranged_acc="$band_none_text <span color='#94bf6f'>ranged accuracy +2(1)</span>, <span color='#cf467a'>+1 ranged dmg</span>
$band_initiated_text <span color='#94bf6f'>ranged accuracy +5(3)</span>, <span color='#cf467a'>+1 ranged dmg</span>
$band_proven_text <span color='#94bf6f'>ranged accuracy +8(5)</span>, <span color='#cf467a'>+1 ranged dmg</span>
$band_notable_text <span color='#94bf6f'>ranged accuracy +12(7)</span>, <span color='#d194e3'>assassination x1.5 (r)</span>, <span color='#cf467a'>+2 ranged dmg</span>
$band_significant_text <span color='#94bf6f'>ranged accuracy +16(10)</span>, <span color='#d194e3'>assassination x2 (r)</span>, <span color='#cf467a'>+2 ranged dmg</span>
$band_epic_text <span color='#94bf6f'>ranged accuracy +20(15)</span>, <span color='#d194e3'>assassination x2.5 (r)</span>, <span color='#cf467a'>+3 ranged dmg</span>"

			melee_parry="$band_none_text <span color='#a4b874'>melee parry +3</span>
$band_initiated_text <span color='#a4b874'>melee parry +5</span>
$band_proven_text <span color='#a4b874'>melee parry +7</span>
$band_notable_text <span color='#a4b874'>melee parry +9</span>, <span color='#d194e3'>counterbalance 30 (m)</span>
$band_significant_text <span color='#a4b874'>melee parry +12</span>, <span color='#d194e3'>counterbalance 40 (m)</span>
$band_epic_text <span color='#a4b874'>melee parry +15</span>, <span color='#d194e3'>counterbalance 50 (m)</span>, <span color='#2d8a7f'>peaceful warrior</span>"

			melee_poison="$band_none_text <span color='#d194e3'>poison (lower level only) (m)</span>
$band_initiated_text <span color='#d194e3'>poison (same and lower level only) (m)</span>
$band_proven_text <span color='#d194e3'>poison (m)</span>
$band_notable_text <span color='#d194e3'>poison 10 (m)</span>, <span color='#94bf6f'>melee accuracy +2</span>, <span color='#d194e3'>backstab x1.5 (m)</span>
$band_significant_text <span color='#d194e3'>poison 12 (m)</span>, <span color='#94bf6f'>melee accuracy +3</span>, <span color='#d194e3'>backstab x2 (m)</span>
$band_epic_text <span color='#d194e3'>poison 16 (m)</span>, <span color='#94bf6f'>melee accuracy +5</span>, <span color='#d194e3'>backstab x2.5 (m)</span>"

			melee_slow="$band_none_text <span color='#d194e3'>slow (day only) (m)</span>
$band_initiated_text <span color='#d194e3'>slow (day, dawn and dusk) (m)</span>
$band_proven_text <span color='#d194e3'>slow (m)</span>
$band_notable_text <span color='#d194e3'>slow (m)</span>, <span color='#9dc9c3'>slow aura</span>
$band_significant_text <span color='#d194e3'>slow (m)</span>, <span color='#9dc9c3'>slow aura, lesser chronosphere</span>
$band_epic_text <span color='#d194e3'>slow (m)</span>, <span color='#9dc9c3'>slow aura, chronosphere</span>"

			mp="$band_none_text <span color='#6b71e3'>+1mp</span>
$band_initiated_text <span color='#6b71e3'>+1mp</span>
$band_proven_text <span color='#6b71e3'>+2mp</span>
$band_notable_text <span color='#6b71e3'>+2mp</span>, <span color='#9dc9c3'>slow immunity</span>
$band_significant_text <span color='#6b71e3'>+3mp</span>, <span color='#9dc9c3'>slow immunity aura</span>
$band_epic_text <span color='#6b71e3'>+4mp</span>, <span color='#9dc9c3'>motility mastery</span>"

			feeding="$band_none_text <span color='#9dc9c3'>deluminates -5</span>
$band_initiated_text <span color='#9dc9c3'>deluminates -15</span>
$band_proven_text <span color='#9dc9c3'>deluminates -25</span>
$band_notable_text <span color='#9dc9c3'>deluminates -25</span>, <span color='#9dc9c3'>15% to summon lvl0 undead</span>
$band_significant_text <span color='#9dc9c3'>deluminates -30</span>, <span color='#9dc9c3'>16% to summon lvl1 undead</span>, <span color='#9dc9c3'>feeding +1hp</span>
$band_epic_text <span color='#9dc9c3'>deluminates -35</span>, <span color='#9dc9c3'>17% to summon lvl2 undead</span>, <span color='#9dc9c3'>feeding +1hp</span>"

			leadership="$band_none_text <span color='#9dc9c3'>leadership 5%</span>
$band_initiated_text <span color='#9dc9c3'>leadership 15%</span>
$band_proven_text <span color='#9dc9c3'>leadership 25%</span>
$band_notable_text <span color='#9dc9c3'>leadership 25%</span>, <span color='#9dc9c3'>leads by example 15%</span>
$band_significant_text <span color='#9dc9c3'>leadership 30%</span>, <span color='#9dc9c3'>leads by example 25%</span>, <span color='#9dc9c3'>great leader 25%</span>
$band_epic_text <span color='#9dc9c3'>leadership 35%</span>, <span color='#9dc9c3'>leads by example 35%</span>, <span color='#9dc9c3'>great leader 50%</span>, <span color='#2d8a7f'>fearless</span>"

			drain="$band_none_text <span color='#d194e3'>drains 20% (r)</span>
$band_initiated_text <span color='#d194e3'>drains 35% (r)</span>
$band_proven_text <span color='#d194e3'>drains 50% (r)</span>
$band_notable_text <span color='#d194e3'>drains 55%(20% non-living) (r)</span>, <span color='#d194e3'>wicked x1.15 (r)</span>
$band_significant_text <span color='#d194e3'>drains 65%(30% non-living) (r)</span>, <span color='#d194e3'>wicked x1.25 (r)</span>
$band_epic_text <span color='#d194e3'>drains 75%(40% non-living) (r)</span>, <span color='#d194e3'>unholy x1.35</span>"

			defense="$band_none_text <span color='#8dadb0'>defense +1%</span>
$band_initiated_text <span color='#8dadb0'>defense +3%</span>
$band_proven_text <span color='#8dadb0'>defense +5%</span>
$band_notable_text <span color='#8dadb0'>defense +7%</span>, <span color='#6b71e3'>-1 movement cost</span>
$band_significant_text <span color='#8dadb0'>defense +10%</span>, <span color='#6b71e3'>-2 movement cost</span>, <span color='#9dc9c3'>terrain knowledge</span>
$band_epic_text <span color='#8dadb0'>defense +10%</span>, <span color='#6b71e3'>-3 movement cost</span>, <span color='#9dc9c3'>cartography</span>"

			skirm="$band_none_text <span color='#9dc9c3'>nighttime only skirmisher</span>
$band_initiated_text <span color='#9dc9c3'>dawn, dusk and night skirmisher</span>
$band_proven_text <span color='#9dc9c3'>skirmisher</span>
$band_notable_text <span color='#9dc9c3'>skirmisher</span>, <span color='#6b71e3'>+1mp</span>
$band_significant_text <span color='#9dc9c3'>skirmisher</span>, <span color='#6b71e3'>+2mp</span>, <span color='#9dc9c3'>battle fervor +1</span>
$band_epic_text <span color='#9dc9c3'>skirmisher</span>, <span color='#6b71e3'>+2mp</span>, <span color='#9dc9c3'>battle fervor +2</span>, <span color='#9dc9c3'>enemy control</span>"

			first_strike="$band_none_text <span color='#d194e3'>first strike against lower level units (m)</span>
$band_initiated_text <span color='#d194e3'>first strike (m)</span>
$band_proven_text <span color='#d194e3'>first strike</span>
$band_notable_text <span color='#d194e3'>first strike</span>, <span color='#d194e3'>preemptive strike 50%</span>
$band_significant_text <span color='#d194e3'>first strike</span>, <span color='#d194e3'>preemptive strike 75%</span>
$band_epic_text <span color='#d194e3'>first strike</span>, <span color='#d194e3'>initiative</span>, <span color='#9dc9c3'>eagerness aura</span>"

			fear="$band_none_text <span color='#d194e3'>bane 0%(10%) adjacent lvl0</span>, <span color='#d194e3'>retaliation -5%</span>
$band_initiated_text <span color='#d194e3'>bane 5%(10%) adjacent max lvl1</span>, <span color='#d194e3'>retaliation -5%</span>
$band_proven_text <span color='#d194e3'>bane 5%(15%) radius 2 max lvl2</span>, <span color='#d194e3'>retaliation -10%</span>
$band_notable_text <span color='#d194e3'>bane 10%(20%) radius 3 max lvl3</span>, <span color='#d194e3'>retaliation -15%</span>, <span color='#d194e3'>+1 heal on hit (m)</span>
$band_significant_text <span color='#d194e3'>bane 10%(25%) radius 4 max lvl4</span>, <span color='#d194e3'>retaliation -20%</span>, <span color='#d194e3'>+2 heal on hit (m)</span>
$band_epic_text <span color='#d194e3'>bane 15%(30%) radius 5 max lvl5</span>, <span color='#d194e3'>retaliation -25%</span>, <span color='#d194e3'>+3 heal on hit (m)</span>, <span color='#2d8a7f'>fearless</span>"

			discouragement="$band_none_text <span color='#d194e3'>dishearten -10% (m)</span>
$band_initiated_text <span color='#d194e3'>dishearten -15% (m)</span>
$band_proven_text <span color='#d194e3'>dishearten -20%</span>
$band_notable_text <span color='#d194e3'>dishearten -20%</span>, <span color='#d194e3'>discourage -1 (m)</span>
$band_significant_text <span color='#d194e3'>dishearten -25%</span>, <span color='#d194e3'>discourage -1</span>
$band_epic_text <span color='#d194e3'>dishearten -30%</span>, <span color='#d194e3'>discourage -1</span>, <span color='#d94848'>corrupts</span>"

			burns="$band_none_text <span color='#9dc9c3'>secret fire 2</span>, <span color='#d6d685'>+5% fire resistance</span>
$band_initiated_text <span color='#9dc9c3'>secret fire 4</span>, <span color='#d6d685'>+5% fire resistance</span>
$band_proven_text <span color='#9dc9c3'>secret fire 8</span>, <span color='#d6d685'>+5% fire resistance</span>
$band_notable_text <span color='#9dc9c3'>secret fire 12(8)</span>, <span color='#9dc9c3'>fire vision +1</span>, <span color='#d6d685'>+15% fire resistance</span>
$band_significant_text <span color='#9dc9c3'>secret fire 16(12)</span>, <span color='#9dc9c3'>fire vision +2</span>, <span color='#d6d685'>+15% fire resistance</span>
$band_epic_text <span color='#9dc9c3'>secret fire 20(16)</span>, <span color='#9dc9c3'>fire vision +3</span>, <span color='#d6d685'>+25% fire resistance</span>"

			golden_armor="$band_none_text <span color='#d6d685'>all resistance +3</span>
$band_initiated_text <span color='#d6d685'>all resistance +6</span>
$band_proven_text <span color='#d6d685'>all resistance +10</span>
$band_notable_text <span color='#d6d685'>all resistance +13</span>, <span color='#9dc9c3'>reflects 20%(10%)</span>
$band_significant_text <span color='#d6d685'>all resistance +16</span>, <span color='#9dc9c3'>reflects 40%(20%)</span>
$band_epic_text <span color='#d6d685'>all resistance +20</span>, <span color='#9dc9c3'>reflects 60%(30%)</span>"

			heal="$band_none_text <span color='#9dc9c3'>heals +2</span>, <span color='#d6d685'>+5% arcane resistance</span>
$band_initiated_text <span color='#9dc9c3'>heals +4</span>, <span color='#d6d685'>+5% arcane resistance</span>
$band_proven_text <span color='#9dc9c3'>heals +8</span>, <span color='#d6d685'>+5% arcane resistance</span>
$band_notable_text <span color='#9dc9c3'>heals +8</span>, <span color='#9dc9c3'>heals all +2</span>, <span color='#d6d685'>+15% arcane resistance</span>
$band_significant_text <span color='#9dc9c3'>heals +10</span>, <span color='#9dc9c3'>heals all +4</span>, <span color='#d6d685'>+15% arcane resistance</span>
$band_epic_text <span color='#9dc9c3'>heals +12</span>, <span color='#9dc9c3'>restores all +8</span>, <span color='#2d8a7f'>distinguished</span>, <span color='#d6d685'>+25% arcane resistance</span>"

			freezing_gem="$band_none_text <span color='#d194e3'>freezing touch -1</span>, <span color='#d6d685'>+5% cold resistance</span>
$band_initiated_text <span color='#d194e3'>freezing touch -2</span>, <span color='#d6d685'>+5% cold resistance</span>
$band_proven_text <span color='#d194e3'>freezing touch -3</span>, <span color='#d6d685'>+5% cold resistance</span>
$band_notable_text <span color='#d194e3'>freezing touch -4</span>, <span color='#d194e3'>icy shackles x1.5</span>, <span color='#d6d685'>+15% cold resistance</span>
$band_significant_text <span color='#d194e3'>freezing touch -5</span>, <span color='#d194e3'>icy shackles x1.65</span>, <span color='#d6d685'>+15% cold resistance</span>
$band_epic_text <span color='#d194e3'>freezing touch -6</span>, <span color='#d194e3'>icy shackles x1.8</span>, <span color='#d6d685'>+25% cold resistance</span>"

			field_disruption="$band_none_text <span color='#9dc9c3'>field -10</span>
$band_initiated_text <span color='#9dc9c3'>field -15</span>
$band_proven_text <span color='#9dc9c3'>field -20</span>
$band_notable_text <span color='#9dc9c3'>field -25</span>, <span color='#9dc9c3'>phase 5(5)</span>
$band_significant_text <span color='#9dc9c3'>field -30</span>, <span color='#9dc9c3'>phase 15(10)</span>
$band_epic_text <span color='#9dc9c3'>field -35</span>, <span color='#9dc9c3'>phase 25(15)</span>"

			armor_destruction="$band_none_text <span color='#d194e3'>armor destruction -1 (m)</span>, <span color='#cf467a'>+1 melee damage</span>
$band_initiated_text <span color='#d194e3'>armor destruction -2 (m)</span>, <span color='#cf467a'>+1 melee damage</span>
$band_proven_text <span color='#d194e3'>armor destruction -3 (m)</span>, <span color='#cf467a'>+1 melee damage</span>
$band_notable_text <span color='#d194e3'>armor destruction -4 (m)</span>, <span color='#d194e3'>bloodseeker 4 (m)</span>, <span color='#cf467a'>+2 melee damage</span>
$band_significant_text <span color='#d194e3'>armor destruction -5 (m)</span>, <span color='#d194e3'>bloodseeker 6 (m)</span>, <span color='#cf467a'>+2 melee damage</span>
$band_epic_text <span color='#d194e3'>armor destruction -6 (m)</span>, <span color='#d194e3'>bloodseeker 8 (m)</span>, <span color='#d194e3'>duel 2 (m)</span>, <span color='#cf467a'>+3 melee damage</span>"

			protection="$band_none_text <span color='#9dc9c3'>protection +10</span>
$band_initiated_text <span color='#9dc9c3'>protection +15</span>
$band_proven_text <span color='#9dc9c3'>protection +20</span>
$band_notable_text <span color='#9dc9c3'>protection +25</span>, <span color='#9dc9c3'>defensive wall x1.2</span>
$band_significant_text <span color='#9dc9c3'>protection +30</span>, <span color='#9dc9c3'>defensive wall x1.4</span>
$band_epic_text <span color='#9dc9c3'>protection +35</span>, <span color='#9dc9c3'>impenetrable wall x1.5</span>"

			double_attack="$band_none_text <span color='#d194e3'>double attack (8 to charge) (r)</span>
$band_initiated_text <span color='#d194e3'>double attack (7 to charge) (r)</span>
$band_proven_text <span color='#d194e3'>double attack (6 to charge) (r)</span>
$band_notable_text <span color='#d194e3'>double attack (5 to charge) (r)</span>, <span color='#d194e3'>sharpshooter 30% (r)</span>
$band_significant_text <span color='#d194e3'>double attack (4 to charge) (r)</span>, <span color='#d194e3'>sharpshooter 50% (r)</span>
$band_epic_text <span color='#d194e3'>double attack (3 to charge) (r)</span>, <span color='#d194e3'>sharpshooter 70% (r)</span>"

			hitn_run="$band_none_text <span color='#9dc9c3'>nightstalk</span>
$band_initiated_text <span color='#9dc9c3'>nightstalk</span>, <span color='#9dc9c3'>kill and run +1</span>
$band_proven_text <span color='#9dc9c3'>nightstalk</span>, <span color='#9dc9c3'>kill and run +2</span>
$band_notable_text <span color='#9dc9c3'>nightstalk</span>, <span color='#9dc9c3'>hit and run +1(3)</span>, <span color='#d194e3'>assassin's strike x1.5</span>
$band_significant_text <span color='#9dc9c3'>nightstalk</span>, <span color='#9dc9c3'>hit and run +2(4)</span>, <span color='#d194e3'>assassin's strike x2</span>
$band_epic_text <span color='#9dc9c3'>nightstalk</span>, <span color='#9dc9c3'>hit and run +3(5)</span>, <span color='#d194e3'>assassin's strike x2.5</span>, <span color='#9dc9c3'>successful operation</span>"

			extra_strikes="$band_none_text <span color='#d194e3'>extra strike below 33% hp</span>
$band_initiated_text <span color='#d194e3'>extra strike below 67% hp</span>
$band_proven_text <span color='#c2986e'>+1 strike</span>
$band_notable_text <span color='#c2986e'>+1 strike</span>, <span color='#d194e3'>extra below 50% hp</span>, <span color='#d194e3'>marksman 50</span>
$band_significant_text <span color='#c2986e'>+1 strike</span>, <span color='#d194e3'>extra below 67% and 33% hp</span>, <span color='#d194e3'>marksman 60</span>
$band_epic_text <span color='#c2986e'>+2 strikes</span>, <span color='#d194e3'>extra below 50%</span>, <span color='#d194e3'>marksman 65</span>"

			rat_pack="$band_none_text <span color='#9dc9c3'>rodents spawn every 6 turns</span>
$band_initiated_text <span color='#9dc9c3'>rodents spawn every 5 turns</span>
$band_proven_text <span color='#9dc9c3'>rodents spawn every 4 turns</span>
$band_notable_text <span color='#9dc9c3'>rodents spawn every 4 turns, 50% chance to be a special rat</span>
$band_significant_text <span color='#9dc9c3'>rodents spawn every 3 turns, 75% to be a special rat</span>, <span color='#9dc9c3'>rat ambassador</span>
$band_epic_text <span color='#9dc9c3'>special rodents spawns every 2 turns</span>, <span color='#9dc9c3'>rat ambassador</span>"

			icewind_aura="$band_none_text <span color='#9dc9c3'>icewind radius 1</span>
$band_initiated_text <span color='#9dc9c3'>icewind radius 2</span>
$band_proven_text <span color='#9dc9c3'>icewind radius 3</span>
$band_notable_text <span color='#9dc9c3'>icewind radius 5, passive 2 cold damage, defenses -2%</span>
$band_significant_text <span color='#9dc9c3'>icewind radius 7, passive 4 cold damage, defenses -5%</span>
$band_epic_text <span color='#9dc9c3'>icewind radius 9, passive 8 cold damage, defenses -10%, damage +15%</span>"

			book="$band_none_text <span color='#9dc9c3'>battle study +15% xp</span>
$band_initiated_text <span color='#9dc9c3'>battle study +25% xp</span>
$band_proven_text <span color='#9dc9c3'>battle study +40% xp</span>
$band_notable_text <span color='#9dc9c3'>battle study +40%(15%) xp</span>, <span color='#2d8a7f'>intelligent</span>, <span color='#9dc9c3'>combat teacher +1</span>
$band_significant_text <span color='#9dc9c3'>battle study +40%(25%) xp</span>, <span color='#2d8a7f'>intelligent</span>, <span color='#9dc9c3'>combat teacher +2</span>
$band_epic_text <span color='#9dc9c3'>battle study +40%(40%) xp</span>, <span color='#9dc9c3'>combat teacher +3</span>, <span color='#2d8a7f'>all intelligent</span>"

			dragon_protection="$band_none_text <span color='#9dc9c3'>protects against lvl 0, restores 1hp</span>, <span color='#d6d685'>resistance +5%(15%)</span>
$band_initiated_text <span color='#9dc9c3'>protects against lvl 1 max, restores 3hp</span>, <span color='#d6d685'>resistance +5%(15%)</span>
$band_proven_text <span color='#9dc9c3'>protects against lvl 2 max, restores 5hp</span>, <span color='#d6d685'>resistance +5%(15%)</span>
$band_notable_text <span color='#9dc9c3'>protects against lvl 3 max, restores 20% hp</span>, <span color='#d6d685'>resistance +10%(25%)</span>
$band_significant_text <span color='#9dc9c3'>protects against lvl 4 max, restores 35% hp</span>, <span color='#d6d685'>resistance +10%(25%)</span>
$band_epic_text <span color='#9dc9c3'>protects against lvl 6 max, restores 50% hp</span>, <span color='#d6d685'>resistance +15%(35%)</span>"
		[/value]
	[/set_variables]
#enddef

#define SHOW_ITEM_PICKUP_MESSAGE ITEM_ID IMAGE TEXT
	[message]
		speaker=narrator
		message={TEXT}
		image={IMAGE}

		[option]
			label="Yes"

			[command]
				{VARIABLE item_append_id {ITEM_ID}}

				[if]
					[variable]
						name=item_append_id
						not_equals=""
					[/variable]
					[then]
						[fire_event]
							name=append_item_variables
							[primary_unit]
								x,y=$x1,$y1
							[/primary_unit]
						[/fire_event]

						[fire_event]
							name=promote_unit
							[primary_unit]
								x,y=$x1,$y1
							[/primary_unit]
						[/fire_event]
					[/then]
				[/if]

				[remove_item]
					x,y=$x1,$y1
					image={IMAGE}
				[/remove_item]
				
				{VARIABLE allow_undo no}
				{CLEAR_VARIABLE scrollable_items[$item_list_key]}
				{VARIABLE_OP item_list_key sub 1}
			[/command]
		[/option]

		[option]
			label="No"

			[command][/command]
		[/option]
	[/message]
#enddef

#define QQUWS_ITEMS
	[event]
		name=drop_new_item
		first_time_only=no
		
		{VARIABLE drop_item_image $items_steps[3].$item_type_id}
		[if]
			[variable]
				name=overwrite_item_image
				not_equals=""
			[/variable]
			[then]
				{VARIABLE drop_item_image $overwrite_item_image}
			[/then]
		[/if]

		{VARIABLE render_dropped_item yes}
		
		[if]
			[variable]
				name=render_new_item
				boolean_equals=yes
			[/variable]
			[then]
				{VARIABLE place_item yes}
				[if]
					[variable]
						name=uws_game.mode
						equals=scroll
					[/variable]
					[then]
						[if]
							[variable]
								name=item_y
								less_than=4
							[/variable]
							[or]
								[variable]
									name=item_y
									greater_than=18
								[/variable]
							[/or]
							[then]
								{VARIABLE place_item no}
							[/then]
						[/if]
					[/then]
				[/if]

				[if]
					[variable]
						name=place_item
						boolean_equals=yes
					[/variable]
					[then]
						[item]
							x,y=$item_x,$item_y
							image=$drop_item_image
						[/item]
					[/then]
				[/if]
			[/then]
			[else]
				{VARIABLE render_dropped_item no}
			[/else]
		[/if]

		[set_variables]
			name=scrollable_items
			mode=append
			[value]
				cat=item
				x=$item_x
				y=$item_y
				image=$drop_item_image
				type=$item_type_id
				render=$render_dropped_item
				object_id=$drop_object_id
			[/value]
		[/set_variables]
		
		{CLEAR_VARIABLE overwrite_item_image}
	[/event]
	
	[event]
		name=add_extra_item_gold
		first_time_only=no
		
		[store_gold]
			side=$side_number
			variable=gold
		[/store_gold]
		
		[if]
			[variable]
				name=gold
				less_than=0
			[/variable]
			[then]
				[set_variable]
					name=gold
					multiply=-1
				[/set_variable]
				[gold]
					side=$side_number
					amount=$gold
				[/gold]
			[/then]
		[/if]
		
	        [gold]
	     	   side=$side_number
	     	   amount=25
	        [/gold]
	[/event]
#enddef

#define QQUWS_PROMOTE_UNIT
	[event]
		name=generate_promotion_rank_variables
		first_time_only=no
		
		{VARIABLE promotion_label none}
		{VARIABLE promotion_level 0}
		{VARIABLE promotion_def_suffix "/$threshold_initiated"}
		{VARIABLE promotion_colour $rank_none_color}
		{VARIABLE next_promo_label " / next level"}
		{VARIABLE promo_bonus_dmg 0}
		{VARIABLE unit_items_names ""}

		[if]
			[variable]
				name=unit.variables.kills
				greater_than_equal_to=$threshold_epic
			[/variable]
			[then]
				{VARIABLE promotion_label epic}
				{VARIABLE promotion_level 5}
				{VARIABLE promotion_def_suffix ""}
				{VARIABLE promotion_colour $rank_epic_color}
				{VARIABLE next_promo_label ""}
				{VARIABLE promo_bonus_dmg 65}
			[/then]
			[else]
				[if]
					[variable]
						name=unit.variables.kills
						greater_than_equal_to=$threshold_significant
					[/variable]
					[then]
						{VARIABLE promotion_label significant}
						{VARIABLE promotion_level 4}
						{VARIABLE promotion_def_suffix "/$threshold_epic"}
						{VARIABLE promotion_colour $rank_significant_color}
						{VARIABLE promo_bonus_dmg 45}
					[/then]
					[else]
						[if]
							[variable]
								name=unit.variables.kills
								greater_than_equal_to=$threshold_notable
							[/variable]
							[then]
								{VARIABLE promotion_label notable}
								{VARIABLE promotion_level 3}
								{VARIABLE promotion_def_suffix "/$threshold_significant"}
								{VARIABLE promotion_colour $rank_notable_color}
								{VARIABLE promo_bonus_dmg 33}
							[/then]
							[else]
								[if]
									[variable]
										name=unit.variables.kills
										greater_than_equal_to=$threshold_proven
									[/variable]
									[then]
										{VARIABLE promotion_label proven}
										{VARIABLE promotion_level 2}
										{VARIABLE promotion_def_suffix "/$threshold_notable"}
										{VARIABLE promotion_colour $rank_proven_color}
										{VARIABLE promo_bonus_dmg 20}
									[/then]
									[else]
										[if]
											[variable]
												name=unit.variables.kills
												greater_than_equal_to=$threshold_initiated
											[/variable]
											[then]
												{VARIABLE promotion_label initiated}
												{VARIABLE promotion_level 1}
												{VARIABLE promotion_def_suffix "/$threshold_proven"}
												{VARIABLE promotion_colour $rank_initiated_color}
												{VARIABLE promo_bonus_dmg 10}
											[/then]
										[/if]
									[/else]
								[/if]
							[/else]
						[/if]
					[/else]
				[/if]
			[/else]
		[/if]
		
		[if]
			[variable]
				name=promotion_level
				greater_than=0
			[/variable]
			[or]
				[variable]
					name=unit.variables.items_picked_up
					not_equals=""
				[/variable]
			[/or]
			[then]
				{VARIABLE current_promotion_level $unit.variables.promotion_level}
				{VARIABLE unit_items_info "yet"}
				{VARIABLE items_count "No"}
				[if]
					[variable]
						name=unit.variables.items_picked_up
						not_equals=""
					[/variable]
					[then]
						{VARIABLE unit_items_info " (<span color='$promotion_colour'>$promotion_label</span>$next_promo_label|):"}
						
						[set_variables]
							name=unit_items_ids
							mode=replace
							[split]
								list=$unit.variables.items_picked_up
								key=item
								separator=","
							[/split]
						[/set_variables]
						
						{VARIABLE items_count "$unit_items_ids.length|/$uws_game.max_items_per_unit"}
						
						[for]
							variable=i
							array=unit_items_ids
							[do]
								{VARIABLE array_key $unit_items_ids[$i].item}
								
								[set_variables]
									name=steps_readable
									mode=replace
									[split]
										list=$items_steps[2].$array_key
										key=step
										separator="/"
									[/split]
								[/set_variables]
								
								{VARIABLE step_value_now $steps_readable[$promotion_level].step}
								{VARIABLE step_value_next ""}
								
								[if]
									[variable]
										name=promotion_level
										less_than=5
									[/variable]
									[then]
										{VARIABLE tmp_next_level $promotion_level}
										{VARIABLE_OP tmp_next_level add 1}
										{VARIABLE step_value_next "/ $steps_readable[$tmp_next_level].step"}
									[/then]
								[/if]
								
								[if]
									[variable]
										name=unit_items_names
										equals=""
									[/variable]
									[then]
										{VARIABLE unit_items_names "$items_steps[1].$array_key"}
									[/then]
									[else]
										{VARIABLE unit_items_names "$unit_items_names
            $items_steps[1].$array_key"}
									[/else]
								[/if]
								
								{VARIABLE unit_items_info "$unit_items_info
$items_steps[1].$array_key|: <span color='$promotion_colour|'>$step_value_now|</span> $step_value_next"}
							[/do]
						[/for]
					[/then]
				[/if]
				
				{VARIABLE unit_kills_info $unit.variables.kills}
				[if]
					[variable]
						name=unit_kills_info
						equals=""
					[/variable]
					[then]
						{VARIABLE unit_kills_info 0}
					[/then]
				[/if]
				
				{VARIABLE display_rank_info yes}
			[/then]
		[/if]
	[/event]
	
	[event]
		name=promote_unit
		first_time_only=no
		
		{VARIABLE display_rank_info no}
		
		[fire_event]
			name=generate_promotion_rank_variables
			[primary_unit]
				id=$unit.id
			[/primary_unit]
		[/fire_event]
		
		[if]
			[variable]
				name=display_rank_info
				boolean_equals=yes
			[/variable]
			[then]
				[remove_trait]
					id=$unit.id
					trait_id=qquws_promotion_rank_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						promotion_level=$promotion_level
					[/variables]

					[trait]
						id=qquws_promotion_rank_trait
						name="<span color='$promotion_colour'>$promotion_label</span>"
						description="Promotion rank, provides +$promo_bonus_dmg|% dmg and affects item specials ($unit_kills_info|$promotion_def_suffix| kills)
								
$items_count items picked up $unit_items_info"
					[/trait]
				[/modify_unit]
				
				[if]
					[variable]
						name=promotion_level
						greater_than=$current_promotion_level
					[/variable]
					[then]
						[fire_event]
							name=upgrade_item_specials
							[primary_unit]
							    id=$second_unit.id
							[/primary_unit]
						[/fire_event]
					[/then]
				[/if]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=recalculate_items_count_for_unit
		first_time_only=no
		
		{VARIABLE items_count 0}
		{VARIABLE unit_item_list ""}
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				[set_variables]
					name=tmp_unit_items_array
					mode=replace
					[split]
						list=$unit.variables.items_picked_up
						key=item
						separator=","
					[/split]
				[/set_variables]
				
				{VARIABLE items_count $tmp_unit_items_array.length}
				{VARIABLE unit_item_list $unit.variables.items_picked_up}
			[/then]
		[/if]
	[/event]
	
	[event]
		name=append_item_variables
		first_time_only=no
		
		{VARIABLE already_applied ""}
		{VARIABLE current_promotion_level $unit.variables.promotion_level}
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				{VARIABLE already_applied "$unit.variables.items_picked_up|,"}
			[/then]
		[/if]
		
		{VARIABLE items_count $unit_items_ids.length}
		
		[if]
			[variable]
				name=unit.variables.promotion_level
				equals=""
			[/variable]
			[then]
				{VARIABLE current_promotion_level 0}
			[/then]
		[/if]
		
		[modify_unit]
			[filter]
				id=$unit.id
			[/filter]
			
			[variables]
				items_picked_up="$already_applied|$item_append_id"
				promotion_level=$current_promotion_level
			[/variables]
		[/modify_unit]
		
		{VARIABLE item_key $item_append_id}
		[set_variables]
			name=current_item_steps
			mode=replace
			[split]
				list=$items_steps[0].$item_key
				key=step_value
				separator="/"
			[/split]
		[/set_variables]
		
		[for]
			variable=use_promotion_level
			start=0
			end=$current_promotion_level
			step=1
			[do]
				{VARIABLE item_step $current_item_steps[$use_promotion_level].step_value}
				
				[fire_event]
					name=upgrade_single_item_promotion
					[primary_unit]
					    id=$unit.id
					[/primary_unit]
				[/fire_event]
			[/do]
		[/for]
	[/event]
	
	[event]
		name=upgrade_item_specials
		first_time_only=no

		[remove_trait]
			id=$unit.id
			trait_id=qquws_promotion_effect_trait
		[/remove_trait]

		[if]
			[variable]
				name=promo_bonus_dmg
				greater_than=0
			[/variable]
			[then]
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_promotion_effect_trait

						[effect]
						    apply_to=attack
						    increase_damage="$promo_bonus_dmg|%"
						[/effect]
					[/trait]
				[/modify_unit]
			[/then]
		[/if]		
		
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				[set_variables]
					name=current_unit_items_set
					mode=replace
					[split]
						list=$unit.variables.items_picked_up
						key=item_id
						separator=","
					[/split]
				[/set_variables]
				
				[for]
					variable=i
					array=current_unit_items_set
					[do]
						{VARIABLE item_key $current_unit_items_set[$i].item_id}
						[set_variables]
							name=current_item_steps
							mode=replace
							[split]
								list=$items_steps[0].$item_key
								key=step_value
								separator="/"
							[/split]
						[/set_variables]
						
						{VARIABLE item_step $current_item_steps[$unit.variables.promotion_level].step_value}
						{VARIABLE use_promotion_level $unit.variables.promotion_level}
						[fire_event]
							name=upgrade_single_item_promotion
							[primary_unit]
							    id=$unit.id
							[/primary_unit]
						[/fire_event]
					[/do]
				[/for]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=upgrade_single_item_promotion
		first_time_only=no

		{VARIABLE item_promotion_unit_id $unit.id}
		{VARIABLE item_promotion_unit_side $unit.side}
		
		[switch]
			variable=item_key
			[case]
				value=magic_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							arcane=-$item_step
							cold=-$item_step
							fire=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE negates_magic_value 5}
					[/case]
					[case]
						value=4
						{VARIABLE negates_magic_value 15}
					[/case]
					[case]
						value=5
						{VARIABLE negates_magic_value 25}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=negates_magic_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								negates_magic_value=$negates_magic_value
							[/variables]
						[/modify_unit]
					
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_negates_magic
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_negates_magic
										name="negates magic $negates_magic_value"
										description="All allied units receive $negates_magic_value|% bonus to magic resistances."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_magic_negation_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=cold_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							cold=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes

							[effect]
								apply_to=new_attack
								name=qquws_w_time_dilation
								description="time dilation"
								type=cold
								range=ranged
								icon="attacks/staff-magic.png"
								damage=6
								number=2
								[specials]
									{WEAPON_SPECIAL_SLOW}
									{WEAPON_SPECIAL_MAGICAL}
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_time_dilation
								increase_damage=1
								increase_attacks=1
								[set_specials]
									mode=append
									[dummy]
										id=qquws_time_lock
										name="time lock"
										description="When this weapon is used on offense, upon successful hit, both the attacker and defender go into the time lock. For a duration of one turn the defender gets all defenses set to 25% and strikes on all weapons to 1. In addition to that, all adjacent enemies to the attacked unit receive 4 cold damage and get slowed. The attacker gets all defenses set to 25% and all weapons removed. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_time_dilation
								increase_damage=4
								remove_specials=qquws_time_lock
								[set_specials]
									mode=append
									[dummy]
										id=qquws_infinity_lock
										name="infinity lock"
										description="When this weapon is used on offense, upon successful hit, both the attacker and defender go into the infinity lock. For a duration of one turn the defender can't move, gets all defenses set to 15% and all weapons removed. In addition to that, all enemies within radius 5 from the attacked unit receive 8 cold damage and get slowed. The attacker gets all weapons removed. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_cold_mastery_aura
										name="cold mastery"
										description="Improves cold resistance of all allied units by 15% and increases their cold damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=phys_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
							impact=-$item_step
							pierce=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE res_reduction_value 5}
					[/case]
					[case]
						value=4
						{VARIABLE res_reduction_value 15}
					[/case]
					[case]
						value=5
						{VARIABLE res_reduction_value 25}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=res_reduction_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								armor_science_value=$res_reduction_value
							[/variables]
						[/modify_unit]
					
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_armor_science
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_armor_science
										name="armor science $res_reduction_value"
										description="Reduces physical resistances of all enemies within the vision range from the scientist by $res_reduction_value|%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=impact_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							impact=-$item_step
					    [/resistance]
					[/effect]
				[/object]

				{VARIABLE element_damage_increase 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						{VARIABLE element_damage_increase 10}
					[/case]
					[case]
						value=4
						
						{VARIABLE element_damage_increase 20}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								leather_cover_reduction=2
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_leather_cover
											name="leather cover 2"
											description="All allies on the map receive 2 point damage reduction to all attack types except arcane and secret."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_leather_cover_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5

						{VARIABLE element_damage_increase 30}
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								leather_cover_reduction=4
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_leather_cover
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_leather_cover
											name="leather cover 4"
											description="All allies on the map receive 4 points damage reduction to all attack types except arcane and secret."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_leather_cover_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_leather_cover_to_all_allies
						[/fire_event]
					[/case]
				[/switch]

				[if]
					[variable]
						name=element_damage_increase
						greater_than=0
					[/variable]
					[then]
						[remove_trait]
							id=$unit.id
							trait_id=qquws_impact_mastery_keeper_trait
						[/remove_trait]

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								impact_damage_increase=$element_damage_increase
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_impact_mastery
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_global_impact_mastery
											name="impact mastery $element_damage_increase"
											description="All allied units including the item keeper receive $element_damage_increase|% impact damage increase."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]

							[trait]
								id=qquws_impact_mastery_keeper_trait
								name="master of impact $element_damage_increase"
								description="This unit and all allies have their impact damage immproved by $element_damage_increase|%."

								[effect]
									apply_to=attack
									type=impact
									increase_damage="$element_damage_increase|%"
								[/effect]
							[/trait]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_impact_mastery_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_impact_mastery_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=impact_weapon

				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_impact_m
								description="thunderhammer"
								type=impact
								range=melee
								icon="attacks/hammer-dwarven-runic.png"
								damage=8
								number=1
								[specials]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.75) )"
									[/damage]
								[/specials]
							[/effect]

							[effect]
								apply_to=new_attack
								name=qquws_w_impact_r
								description="thunderstrike"
								type=impact
								range=ranged
								icon="attacks/lightning.png"
								damage=6
								number=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_impact_m
								increase_damage=3
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 1.25) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_impact_r
								increase_damage=2
								[set_specials]
									mode=append
									{WEAPON_SPECIAL_MAGICAL}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_impact_m
								increase_damage=2
								increase_attacks=1
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 1.5) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_impact_r
								increase_damage=3
								remove_specials=magical
								[set_specials]
									mode=append
									[chance_to_hit]
										id=qquws_stronger_magical
										name="magical 75"
										description="This attack has always 75% chance to hit."
										value=75
										cumulative=no
									[/chance_to_hit]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.75) )"
									[/damage]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes
								 
								[effect]
									apply_to=attack
									name=qquws_w_impact_m
									increase_damage=3
									remove_specials=qquws_per_level_damage,qquws_stun
									[set_specials]
										mode=append
										[dummy]
											id=qquws_stun
											name="stun"
											description="This attack puts enormous pressure on the enemy, disrupting his ZOC if a hit is landed. Not active on defense."
											active_on=offense
										[/dummy]
										[damage]
											id=qquws_per_level_damage
											add="( self.level * 2 )"
										[/damage]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_impact_r
									increase_damage=3
									remove_specials=qquws_stun,qquws_stronger_magical,qquws_per_level_damage
									[set_specials]
										mode=append
										[dummy]
											id=qquws_stun
											name="stun"
											description="This attack puts enormous pressure on the enemy, disrupting his ZOC if a hit is landed. Not active on defense."
											active_on=offense
										[/dummy]
										[chance_to_hit]
											id=qquws_stronger_magical
											name="magical 80"
											description="This attack has always 80% chance to hit."
											value=80
											cumulative=no
										[/chance_to_hit]
										[damage]
											id=qquws_per_level_damage
											add="( floor(self.level * 1.25) )"
										[/damage]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes
								 
								[effect]
									apply_to=attack
									name=qquws_w_impact_m
									increase_damage=4
									remove_specials=qquws_per_level_damage,qquws_stun
									[set_specials]
										mode=append
										[dummy]
											id=qquws_crushing_blow
											name="crushing blow"
											description="When this weapon is used on offense and a hit lands, the enemy gets one strike removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit."
											active_on=offense
										[/dummy]
										[damage]
											id=qquws_per_level_damage
											add="( self.level * 3 )"
										[/damage]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_impact_r
									increase_damage=3
									remove_specials=qquws_stronger_magical,qquws_per_level_damage
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_stronger_magical
											name="magical 85"
											description="This attack has always 85% chance to hit."
											value=85
											cumulative=no
										[/chance_to_hit]
										[damage]
											id=qquws_per_level_damage
											add="( floor(self.level * 1.75) )"
										[/damage]
										[attacks]
											id=AE_mag_nocounter
											name="no counter-attack"
											description="The opponent has a 0% chance of retaliation when this unit is attacking. Opponents with berserker frenzy are immune."
											value=0
											cumulative=no
											active_on=offense
											apply_to=opponent

											[filter_opponent]
												[filter_weapon]
													[not]
														special_id=berserk
													[/not]
												[/filter_weapon]
											[/filter_opponent]
										[/attacks]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes

								 [effect]
									apply_to=attack
									name=qquws_w_impact_m
									increase_damage=6
									increase_attacks=1
									remove_specials=qquws_per_level_damage,qquws_crushing_blow
									[set_specials]
										mode=append
										[dummy]
											id=qquws_shatter_the_bones
											name="shatter the bones"
											description="When this weapon is used on offense and a hit lands, the enemy gets 50% of strikes removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit."
											active_on=offense
										[/dummy]
										[damage]
											id=qquws_per_level_damage
											add="( self.level * 4 )"
										[/damage]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_impact_r
									increase_damage=3
									increase_attacks=1
									remove_specials=qquws_stronger_magical,qquws_per_level_damage,qquws_stun
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_stronger_magical
											name="magical 90"
											description="This attack has always 90% chance to hit."
											value=90
											cumulative=no
										[/chance_to_hit]
										[dummy]
											id=qquws_crushing_blow
											name="crushing blow"
											description="When this weapon is used on offense and a hit lands, the enemy gets one strike removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit."
											active_on=offense
										[/dummy]
										[damage]
											id=qquws_per_level_damage
											add="( floor(self.level * 2.5) )"
										[/damage]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=fire_res

				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							fire=-$item_step
					    [/resistance]
					[/effect]
				[/object]

				{VARIABLE element_damage_increase 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						{VARIABLE element_damage_increase 10}
					[/case]
					[case]
						value=4
						
						{VARIABLE element_damage_increase 20}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								familiar_type=minion
								familiar_share_xp=no
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_fiery_familiar
											name="familiar master"
											description="Whenever this unit levels up (or amlas) it summons a familiar minion. Only one familiar can exist at given time, meaning that when it dies, this unit has to level up or amla again to get a new familiar."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						{VARIABLE element_damage_increase 30}
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								familiar_type=champion
								familiar_share_xp=yes
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_fiery_familiar
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_fiery_familiar
											name="fiery familiar master"
											description="Whenever this unit levels up (or amlas) it summons a very powerful familiar. Only one familiar can exist at given time, meaning that when it dies, this unit has to level up or amla again to get a new familiar. When a familiar kills an enemy then the familiar's master receives half of the kill's xp."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]

				[if]
					[variable]
						name=element_damage_increase
						greater_than=0
					[/variable]
					[then]
						[remove_trait]
							id=$unit.id
							trait_id=qquws_fire_mastery_keeper_trait
						[/remove_trait]

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								fire_damage_increase=$element_damage_increase
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_fire_mastery
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_global_fire_mastery
											name="fire mastery $element_damage_increase"
											description="All allied units including the item keeper receive $element_damage_increase|% fire damage increase."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]

							[trait]
								id=qquws_fire_mastery_keeper_trait
								name="master of fire $element_damage_increase"
								description="This unit and all allies have their fire damage immproved by $element_damage_increase|%."

								[effect]
									apply_to=attack
									type=fire
									increase_damage="$element_damage_increase|%"
								[/effect]
							[/trait]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_fire_mastery_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_fire_mastery_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=fire_weapon

				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_fire_m
								description="flame of anganor"
								type=fire
								range=melee
								icon="attacks/sword-flaming.png"
								damage=4
								number=3
								[specials]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.5) )"
									[/damage]
								[/specials]
							[/effect]

							[effect]
								apply_to=new_attack
								name=qquws_w_fire_r
								description="sparks of anganor"
								type=fire
								range=ranged
								icon="attacks/fireball.png"
								damage=1
								number=3
								[specials]
									{WEAPON_SPECIAL_SWARM}
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_fire_m
								increase_damage=2
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.75) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_fire_r
								increase_damage=1
								increase_attacks=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_fire_m
								increase_damage=2
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[chance_to_hit]
										id=qquws_fiery_attack
										name="fiery attack 60"
										description="This attack has always at least 60% chance to hit."
										value=60
										cumulative=yes
									[/chance_to_hit]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_fire_r
								increase_attacks=1
								[set_specials]
									mode=append
									{WEAPON_SPECIAL_MAGICAL}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								fire_cleave_factor=25
								blinding_sparks_factor=3
							[/variables]

							[object]
								 silent=yes
								 
								[effect]
									apply_to=attack
									name=qquws_w_fire_m
									increase_damage=1
									increase_attacks=1
									remove_specials=qquws_per_level_damage,qquws_fiery_attack
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_fiery_attack
											name="fiery attack 65"
											description="This attack has always at least 65% chance to hit."
											value=65
											cumulative=yes
										[/chance_to_hit]
										[damage]
											id=qquws_per_level_damage
											add="( floor(self.level * 1.25) )"
										[/damage]
										[dummy]
											id=qquws_fire_cleave
											name="fire cleave 25%"
											description="When this weapon is used on offense, then the enemies adjacent to both the attacker and defender receive 25% of the dealt fire damage. The chance to hit additional enemies depends on their defense value and is irrespective of whether the primary target is hit."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_fire_r
									increase_damage=1
									[set_specials]
										mode=append
										[dummy]
											id=qquws_blinding_sparks
											name="blinding sparks 3"
											description="Each successful hit of this weapon decreases the ability of the enemy unit to hit by 3%. The effect lasts one turn."
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								fire_cleave_factor=40
								blinding_sparks_factor=4
							[/variables]

							[object]
								 silent=yes
								 
								[effect]
									apply_to=attack
									name=qquws_w_fire_m
									increase_damage=3
									remove_specials=qquws_per_level_damage,qquws_fiery_attack,qquws_fire_cleave
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_fiery_attack
											name="fiery attack 70"
											description="This attack has always at least 70% chance to hit."
											value=70
											cumulative=yes
										[/chance_to_hit]
										[damage]
											id=qquws_per_level_damage
											add="( floor(self.level * 1.75) )"
										[/damage]
										[dummy]
											id=qquws_fire_cleave
											name="fire cleave 40%"
											description="When this weapon is used on offense, then the enemies adjacent to both the attacker and defender receive 40% of the dealt fire damage. The chance to hit additional enemies depends on their defense value and is irrespective of whether the primary target is hit."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_fire_r
									increase_attacks=1
									remove_specials=qquws_blinding_sparks
									[set_specials]
										mode=append
										[dummy]
											id=qquws_blinding_sparks
											name="blinding sparks 4"
											description="Each successful hit of this weapon decreases the ability of the enemy unit to hit by 4%. The effect lasts one turn."
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								fire_cleave_factor=65
								blinding_sparks_factor=5
							[/variables]

							[object]
								 silent=yes

								 [effect]
									apply_to=attack
									name=qquws_w_fire_m
									increase_damage=1
									increase_attacks=1
									remove_specials=qquws_per_level_damage,qquws_fiery_attack,qquws_fire_cleave
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_fiery_attack
											name="fiery attack 75"
											description="This attack has always at least 75% chance to hit."
											value=75
											cumulative=yes
										[/chance_to_hit]
										[damage]
											id=qquws_per_level_damage
											add="( floor(self.level * 2) )"
										[/damage]
										[dummy]
											id=qquws_fire_cleave
											name="fire cleave 65%"
											description="When this weapon is used on offense, then the enemies adjacent to both the attacker and defender receive 65% of the dealt fire damage. The chance to hit additional enemies depends on their defense value and is irrespective of whether the primary target is hit."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_fire_r
									increase_damage=1
									increase_attacks=1
									remove_specials=qquws_blinding_sparks
									[set_specials]
										mode=append
										[dummy]
											id=qquws_blinding_sparks
											name="blinding sparks 5"
											description="Each successful hit of this weapon decreases the ability of the enemy unit to hit by 5%. The effect lasts one turn."
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=arcane_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							arcane=-$item_step
					    [/resistance]
					[/effect]
				[/object]

				{VARIABLE element_damage_increase 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						{VARIABLE element_damage_increase 10}
					[/case]
					[case]
						value=4
						
						{VARIABLE element_damage_increase 20}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								dragons_pride_reheal_option=item_a
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_dragon_pride
											name="pride of the drakes"
											description="Whenever this unit is defending then each time it receives damage, there is a 6-54% chance (the less hp the higher the chance) to instantly heal random 20-150% of received damage."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						{VARIABLE element_damage_increase 30}
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								dragons_pride_reheal_option=item_b
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_dragon_pride
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_dragon_pride
											name="pride of the dragons"
											description="Whenever this unit is defending then each time it receives damage, there is a 8-72% chance (the less hp the higher the chance) to instantly heal random 35-200% of received damage. Additionally, this unit gets one chance of turning into stone for one turn upon receiving a fatal blow, therefore avoiding death."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]

							[trait]
								id=qquws_dragon_pride_stone_active
								name="<span color='#54a862'>untouchable</span>"
								description="This unit is untouchable, upon receiving a fatal blow it will turn to stone for one turn instead of dying. This can take effect only once per game."
							[/trait]
						[/modify_unit]
					[/case]
				[/switch]

				[if]
					[variable]
						name=element_damage_increase
						greater_than=0
					[/variable]
					[then]
						[remove_trait]
							id=$unit.id
							trait_id=qquws_arcane_mastery_keeper_trait
						[/remove_trait]

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								arcane_damage_increase=$element_damage_increase
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_arcane_mastery
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_global_arcane_mastery
											name="arcane mastery $element_damage_increase"
											description="All allied units including the item keeper receive $element_damage_increase|% arcane damage increase."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]

							[trait]
								id=qquws_arcane_mastery_keeper_trait
								name="master of arcane $element_damage_increase"
								description="This unit and all allies have their arcane damage immproved by $element_damage_increase|%."

								[effect]
									apply_to=attack
									type=arcane
									increase_damage="$element_damage_increase|%"
								[/effect]
							[/trait]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_arcane_mastery_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_arcane_mastery_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=arcane_weapon

				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_arcane_m
								description="holy blade"
								type=arcane
								range=melee
								icon="attacks/sword-holy.png"
								damage=3
								number=3
								[specials]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.5) )"
									[/damage]
								[/specials]
							[/effect]

							[effect]
								apply_to=new_attack
								name=qquws_w_arcane_r
								description="divine grapple"
								type=arcane
								range=ranged
								icon="attacks/lightbeam.png"
								damage=4
								number=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_arcane_m
								increase_damage=2
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.75) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_arcane_r
								increase_damage=5
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_arcane_m
								increase_damage=4
								increase_attacks=1
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[chance_to_hit]
										id=qquws_enchanted
										name="enchanted"
										description="This attack has always 60% chance to hit."
										value=60
										cumulative=no
									[/chance_to_hit]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_arcane_r
								increase_damage=6
								[set_specials]
									mode=append
									[chance_to_hit]
										id=qquws_magical_offense
										name="magical (attack only)"
										description="This attack has 70% chance to hit when used offensively."
										value=70
										cumulative=no
										active_on=offense
									[/chance_to_hit]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes
								 
								[effect]
									apply_to=attack
									name=qquws_w_arcane_m
									increase_damage=2
									remove_specials=qquws_enchanted
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_magical
											name="magical"
											description="This attack has always 70% chance to hit."
											value=70
											cumulative=no
										[/chance_to_hit]
										[damage_type]
											id=qquws_discerning_blade
											name="discerning blade"
											description="This weapon can deal secret type of damage if the enemy's resistance to arcane damage is too high."
											alternative_type=secret
										[/damage_type]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_arcane_r
									increase_damage=7
									remove_specials=qquws_magical_offense
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_magical_offense
											name="precission (attack only)"
											description="This attack has 80% chance to hit when used offensively."
											value=80
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[drains]
											id=qquws_drains
											name="drains 40%"
											description="This unit drains health from living units, healing itself for 40% the amount of damage it deals (rounded down). Active only on offense."
											value=40
											active_on=offense
										[/drains]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes
								 
								[effect]
									apply_to=attack
									name=qquws_w_arcane_m
									increase_damage=3
									increase_attacks=1
									remove_specials=qquws_magical
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_precision
											name="precision"
											description="This attack has always 80% chance to hit."
											value=80
											cumulative=no
										[/chance_to_hit]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_arcane_r
									increase_damage=8
									remove_specials=qquws_magical_offense,qquws_drains
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_magical_offense
											name="unavoidable (attack only)"
											description="This attack has 90% chance to hit when used offensively."
											value=90
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[drains]
											id=qquws_drains
											name="drains 70%"
											description="This unit drains health from living units, healing itself for 70% the amount of damage it deals (rounded down). Active only on offense."
											value=70
											active_on=offense
										[/drains]
										[dummy]
											id=qquws_reversed_polarity
											name="reversed polarity"
											description="When this weapon is used on offense, once a successful hit lands, the attacker and the defender swap their locations. This stops the attack. The position swapping occurs only if the defending unit survives the attack."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								test_of_faith_increase=3
							[/variables]

							[object]
								 silent=yes

								 [effect]
									apply_to=attack
									name=qquws_w_arcane_m
									increase_damage=2
									remove_specials=qquws_precision
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_unavoidable
											name="unavoidable"
											description="This attack has always 90% chance to hit."
											value=90
											cumulative=no
										[/chance_to_hit]
										[dummy]
											id=qquws_test_of_faith
											name="test of faith"
											description="When used offensively, each successful hit deals 3 points more damage."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]

								[effect]
									apply_to=attack
									name=qquws_w_arcane_r
									increase_damage=10
									remove_specials=qquws_magical_offense,qquws_drains
									[set_specials]
										mode=append
										[chance_to_hit]
											id=qquws_magical_offense
											name="always hits (attack only)"
											description="This attack has 100% chance to hit when used offensively."
											value=100
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[drains]
											id=qquws_drains
											name="drains 100%"
											description="This unit drains health from living units, healing itself for 100% the amount of damage it deals (rounded down). Active only on offense."
											value=100
											active_on=offense
										[/drains]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=blade_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
					    [/resistance]
					[/effect]
				[/object]

				{VARIABLE element_damage_increase 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						{VARIABLE element_damage_increase 10}
					[/case]
					[case]
						value=4
						
						{VARIABLE element_damage_increase 20}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								battle_cry_base_dmg=4
								battle_cry_factor=0.5
							[/variables]

							[object]
								silent=yes
								
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_final_cry
											name="battle cry 4"
											description="All allies on the map belonging to this unit's side deal final damage to all surrounding enemies upon dying. The damage dealt is equal to the 50% of the unit's kill count or 4 (whichever is higher). Like poison, this damage cannot kill. If the dying unit is to be revived (dragon's protection or awake ability) then it is revived AFTER the battle cry, causing the damage to surrounding enemies as if the unit was to die regardless."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						{VARIABLE element_damage_increase 30}
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								battle_cry_base_dmg=12
								battle_cry_factor=1
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_final_cry
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_final_cry
											name="battle cry 12"
											description="All allies on the map belonging to this unit's side deal final damage to all surrounding enemies upon dying. The damage dealt is equal to the unit's kill count or 12 (whichever is higher). Like poison, this damage cannot kill. If the dying unit is to be revived (dragon's protection or awake ability) then it is revived AFTER the battle cry, causing the damage to surrounding enemies as if the unit was to die regardless."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]

				[if]
					[variable]
						name=element_damage_increase
						greater_than=0
					[/variable]
					[then]
						[remove_trait]
							id=$unit.id
							trait_id=qquws_blade_mastery_keeper_trait
						[/remove_trait]

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								blade_damage_increase=$element_damage_increase
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_blade_mastery
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_global_blade_mastery
											name="blade mastery $element_damage_increase"
											description="All allied units including the item keeper receive $element_damage_increase|% blade damage increase."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]

							[trait]
								id=qquws_blade_mastery_keeper_trait
								name="master of blade $element_damage_increase"
								description="This unit and all allies have their blade damage immproved by $element_damage_increase|%."

								[effect]
									apply_to=attack
									type=blade
									increase_damage="$element_damage_increase|%"
								[/effect]
							[/trait]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_blade_mastery_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_blade_mastery_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=blade_weapon

				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_blade_m
								description="axe fury"
								type=blade
								range=melee
								icon="attacks/axe-undead.png"
								damage=4
								number=4
								[specials]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.4) )"
									[/damage]
								[/specials]
							[/effect]

							[effect]
								apply_to=new_attack
								name=qquws_w_blade_r
								description="thrown axe"
								type=blade
								range=ranged
								icon="attacks/battleaxe.png"
								damage=5
								number=2
								[specials]
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.7) )"
									[/damage]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_blade_m
								increase_damage=2
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.6) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_blade_r
								increase_damage=1
								increase_accuracy=4
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level) )"
									[/damage]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_blade_m
								increase_attacks=1
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 0.8) )"
									[/damage]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_blade_r
								increase_damage=3
								increase_attacks=1
								increase_accuracy=4
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 1.3) )"
									[/damage]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_blade_m
								increase_attacks=1
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level) )"
									[/damage]
									[berserk]
										id=berserk_duel2
										name="duel 2"
										description="When attacking this unit presses the engagement and can fight for an extra round."
										value=2
										active_on=offense
									[/berserk]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_blade_r
								increase_damage=3
								increase_accuracy=4
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 1.6) )"
									[/damage]
									[attacks]
										id=qquws_overpower
										name="overpower 1"
										description="When used in offense, this attack reduces the opponent's number of strikes by 1."
										sub=1
										active_on=offense
										apply_to=opponent
								 	[/attacks]
								[/set_specials]
							[/effect]
						[/object]
					[/case]

					[case]
						value=4

						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_blade_m
								increase_damage=2
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 1.2) )"
									[/damage]
									[dummy]
										id=qquws_battle_trance
										name="battle trance"
										description="When this weapon is used on offense each landing hit increases the damage by 1."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_blade_r
								increase_damage=2
								increase_accuracy=4
								remove_specials=qquws_per_level_damage,qquws_overpower
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 1.9) )"
									[/damage]
									[attacks]
										id=qquws_overpower
										name="overpower 2"
										description="When used in offense, this attack reduces the opponent's number of strikes by 2."
										sub=2
										active_on=offense
										apply_to=opponent
								 	[/attacks]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5

						[object]
							 silent=yes
							 
							 [effect]
								apply_to=attack
								name=qquws_w_blade_m
								increase_attacks=1
								increase_damage=1
								remove_specials=qquws_per_level_damage,qquws_battle_trance,berserk_duel2
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 1.4) )"
									[/damage]
									[berserk]
										id=berserk_duel3
										name="duel 3"
										description="When attacking this unit presses the engagement and can fight for extra two round."
										value=3
										active_on=offense
									[/berserk]
									[dummy]
										id=qquws_overwhelm
										name="overwhelm"
										description="When this weapon is used on offense each landing hit increases the damage by 1, while simultaneously decreases opponent's damage by 2(1) if current damage is above 67%(33%). After the attack, opponent's defense and attack accuracy are reduced by 10% for one turn."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]

							[effect]
								apply_to=attack
								name=qquws_w_blade_r
								increase_damage=1
								increase_attacks=1
								increase_accuracy=4
								remove_specials=qquws_per_level_damage
								[set_specials]
									mode=append
									[damage]
										id=qquws_per_level_damage
										add="( floor(self.level * 2.2) )"
									[/damage]
									[berserk]
										id=berserk_duel2
										name="duel 2"
										description="When attacking this unit presses the engagement and can fight for an extra round."
										value=2
										active_on=offense
									[/berserk]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=pierce_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							pierce=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_atrocious_impalement
								description="atrocious impalement"
								type=pierce
								range=melee
								icon="attacks/trident2-pierce.png"
								damage=13
								number=2
								[specials]
									[damage]
										id=charge
										name="charge"
										description="When used offensively, this attack deals double damage to the target. It also causes this unit to take double damage from the target’s counterattack."
										multiply=2
										apply_to=both
										active_on=offense
									[/damage]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								impale_armor_reduce=25
							[/variables]
							
							[object]
								 silent=yes
								 
								 [effect]
									apply_to=attack
									name=qquws_w_atrocious_impalement
									increase_damage=3
									[set_specials]
										mode=append
										[dummy]
											id=qquws_impale
											name="impale"
											description="When this weapon is used on offense and a hit lands, it permanently decreases enemy's pierce resistance by 25 once per engagement. Furthermore the opponent's damage and movement points are reduced by 33% for one turn. Champions and The Butcher of Wesnoth are immune. Reduced resistance cannot go below -15%."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_atrocious_impalement
								increase_damage=2
								[set_specials]
									mode=append
									[attacks]
										id=AE_mag_nocounter
										name="no counter-attack"
										description="The opponent has a 0% chance of retaliation when this unit is attacking. Champions and The Butcher of Wesnoth are immune and so are opponents with berserker frenzy."
										value=0
										cumulative=no
										active_on=offense
										apply_to=opponent

										[filter_opponent]
											[filter_weapon]
												[not]
													special_id=berserk
												[/not]
											[/filter_weapon]
			
											[not]
												trait=immune_to_specials
											[/not]
										[/filter_opponent]
									[/attacks]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_pierce_mastery_aura
										name="pierce mastery"
										description="Improves pierce resistance of all allied units by 15% and increases their pierce damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_low

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_low_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_low_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]

				[switch]
					variable=use_promotion_level

					[case]
						value=2

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[heals]
											id=curing
										[/heals]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[heals]
									        affect_allies=yes
									        id=curing
									        name="cures"
									        description="A curer can cure a unit of poison, although that unit will receive no additional healing on the turn it is cured of the poison."
									        affect_self=no
									        poison=cured
									        [affect_adjacent]
									        [/affect_adjacent]
									    [/heals]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]

					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								poison_aura_radius=1
								poison_aura_dmg=1
								damage_on_death_tn_factor=0.33
							[/variables]

							[trait]
								id=qquws_unpoisonable_trait
								name="immune to poison"
								description="This unit cannot be poisoned."

								[effect]
									apply_to=status
									add=unpoisonable
								[/effect]
							[/trait]

							[object]
					 			silent=yes
					 			
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_poison_aura
											name="poisonous fumes 1"
											description="At the beginning of this unit's turn, all adjacent enemies get poisoned and receive 1dmg. Non-living units are immune."
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
											name="unstable concoction 33%"
											description="Upon death this unit drops a flask of a very unstable mixture causing a massive explosion causing impact damage to all surrounding units, friends and foes alike. Damage dealt is equal to 33% value of the current turn number, but even though the explosion is immense, it does not kill."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								poison_aura_radius=3
								poison_aura_dmg=2
								damage_on_death_tn_factor=0.67
								alcohol_fumes_reduction=5
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[heals]
											id=curing
										[/heals]
										[dummy]
											id=qquws_poison_aura
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_unpoisonable_aura
											name="poison knowledge"
											description="All allied units receive poison immunity."
										[/dummy]
										[dummy]
											id=qquws_poison_aura
											name="poisonous fumes 3"
											description="At the beginning of this unit's turn, all enemies within radius 3 get poisoned and receive 2dmg. Non-living units are immune."
										[/dummy]
										[dummy]
											id=qquws_alcohol_fumes
											name="alcohol fumes 5"
											description="When defending, before the first strike the attacker is engulfed with a cloud of alcohol fumes causing -5% defense and -5% accuracy on all weapons for a duration of one turn."
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
											name="unstable concoction 67"
											description="Upon death this unit drops a flask of a very unstable mixture causing a massive explosion causing impact damage to all surrounding units, friends and foes alike. Damage dealt is equal to 67% value of the current turn number, but even though the explosion is immense, it does not kill."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_unpoisonable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								poison_aura_radius=5
								poison_aura_dmg=4
								damage_on_death_tn_factor=1
								alcohol_fumes_reduction=10
							[/variables]

							[object]
					 			silent=yes
					 			
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_poison_aura
										[/dummy]
										[dummy]
											id=qquws_alcohol_fumes
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_poison_aura
											name="poisonous fumes 5"
											description="At the beginning of this unit's turn, all enemies within radius 5 get poisoned and receive 4dmg. Non-living units are immune."
										[/dummy]
										[dummy]
											id=qquws_alcohol_fumes
											name="alcohol fumes 10"
											description="When defending, before the first strike the attacker is engulfed with a cloud of alcohol fumes causing -10% defense and -10% accuracy on all weapons for a duration of one turn."
										[/dummy]
										[dummy]
											id=qquws_damage_on_death
											name="unstable concoction 100"
											description="Upon death this unit drops a flask of a very unstable mixture causing a massive explosion causing impact damage to all surrounding units, friends and foes alike. Damage dealt is equal to 100% value of the current turn number, but even though the explosion is immense, it does not kill."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_med
				
				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_med_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_med_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]

				[switch]
					variable=use_promotion_level

					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								melee_endurance_reduction=20
								drain_base=4
								aoe_drains_heal_factor=1
							[/variables]

							[trait]
								id=qquws_undrainable_trait
								name="immune to drain"
								description="This unit's health cannot be drained."

								[effect]
									apply_to=status
									add=undrainable
								[/effect]
							[/trait]

							[object]
					 			silent=yes
					 			
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_melee_endurance
											name="melee endurance 20"
											description="Each time this unit is hit in melee combat, it immediately regenerates 20% of the received damage unless the attack type is secret or the hits otherwise kills the unit."
										[/dummy]
										[dummny]
											id=qquws_aoe_draining
											name="aoe drains 4"
											description="At the beginning of it's turn this unit drains life from all surrounding enemies by dealing 4 dmg to all surrounding enemies and then regenerating an amount of hitpoints equal to the total damage dealt. Damage is affected by ToD bonus. All units are vulnerable."
										[/dummny]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								melee_endurance_reduction=30
								drain_base=6
								aoe_drains_heal_factor=1
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_melee_endurance
										[/dummy]
										[dummy]
											id=qquws_aoe_draining
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_undrainable_aura
											name="drains immunity aura"
											description="All allied units receive drains immunity."
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_melee_endurance
											name="melee endurance 30"
											description="Each time this unit is hit in melee combat, it immediately regenerates 30% of the received damage unless the attack type is secret or the hits otherwise kills the unit."
										[/dummy]
										[dummny]
											id=qquws_aoe_draining
											name="aoe drains 6"
											description="At the beginning of it's turn this unit drains life from all surrounding enemies by dealing 6 dmg to all surrounding enemies and then regenerating an amount of hitpoints equal to the total damage dealt. Damage is affected by ToD bonus. All units are vulnerable."
										[/dummny]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_undrainable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								melee_endurance_reduction=40
								drain_base=8
								aoe_drains_heal_factor=1
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_melee_endurance
										[/dummy]
										[dummy]
											id=qquws_aoe_draining
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_melee_endurance
											name="melee endurance 40"
											description="Each time this unit is hit in melee combat, it immediately regenerates 40% of the received damage unless the attack type is secret or the hits otherwise kills the unit."
										[/dummy]
										[dummny]
											id=qquws_aoe_draining
											name="aoe drains 8"
											description="At the beginning of it's turn this unit drains life from all surrounding enemies by dealing 8 dmg to all surrounding enemies and then regenerating an amount of hitpoints equal to the total damage dealt. Damage is affected by ToD bonus. All units are vulnerable."
										[/dummny]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_high
				
				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_high_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_high_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								bloodline_increase=10
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_bloodline
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_bloodline
											name="bloodline 10"
											description="Increases the hitpoints of all allied units on the map by 10%."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_bloodline_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_bloodline_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								bloodline_increase=20
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_bloodline
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_bloodline
											name="bloodline 20"
											description="Increases the hitpoints of all allied units on the map by 20%."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_bloodline_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_bloodline_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								bloodline_increase=30
								treats_wounded_hospital_cost=20
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_bloodline
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_bloodline
											name="bloodline 30"
											description="Increases the hitpoints of all allied units on the map by 30%."
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
											name="treats wounded"
											description="Any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow. Units sent to the recall list do NOT drop items."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_bloodline_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_bloodline_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
			[/case]
			[case]
				value=steadfast
				
				{VARIABLE shield_master_chance 0}
				{VARIABLE shield_master_increase 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE steadfast_factor 1.5}
					[/case]
					[case]
						value=1
						{VARIABLE steadfast_factor 1.75}
					[/case]
					[case]
						value=2
						{VARIABLE steadfast_factor 2}
					[/case]
					[case]
						value=3
						{VARIABLE steadfast_factor 2}
						{VARIABLE shield_master_chance 16}
						{VARIABLE shield_master_increase 20}
					[/case]
					[case]
						value=4
						{VARIABLE steadfast_factor 2.25}
						{VARIABLE shield_master_chance 19}
						{VARIABLE shield_master_increase 40}
					[/case]
					[case]
						value=5
						{VARIABLE steadfast_factor 2.5}
						{VARIABLE shield_master_chance 22}
						{VARIABLE shield_master_increase 70}
					[/case]
				[/switch]
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
						[resistance]
							id=steadfast
						[/resistance]
					    [/abilities]
					[/effect]
					 [effect]
					    apply_to=new_ability
					    [abilities]
						[resistance]
							id=steadfast
							multiply=$steadfast_factor
							max_value=$item_step
							[filter_base_value]
							    greater_than=0
							    less_than=$item_step
							[/filter_base_value]
							name="steadfast"
							description="This unit’s resistances are multiplied by a factor of $steadfast_factor|, up to a maximum of $item_step|%, when defending. Vulnerabilities are not affected."
							affect_self=yes
							active_on=defense
						[/resistance]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=shield_master_chance
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								qquws_shield_master_chance=$shield_master_chance
							[/variables]

							[status]
								qquws_shield_master_active=no
							[/status]

							[object]
								 silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
									[resistance]
										id=qquws_shield_master
									[/resistance]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[resistance]
											id=qquws_shield_master
											add=$shield_master_increase
											max_value=100
											name="shield master $shield_master_increase($shield_master_chance|%)"
											description="This unit has a $shield_master_chance|% chance to raise it's own and adjacent allies' resistances by $shield_master_increase|% each time they defend."
											affect_enemies=no
											affect_allies=yes
											affect_self=yes
											[affect_adjacent]
											[/affect_adjacent]
											active_on=defense
											[filter]
								            	status=qquws_shield_master_active
								            [/filter]
								            overlay_image="halo/uws/shield_master.png"
								            halo_image="halo/misc/leadership-flare-[1~13].png:25"
										[/resistance]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=regen
				
				{VARIABLE village_regen 0}
				{VARIABLE extra_description ""}
				{VARIABLE extra_info ""}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE village_regen 16}
						{VARIABLE extra_info "/16/2"}
						{VARIABLE extra_description " (16hp when stationing in a village)"}
						{VARIABLE fight_regen 2}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 2 hit points."}
					[/case]
					[case]
						value=4
						{VARIABLE village_regen 24}
						{VARIABLE extra_info "/24/4"}
						{VARIABLE extra_description " (24hp when stationing in a village)"}
						{VARIABLE fight_regen 4}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 4 hit points."}
					[/case]
					[case]
						value=5
						{VARIABLE village_regen 32}
						{VARIABLE extra_info "/32/8"}
						{VARIABLE extra_description " (32 when stationing in a village)"}
						{VARIABLE fight_regen 8}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 8 hit points."}
					[/case]
				[/switch]
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[regenerate]
								id=regenerates
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates6
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates8
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates10
							[/regenerate]
							[regenerate]
								id=eoma_regenerates6
							[/regenerate]
							[regenerate]
								id=eoma_regenerates8
							[/regenerate]
							[regenerate]
								id=eoma_regenerates10
							[/regenerate]
							[regenerate]
								id=qquws_regenerates
							[/regenerate]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[regenerate]
								value=$item_step
								id=qquws_regenerates
								name="regenerates $item_step|$extra_info"
								description="The unit will heal itself $item_step HP per turn$extra_description|. If it is poisoned, it will remove the poison instead of healing.$fight_r_description"
								affect_self=yes
								poison=cured
							[/regenerate]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=village_regen
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								qquws_fight_regen_amount=$fight_regen
							[/variables]
							
							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[regenerate]
											id=qquws_village_regen
										[/regenerate]
										[dummy]
											id=qquws_fight_regen
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[regenerate]
											value=$village_regen
											id=qquws_village_regen
											affect_self=yes
											poison=cured
											[filter_self]
												[filter_location]
													terrain=*^V*
												[/filter_location]
											[/filter_self]
										[/regenerate]
										[dummy]
											id=qquws_fight_regen
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
				
				{CLEAR_VARIABLE extra_description,extra_info,village_regen,fight_r_description,fight_regen}
			[/case]
			[case]
				value=melee_dmg

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_melee_dmg_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_melee_dmg_trait

						[effect]
						    apply_to=attack
						    range=melee
						    increase_damage="$item_step|%"
						[/effect]
					[/trait]
				[/modify_unit]
				
				{VARIABLE fury_amount 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE fury_amount 8}
					[/case]
					[case]
						value=4
						{VARIABLE fury_amount 16}
					[/case]
					[case]
						value=5
						{VARIABLE fury_amount 24}
						
						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=fury_amount
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								fury_amount=$fury_amount
							[/variables]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_battle_fury
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_battle_fury
											name="battle fury +$fury_amount|%"
											description="With each successful hit the damage increases by $fury_amount|%. If the unit gets hit, the counter is reset. Active only on offense."
											active_on=offense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=ranged_dmg

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_ranged_dmg_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_ranged_dmg_trait

						[effect]
						    apply_to=attack
						    range=ranged
						    increase_damage="$item_step|%"
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    [set_specials]
								    	mode=append
										[attacks]
											id=qquws_ruthless
											name="ruthless"
											description="Adds 1 strike against enemies with no ranged attacks. Attack only."
											active_on=offense
											add=1
											[filter_opponent]
												[not]
													[has_attack]
														range=ranged
													[/has_attack]
												[/not]
											[/filter_opponent]
										[/attacks]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    
								    increase_attacks=1
								    remove_specials=qquws_ruthless
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    [set_specials]
								    	mode=append
									[attacks]
										id=qquws_merciless
										name="merciless"
										description="Adds 3 strikes against enemies with no ranged attacks. Attack only."
										active_on=offense
										add=3
										[filter_opponent]
											[not]
												[has_attack]
													range=ranged
												[/has_attack]
											[/not]
										[/filter_opponent]
									[/attacks]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=ranged_acc

				{VARIABLE assassination_factor 0}
				{VARIABLE regular_cth_cumulative 0}
				{VARIABLE magical_cth 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						{VARIABLE regular_cth_cumulative 2}
						{VARIABLE magical_cth 1}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    increase_damage=1
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=1
						{VARIABLE regular_cth_cumulative 3}
						{VARIABLE magical_cth 3}
					[/case]
					[case]
						value=2
						{VARIABLE regular_cth_cumulative 3}
						{VARIABLE magical_cth 5}
					[/case]
					[case]
						value=3
						{VARIABLE assassination_factor 0.5}
						{VARIABLE assassination_value 1.5}
						{VARIABLE assassination_readable "50%"}
						{VARIABLE regular_cth_cumulative 4}
						{VARIABLE magical_cth 7}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    increase_damage=1
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						{VARIABLE assassination_factor 1}
						{VARIABLE assassination_value 2}
						{VARIABLE assassination_readable "100%"}
						{VARIABLE regular_cth_cumulative 4}
						{VARIABLE magical_cth 10}
					[/case]
					[case]
						value=5
						{VARIABLE assassination_factor 1.5}
						{VARIABLE assassination_value 2.5}
						{VARIABLE assassination_readable "150%"}
						{VARIABLE regular_cth_cumulative 4}
						{VARIABLE magical_cth 15}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    increase_damage=1
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]

				[object]
					 silent=yes

					[effect]
					    apply_to=attack
					    range=ranged
					    [not]
					    	special_id=qquws_block_specials,magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
					    [/not]

					    increase_accuracy=$regular_cth_cumulative
					[/effect]
					[effect]
					    apply_to=attack
					    range=ranged
					    special_id=qquws_block_specials,magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
					    remove_specials=qquws_magical_cth
					    [set_specials]
					    	mode=append
							[chance_to_hit]
								id=qquws_magical_cth
								name="concentrated magic +$magical_cth"
								description="The magical chance to hit on this attack is improved by $magical_cth|%."
								add=$magical_cth
								cumulative=no
								active_on=offense
							[/chance_to_hit]
					    [/set_specials]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=assassination_factor
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								assassination_factor=$assassination_factor
							[/variables]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    remove_specials=qquws_assassination
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_assassination
											name="assassination x$assassination_value"
											description="This attack can deal up to $assassination_readable more damage if a single hit eliminates the opponent. Attack only."
											active_on=offense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_parry

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[object]
						 silent=yes

						[effect]
						    apply_to=attack
						    range=melee
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    increase_parry=$item_step
						[/effect]
					[/object]
				[/modify_unit]

				{VARIABLE counterbalance_settings ""}
				[switch]
					variable=use_promotion_level

					[case]
						value=3

						{VARIABLE counterbalance_settings "70,90"}
						{VARIABLE counterbalance_info 30}
					[/case]
					[case]
						value=4

						{VARIABLE counterbalance_settings "60,85,95"}
						{VARIABLE counterbalance_info 40}
					[/case]
					[case]
						value=5

						{VARIABLE counterbalance_settings "50,80,90,95"}
						{VARIABLE counterbalance_info 50}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes

								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_peaceful_warrior
											name="peaceful warrior"
											description="When defending this unit will never deal the fatal blow and kill the enemy. Instead it will disarm them by leaving 1hp and removing all weapons for a duration of one turn."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]

				[if]
					[variable]
						name=counterbalance_settings
						not_equals=""
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								counterbalance_list=$counterbalance_settings
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_counterbalance
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_counterbalance
											name="counterbalance $counterbalance_info"
											description="When defending, each time this unit dodges a melee attack it has $counterbalance_info|% chance to retaliate multiple times before enemy can attack again. Retaliations deal 50% of the base damage and all weapon specials are disabled."
											active_on=defense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_poison
				
				{VARIABLE backstab_factor 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	[poison]
								        id=poison
								        name="poison (lower level only)"
								        description="This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit. Affects only enemies of lower level."
								    	[filter_opponent]
								    		formula="if(level < other.level, 1, 0)"
								    	[/filter_opponent]
								    [/poison]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	[poison]
								        id=poison
								        name="poison (same and lower level only)"
								        description="This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit. Affects only enemies of the same or lower level."
								    	[filter_opponent]
								    		formula="if(level <= other.level, 1, 0)"
								    	[/filter_opponent]
								    [/poison]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	{WEAPON_SPECIAL_POISON}
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						{VARIABLE backstab_factor 1.5}
						{VARIABLE acc_increase 2}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								super_poison_extra_dmg=2
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    remove_specials=poison,qquws_super_poison
								    [set_specials]
								    	mode=append
								    	[poison]
									        id=qquws_super_poison
									        name="poison 10"
									        description="This attack poisons living targets. Poisoned units lose 10 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit."
									    [/poison]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						{VARIABLE backstab_factor 2}
						{VARIABLE acc_increase 1}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								super_poison_extra_dmg=4
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    remove_specials=poison,qquws_super_poison
								    [set_specials]
								    	mode=append
								    	[poison]
									        id=qquws_super_poison
									        name="poison 12"
									        description="This attack poisons living targets. Poisoned units lose 12 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit."
									    [/poison]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						{VARIABLE backstab_factor 2.5}
						{VARIABLE acc_increase 2}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								super_poison_extra_dmg=8
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    remove_specials=poison,qquws_super_poison
								    [set_specials]
								    	mode=append
								    	[poison]
									        id=qquws_super_poison
									        name="poison 16"
									        description="This attack poisons living targets. Poisoned units lose 16 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit."
									    [/poison]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=backstab_factor
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=backstab
							    increase_accuracy=$acc_increase
							    [set_specials]
							    	mode=append
							        [damage]
										id=backstab
										name="backstab x$backstab_factor"
										description="When used offensively, this attack deals x$backstab_factor damage if there is an enemy of the target on the opposite side of the target."
										multiply=$backstab_factor
										active_on=offense
										[filter_opponent]
										    formula="
											enemy_of(self, flanker) and not flanker.petrified
										    where
											flanker = unit_at(direction_from(loc, other.facing))
										    "
										[/filter_opponent]
									[/damage]
							    [/set_specials]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_slow
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
										id=slow
										name="slows (day only)"
										description="This attack slows the target until it ends a turn. Active only during a day."
										[filter_self]
											[filter_location]
												time_of_day_id=morning,midday,afternoon
											[/filter_location]
										[/filter_self]
									[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
									id=slow
									name="slows (day, dawn and dusk)"
									description="This attack slows the target until it ends a turn. Active only during a day, dawn and dusk."
									[filter_self]
										[filter_location]
											time_of_day_id=dawn,morning,midday,afternoon,dusk
										[/filter_location]
									[/filter_self]
								[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							   	[not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
										id=slow
										name="slows"
										description="This attack slows the target until it ends a turn."
									[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								slow_aura_damage=1
							[/variables]
						
							[object]
								silent=yes
								
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_slow_aura
											name="slow aura"
											description="At the beginning of the turn all surrounding enemies receive small cold damage and get slowed. This ability in and of itself does not kill."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								slow_aura_damage=2
							[/variables]
						
							[object]
								silent=yes
								
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_lesser_chronosphere
											name="lesser chronosphere"
											description="When defending against melee attacks, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								slow_aura_damage=4
							[/variables]
						
							[object]
								silent=yes
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_lesser_chronosphere
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_chronosphere
											name="chronosphere"
											description="When defending, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=mp
				[object]
					 silent=yes

					[effect]
					    apply_to=movement
					    increase=$item_step
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[trait]
								id=qquws_unslowable_trait
								name="slow immunity"
								description="This unit can not be slowed."

								[effect]
									apply_to=status
									add=unslowable
								[/effect]
							[/trait]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[object]
				 			silent=yes
				 			
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_unslowable_aura
										name="slow immunity aura"
										description="All allied units receive slow immunity."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_unslowable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[object]
				 			silent=yes
				 			
							[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_unslowable_aura
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										# id must stay the same
										id=qquws_unslowable_aura
										name="motility mastery"
										description="This unit and all allies become immune to slow. In addition to that at the beginning of this unit's turn all surrounding enemies become immobilised. Affected units lose their zone of control. Champions, the Butcher of Wesnoth and unslowable units are immune."
									[/dummy]
									[dummy]
										id=qquws_motility_aoe
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=feeding
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 5}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=halo
								    halo="halo/uws/deluminates.png"
								[/effect]
								[effect]
									apply_to=alignment
									set=chaotic
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=1
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 15}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=2
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 25}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=3
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 15}
						{VARIABLE summons_lvl 0}
						{VARIABLE summons_ageless "Walking Corpse,AE_arc_phantom_Mummy,AE_arc_despair_Wisp"}
						{VARIABLE summons_default "Walking Corpse"}
						{VARIABLE deluminates_value 25}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=4
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 16}
						{VARIABLE summons_lvl 1}
						{VARIABLE summons_ageless "Skeleton,Ghost,QQ_enslaved_soul,Skeleton Archer,AE_arc_despair_Spearman,AE_arc_despair_Fright,AE_mrc_Blight_Charred_Zombie"}
						{VARIABLE summons_default "Skeleton,Ghost,QQ_enslaved_soul,Skeleton Archer"}
						{VARIABLE deluminates_value 30}
						{VARIABLE deluminates_limit 30}
						{VARIABLE feeding_cap 1}
					[/case]
					[case]
						value=5
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 17}
						{VARIABLE summons_lvl 2}
						{VARIABLE summons_ageless "Shadow,Wraith,Revenant,Death Squire,AE_mrc_Blight_Dismembered,AE_arc_despair_Black_Shadow"}
						{VARIABLE summons_default "Shadow,Wraith,Revenant,Death Squire"}
						{VARIABLE deluminates_value 35}
						{VARIABLE deluminates_limit 35}
						{VARIABLE feeding_cap 1}
					[/case]
				[/switch]
				
				{VARIABLE summons_list $summons_default}
				[if]
					[variable]
						name=random_pool.allow_ae
						boolean_equals=yes
					[/variable]
					[then]
						{VARIABLE summons_list $summons_ageless}
					[/then]
				[/if]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[object]
						silent=yes
						
						[effect]
						    apply_to=remove_ability
						    [abilities]
								[illuminates]
									id=qquws_delumination
								[/illuminates]
						    [/abilities]
						[/effect]
						[effect]
						    apply_to=new_ability
						    [abilities]
								[illuminates]
							        id=qquws_delumination
							        value=-$deluminates_value
							        min_value=-$deluminates_limit
							        max_value=0
							        cumulative=no
							        name="deluminates $deluminates_value"
							        description="This unit obscures the surrounding area, making chaotic units fight better, and lawful units fight worse."
							        affect_self=yes
							    [/illuminates]
						    [/abilities]
						[/effect]
					[/object]
				[/modify_unit]
				
				[if]
					[variable]
						name=feeding_cap
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								feeding_cap=$feeding_cap
							[/variables]

							[object]
								silent=yes
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_feeding
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
									[dummy]
										id=qquws_feeding
										name="magical feeding"
										description="This unit gains extra hitpoints whenever it kills a unit. The number added depends on the level of the unit killed (cap $feeding_cap|)."
									[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=summons_enabled
						boolean_equals=yes
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								summons_chance=$summons_chance
								summons_list=$summons_list
							[/variables]

							[object]
								silent=yes
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_raises_undead
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_raises_undead
											name="raises the undead"
											description="At the beginning of it's turn, this unit has $summons_chance|% chance to summon a level $summons_lvl undead minion. The strength of the summoned units varies."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=leadership

				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE leadership_amount 5}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=1
						{VARIABLE leadership_amount 15}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=2
						{VARIABLE leadership_amount 25}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=3
						{VARIABLE leadership_amount 25}
						{VARIABLE leads_by_example_value 15}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=4
						{VARIABLE leadership_amount 30}
						{VARIABLE leads_by_example_value 25}
						{VARIABLE great_leader_value 25}
					[/case]
					[case]
						value=5
						{VARIABLE leadership_amount 35}
						{VARIABLE leads_by_example_value 35}
						{VARIABLE great_leader_value 50}

						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]

				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[leadership]
								id=leadership
							[/leadership]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[leadership]
								id=leadership
								value=$leadership_amount
								cumulative=no
								name="leadership"
								description="This unit can lead your own units that are next to it, making them fight better. Affects units of the same or lower level increasing their damage by $leadership_amount|% regardless of their level difference."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
								    [filter]
									formula="level <= other.level"
								    [/filter]
								[/affect_adjacent]
							[/leadership]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=leads_by_example_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								qquws_leads_by_example_buff=$leads_by_example_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_leads_by_example
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_leads_by_example
											name="leads by example $leads_by_example_value|%"
											description="Whenever this unit attacks a champion, or a regular enemy of the same or higher level with more than 50% hitpoints, then all units of the same side that haven't made a move yet receive +1mp and a $leads_by_example_value|% damage bonus until the end of the turn."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=great_leader_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								qquws_great_leader_teaching_rate=$great_leader_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_great_leader
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_great_leader
											name="great leader $great_leader_value|%"
											description="Whenever this unit kills an enemy all surrounding allied units receive $great_leader_value|% experience points of the kill as teachings and explanations from the leader."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=drain

				{VARIABLE drains_extra_label ""}
				{VARIABLE drains_extra_text ""}
				{VARIABLE drains_non_living_percentage 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=ranged
								[not]
							    	special_id=qquws_block_specials
							    [/not]

								[set_specials]
									 mode=append
									[damage]
										id=qquws_evil
										name="wicked"
										description="When used offensively at nighttime, this attack deals 15% more damage to living units."
										multiply=1.15
										active_on=offense
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
									[dummy]
										id=qquws_non_living_drains
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/20%"}
						{VARIABLE drains_non_living_percentage 20}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 20% of the damage dealt."}
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=ranged
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_evil
								[set_specials]
									 mode=append
									 [damage]
										id=qquws_evil
										name="wicked"
										description="When used offensively at nighttime, this attack deals 25% more damage to living units."
										multiply=1.25
										active_on=offense
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/30%"}
						{VARIABLE drains_non_living_percentage 30}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 30% of the damage dealt."}
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_evil
								[set_specials]
									 mode=append
									 [damage]
										id=qquws_evil
										name="unholy"
										description="When used at nighttime, this attack deals 35% more damage to living units."
										multiply=1.35
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/40%"}
						{VARIABLE drains_non_living_percentage 40}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 40% of the damage dealt."}
					[/case]
				[/switch]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[variables]
						non_living_drains=$drains_non_living_percentage
					[/variables]

					[object]
						silent=yes

						[effect]
						    apply_to=attack
						    range=ranged
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    remove_specials=drains,qquws_drains
						    [set_specials]
						    	mode=append
						    	[drains]
									id=qquws_drains
									name="drains $item_step|%$drains_extra_label"
									description="This unit drains health from living units, healing itself for $item_step|% the amount of damage it deals (rounded down).$drains_extra_text"
									value=$item_step
								[/drains]
						    [/set_specials]
						[/effect]
					[/object]
				[/modify_unit]
			[/case]
			[case]
				value=defense
				[object]
					 silent=yes

					[effect]
					    apply_to=movement_costs
					    replace=no
					    [movement_costs]
							flat=-$item_step
							frozen=-$item_step
							forest=-$item_step
							hills=-$item_step
							mountains=-$item_step
							village=-$item_step
							swamp_water=-$item_step
							shallow_water=-$item_step
							deep_water=-$item_step
							reef=-$item_step
							castle=-$item_step
							cave=-$item_step
							sand=-$item_step
							fungus=-$item_step
					    [/movement_costs]
					[/effect]
				[/object]
				
				{VARIABLE improve_defense 0}
				[switch]
					variable=use_promotion_level

					[case]
						value=0
						{VARIABLE improve_defense 1}
					[/case]
					[case]
						value=1
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=2
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=3
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=4
						{VARIABLE improve_defense 3}

						[object]
							silent=yes

							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_terrain_knowledge
										name="terrain knowledge"
										description="This unit mastered the different terrains. All allied units improve defense by 5% on all terrains."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_terrain_knowledge_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						{VARIABLE improve_defense 0}
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_terrain_knowledge
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_terrain_mastery
										name="cartography"
										description="All allied units receive +10% defense everywhere and improve their movement costs by 1."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_terrain_knowledge_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_terrain_mastery_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=improve_defense
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
								apply_to=defense
								replace=no
								[defense]
									flat=-$improve_defense
									frozen=-$improve_defense
									forest=-$improve_defense
									hills=-$improve_defense
									mountains=-$improve_defense
									village=-$improve_defense
									swamp_water=-$improve_defense
									shallow_water=-$improve_defense
									deep_water=-$improve_defense
									reef=-$improve_defense
									castle=-$improve_defense
									cave=-$improve_defense
									sand=-$improve_defense
									fungus=-$improve_defense
									unwalkable=-$improve_defense
								[/defense]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=skirm
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher (nighttime only)"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control. Active only during nighttime."
										affect_self=yes
										[filter_self]
											[filter_location]
												time_of_day_id=first_watch,midnight,second_watch
											[/filter_location]
										[/filter_self]
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher (dusk, nighttime and dawn)"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control. Active only during dusk, nighttime and dawn."
										affect_self=yes
										[filter_self]
											[filter_location]
												time_of_day_id=dusk,first_watch,midnight,second_watch,dawn
											[/filter_location]
										[/filter_self]
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control."
										affect_self=yes
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
							    apply_to=movement
							    increase=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								battle_fervor_mp=1
							[/variables]
							
							[object]
								silent=yes

								[effect]
								    apply_to=movement
								    increase=1
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
											name="battle fervor +1"
											description="Increases movement points of all ally units by 1."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
						
						[fire_event]
							name=apply_battle_fervor_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								battle_fervor_mp=2
							[/variables]
							
							[object]
								silent=yes

								[effect]
									apply_to=remove_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
											name="battle fervor +2"
											description="Increases movement points of all ally units by 2."
										[/dummy]
										[dummy]
											id=qquws_enemy_control
											name="enemy control"
											description="All allied units learn how to ignore enemies' zones of control."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
						
						[fire_event]
							name=apply_battle_fervor_to_all_allies
						[/fire_event]
						
						[fire_event]
							name=apply_enemy_control_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
			[/case]
			[case]
				value=first_strike
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 [firststrike]
								        id=firststrike
								        name="first strike (lower levels only)"
								        description="This unit always strikes first with this attack against enemies of lower level."
								        [filter_opponent]
								    		formula="if(level < other.level, 1, 0)"
								    	[/filter_opponent]
								    [/firststrike]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 {WEAPON_SPECIAL_FIRSTSTRIKE}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 {WEAPON_SPECIAL_FIRSTSTRIKE}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								preemptive_strike_chance=50
								preemptive_strike_champion_chance=30
								preemptive_strike_damage=50
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									[set_specials]
										 mode=append
										 
										 [dummy]
										 	id=qquws_preemptive_strike
											name="preemptive strike 50%"
											description="When attacking you strike twice before the enemy can retaliate. The first strike deals 50% normal damage, has always 50% chance to hit and all specials disabled. Chance to hit is 30% if fighting a champion or the Butcher of Wesnoth."
											active_on=offense
										 [/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								preemptive_strike_chance=60
								preemptive_strike_champion_chance=40
								preemptive_strike_damage=75
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_preemptive_strike
									[set_specials]
										 mode=append
										 
										 [dummy]
										 	id=qquws_preemptive_strike
											name="preemptive strike 75%"
											description="When attacking you strike twice before the enemy can retaliate. The first strike deals 75% normal damage, has always 60% chance to hit and all specials disabled. Chance to hit is 40% if fighting a champion or the Butcher of Wesnoth."
											active_on=offense
										 [/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_preemptive_strike
								[set_specials]
									 mode=append
									 [dummy]
									 	id=qquws_initiative
										name="initiative"
										description="When attacking and defending you strike twice before the enemy. The first strike deals 125% normal damage, has always 70% chance to hit and all specials disabled. Chance to hit is 50% if fighting a champion or the Butcher of Wesnoth."
									 [/dummy]
								[/set_specials]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
							    	[firststrike]
										id=qquws_eagerness_aura
										name="eagerness aura"
										description="All surrounding allies gain first strike on all weapons."
										affect_enemies=no
										affect_allies=yes
										affect_self=no
										[affect_adjacent]
										[/affect_adjacent]
									[/firststrike]
							    [/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=fear

				{VARIABLE fear_reduction 0}
				{VARIABLE fear_radius 0}
				{VARIABLE fear_heal_on_hit 0}
				{VARIABLE fear_max_lvl 0}
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE fear_reduction 0}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 5}
						{VARIABLE fear_radius 1}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=1
						{VARIABLE fear_reduction 5}
						{VARIABLE fear_kill_reduction 5}
						{VARIABLE fear_attack_reduction 5}
						{VARIABLE fear_radius 1}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=2
						{VARIABLE fear_reduction 5}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 10}
						{VARIABLE fear_radius 2}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=3
						{VARIABLE fear_reduction 10}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 15}
						{VARIABLE fear_radius 3}
						{VARIABLE fear_heal_on_hit 1}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=4
						{VARIABLE fear_reduction 10}
						{VARIABLE fear_kill_reduction 15}
						{VARIABLE fear_attack_reduction 20}
						{VARIABLE fear_radius 4}
						{VARIABLE fear_heal_on_hit 2}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=5
						{VARIABLE fear_reduction 15}
						{VARIABLE fear_kill_reduction 15}
						{VARIABLE fear_attack_reduction 25}
						{VARIABLE fear_radius 5}
						{VARIABLE fear_heal_on_hit 3}
						{VARIABLE fear_lvl_inc 0}
						
						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]
				
				{VARIABLE fear_kill_total_reduction $fear_reduction}
				{VARIABLE_OP fear_kill_total_reduction add $fear_kill_reduction}
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						fear_reduction=$fear_reduction
						fear_kill_reduction=$fear_kill_reduction
						fear_radius=$fear_radius
						fear_increase_max_level=$fear_lvl_inc
					[/variables]
					
					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_necromancers_bane
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_necromancers_bane
									name="necromancer's bane"
									description="Each time this unit attacks, the defender retaliates with $fear_attack_reduction|% damage reduction. Furthermore all enemies level of the unit killed + 1 and less within range $fear_radius from this unit receive $fear_reduction|% damage reduction ($fear_kill_total_reduction|% if the unit is killed) at the end of the fight for a duration of one turn. Champions, Butcher of Wesnoth, fearless units, and leaders receive half of the reduction."
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
						    apply_to=attack
						    remove_specials=qquws_necro_bane_dmg
						    [set_specials]
					    	  	mode=append
					     		[damage]
									id=qquws_necro_bane_dmg
									name=""
									description=""
									active_on=offense
									apply_to=opponent
									multiply="( (100.0 - if(defender.traits.immune_to_specials or defender.traits.fearless or defender.canrecruit, $fear_attack_reduction / 2.0, $fear_attack_reduction)) / 100.0 )"
								[/damage]
						    [/set_specials]
						 [/effect]
					[/object]
				[/modify_unit]
				
				[if]
					[variable]
						name=fear_heal_on_hit
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_heals_on_hit
								[set_specials]
								  mode=append
									  [heal_on_hit]
										id=qquws_heals_on_hit
										name="heals on hit +$fear_heal_on_hit"
										description="Each landing hit causes this unit to heal $fear_heal_on_hit hitpoint(s)."
										value=$fear_heal_on_hit
										apply_to=self
									  [/heal_on_hit] 
								[/set_specials]
							 [/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=discouragement
				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     range=melee
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 10%"
										description="When used defensively this attack reduces the opponent's damage by 10%."
										multiply=0.9
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=1

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     range=melee
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 15%"
										description="When used defensively this attack reduces the opponent's damage by 15%."
										multiply=0.85
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=2

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 20%"
										description="When used defensively this attack reduces the opponent's damage by 20%."
										multiply=0.8
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=3

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     range=melee
							     [set_specials]
							    		mode=append
							     	  	[attacks]
											id=qquws_discouragement
											name="discourage"
											description="When used in defense, this attack reduces the opponent's number of strikes by 1."
											sub=1
											active_on=defense
											apply_to=opponent
									 	[/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=4

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten,qquws_discouragement
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 25%"
										description="When used defensively this attack reduces the opponent's damage by 25%."
										multiply=0.75
										apply_to=opponent
										active_on=defense
								    [/damage]
								    [attacks]
										id=qquws_discouragement
										name="discourage"
										description="When used in defense, this attack reduces the opponent's number of strikes by 1."
										sub=1
										active_on=defense
										apply_to=opponent
								 	[/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 30%"
										description="When used defensively this attack reduces the opponent's damage by 30%."
										multiply=0.7
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
							 [effect]
								apply_to=new_attack
								name=qquws_w_corruption
								description="corruption"
								type=corruption
								range=corruption
								icon="attacks/wail.png"
								damage=1
								number=1
								[specials]
									[dummy]
										id=qquws_corruption
										name="corrupts"
										description="When used the enemy unit will either change sides or become enraged and it's damage will increase by 40%. The chance of conversion depends on the difference in levels between the corrupting and the corrupted unit. If the levels are the same it's 50% - 50%. Each point of difference in levels affects the chances by 20%. Champions, the Butcher of Wesnoth and recruiting units are immune. Available only on offense. Number of owned corrupted units is limited to 1."
										active_on=offense
									[/dummy]
									[chance_to_hit]
										id=magical
										name="always hits"
										description="This attack has always a 100% chance to hit regardless of the defensive ability of the unit being attacked."
										value=100
										cumulative=no
									[/chance_to_hit]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=burns

				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[object]
							silent=yes

							[effect]
							    apply_to=halo
							    halo="halo/uws/burns.png"
							[/effect]
						[/object]

						{VARIABLE secret_fire_adjacent 2}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "2"}
						{VARIABLE fire_vision_bonus 0}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-5
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1

						{VARIABLE secret_fire_adjacent 4}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "4"}
						{VARIABLE fire_vision_bonus 0}
					[/case]
					[case]
						value=2

						{VARIABLE secret_fire_adjacent 8}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "8"}
						{VARIABLE fire_vision_bonus 0}
					[/case]
					[case]
						value=3

						{VARIABLE secret_fire_adjacent 12}
						{VARIABLE secret_fire_defending 8}
						{VARIABLE secret_fire_message " Additionally it deals 8 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 15%."}
						{VARIABLE secret_fire_name_info "12(8)"}
						{VARIABLE fire_vision_bonus 1}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4

						{VARIABLE secret_fire_adjacent 16}
						{VARIABLE secret_fire_defending 12}
						{VARIABLE secret_fire_message " Additionally it deals 12 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 15%."}
						{VARIABLE secret_fire_name_info "16(12)"}
						{VARIABLE fire_vision_bonus 2}
					[/case]
					[case]
						value=5
						
						{VARIABLE secret_fire_adjacent 20}
						{VARIABLE secret_fire_defending 16}
						{VARIABLE secret_fire_message " Additionally it deals 16 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 25%."}
						{VARIABLE secret_fire_name_info "20(16)"}
						{VARIABLE fire_vision_bonus 3}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
				[/switch]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						secret_fire_adjacent=$secret_fire_adjacent
						secret_fire_defending=$secret_fire_defending
					[/variables]

					[object]
						 silent=yes

						[effect]
						    apply_to=remove_ability
						    [abilities]
								[dummy]
									id=qquws_secret_fire
								[/dummy]
						    [/abilities]
						[/effect]
						[effect]
						    apply_to=new_ability
						    [abilities]
								[dummy]
									id=qquws_secret_fire
									name="secret fire $secret_fire_name_info"
									description="Burns adjacent enemies at the beginning of each turn dealing $secret_fire_adjacent base fire damage (affected by time of day bonus according to the unit's alignment).$secret_fire_message"
								[/dummy]
						    [/abilities]
						[/effect]
					[/object]
				[/modify_unit]

				[if]
					[variable]
						name=fire_vision_bonus
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								fire_vision_bonus=$fire_vision_bonus
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_fire_vision
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_fire_vision
											name="fire vision +$fire_vision_bonus"
											description="All allied units receive +$fire_vision_bonus bonus vision points."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						{VARIABLE remove_trait_from_side $unit.side}
						{VARIABLE remove_trait_id qquws_fire_vision_trait}
						[fire_event]
							name=remove_global_trait
						[/fire_event]

						[fire_event]
							name=apply_fire_vision_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=golden_armor
				
				{VARIABLE reflects_melee 0}
				{VARIABLE reflects_ranged 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=3
						{VARIABLE reflects_melee 20}
						{VARIABLE reflects_ranged 10}
						{VARIABLE golden_armour_value 13}
					[/case]
					[case]
						value=4
						{VARIABLE reflects_melee 40}
						{VARIABLE reflects_ranged 20}
						{VARIABLE golden_armour_value 16}
					[/case]
					[case]
						value=5
						{VARIABLE reflects_melee 60}
						{VARIABLE reflects_ranged 30}
						{VARIABLE golden_armour_value 20}
					[/case]
				[/switch]

				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
							impact=-$item_step
							pierce=-$item_step
							arcane=-$item_step
							cold=-$item_step
							fire=-$item_step
							secret=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=reflects_melee
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								reflects_melee_factor="$( 0.01 * $reflects_melee )"
								reflects_ranged_factor="$( 0.01 * $reflects_ranged )"
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummny]
										id=qquws_reflects_damage
									[/dummny]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
									[dummny]
										id=qquws_reflects_damage
										name="reflects damage $reflects_melee|($reflects_ranged|%)"
										description="Each time this unit is fighting $reflects_melee|% of received melee and $reflects_ranged|% ranged damage is reflected back to the enemy. Passively increases all resistances by $golden_armour_value|%."
									[/dummny]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=heal

				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[heals]
								id=healing
							[/heals]
							[heals]
								id=curing
							[/heals]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[heals]
								value=$item_step
								id=healing
								affect_allies=yes
								name="heals +$item_step"
								description="This unit combines herbal remedies with magic to heal units more quickly than is normally possible on the battlefield."
								affect_self=no
								poison=cured
								[affect_adjacent]
									adjacent=n,ne,se,s,sw,nw
								[/affect_adjacent]
							[/heals]
					    [/abilities]
					[/effect]
				[/object]

				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								silent=yes

								[effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-5
								    [/resistance]
								[/effect]
								[effect]
									apply_to=overlay
									add="halo/uws/healing_cross.png"
								[/effect]
								[effect]
									apply_to=new_animation
									[healing_anim]
										[frame]
								            halo="halo/saurian-magic-halo-[1~7].png:100"
								        [/frame]
									[/healing_anim]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]

					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=2
								heals_restore_statuses=no
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-10
								    [/resistance]
								[/effect]
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_global_heals
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_global_heals
											name="heals all +2"
											description="At the beginning of it's turn, this unit heals all ally units on the map. Healing amount is 2 hitpoints."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=4
								heals_restore_statuses=no
							[/variables]

							[object]
					 			silent=yes
					 			
					 			[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_heals
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_global_heals
											name="heals all +4"
											description="At the beginning of it's turn, this unit heals all ally units on the map. Healing amount is 4 hitpoints."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=8
								heals_restore_statuses=yes
							[/variables]

							[trait]
								id=qquws_distinguished
								name=distinguished
								description="Distinguished units can assume the role of a new leader in an unfortunate situation where one dies."
							[/trait]
							
							[object]
								 silent=yes

								 [effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-10
								    [/resistance]
								[/effect]
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_global_heals
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_global_heals
											name="restores all +8"
											description="At the beginning of it's turn, this unit not only heals all ally units on the map, but also cures, removes slow and unpetrifies them. Healing amount is 8 hitpoins."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=freezing_gem
				
				{VARIABLE freezing_touch_amount 0}
				{VARIABLE freezing_touch_cold 5}
				{VARIABLE icy_shackles_value 0}
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE freezing_touch_amount 1}
						{VARIABLE freezing_touch_cold 5}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-5
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						{VARIABLE freezing_touch_amount 2}
						{VARIABLE freezing_touch_cold 5}
					[/case]
					[case]
						value=2
						{VARIABLE freezing_touch_amount 3}
						{VARIABLE freezing_touch_cold 5}
					[/case]
					[case]
						value=3
						{VARIABLE freezing_touch_amount 4}
						{VARIABLE freezing_touch_cold 15}
						{VARIABLE icy_shackles_value 1.5}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						{VARIABLE freezing_touch_amount 5}
						{VARIABLE freezing_touch_cold 15}
						{VARIABLE icy_shackles_value 1.65}
					[/case]
					[case]
						value=5
						{VARIABLE freezing_touch_amount 6}
						{VARIABLE freezing_touch_cold 25}
						{VARIABLE icy_shackles_value 1.8}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=freezing_touch_amount
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								freezing_touch_amount=$freezing_touch_amount
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_freezing_gem
								    [set_specials]
										mode=append
										[dummy]
											id=qquws_freezing_gem
											name="freezing touch $freezing_touch_amount"
											description="Each landing hit of this weapon decreases enemy's defense ability by $freezing_touch_amount for 1 turn. Passively increases cold resistance by $freezing_touch_cold"
										[/dummy]
								    [/set_specials]
								 [/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=icy_shackles_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								icy_shackles_factor=$icy_shackles_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_icy_shackles
								    [set_specials]
										mode=append
										[dummy]
											id=qquws_icy_shackles
											name="icy shackles x$icy_shackles_value"
											description="At the end of the fight, the opponent's strikes and movement are reduced for a duration of one turn. The level of reduction depends on the difference in defense before and after the fight. Active only on offense."
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=field_disruption

				{VARIABLE half_value "$( floor($item_step * 0.5) )"}
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[resistance]
								id=qquws_field_disruption
							[/resistance]
							[resistance]
								id=qquws_field_disruption_champions
							[/resistance]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[resistance]
								id=qquws_field_disruption
								sub=$item_step
								max_value=100
								apply_to=arcane,cold,fire
								name="field disruption"
								description="Enemies standing next to this unit have their arcane, cold and fire resistances reduced by $item_step|. Champions receive half the effect."
								affect_self=no
								affect_allies=no
								affect_enemies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
									[filter]
										[not]
											trait=immune_to_specials
										[/not]
									[/filter]
								[/affect_adjacent]
							[/resistance]
							[resistance]
								id=qquws_field_disruption_champions
								sub=$half_value
								max_value=100
								apply_to=arcane,cold,fire
								affect_self=no
								affect_allies=no
								affect_enemies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
									[filter]
										trait=immune_to_specials
									[/filter]
								[/affect_adjacent]
							[/resistance]
					    [/abilities]
					[/effect]
				[/object]

				{VARIABLE phase_disruption 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=0
						[object]
							silent=yes

							[effect]
								apply_to=halo
								halo="halo/uws/field_disruption.png"
							[/effect]
						[/object]
					[/case]

					[case]
						value=3
						{VARIABLE phase_disruption 5}
						{VARIABLE phase_damage 0.05}
						{VARIABLE phase_damage_info 5}
						{VARIABLE phase_min_base_dmg 13}
					[/case]
					[case]
						value=4
						{VARIABLE phase_disruption 10}
						{VARIABLE phase_damage 0.15}
						{VARIABLE phase_damage_info 15}
						{VARIABLE phase_min_base_dmg 9}
					[/case]
					[case]
						value=5
						{VARIABLE phase_disruption 15}
						{VARIABLE phase_damage 0.25}
						{VARIABLE phase_damage_info 25}
						{VARIABLE phase_min_base_dmg 4}
					[/case]
				[/switch]

				[if]
					[variable]
						name=phase_disruption
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
							    apply_to=remove_ability
							    [abilities]
									[chance_to_hit]
										id=qquws_phase_disruption
									[/chance_to_hit]
									[chance_to_hit]
										id=qquws_phase_disruption_ally
									[/chance_to_hit]
							    [/abilities]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
									[chance_to_hit]
										id=qquws_phase_disruption
										sub=$phase_disruption
										name="phase disruption $phase_disruption|($phase_damage_info|)"
										description="Surrounding non-champion enemies have their magical damage reduced by chance to hit reduced by $phase_damage_info|% and chance to hit by$phase_disruption|%. Conversely surrounding ally units have their magical damage and chance to hit increased by the corresponding amount."
										affect_self=no
										affect_allies=no
										affect_enemies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_student]
									[/chance_to_hit]
									[damage]
										id=qquws_phase_damage_disruption
										multiply="$( 1.0 - $phase_damage )"
										affect_self=no
										affect_allies=no
										affect_enemies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_student]
										[filter_base_value]
											greater_than=$phase_min_base_dmg
										[/filter_base_value]
									[/damage]
									[chance_to_hit]
										id=qquws_phase_disruption_ally
										add=$phase_disruption
										affect_self=no
										affect_allies=yes
										affect_enemies=no
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]
										[/filter_student]
									[/chance_to_hit]
									[damage]
										id=qquws_phase_damage_disruption_ally
										multiply="$( 1.0 + $phase_damage )"
										affect_self=no
										affect_allies=yes
										affect_enemies=no
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_student]
										[filter_base_value]
											greater_than=$phase_min_base_dmg
										[/filter_base_value]
									[/damage]
							    [/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=armor_destruction

				{VARIABLE damage_increase_txt 1}
				{VARIABLE bloodseeker_factor 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						{VARIABLE damage_increase_txt 1}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						{VARIABLE damage_increase_txt 1}
					[/case]
					[case]
						value=2
						
						{VARIABLE damage_increase_txt 1}
					[/case]
					[case]
						value=3
						
						{VARIABLE damage_increase_txt 2}
						{VARIABLE bloodseeker_factor 4}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						{VARIABLE damage_increase_txt 2}
						{VARIABLE bloodseeker_factor 6}
					[/case]
					[case]
						value=5
						
						{VARIABLE damage_increase_txt 3}
						{VARIABLE bloodseeker_factor 8}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    	special_type=berserk
							    [/not]

								[berserk]
									id=berserk_duel2
									name="duel 2"
									description="When attacking, this unit presses the engagement and can fight for an extra round."
									value=2
									active_on=offense
								[/berserk]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=item_step
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								armor_destruction_amount=$item_step
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									range=melee
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_armor_destruction
									[set_specials]
										mode=append
										[dummy]
											id=qquws_armor_destruction
											name="armor destruction $item_step"
											description="Each landing hit permanently decreases enemy's resistance to this weapon's damage type by $item_step|. Resistance cannot go lower than -15. Works only on offense. Passively increases melee damage by $damage_increase_txt"
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=bloodseeker_factor
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									range=melee
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_bloodseeker
									[set_specials]
										mode=append
										[damage]
							                id=qquws_bloodseeker
							                name="bloodseeker $bloodseeker_factor"
							                description="The more wounded the opponent is the more damage this attack deals. Damage dealt is $bloodseeker_factor|% higher per every 10% hitpoints missing. Active only on offense."
							                multiply="( 1.0 + 0.01 * $bloodseeker_factor * if(defender.max_hitpoints > 0, floor( 10.0 * (defender.max_hitpoints - defender.hitpoints + 0.5) / defender.max_hitpoints ), 0) )"
							                apply_to=attacker
							                active_on=offense
							            [/damage]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=protection
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[resistance]
								id=qquws_protection
							[/resistance]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[resistance]
								id=qquws_protection
								add=$item_step
								max_value=75
								apply_to=blade,impact,pierce
								name="protection $item_step"
								description="Friendly warriors standing next to this unit have their blade, impact and pierce resistances increased by $item_step up to maximum of 75."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
								[/affect_adjacent]
								overlay_image="halo/uws/shield.png"
							[/resistance]
					    [/abilities]
					[/effect]
				[/object]

				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
										multiply=1.2
										active_on=defense
										name="defensive wall"
										description="This unit and all friendly warriors standing next to it deal 20% more melee damage when defending."
										affect_self=yes
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_defender]
											[filter_weapon]
												range=melee
											[/filter_weapon]
										[/filter_defender]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
										multiply=1.4
										active_on=defense
										name="defensive wall"
										description="This unit and all friendly warriors standing next to it deal 40% more melee damage when defending."
										affect_self=yes
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_defender]
											[filter_weapon]
												range=melee
											[/filter_weapon]
										[/filter_defender]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_impenetrable_wall
										multiply=1.5
										active_on=defense
										name="impenetrable wall"
										description="This unit and all friendly warriors standing next to it deal 50% more damage when defending."
										affect_self=yes
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=double_attack
				
				{VARIABLE attacks_done $unit.variables.double_attack_bank}
				{VARIABLE is_second_attack $unit.variables.is_second_attack}
				[if]
					[variable]
						name=attacks_done
						equals=""
					[/variable]
					[then]
						{VARIABLE attacks_done 0}
						{VARIABLE is_second_attack no}
					[/then]
				[/if]

				[remove_object]
					find_in=unit
					object_id=qquws_double_attack_item_object
				[/remove_object]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						double_attack_required=$item_step
						double_attack_bank=$attacks_done
						is_second_attack=$is_second_attack
					[/variables]

					[object]
						id=qquws_double_attack_item_object
						take_only_once=no
						silent=yes

						[effect]
						    apply_to=attack
						    range=ranged
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    [set_specials]
						    	mode=append
						     	[dummy]
									id=qquws_double_attack
									name="double attack ($attacks_done|\$item_step|)"
									description="When charged, this unit can attack twice in a single turn."
									active_on=offense
							 	[/dummy]
						    [/set_specials]
						[/effect]
					[/object]
				[/modify_unit]

				{VARIABLE sharpshooter_value 0}
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						{VARIABLE sharpshooter_value 30}
						{VARIABLE sharpshooter_chance 50}
					[/case]
					[case]
						value=4
						{VARIABLE sharpshooter_value 50}
						{VARIABLE sharpshooter_chance 60}
					[/case]
					[case]
						value=5
						{VARIABLE sharpshooter_value 70}
						{VARIABLE sharpshooter_chance 70}
					[/case]
				[/switch]

				[if]
					[variable]
						name=sharpshooter_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								sharpshooter_chance=$sharpshooter_chance
								sharpshooter_fraction=$sharpshooter_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_sharpshooter
								    [set_specials]
								    	mode=append
								     	[dummy]
											id=qquws_sharpshooter
											name="sharpshooter"
											description="When used offensively, this attack has $sharpshooter_chance|% chance to pierce through the enemy and deal $sharpshooter_value|% damage to the enemy behind it. It does not deal damage to friendly units. Champions and the Butcher of Wesnoth are immune to the piercing effect, but can still be harmed if behind a regular enemy."
											active_on=offense
									 	[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=hitn_run

				[switch]
					variable=use_promotion_level
					[case]
						value=0

						[object]
							 silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=nightstalk
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									{ABILITY_NIGHTSTALK}
								[/abilities]
							[/effect]
						[/object]

						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 0}
					[/case]
					[case]
						value=1
						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run yes}
						{VARIABLE hit_and_run_amount 1}
					[/case]
					[case]
						value=2
						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run yes}
						{VARIABLE hit_and_run_amount 2}
					[/case]
					[case]
						value=3
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 1}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[status]
								assassins_strike_active=no
							[/status]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    
								    [set_specials]
								    	mode=append
										[damage]
											id=qquws_assassins_strike
											name="assassin's strike"
											description="When used offensively at nighttime then the very first strike deals 150% damage if lands. Inactive against enemies with activated first strike special."
											multiply=1.5
											active_on=offense
											apply_to=self
											
											[filter_self]
												status=assassins_strike_active
											[/filter_self]

											[filter]
												[filter_location]
													time_of_day_id=first_watch,midnight,second_watch
												[/filter_location]
											[/filter]
										[/damage]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 2}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[status]
								assassins_strike_active=no
							[/status]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_assassins_strike
								    [set_specials]
								    	mode=append
										[damage]
											id=qquws_assassins_strike
											name="assassin's strike"
											description="When used offensively at nighttime then the very first strike deals 200% damage if lands. Inactive against enemies with activated first strike special."
											multiply=2
											active_on=offense
											apply_to=self
											
											[filter_self]
												status=assassins_strike_active
											[/filter_self]

											[filter]
												[filter_location]
													time_of_day_id=first_watch,midnight,second_watch
												[/filter_location]
											[/filter]
										[/damage]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 3}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[status]
								assassins_strike_active=no
							[/status]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_assassins_strike
								    [set_specials]
								    	mode=append
										[damage]
											id=qquws_assassins_strike
											name="assassin's strike"
											description="When used offensively at nighttime then the very first strike deals 250% damage if lands. Inactive against enemies with activated first strike special."
											multiply=2.5
											active_on=offense
											apply_to=self
											
											[filter_self]
												status=assassins_strike_active
											[/filter_self]

											[filter]
												[filter_location]
													time_of_day_id=first_watch,midnight,second_watch
												[/filter_location]
											[/filter]
										[/damage]
								    [/set_specials]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_successful_operation
											name="successful operation"
											description="If this unit eliminates an enemy successfuly with assassin's strike then it can attack again during the same turn."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=hit_and_run
						boolean_equals=yes
					[/variable]
					[or]
						[variable]
							name=kill_and_run
							boolean_equals=yes
						[/variable]
					[/or]
					[then]
						[if]
							[variable]
								name=hit_and_run
								boolean_equals=yes
							[/variable]
							[then]
								{VARIABLE hit_and_run_kill_amount "$( $hit_and_run_amount + 2 )"}
								{VARIABLE ability_id "qquws_hit_and_run"}
								{VARIABLE ability_name "hit and run +$hit_and_run_amount|($hit_and_run_kill_amount|)"}
								{VARIABLE ability_description "This unit gains additional moves back after attacking, but cannot attack again. If the enemy is eliminated the unit gets more movement points."}
							[/then]
							[else]
								{VARIABLE ability_id "qquws_kill_and_run"}
								{VARIABLE ability_name "kill and run +$hit_and_run_amount"}
								{VARIABLE ability_description "This unit gains additional moves back after eliminating an opponent, but cannot attack again."}
							[/else]
						[/if]
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								hit_and_run=$hit_and_run
								kill_and_run=$kill_and_run
								hit_and_run_amount=$hit_and_run_amount
								hit_and_run_kill_amount="$( $hit_and_run_amount + 2 )"
							[/variables]
							
							moves=1 # fixes issue when kill and run gets replaced with hit and run
						[/modify_unit]
						
						[object]
							 silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_hit_and_run
									[/dummy]
									[dummy]
										id=qquws_kill_and_run
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=$ability_id
										name=$ability_name
										description=$ability_description
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=extra_strikes

				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes (33%)"
										description="This unit gains 1 strike when it's hp drops below 33%."
										add=1
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.33 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes (67%)"
										description="This unit gains 1 strike when it's hp drops below 67%."
										add=1
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.67 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    increase_attacks=1
							    remove_specials=qquws_extra_strikes
							 [/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=qquws_extra_strikes
							    [set_specials]
							    	mode=append
							     	[attacks]
										id=qquws_extra_strikes
										name="extra strikes (50%)"
										description="This unit gains 1 strike when it's hp drops below 50%. Passively increases strikes by 1."
										add=1
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									[/attacks]
							    [/set_specials]
							[/effect]

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    [not]
							    	special_type=chance_to_hit
							    [/not]
								[set_specials]
									mode=append
									[chance_to_hit]
										id=qquws_marksman
										name="marksman 50"
										description="When used offensively, this attack always has at least a 50% chance to hit."
										value=50
										cumulative=yes
										active_on=offense
									[/chance_to_hit]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=qquws_extra_strikes
							    [set_specials]
							    	mode=append
							     	[attacks]
										id=qquws_extra_strikes
										name="extra strikes (67%, 33%)"
										description="This unit gains 1 strike when it's hp drops below 67% and another one below 33%. Passively increases strikes by 1."
										add="( if(hitpoints < 0.67 * max_hitpoints, if(hitpoints < 0.33 * max_hitpoints, 2, 1), 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.67 * max_hitpoints, 1, 0)"
										[/filter_self]
									[/attacks]
							     [/set_specials]
							[/effect]

							[effect]
							    apply_to=attack
							    special_id=qquws_marksman
							    remove_specials=qquws_marksman
								[set_specials]
									mode=append
									[chance_to_hit]
										id=qquws_marksman
										name="marksman 60"
										description="When used offensively, this attack always has at least a 60% chance to hit."
										value=60
										cumulative=yes
										active_on=offense
									[/chance_to_hit]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    increase_attacks=1
							    remove_specials=qquws_extra_strikes
							    [set_specials]
							    	mode=append
							     	[attacks]
										id=qquws_extra_strikes
										name="extra strikes (50%)"
										description="This unit gains 1 strike when it's hp drops below 50%. Passively increases strikes by 2."
										add="( if(hitpoints < 0.5 * max_hitpoints, 1, 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									[/attacks]
							    [/set_specials]
							[/effect]

							[effect]
							    apply_to=attack
							    special_id=qquws_marksman
							    remove_specials=qquws_marksman
								[set_specials]
									mode=append
									[chance_to_hit]
										id=qquws_marksman
										name="marksman 65"
										description="When used offensively, this attack always has at least a 65% chance to hit."
										value=65
										cumulative=yes
										active_on=offense
									[/chance_to_hit]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=rat_pack

				{VARIABLE chance_special 0}
				{VARIABLE chance_special_text ""}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE rats_frequency 6}
					[/case]
					[case]
						value=1
						{VARIABLE rats_frequency 5}
					[/case]
					[case]
						value=2
						{VARIABLE rats_frequency 4}
					[/case]
					[case]
						value=3
						{VARIABLE rats_frequency 4}
						{VARIABLE chance_special 50}
						{VARIABLE chance_special_text " 50% chance to breed a special rat."}
					[/case]
					[case]
						value=4
						{VARIABLE rats_frequency 3}
						{VARIABLE chance_special 75}
						{VARIABLE chance_special_text " 75% chance to breed a special rat."}

						[object]
							silent=yes
							
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_rat_ambassador
										name="rat ambassador"
										description="This unit's stats improve along the title of the highest ranking rat alive."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						{VARIABLE rats_frequency 2}
						{VARIABLE chance_special 100}
						{VARIABLE chance_special_text " Always breeds a special rat."}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[status]
					     spawns_rats=yes
					[/status]
					
					[variables]
						rats_frequency=$rats_frequency
						rats_special_chance=$chance_special
						rats_extra_info=$chance_special_text
					[/variables]

					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_breeds_rats
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_breeds_rats
									name="breeds rats"
									description="This unit is able to breed tasty rats once every $rats_frequency turn(s) (max 4 bred rats).$chance_special_text"
								[/dummy]
							[/abilities]
						[/effect]
					[/object]
				[/modify_unit]
			[/case]
			[case]
				value=icewind_aura
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE icewind_radius 1}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_r_dmg 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=1
						{VARIABLE icewind_radius 2}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_r_dmg 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=2
						{VARIABLE icewind_radius 3}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_r_dmg 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=3
						{VARIABLE icewind_radius 5}
						{VARIABLE icewind_damage 2}
						{VARIABLE icewind_defense 2}
						{VARIABLE icewind_r_dmg 0}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
					[case]
						value=4
						{VARIABLE icewind_radius 7}
						{VARIABLE icewind_damage 4}
						{VARIABLE icewind_defense 5}
						{VARIABLE icewind_r_dmg 0}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
					[case]
						value=5
						{VARIABLE icewind_radius 9}
						{VARIABLE icewind_damage 8}
						{VARIABLE icewind_defense 10}
						{VARIABLE icewind_r_dmg 15}
						{VARIABLE icewind_text ", defenses by $icewind_defense|, damage received in defense by 15% and receive $icewind_damage cold damage"}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						icewind_radius=$icewind_radius
						icewind_damage=$icewind_damage
						icewind_defense=$icewind_defense
						icewind_received_dmg=$icewind_r_dmg
					[/variables]
				[/modify_unit]
			
				[object]
					silent=yes

					[effect]
						apply_to=remove_ability
						[abilities]
							[dummy]
								id=qquws_icewind_aura
							[/dummy]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_icewind_aura
								name="icewind aura $icewind_defense|,$icewind_damage|/$icewind_radius"
								description="At the beginning of your turn all enemies within $icewind_radius radius from this unit get their mp reduced by 30%$icewind_text. Affects units of the same or lower level as the item keeper."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/case]
			[case]
				value=book
				
				{VARIABLE battle_study_adjacent 0}
				{VARIABLE bs_adjacent_text ""}
				{VARIABLE bs_adjacent_info ""}
				{VARIABLE combat_teacher 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE battle_study_self 15}
					[/case]
					[case]
						value=1
						{VARIABLE battle_study_self 25}
					[/case]
					[case]
						value=2
						{VARIABLE battle_study_self 40}
					[/case]
					[case]
						value=3
						{VARIABLE battle_study_self 40}
						{VARIABLE battle_study_adjacent 15}
						{VARIABLE combat_teacher 1}
						{VARIABLE bs_adjacent_text " Additionally, all adjacent allies receive +15% xp whenever they kill an enemy."}
						{VARIABLE bs_adjacent_info "(15%)"}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_study_adjacent_enabled
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[modify_unit]
							[filter]
								id=$unit.id
								[not]
									trait=intelligent
								[/not]
							[/filter]
							
							{TRAIT_INTELLIGENT}
						[/modify_unit]
					[/case]
					[case]
						value=4
						{VARIABLE battle_study_self 40}
						{VARIABLE battle_study_adjacent 25}
						{VARIABLE combat_teacher 2}
						{VARIABLE bs_adjacent_text " Additionally, all adjacent allies receive +25% xp whenever they kill an enemy."}
						{VARIABLE bs_adjacent_info "(25%)"}
					[/case]
					[case]
						value=5
						{VARIABLE battle_study_self 40}
						{VARIABLE battle_study_adjacent 40}
						{VARIABLE combat_teacher 3}
						{VARIABLE bs_adjacent_text " Additionally, all adjacent allies also receive +40% xp whenever they kill an enemy."}
						{VARIABLE bs_adjacent_info "(40%)"}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_intelligence_increase
											name="all intelligent"
											description="All ally units receive intelligent trait."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_intelligent_trait_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						battle_study_self=$battle_study_self
						battle_study_adjacent=$battle_study_adjacent
					[/variables]

					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_battle_study
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_battle_study
									name="battle study +$battle_study_self|%$bs_adjacent_info"
									description="Whenever this unit kills an enemy it receives additional $battle_study_self|% xp.$bs_adjacent_text"
								[/dummy]
							[/abilities]
						[/effect]
					[/object]
				[/modify_unit]
			
				[if]
					[variable]
						name=combat_teacher
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								combat_teacher_amount=$combat_teacher
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=remove_ability
									[abilities]
										[dummy]
											id=qquws_combat_teacher
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_combat_teacher
											name="combat teacher +$combat_teacher"
											description="At the beginning of each turn all adjacent allied units receive +$combat_teacher|xp."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=dragon_protection
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									blade=-5
									impact=-5
									pierce=-5
									arcane=-5
									cold=-5
									fire=-5
									secret=-15
							    [/resistance]
							[/effect]
						[/object]
						
						{VARIABLE dragon_protection_restore_amount 1}
						{VARIABLE dragon_protection_is_fraction no}
						{VARIABLE dragon_protection_common 5}
						{VARIABLE dragon_protection_secret 15}
						{VARIABLE dragon_protection_info "1"}
					[/case]
					[case]
						value=1
						
						{VARIABLE dragon_protection_restore_amount 3}
						{VARIABLE dragon_protection_is_fraction no}
						{VARIABLE dragon_protection_common 5}
						{VARIABLE dragon_protection_secret 15}
						{VARIABLE dragon_protection_info "3"}
					[/case]
					[case]
						value=2
						
						{VARIABLE dragon_protection_restore_amount 5}
						{VARIABLE dragon_protection_is_fraction no}
						{VARIABLE dragon_protection_common 5}
						{VARIABLE dragon_protection_secret 15}
						{VARIABLE dragon_protection_info "5"}
					[/case]
					[case]
						value=3

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									blade=-5
									impact=-5
									pierce=-5
									arcane=-5
									cold=-5
									fire=-5
									secret=-10
							    [/resistance]
							[/effect]
						[/object]
						
						{VARIABLE dragon_protection_restore_amount 0.2}
						{VARIABLE dragon_protection_is_fraction yes}
						{VARIABLE dragon_protection_common 10}
						{VARIABLE dragon_protection_secret 25}
						{VARIABLE dragon_protection_info "20%"}
					[/case]
					[case]
						value=4
						
						{VARIABLE dragon_protection_restore_amount 0.35}
						{VARIABLE dragon_protection_is_fraction yes}
						{VARIABLE dragon_protection_common 10}
						{VARIABLE dragon_protection_secret 25}
						{VARIABLE dragon_protection_info "35%"}
					[/case]
					[case]
						value=5

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									blade=-5
									impact=-5
									pierce=-5
									arcane=-5
									cold=-5
									fire=-5
									secret=-10
							    [/resistance]
							[/effect]
						[/object]
						
						{VARIABLE dragon_protection_restore_amount 0.5}
						{VARIABLE dragon_protection_is_fraction yes}
						{VARIABLE dragon_protection_common 15}
						{VARIABLE dragon_protection_secret 35}
						{VARIABLE dragon_protection_info "50%"}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						dragon_protection_max_lvl=$item_step
						dragon_protection_counter=1
						dragon_restore_amount=$dragon_protection_restore_amount
						dragon_restore_is_fraction=$dragon_protection_is_fraction
					[/variables]
				[/modify_unit]
			
				[object]
					silent=yes

					[effect]
						apply_to=remove_ability
						[abilities]
							[dummy]
								id=qquws_dragon_protection
							[/dummy]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_dragon_protection
								name="dragon's protection $item_step($dragon_protection_info)"
								description="When this unit is killed by a unit of level $item_step or lower, the Dragon's Protection revives it, restoring $dragon_protection_info| hitpoints. A unit can only be revived once per turn (the counter refreshes at the beginning of the player's turn). Passively increases resistance to all common weapon types by $dragon_protection_common|% and against the secret attacks by $dragon_protection_secret|%."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/case]
		[/switch]
	[/event]
#enddef

