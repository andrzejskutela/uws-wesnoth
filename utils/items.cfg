#define INIT_ITEMS_DATA
	[set_variables]
		name=items_steps
		mode=replace
		[value] # steps
			magic_res="5/5/5/5/5/10"
			cold_res="10/10/10/10/20/25"
			phys_res="5/5/5/5/5/10"
			impact_res="10/10/10/10/20/25"
			fire_res="10/10/10/10/20/25"
			arcane_res="10/10/10/10/20/25"
			blade_res="10/10/10/10/20/25"
			pierce_res="10/10/10/10/20/25"
			hp_low="10/20/30/40/50/60"
			hp_med="10/20/30/40/50/60"
			hp_high="10/20/30/40/50/60"
			steadfast="25/40/50/50/60/75"
			regen="2/4/8/10/14/20"
			melee_dmg="7/15/25/33/40/50"
			ranged_dmg="7/15/25/33/40/50"
			ranged_acc="3/2/2/2/3/3"
			melee_parry="3/2/2/2/3/3"
			melee_poison="0/2/1/1/1/0"
			melee_slow="1/0/0/0/0/0"
			mp="1/0/1/0/1/2"
			feeding="1/1/1/1/1/2"
			leadership="1/0/0/0/0/0"
			drain="20/35/50/55/65/75"
			defense="0/0/0/1/1/1"
			skirm="1/0/0/0/0/0"
			first_strike="1/0/0/0/0/0"
			fear="1/0/0/0/0/0"
			discouragement="1/0/0/0/0/0"
			burns="2/4/8/8/8/12"
			golden_armor="3/3/4/2/3/5"
			heal="2/4/8/10/14/18"
			freezing_gem="1/2/3/4/5/6"
			field_disruption="5/10/15/20/25/35"
			armor_destruction="1/2/3/4/5/6"
			protection="5/10/15/20/25/30"
			double_attack="8/7/6/5/4/3"
			hitn_run="1/0/0/1/0/0"
			extra_strikes="40/50/60/70/80/100"
			rat_pack="7/6/5/4/3/2"
			icewind_aura="1/2/3/5/7/9"
			dragon_protection="5/10/15/25/35/999"
		[/value]
		[value] # name
			magic_res="Magic Mastery"
			cold_res="Cold Mastery"
			phys_res="Physical Mastery"
			impact_res="Impact Mastery"
			fire_res="Fire Mastery"
			arcane_res="Arcane Mastery"
			blade_res="Blade Mastery"
			pierce_res="Pierce Mastery"
			hp_low="Potion of Health"
			hp_med="Ring of Endurance"
			hp_high="Talisman of Vitality"
			steadfast="Amulet of Devotion"
			regen="Charm of Regeneration"
			melee_dmg="War Sword"
			ranged_dmg="Crystal Bow"
			ranged_acc="Elven Ring of Accuracy"
			melee_parry="Battle Staff"
			melee_poison="Assassin's Dagger"
			melee_slow="Chronomancer's Staff"
			mp="Potion of Swiftness"
			feeding="Necronomicon"
			leadership="Celestial Hammer"
			drain="Staff of Dark Sorcery"
			defense="Potion of Agility"
			skirm="Potion of Dexterity"
			first_strike="Ceremonial Spear"
			fear="Necromancer's Bane"
			discouragement="Potion of Hindrance"
			burns="Torch of the Secret Fire"
			golden_armor="Golden Armor"
			heal="Potion of Rejuvenation"
			freezing_gem="Gem of Hoarfrost"
			field_disruption="Sorcerer's Battle Armor"
			armor_destruction="The Scythe"
			protection="Talisman of Protection"
			double_attack="Elven Royal Bow"
			hitn_run="Hitman's Cloak"
			extra_strikes="Battle Gauntlets"
			rat_pack="Rodent Breeder"
			icewind_aura="IceLord's Protection"
			dragon_protection="Dragon's Protection"
		[/value]
		[value] # step labels for display
			magic_res="+5% magic res/+10% magic res/+15% magic res/+20% magic res, 5% negation/+25% magic res, 10% negation/+35% magic res, 20% negation" 
			cold_res="+10% cold/+20% cold/+30% cold/+40% cold + decent weapon/+60% cold + powerful weapon/+85% cold, element mastery + mythical weapon"
			phys_res="+5% phys res/+10% phys res/+15% phys res/+20% phys res, 5% reduction/+25% phys res, 10% reduction/+35% phys res, 20% reduction"
			impact_res="+10% impact/+20% impact/+30% impact/+40% impact + decent weapon/+60% impact + powerful weapon/+85% impact, element mastery + mythical weapon"
			fire_res="+10% fire/+20% fire/+30% fire/+40% fire + decent weapon/+60% fire + powerful weapon/+85% fire, element mastery + mythical weapon"
			arcane_res="+10% arcane/+20% arcane/+30% arcane/+40% arcane + decent weapon and ability/+60% arcane + powerful weapon/+85% arcane, element mastery + mythical ability"
			blade_res="+10% blade/+20% blade/+30% blade/+40% blade + decent weapon/+60% blade + powerful weapon/+85% blade, element mastery + mythical weapon"
			pierce_res="+10% pierce/+20% pierce/+30% pierce/+40% pierce + decent weapon/+60% pierce + powerful weapon/+85%, element mastery pierce + mythical weapon"
			hp_low="+10% hp/+20% hp/+30% hp/+40% hp, unpoisonable/+50% hp, unpoisonable aura/+60% hp, poison mastery"
			hp_med="+10% hp/+20% hp/+30% hp/+40% hp, undrainable/+50% hp, undrainable aura/+60% hp, draining mastery"
			hp_high="+10% hp/+20% hp/+30% hp/+40% hp, heals all +2/+50% hp, heals all +4/+60% hp, restores all +8"
			steadfast="x1.5 25% max/x1.75 40% max/x2 50% max/x2 50% max, adjacent x2 20% max/x2.25 60% max, adjacent x2 30% max/x2.5 75% max, adjacent x2 40% max"
			regen="+2/+4/+8/+10 (village +14, fight +2)/+14 (village +20, fight +4)/+20 (village +28, fight +8)"
			melee_dmg="+7% melee dmg/+15% melee dmg/+25% melee dmg/+33% melee dmg, fury +10%/+40% melee dmg, fury +15%/+50% melee dmg, fearless, fury +22%"
			ranged_dmg="+7% ranged dmg/+15% ranged dmg/+25% ranged dmg/+33% ranged dmg, ruthless/+40% ranged dmg, ruthless/+50% ranged dmg, merciless"
			ranged_acc="+3 ranged accuracy/+5 ranged accuracy/+7 ranged accuracy/+9 ranged accuracy, concentration +3/+12 ranged accuracy, concentration +6/+15 ranged accuracy, concentration +9"
			melee_parry="+3 melee parry/+5 melee parry/+7 melee parry/+9 melee parry, counterbalance 30/+12 melee parry, counterbalance 40/+15 melee parry, counterbalance 50, peaceful warrior"
			melee_poison="melee poison (lower lvl only)/melee poison (same and lower lvl only)/melee poison/melee poison, +1 acc, 1.25x backstab/melee poison, +3 acc, 1.5x backstab/melee poison, +5 acc, 2x backstab"
			melee_slow="day only melee slow/day, dawn and dusk melee slow/melee slow/melee slow, stillness aura/melee slow, lesser chronosphere/melee slow, chronosphere"
			mp="+1 mp/+1 mp/+2 mp/+2 mp, slow immunity/+3 mp, slow immunity aura/+4 mp, motility mastery"
			feeding="deluminates -5/deluminates -15/deluminates -25/deluminates -25, feeding +1, 15% to summon lvl0/deluminates -30, feeding +2, 17% to summon lvl1/deluminates -35, feeding +3, 19% to summon lvl2"
			leadership="leadership 15%/leadership 20%/leadership 25%/leadership 25%, leads by example 15%/leadership 30%, leads by example 25%, great leader 25%/leadership 35%, leads by example 35%, great leader 50%, fearless"
			drain="20%/35%/50%/55%(20%), wicked x1.15/65%(30%), wicked x1.25/75%(40%), unholy x1.35"
			defense="+1% def/+3% def/+5% def/+6% def, -1mc/+8% def, -2mc/+10% def, -3mc, terrain mastery"
			skirm="nighttime only skirmisher/dawn, dusk and night skirmisher/skirmisher/skirmisher, +1 mp/skirmisher +2 mp, battle fervor +1/skirmisher, +2 mp, battle fervor +2, enemy control"
			first_strike="melee first strike (lower levels only)/melee first strike/first strike/first strike, preemptive 50%/first strike, preemptive 75%/first strike, initiative, eagerness aura"
			fear="5% attack, 0%(10%) lvl0(r1)/5% attack, 5%(10%) lvl1(r1)/10% attack, 5%(15%) lvl2(r2)/15% attack, 10%(20%) lvl3(r3), +1 heal on hit/20% attack, 10%(25%) lvl4(r4), +2 heal on hit/25% attack, 15%(30%) lvl5(r5), +3 heal on hit, fearless"
			discouragement="melee dishearten -10%/melee dishearten -15%/dishearten -20%/dishearten -20%, melee discourage -1/dishearten -25%, discourage -1/dishearten -30%, discourage -1, corrupts"
			burns="secret fire 2, +5% fire res/secret fire 4, +5% fire res/secret fire 8, +5% fire res/secret fire 8(8), +15% fire res, +1 fire vision/secret fire 12(12), +15% fire res, +2 fire vision/secret fire 16(16), +25% fire res, +3 fire vision"
			golden_armor="+3% res/+6% res/+10% res/+12% res, reflects 15%/+15% res, reflects 30%/+20% res, reflects 50%"
			heal="heals +2, +5% arcane res/heals +4, +5% arcane res/heals +8, +5% arcane res/heals +10, treats wounded 40, +15% arcane res/heals +14, treats wounded 30, +15% arcane res/heals +18, treats wounded 20, +25% arcane res, distinguished"
			freezing_gem="freezing touch -1, +5% cold res/freezing touch -2, +5% cold res/freezing touch -3, +5% cold res/freezing touch -4, +15% cold res/freezing touch -5, +15% cold res/freezing touch -6, +25% cold res"
			field_disruption="field -5/field -10/field -15/field -20, phase 5/field -25, phase 10/field -30, phase 15"
			armor_destruction="-1 res per hit, +1 dmg/-2 res per hit, +1 dmg/-3 res per hit, +1 dmg/-4 res per hit, +2 dmg/-5 res per hit, +2 dmg/-6 res per hit, +3 dmg"
			protection="protection +5/protection +10/protection +15/protection +20, defensive wall 1.15/protection +25, defensive wall 1.3/protection +30, impenetrable wall 1.5"
			double_attack="8 to charge/7 to charge/6 to charge/5 to charge, sharpshooter 30%/4 to charge, sharpshooter 50%/3 to charge, sharpshooter 70%"
			hitn_run="nightstalk/nightstalk, kill +1/nightstalk, kill +1/nightstalk, hit +1/nightstalk, hit +2/nightstalk, hit +3, cover of the night"
			extra_strikes="below 50%/below 65% and 30%/always +1/always +1, extra below 50%, accuracy +2/always +1, extra below 65% and 30%, accuracy +3/always +2, extra below 50%, accuracy +5"
			rat_pack="spawn every 6 turns/spawn every 5 turns/spawn every 4 turns/spawn every 4 turns, 50% special/spawn every 3 turns, 75% special/special spawn every 2 turns, plague on melee"
			icewind_aura="1 radius/2 radius/3 radius/5 radius, 2 cold damage, defenses -2%/7 radius, 4 cold damage, defenses -5%/9 radius, 8 cold damage, defenses -10%"
			dragon_protection="5hp(1hp)/10hp(5hp)/15hp(10hp)/25hp(15hp)/35hp(25hp)/always(35hp)"
		[/value]
		[value] # image
			magic_res="items/ball-magenta.png"
			cold_res="items/ball-blue.png"
			phys_res="items/ball-green.png"
			impact_res="scenery/trapdoor-closed.png"
			fire_res="items/ring-red.png"
			arcane_res="items/talisman-bone.png"
			blade_res="items/buckler.png"
			pierce_res="items/armor.png"
			hp_low="items/potion-red.png"
			hp_med="items/ring-brown.png"
			hp_high="items/ankh-necklace.png"
			steadfast="items/necklace-stone.png"
			regen="items/ankh-necklace2.png"
			melee_dmg="items/flame-sword-bare.png"
			ranged_dmg="items/bow-crystal-2.png"
			ranged_acc="items/ring-silver.png"
			melee_parry="items/staff-plain.png"
			melee_poison="items/dagger-poison.png"
			melee_slow="items/staff-magic-2.png"
			mp="items/potion-yellow.png"
			feeding="items/book5.png"
			leadership="items/hammer-runic.png"
			drain="items/staff.png"
			defense="items/potion-grey.png"
			skirm="items/potion-blue.png"
			first_strike="items/spear-fancy-2.png"
			fear="items/sword-wraith.png"
			discouragement="items/potion-poison.png"
			burns="items/torch.png"
			golden_armor="items/armor-golden.png"
			heal="items/holy-water.png"
			freezing_gem="items/uws/freezing_gem.png"
			field_disruption="items/uws/disruptor.png"
			armor_destruction="items/uws/cutter.png"
			protection="items/uws/protection.png"
			double_attack="items/bow-elven.png"
			hitn_run="items/uws/cloak.png"
			extra_strikes="items/uws/gauntlets.png"
			rat_pack="items/leather-pack.png"
			icewind_aura="items/uws/icewind.png"
			dragon_protection="items/uws/armor-dragon.png"
		[/value]
		[value] # long description when unit picks the item
			magic_res="Adds resistance to magical attack types.
			
<span color='#5b8742'>Negates Magic</span>: improves magical resistance of all allied units on the map by certain amount."

			cold_res="Adds cold resistance.

<span color='#7375e6'>Time Lock</span>: attack only, both the attacker and defender go into the time lock. For a duration of one turn the defender gets all defenses set to 25% and strikes on all weapons to 1. In addition to that, all adjacent enemies to the attacked unit receive 4 cold damage and get slowed. The attacker gets all defenses set to 25% and all weapons removed. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Infinity Lock</span>: attack only, both the attacker and defender go into the infinity lock. For a duration of one turn the defender can't move, gets all defenses set to 15% and all weapons removed. In addition to that, all enemies within radius 5 from the attacked unit receive 8 cold damage and get slowed. The attacker gets all weapons removed. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Cold Mastery</span>: improves cold resistance and cold damage of all allied units on the map."

			phys_res="Adds resistance to physical attack types.
			
<span color='#5b8742'>Armor Science</span>: reduces physical resistances of all enemies within the vision range from the scientist by certain amount."

			impact_res="Adds impact resistance.

<span color='#7375e6'>Stun</span>: attack only, disrupts enemy's ZOC upon a hit.

<span color='#7375e6'>Crushing Blow</span>: attack only, upon a hit the enemy gets one strike removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Shatter the Bones</span>: attack only, upon a hit the enemy gets 50% of strikes removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Impact Mastery</span>: improves impact resistance and impact damage of all allied units on the map."

			fire_res="Adds fire resistance.

<span color='#7375e6'>Burning Passion</span>: attack only, after killing an enemy this unit gets possessed by burning passion, gets damage increased by 1 point and a chance to attack another enemy. After the turn is finished, all attacks get disabled and all resistances(except fire) and movement drop to 0 for a duration of one turn.

<span color='#7375e6'>Burning Possession</span>: attack only, after killing an enemy this unit gets possessed by infernal passion, receives extra 2 movement points, gets damage increased by 2 points and a chance to attack another enemy. After the turn is finished, all attacks get disabled, all resistances(except fire) drop to 0 and movement is reduced to 3 points for a duration of one turn.

<span color='#5b8742'>Fire Mastery</span>: improves fire resistance and fire damage of all allied units on the map."

			arcane_res="Adds arcane resistance.

<span color='#5b8742'>Mind Tricks</span>: once a fight is finished if both units are still alive then some percentage of the damage received is reflected back onto the enemy as arcane damage. Equally, the same amount is used to heal the wounds received during the fight. Champions and The Butcher of Wesnoth are immune. Active only on offense.

<span color='#7375e6'>Reversed Polarity</span>: attack only, upon a hit the attacker and the defender swap their locations. This stops the attack. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Drains</span>: the unit can drain health from living units, healing itself for a percentage of the amount of damage it deals (rounded down).

<span color='#5b8742'>Arcane Mastery</span>: improves arcane resistance and arcane damage of all allied units on the map."

			blade_res="Adds blade resistance.

<span color='#7375e6'>Duel 2</span>: attack only, fight lasts for an extra round.

<span color='#7375e6'>Battle Trance</span>: attack only, each landing hit increases the damage by 1. Champions and The Butcher of Wesnoth are immune.

<span color='#7375e6'>Overwhelm</span>: attack only, each landing hit increases the damage by 1, while simultaneously decreases opponent's damage by 2(1) if current damage is above 67%(33%). After the attack, opponent's defense and attack accuracy are reduced by 10% for one turn. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Blade Mastery</span>: improves blade resistance and blade damage of all allied units on the map."

			pierce_res="Adds pierce resistance.

<span color='#7375e6'>Impale</span>: attack only, ignores the enemy's pierce resistance. Upon successful hit, the opponent's damage and movement points are reduced by 33% for one turn.

<span color='#7375e6'>No Counter-Attack</span>: attack only, the opponent has a 0% chance of retaliation. Champions, the Butcher of Wesnoth and berserker frenzy units are immune.

<span color='#5b8742'>Pierce Mastery</span>: improves pierce resistance and pierce damage of all allied units on the map."

			hp_low="Provides hitpoints bonus.

<span color='#5b8742'>Immune to Poison</span>: the unit becomes unpoisonable (no effect on undead, mechanical and magical units, etc).

<span color='#5b8742'>Poison Immunity Aura</span>: all allies become immune to poison.

<span color='#5b8742'>Poison Mastery</span>: this unit and all allies become immune to poison. In addition to that at the beginning of it's turn this unit poisons all surrounding enemies. Champions, the Butcher of Wesnoth and non-living units are immune."

			hp_med="Provides hitpoints bonus.

<span color='#5b8742'>Immune to Drains</span>: the unit becomes undrainable (no effect on undead, mechanical and magical units, etc).

<span color='#5b8742'>Drains Immunity Aura</span>: all allies become immune to drain.

<span color='#5b8742'>Draining Mastery</span>: this unit and all allies become immune to drains. In addition to that at the beginning of it's turn this unit drains 4hp while dealing 8dmg to all surrounding enemies. Champions, the Butcher of Wesnoth and non-living units are immune."

			hp_high="Provides hitpoints bonus.

<span color='#5b8742'>Heals All</span> at the beginning of the turn, this unit heals all ally units on the map.

<span color='#5b8742'>Restores All</span> at the beginning of the turn, this unit not only heals all ally units on the map, but also cures, removes slow and unpetrifies them."

			steadfast="Adds steadfast and shielded wall abilities.

<span color='#5b8742'>Steadfast</span> the unitâ€™s resistances are multiplied by a specific factor, up to a maximum value when defending. Vulnerabilities are not affected.

<span color='#5b8742'>Shielded Wall</span> the unit helps adjacent allies to form an impenetrable wall by doubling their resistances up to specific value. Vulnerabilities are not affected."

			regen="Adds regenerates ability.

<span color='#5b8742'>Regenerates</span>: the unit will heal itself some HP amount each turn. If it is poisoned, it will remove the poison instead of healing. In addition to normal healing, the rate of regeneration can be increased if the unit is stationed in a village. There is also a small amount healed when the unit comes out of a fight."

			melee_dmg="Increases damage output on melee weapons.

<span color='#5b8742'>Fearless</span>: fights normally during unfavorable times of day/night.

<span color='#7375e6'>Battle Fury</span>: with each successful hit the damage increases by given amount. If the unit misses, the counter is reset."

			ranged_dmg="Increases damage output on ranged weapons.

<span color='#7375e6'>Ruthless</span>: adds 1 ranged strike against enemies with no ranged attacks. Attack only.

<span color='#7375e6'>Merciless</span>: adds 3 ranged strikes against enemies with no ranged attacks. Attack only."

			ranged_acc="Increases accuracy of ranged weapons.
DOES <span color='#ff0000'>NOT</span> WORK on enchanted, magical, precision and ubiquitous attacks. Only regular and marksman attacks benefit from this artifact.

<span color='#7375e6'>Concentration</span>: with each successful hit, the accuracy of the next shot improves by a certain amount. Attack only."

			melee_parry="Improves parry on melee weapons and adds counterbalance on melee.

<span color='#7375e6'>Counterbalance</span>: when defending, each time this unit dodges a melee attack it has a chance to retaliate multiple times before enemy can attack again. Retaliations deal 50% of the base damage and all weapon specials are disabled.

<span color='#5b8742'>Peaceful Warrior</span>: when defending this unit will never deal the fatal blow and kill the enemy. Instead it will disarm them by leaving 1hp and removing all weapons for a duration of one turn."

			melee_poison="Adds poison, accuracy and backstab to melee weapons.

<span color='#7375e6'>Poison</span>: the attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit.

<span color='#7375e6'>Backstab</span>: when used offensively, this attack deals more damage if there is an enemy of the target on the opposite side of the target."

			melee_slow="Adds slow and heal on hit on melee weapons.

<span color='#7375e6'>Slow</span>: the attack slows the target until it ends a turn. Slow halves the damage caused by attacks and the movement cost for a slowed unit is doubled.

<span color='#5b8742'>Stillness Aura</span>: When defending against melee attacks, the opponent is slowed automatically when it hits. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Lesser Chronosphere</span>: when defending against melee attacks, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune.

<span color='#5b8742'>Chronosphere</span>: when defending, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."

			mp="Increases movement points.

<span color='#5b8742'>Slow Immunity</span>: the unit becomes unslowable.

<span color='#5b8742'>Slow Immunity Aura</span>: all allies become immune to slow.

<span color='#5b8742'>Motility Mastery</span>: this unit and all allies become immune to slow. In addition to that at the beginning of this unit's turn all surrounding enemies become immobilised. Affected units lose their zone of control. Champions, the Butcher of Wesnoth and unslowable units are immune."

			feeding="Adds delumination, magical feeding and raises the undead abilities. Changes the unit's alignment to chaotic.

<span color='#5b8742'>Deluminates</span>: This unit obscures the surrounding area, making chaotic units fight better, and lawful units fight worse.

<span color='#5b8742'>Magical Feeding</span>: the unit gains extra hitpoints whenever it kills a unit, regardless of it's living status. The number of hitpoints added depends on the level of the unit killed capped with the maximum allowed.

<span color='#5b8742'>Raises the Undead</span>: at the beginning of the turn, this unit has a chance to summon an undead minion. The strength of the summoned units is somewhat random, while the level and the chance depend on the promotion rank."

			leadership="Adds leadership ability.

<span color='#5b8742'>Leadership</span>: the unit can lead ally units that are next to it, making them fight better. Affects units of the same or lower level increasing their damage by the same percentage regardless of their level difference.

<span color='#5b8742'>Leads by Example</span>: whenever this unit attacks a champion, or a regular enemy of the same or higher level with more than 50% hitpoints, then all units of the same side that haven't attacked yet receive +1mp and a damage bonus until the end of the turn.

<span color='#5b8742'>Great Leader</span>: whenever this unit kills an enemy all surrounding allied units receive experience points based on the level of the killed unit and the skill of the leader.

<span color='#5b8742'>Fearless</span>: fights normally during unfavorable times of day/night."

			drain="Adds drains on ranged. Does not negatively impact xp mod costs.

<span color='#7375e6'>Drains</span>: the unit can drain health from living units, healing itself for a percentage of the amount of damage it deals (rounded down). On higher ranks it can also drain energy from non-living units.

<span color='#7375e6'>Wicked</span>: when used offensively at nighttime, this attack deals more damage to living units.

<span color='#7375e6'>Unholy</span>: when used at nighttime, this attack deals more damage to living units. Active on all weapons, both in offense and defense."

			defense="Increases defense on all terrain types and improves movement costs.

<span color='#5b8742'>Terrain Mastery</span>: all ally units gain +5% defense everywhere and improve movement costs by 1."

			skirm="Adds skirmisher ability and movement points.

<span color='#5b8742'>Skirmisher</span>: the unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control.

<span color='#5b8742'>Battle Fervor</span>: increases the movement points of all ally units.

<span color='#5b8742'>Enemy Control</span>: all allied units learn how to ignore enemies' zones of control."

			first_strike="Adds first strike ability.

<span color='#7375e6'>First Strike</span>: always strikes first, even when defending.

<span color='#7375e6'>Preemptive Strike</span>: when attacking you strike twice before the enemy can retaliate. Champions and the Butcher of Wesnoth are immune.

<span color='#7375e6'>Initiative</span>: when attacking and defending you strike twice before the enemy. Champions and the Butcher of Wesnoth are immune.

<span color='#5b8742'>Eagerness Aura</span>: all surrounding allies gain first strike on all attacks."

			fear="Adds necromancer's bane ability.

<span color='#5b8742'>Necromancer's Bane</span>: when attacking, the defender retaliates with reduced damage. After the fight is over enemies up to a certain level within defined range have their damage reduced for one turn. The damage reduction is higher if the opponent dies during the fight. Champions, Butcher of Wesnoth, fearless units, and leaders receive half of the damage reduction.

<span color='#5b8742'>Fearless</span>: fights normally during unfavorable times of day/night.

<span color='#7375e6'>Heal on Hit</span>: each landing hit restores some small amount of hp."

			discouragement="Reduces the attacker's damage output.

<span color='#7375e6'>Dishearten</span>: this attack reduces the opponent's damage. Champions and the Butcher of Wesnoth are immune.

<span color='#7375e6'>Discourage</span>: when defending reduces opponent's strikes. Champions and the Butcher of Wesnoth are immune.

<span color='#5b8742'>Corrupts</span>: adds corruption weapon, 1x1 always hits. When used the enemy will either change sides or become enraged and it's damage will increase by 40%. The chance of conversion depends on the difference in levels between the corrupting and the corrupted unit. If the levels are the same it's 50% - 50%. Each point of difference in levels affects the chances by 20%. Champions, the Butcher of Wesnoth and recruiting units are immune. Available only on offense. Number of owned corrupted units is limited to 1."

			burns="Adds Secret Fire and Fire Sight abilities and increases fire resistance.

<span color='#5b8742'>Secret Fire</span>: deals fire damage to all surrounding enemies at the beginning of your turn. Deals additional damage to the attacker when defending. The amount of damage dealt depends on the Time of Day bonus according to the item keeper's alignment.

<span color='#5b8742'>Fire Vision</span>: increases vision points of all allied units."

			golden_armor="Provides extra resistance.

<span color='#5b8742'>Reflects</span>: when defending, some percentage of received damage is reflected back to the attacker."

			heal="Adds heals and treat wounded abilities, small arcane resistance bonus and distinguished trait.

<span color='#5b8742'>Heals</span>: all surrounding allies are healed and poison removed at the beginning of this unit's turn.

<span color='#5b8742'>Treats Wounded</span>: any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow. The cost of recalling is 40/30/20 gold respectively.

<span color='#5b8742'>Distinguished</span>: this unit can become a new side leader if one dies, even if the leader cannot die according to the game settings."

			freezing_gem="Improves cold resistance and adds freezing touch special for melee.

<span color='#7375e6'>Freezing Touch</span>: With each successful hit, opponent's defense is reduced by given amount for one turn. Minimum defense is 15%. Melee only."

			field_disruption="Adds field disruption and phase disruption abilities.

<span color='#5b8742'>Field Disruption</span>: all surrounding enemies have their magic resistances reduced by given amount. Champions receive half the effect.

<span color='#5b8742'>Phase Disruption</span>: surrounding non-champion enemies have their magical chance to hit reduced by given amount. Conversely surrounding ally units have their magical chance to hit increased by the same amount."

			armor_destruction="Improves melee damage and adds adds melee armor destruction special.

<span color='#7375e6'>Armor Destruction</span>: with each successful hit, opponent's resistance to the weapons type is permanently decreased by given amount. Melee only."

			protection="Adds protection, defensive wall and impenetrable wall abilities.

<span color='#5b8742'>Protection</span>: surrounding allied units have their physical resistances improved by given amount.

<span color='#5b8742'>Defensive Wall</span>: surrounding allied units deal higher melee damage when defending.

<span color='#5b8742'>Impenetrable Wall</span>: surrounding allied units deal higher damage when defending."

			double_attack="Adds double attack on ranged.

<span color='#7375e6'>Double Attack</span>: the unit can fire ranged attacks twice in single turn, once the ability is charged. Each offensive use of double-attack weapon adds a single charge.

<span color='#7375e6'>Sharpshooter</span>: when used offensively each attack has a chance to pierce through the enemy and deal damage to the enemy behind. Champions and the Butcher of Wesnoth are immune."

			hitn_run="Adds nightstalk, kill and run, hit and run and cover of the night abilities and specials.

<span color='#5b8742'>Nighstalk</span>: the unit is invisible to the enemies during nighttime.

<span color='#5b8742'>Kill and Run</span>: this unit gains extra movement point(s) after killing an enemy.

<span color='#5b8742'>Hit and Run</span>: this unit gains extra movement point(s) after attacking an enemy.

<span color='#7375e6'>Cover of the Night</span>: when used during the night against a distracted enemy then the damage is increased by 50% and the enemy cannot retaliate. Champions and the Butcher of Wesnoth are immune and so are opponents with berserker frenzy. This attack to be available requires the move points to be below the maximum move points."

			extra_strikes="Adds extra strikes and small non-magical accuracy bonus.

<span color='#7375e6'>Extra Strikes</span>: increases number of strikes based on the promotion rank and unit's hitpoints."

			rat_pack="Adds breeds rats ability.

<span color='#5b8742'>Breeds Rats</span>: spawns an allied rat next to this unit once every few turns. Maximum of 4 rats at a time. On higher ranks there is a chance of spawning a special rat.

<span color='#7375e6'>Plague</span>: when killing a living enemy that enemy is replaced with a rat."

			icewind_aura="Adds icewind aura ability.

<span color='#5b8742'>Icewind Aura</span>: at the beginning of your turn all enemies within radius get their mp reduced by 30%, defenses by a small amount and also receive damage.
Applies only to units of the same or lower level as the unit wearing this item. Champions and The Butcher of Wesnoth are immune.
Movement points cannot drop below 3."

			dragon_protection="Adds dragon's protection ability.

<span color='#5b8742'>Dragon's Protection</span>: when this unit is dying the Dragon's Protection revives it, restoring some hitpoints. Because of how much magical energy this requires, this can only trigger when the unit's hp is below certain point. A unit can only be revived once per turn (the counter refreshes at the beginning of the player's turn). Passively increases resistance to all common weapon types by 15% and against the secret attacks by 35%."

		[/value]
		[value] # short description for all items menu
			magic_res="Provides extra resistance to magical attack types.
Adds Negates Magic ability."
			cold_res="Provides extra cold resistance.
Adds Time Dilation weapon.
Adds Cold Mastery ability."
			phys_res="Provides extra resistance to physical attack types.
Adds Armor Science ability."
			impact_res="Provides extra impact resistance.
Adds Crush Their Souls weapon.
Adds Impact Mastery ability."
			fire_res="Provides extra fire resistance.
Adds Wrath of Fire weapon.
Adds Fire Mastery ability."
			arcane_res="Provides extra arcane resistance.
Adds Unknown Force weapon.
Adds Mind Tricks ability.
Adds Arcane Mastery ability."
			blade_res="Provides extra blade resistance.
Adds Berserker's Fury weapon.
Adds Blade Mastery ability."
			pierce_res="Provides extra pierce resistance.
Adds Atrocious Impalement weapon.
Adds Pierce Mastery ability."
			hp_low="Provides low hitpoints bonus.
Adds poison mastery."
			hp_med="Provides medium hitpoints bonus.
Adds draining mastery."
			hp_high="Provides high hitpoints bonus.
Adds Heals All ability.
Adds Protects All ability."
			steadfast="Adds Steadfast ability.
Adds Shielded Wall ability."
			regen="Adds Regenerates ability."
			melee_dmg="Increases damage output on melee weapons.
Adds Battle Fury on melee.
Adds Fearless trait."
			ranged_dmg="Increases damage output on ranged weapons.
Adds Ruthless on ranged.
Adds Merciless on ranged."
			ranged_acc="Increases accuracy of ranged weapons.
DOES NOT WORK on magical attacks.
Adds Concentration on ranged."
			melee_parry="Improves parry on melee weapons.
Adds Counterbalance on melee.
Adds Peaceful Warrior ability."
			melee_poison="Adds poison, accuracy and backstab on melee."
			melee_slow="Adds slow on melee.
Adds Chronosphere ability."
			mp="Adds movement points.
Adds motility mastery."
			feeding="Adds Delumination ability.
Adds Magical Feeding ability.
Adds Raises the Undead ability."
			leadership="Adds Leadership ability.
Adds Leads by Example ability.
Adds Great Leader ability.
Adds Fearless trait."
			drain="Adds Drain on ranged.
Adds Wicked on ranged.
Adds Unholy on all attacks."
			defense="Improves defense and movement costs.
Adds Terrain Mastery ability."
			skirm="Adds skirmisher ability.
Adds movement points.
Adds Battle Fervor ability.
Adds Enemy Control ability."
			first_strike="Adds First Strike special.
Adds Preemptive Strike special.
Adds Initive special.
Adds Eagerness Aura special."
			fear="Adds Necromancer's Bane ability.
Adds Fearless trait.
Adds Heal on Hit on melee."
			discouragement="Adds Dishearten special.
Adds Discourage special.
Adds Corrupts special."
			burns="Adds small fire resistance.
Adds Secret Fire ability.
Adds Fire Vision ability."
			golden_armor="Provides extra resistance.
Adds Reflects ability."
			heal="Adds Heals ability.
Adds Treats Wounded ability.
Adds Distinguished trait."
			freezing_gem="Adds Freezing Touch special for melee."
			field_disruption="Adds Field Disruption ability.
Adds Phase Disruption ability"
			armor_destruction="Adds Armor Destruction for melee."
			protection="Adds Protection ability.
Adds Defensive Wall ability.
Adds Impenetrable Wall ability."
			double_attack="Adds Double Attack special for ranged.
Adds Sharpshooter special for ranged."
			hitn_run="Adds Kill and Run ability on lower ranks.
Adds Hit and Run ability on higher ranks.
Adds Nighstalk ability.
Adds Cover of the Night weapon special."
			extra_strikes="Adds Extra Strikes ability."
			rat_pack="Adds Breeds Rats ability.
Adds Plague special on melee."
			icewind_aura="Adds Icewind Aura ability."
			dragon_protection="Adds Dragon's Protection ability"

		[/value]
		[value] # steps description when unit picks the item
			magic_res="$band_none_text +5 magic resistance
$band_initiated_text +10 magic resistance
$band_proven_text +15 magic resistance
$band_notable_text +20 magic resistance, <span color='#5b8742'>negates magic 5</span>
$band_significant_text +25 magic resistance, <span color='#5b8742'>negates magic 10</span>
$band_epic_text +35 magic resistance, <span color='#5b8742'>negates magic 20</span>"

			cold_res="$band_none_text +10 cold resistance
$band_initiated_text +20 cold resistance
$band_proven_text +30 cold resistance
$band_notable_text +40 cold resistance, 6x2 ranged weapon (<span color='#7375e6'>slow, magical</span>)
$band_significant_text +60 cold resistance, 7x3 ranged weapon (<span color='#7375e6'>slow, magical, time lock</span>)
$band_epic_text +85 cold resistance, <span color='#5b8742'>cold mastery</span>, 11x3 ranged weapon (<span color='#7375e6'>slow, magical, infinity lock</span>)"

			phys_res="$band_none_text +5 physical resistance
$band_initiated_text +10 physical resistance
$band_proven_text +15 physical resistance
$band_notable_text +20 physical resistance, <span color='#5b8742'>armor science 5</span>
$band_significant_text +25 physical resistance, <span color='#5b8742'>armor science 10</span>
$band_epic_text +35 physical resistance, <span color='#5b8742'>armor science 20</span>"

			impact_res="$band_none_text +10 impact resistance
$band_initiated_text +20 impact resistance
$band_proven_text +30 impact resistance
$band_notable_text +40 impact resistance, 16x2 melee weapon (<span color='#7375e6'>stun</span>)
$band_significant_text +60 impact resistance, 24x2 melee weapon (<span color='#7375e6'>crushing blow</span>)
$band_epic_text +85 impact resistance, <span color='#5b8742'>impact mastery</span>, 36x2 melee weapon (<span color='#7375e6'>shatter the bones</span>)"

			fire_res="$band_none_text +10 fire resistance
$band_initiated_text +20 fire resistance
$band_proven_text +30 fire resistance
$band_notable_text +40 fire resistance, 9x3 melee weapon (<span color='#7375e6'>magical</span>)
$band_significant_text +60 fire resistance, 10x4 melee weapon (<span color='#7375e6'>magical, burning passion</span>)
$band_epic_text +85 fire resistance, <span color='#5b8742'>fire mastery</span>, 11x5 melee weapon (<span color='#7375e6'>magical, burning possession</span>)"

			arcane_res="$band_none_text +10 arcane resistance
$band_initiated_text +20 arcane resistance
$band_proven_text +30 arcane resistance
$band_notable_text +40 arcane resistance, 12x2 melee weapon (<span color='#7375e6'>magical</span>), potent ability (<span color='#5b8742'>mind tricks 20%</span>)
$band_significant_text +60 arcane resistance, 14x2 melee weapon (<span color='#7375e6'>precission, reversed polarity, drains 50%</span>), strong ability (<span color='#5b8742'>mind tricks 35%</span>)
$band_epic_text +85 arcane resistance, <span color='#5b8742'>arcane mastery</span>, 16x2 melee weapon (<span color='#7375e6'>unavoidable, reversed polarity, drains 100%</span>), powerful ability (<span color='#5b8742'>mind tricks 50%</span>)"

			blade_res="$band_none_text +10 blade resistance
$band_initiated_text +20 blade resistance
$band_proven_text +30 blade resistance
$band_notable_text +40 blade resistance, 6x5 melee weapon (<span color='#7375e6'>marksman, duel 2</span>)
$band_significant_text +60 blade resistance, 7x6 melee weapon (<span color='#7375e6'>marksman, duel 2, battle trance</span>)
$band_epic_text +85 blade resistance, <span color='#5b8742'>blade mastery</span>, 8x7 melee weapon (<span color='#7375e6'>marksman, duel 2, overwhelm</span>)"

			pierce_res="$band_none_text +10 pierce resistance
$band_initiated_text +20 pierce resistance
$band_proven_text +30 pierce resistance
$band_notable_text +40 pierce resistance, 13x2 melee weapon (<span color='#7375e6'>charge</span>)
$band_significant_text +60 pierce resistance, 16x2 melee weapon (<span color='#7375e6'>charge, impale</span>)
$band_epic_text +85 pierce resistance, <span color='#5b8742'>pierce mastery</span>, 18x2 melee weapon (<span color='#7375e6'>charge, impale, no counter-attack</span>)"

			hp_low="$band_none_text hp +10%
$band_initiated_text hp +20%
$band_proven_text hp +30%
$band_notable_text hp +40%, <span color='#5b8742'>immune to poison</span>
$band_significant_text hp +50%, <span color='#5b8742'>poison immunity aura</span>
$band_epic_text hp +60%, <span color='#5b8742'>poison mastery</span>"

			hp_med="$band_none_text hp +10%
$band_initiated_text hp +20%
$band_proven_text hp +30%
$band_notable_text hp +40%, <span color='#5b8742'>immune to drains</span>
$band_significant_text hp +50%, <span color='#5b8742'>drains immunity aura</span>
$band_epic_text hp +60%, <span color='#5b8742'>draining mastery</span>"

			hp_high="$band_none_text hp +10%
$band_initiated_text hp +20%
$band_proven_text hp +30%
$band_notable_text hp +40%, <span color='#5b8742'>heals all +2</span>
$band_significant_text hp +50%, <span color='#5b8742'>heals all +4</span>
$band_epic_text hp +60%, <span color='#5b8742'>restores all +8</span>"

			steadfast="$band_none_text x1.5 25% max
$band_initiated_text x1.75 40% max
$band_proven_text x2 50% max
$band_notable_text x2 50% max, <span color='#5b8742'>shielded wall 20%</span> 
$band_significant_text x2.25 60% max, <span color='#5b8742'>shielded wall 30%</span> 
$band_epic_text x2.5 75% max, <span color='#5b8742'>shielded wall 40%</span>"

			regen="$band_none_text regen +2
$band_initiated_text regen +4
$band_proven_text regen +8
$band_notable_text regen +10 (village +14, fight +2)
$band_significant_text regen +14 (village +20, fight +4)
$band_epic_text regen +20 (village +28, fight +8)"

			melee_dmg="$band_none_text melee dmg +7%
$band_initiated_text melee dmg +15%
$band_proven_text melee dmg +25%
$band_notable_text melee dmg +33%, <span color='#7375e6'>battle fury +10%</span>
$band_significant_text melee dmg +40%, <span color='#7375e6'>battle fury +15%</span>
$band_epic_text melee dmg +50%, <span color='#5b8742'>fearless</span>, <span color='#7375e6'>battle fury +22%</span>"

			ranged_dmg="$band_none_text ranged dmg +7%
$band_initiated_text ranged dmg +15%
$band_proven_text ranged dmg +25%
$band_notable_text ranged dmg +33%, <span color='#7375e6'>ruthless</span>
$band_significant_text ranged dmg +40%, <span color='#7375e6'>ruthless</span>
$band_epic_text ranged dmg +50%, <span color='#7375e6'>merciless</span>"

			ranged_acc="$band_none_text ranged accuracy +3
$band_initiated_text ranged accuracy +5
$band_proven_text ranged accuracy +7
$band_notable_text ranged accuracy +9, <span color='#7375e6'>concentration +3</span>
$band_significant_text ranged accuracy +12, <span color='#7375e6'>concentration +6</span>
$band_epic_text ranged accuracy +15, <span color='#7375e6'>concentration +9</span>"

			melee_parry="$band_none_text melee parry +3
$band_initiated_text melee parry +5
$band_proven_text melee parry +7
$band_notable_text melee parry +9, <span color='#7375e6'>counterbalance 30</span>
$band_significant_text melee parry +12, <span color='#7375e6'>counterbalance 40</span>
$band_epic_text melee parry +15, <span color='#7375e6'>counterbalance 50</span>, <span color='#5b8742'>peaceful warrior</span>"

			melee_poison="$band_none_text melee <span color='#7375e6'>poison</span> (lower level only)
$band_initiated_text melee <span color='#7375e6'>poison</span> (same and lower level only)
$band_proven_text melee <span color='#7375e6'>poison</span>
$band_notable_text melee accuracy +1, <span color='#7375e6'>poison, backstab x1.25</span>
$band_significant_text melee accuracy +3, <span color='#7375e6'>poison, backstab x1.5</span>
$band_epic_text melee accuracy +5, <span color='#7375e6'>poison, backstab x2</span>"

			melee_slow="$band_none_text melee <span color='#7375e6'>slow</span> (day only)
$band_initiated_text melee <span color='#7375e6'>slow</span> (day, dawn and dusk)
$band_proven_text melee <span color='#7375e6'>slow</span>
$band_notable_text melee <span color='#7375e6'>slow</span>, <span color='#5b8742'>stillness aura</span>
$band_significant_text melee <span color='#7375e6'>slow</span>, <span color='#5b8742'>lesser chronosphere</span>
$band_epic_text melee <span color='#7375e6'>slow</span>, <span color='#5b8742'>chronosphere</span>"

			mp="$band_none_text +1mp
$band_initiated_text +1mp
$band_proven_text +2mp
$band_notable_text +2mp, <span color='#5b8742'>slow immunity</span>
$band_significant_text +3mp, <span color='#5b8742'>slow immunity aura</span>
$band_epic_text +4mp, <span color='#5b8742'>motility mastery</span>"

			feeding="$band_none_text deluminates -5
$band_initiated_text deluminates -15
$band_proven_text deluminates -25
$band_notable_text deluminates -25, feeding +1hp, 15% to summon lvl0 undead
$band_significant_text deluminates -30, feeding +2hp, 17% to summon lvl1 undead
$band_epic_text deluminates -35, feeding +3hp, 19% to summon lvl2 undead"

			leadership="$band_none_text leadership 15%
$band_initiated_text leadership 20%
$band_proven_text leadership 25%
$band_notable_text leadership 25%, <span color='#5b8742'>leads by example 15%</span>
$band_significant_text leadership 30%, <span color='#5b8742'>leads by example 25%, great leader 25%</span>
$band_epic_text leadership 35%, <span color='#5b8742'>leads by example 35%, great leader 50%, fearless</span>"

			drain="$band_none_text drains 20%
$band_initiated_text drains 35%
$band_proven_text drains 50%
$band_notable_text drains 55%(20% non-living), <span color='#7375e6'>wicked x1.15</span>
$band_significant_text drains 65%(30% non-living), <span color='#7375e6'>wicked x1.25</span>
$band_epic_text drains 75%(40% non-living), <span color='#7375e6'>unholy x1.35</span>"

			defense="$band_none_text defense +1%
$band_initiated_text defense +3%
$band_proven_text defense +5%
$band_notable_text defense +6%, -1 movement cost
$band_significant_text defense +8%, -2 movement cost
$band_epic_text defense +10%, -3 movement cost, <span color='#5b8742'>terrain mastery</span>"

			skirm="$band_none_text nighttime only skirmisher
$band_initiated_text dawn, dusk and night skirmisher
$band_proven_text skirmisher
$band_notable_text skirmisher, +1mp
$band_significant_text skirmisher, +2mp, <span color='#5b8742'>battle fervor +1</span>
$band_epic_text skirmisher, +2mp, <span color='#5b8742'>battle fervor +2</span>, <span color='#5b8742'>enemy control</span>"

			first_strike="$band_none_text melee first strike against lower level units
$band_initiated_text melee first strike
$band_proven_text first strike
$band_notable_text first strike, <span color='#7375e6'>preemptive strike 50%</span>
$band_significant_text first strike, <span color='#7375e6'>preemptive strike 75%</span>
$band_epic_text first strike, <span color='#7375e6'>initiative</span>, <span color='#5b8742'>eagerness aura</span>"

			fear="$band_none_text 5% attack, 0%(10%) adjacent lvl0
$band_initiated_text 5% attack, 5%(10%) adjacent max lvl1
$band_proven_text 10% attack, 5%(15%) radius 2 max lvl2
$band_notable_text 15% attack, 10%(20%) radius 3 max lvl3, melee <span color='#7375e6'>+1 heal on hit</span>
$band_significant_text 20% attack, 10%(25%) radius 4 max lvl4, melee <span color='#7375e6'>+2 heal on hit</span>
$band_epic_text 25% attack, 15%(30%) radius 5 max lvl5, melee <span color='#7375e6'>+3 heal on hit</span>, <span color='#5b8742'>fearless</span>"

			discouragement="$band_none_text melee dishearten -10%
$band_initiated_text melee dishearten -15%
$band_proven_text dishearten -20%
$band_notable_text dishearten -20%, <span color='#7375e6'>melee discourage -1</span>
$band_significant_text dishearten -25%, <span color='#7375e6'>discourage -1</span>
$band_epic_text dishearten 30%, <span color='#7375e6'>discourage -1</span>, <span color='#5b8742'>corrupts</span>"

			burns="$band_none_text secret fire 2, 5% fire res
$band_initiated_text secret fire 4, 5% fire res
$band_proven_text secret fire 8, 5% fire res
$band_notable_text secret fire 8(8), <span color='#5b8742'>fire vision +1</span>, 15% fire res
$band_significant_text secret fire 12(12), <span color='#5b8742'>fire vision +2</span>, 15% fire res
$band_epic_text secret fire 16(16), <span color='#5b8742'>fire vision +3</span>, 25% fire res"

			golden_armor="$band_none_text all resistance +3
$band_initiated_text all resistance +6
$band_proven_text all resistance +10
$band_notable_text all resistance +12, <span color='#5b8742'>reflects 15%</span>
$band_significant_text all resistance +15, <span color='#5b8742'>reflects 30%</span>
$band_epic_text all resistance +20, <span color='#5b8742'>reflects 50%</span>"

			heal="$band_none_text heals +2, +5% arcane res
$band_initiated_text heals +4, +5% arcane res
$band_proven_text heals +8, +5% arcane res
$band_notable_text heals +10, +15% arcane res, <span color='#5b8742'>treats wounded 40</span>
$band_significant_text heals +14, +15% arcane res, <span color='#5b8742'>treats wounded 30</span>
$band_epic_text heals +18, +25% arcane res, <span color='#5b8742'>treats wounded 20, distinguished</span>"

			freezing_gem="$band_none_text <span color='#7375e6'>freezing touch -1</span>, +5% cold resistance
$band_initiated_text <span color='#7375e6'>freezing touch -2</span>, +5% cold resistance
$band_proven_text <span color='#7375e6'>freezing touch -3</span>, +5% cold resistance
$band_notable_text <span color='#7375e6'>freezing touch -4</span>, +15% cold resistance
$band_significant_text <span color='#7375e6'>freezing touch -5</span>, +15% cold resistance
$band_epic_text <span color='#7375e6'>freezing touch -6</span>, +25% cold resistance"

			field_disruption="$band_none_text field -5
$band_initiated_text field -10
$band_proven_text field -15
$band_notable_text field -20, <span color='#5b8742'>phase 5</span>
$band_significant_text field -25, <span color='#5b8742'>phase 10</span>
$band_epic_text field -30, <span color='#5b8742'>phase 15</span>"

			armor_destruction="$band_none_text <span color='#7375e6'>armor destruction -1</span>, +1 melee damage
$band_initiated_text <span color='#7375e6'>armor destruction -2</span>, +1 melee damage
$band_proven_text <span color='#7375e6'>armor destruction -3</span>, +1 melee damage
$band_notable_text <span color='#7375e6'>armor destruction -4</span>, +2 melee damage
$band_significant_text <span color='#7375e6'>armor destruction -5</span>, +2 melee damage
$band_epic_text <span color='#7375e6'>armor destruction -6</span>, +3 melee damage"

			protection="$band_none_text protection +5
$band_initiated_text protection +10
$band_proven_text protection +15
$band_notable_text protection +20, <span color='#5b8742'>defensive wall x1.15</span>
$band_significant_text protection +25, <span color='#5b8742'>defensive wall x1.3</span>
$band_epic_text protection +30, <span color='#5b8742'>impenetrable wall x1.5</span>"

			double_attack="$band_none_text 8 to charge
$band_initiated_text 7 to charge
$band_proven_text 6 to charge
$band_notable_text 5 to charge, <span color='#7375e6'>sharpshooter 30%</span>
$band_significant_text 4 to charge, <span color='#7375e6'>sharpshooter 50%</span>
$band_epic_text 3 to charge, <span color='#7375e6'>sharpshooter 70%</span>"

			hitn_run="$band_none_text nightstalk
$band_initiated_text nightstalk, <span color='#5b8742'>kill and run +1</span>
$band_proven_text nightstalk, <span color='#5b8742'>kill and run +1</span>
$band_notable_text nightstalk, <span color='#5b8742'>hit and run +1</span>
$band_significant_text nightstalk, <span color='#5b8742'>hit and run +2</span>
$band_epic_text nightstalk, <span color='#5b8742'>hit and run +3</span>, <span color='#7375e6'>cover of the night</span>"

			extra_strikes="$band_none_text extra strike below 50% hp
$band_initiated_text extra strikes below 65% and 30% hp
$band_proven_text +1 strike
$band_notable_text +1 strike, extra below 50% hp, +2 accuracy
$band_significant_text +1 strike, extra below 65% and 30% hp, +3 accuracy
$band_epic_text +2 strikes, extra below 50%, +5 accuracy"

			rat_pack="$band_none_text a rat spawns every 6 turns
$band_initiated_text a rat spawns every 5 turns
$band_proven_text a rat spawns every 4 turns
$band_notable_text a rat spawns every 4 turns, 50% chance to be a special rat
$band_significant_text a rat spawns every 3 turns, 75% to be a special rat
$band_epic_text a special rat spawns every 2 turns, plague on melee"

			icewind_aura="$band_none_text adjacent units only
$band_initiated_text within 2 radius
$band_proven_text within 3 radius
$band_notable_text within 5 radius, passive 2 cold damage, defenses -2%
$band_significant_text within 7 radius, passive 4 cold damage, defenses -5%
$band_epic_text within 9 radius, passive 8 cold damage, defenses -10%"

			dragon_protection="$band_none_text below 5hp to trigger, restores 1hp
$band_initiated_text below 10hp to trigger, restores 5hp
$band_proven_text below 15hp to trigger, restores 10hp
$band_notable_text below 25hp to trigger, restores 15hp
$band_significant_text below 35hp to trigger, restores 25hp
$band_epic_text always active, restores 35hp"
		[/value]
	[/set_variables]
#enddef

#define SHOW_ITEM_PICKUP_MESSAGE ITEM_ID IMAGE TEXT
	[message]
		speaker=narrator
		message={TEXT}
		image={IMAGE}

		[option]
			label="Yes"

			[command]
				{VARIABLE item_append_id {ITEM_ID}}

				[if]
					[variable]
						name=item_append_id
						not_equals=""
					[/variable]
					[then]
						[fire_event]
							name=append_item_variables
							[primary_unit]
								x,y=$x1,$y1
							[/primary_unit]
						[/fire_event]

						[fire_event]
							name=promote_unit
							[primary_unit]
								x,y=$x1,$y1
							[/primary_unit]
						[/fire_event]
					[/then]
				[/if]

				[remove_item]
					x,y=$x1,$y1
					image={IMAGE}
				[/remove_item]
				
				{VARIABLE allow_undo no}
				{CLEAR_VARIABLE scrollable_items[$item_list_key]}
				{VARIABLE_OP item_list_key sub 1}
			[/command]
		[/option]

		[option]
			label="No"

			[command][/command]
		[/option]
	[/message]
#enddef

#define QQUWS_ITEMS
	[event]
		name=drop_new_item
		first_time_only=no
		
		{VARIABLE drop_item_image $items_steps[3].$item_type_id}
		[if]
			[variable]
				name=overwrite_item_image
				not_equals=""
			[/variable]
			[then]
				{VARIABLE drop_item_image $overwrite_item_image}
			[/then]
		[/if]
		
		[if]
			[variable]
				name=render_new_item
				boolean_equals=yes
			[/variable]
			[then]
				[item]
					x,y=$item_x,$item_y
					image=$drop_item_image
				[/item]
			[/then]
		[/if]

		[set_variables]
			name=scrollable_items
			mode=append
			[value]
				cat=item
				x=$item_x
				y=$item_y
				image=$drop_item_image
				type=$item_type_id
				render=yes
			[/value]
		[/set_variables]
		
		{CLEAR_VARIABLE overwrite_item_image}
	[/event]
	
	[event]
		name=add_extra_item_gold
		first_time_only=no
		
		[store_gold]
			side=$side_number
			variable=gold
		[/store_gold]
		
		[if]
			[variable]
				name=gold
				less_than=0
			[/variable]
			[then]
				[set_variable]
					name=gold
					multiply=-1
				[/set_variable]
				[gold]
					side=$side_number
					amount=$gold
				[/gold]
			[/then]
		[/if]
		
	        [gold]
	     	   side=$side_number
	     	   amount=25
	        [/gold]
	[/event]
#enddef

#define QQUWS_PROMOTE_UNIT
	[event]
		name=generate_promotion_rank_variables
		first_time_only=no
		
		{VARIABLE promotion_label none}
		{VARIABLE promotion_level 0}
		{VARIABLE promotion_def_suffix "/$threshold_initiated"}
		{VARIABLE promotion_colour $rank_none_color}
		{VARIABLE next_promo_label "/ next level"}
		{VARIABLE promo_bonus_dmg 0}
		{VARIABLE unit_items_names ""}

		[if]
			[variable]
				name=unit.variables.kills
				greater_than_equal_to=$threshold_epic
			[/variable]
			[then]
				{VARIABLE promotion_label epic}
				{VARIABLE promotion_level 5}
				{VARIABLE promotion_def_suffix ""}
				{VARIABLE promotion_colour $rank_epic_color}
				{VARIABLE next_promo_label ""}
				{VARIABLE promo_bonus_dmg 65}
			[/then]
			[else]
				[if]
					[variable]
						name=unit.variables.kills
						greater_than_equal_to=$threshold_significant
					[/variable]
					[then]
						{VARIABLE promotion_label significant}
						{VARIABLE promotion_level 4}
						{VARIABLE promotion_def_suffix "/$threshold_epic"}
						{VARIABLE promotion_colour $rank_significant_color}
						{VARIABLE promo_bonus_dmg 45}
					[/then]
					[else]
						[if]
							[variable]
								name=unit.variables.kills
								greater_than_equal_to=$threshold_notable
							[/variable]
							[then]
								{VARIABLE promotion_label notable}
								{VARIABLE promotion_level 3}
								{VARIABLE promotion_def_suffix "/$threshold_significant"}
								{VARIABLE promotion_colour $rank_notable_color}
								{VARIABLE promo_bonus_dmg 33}
							[/then]
							[else]
								[if]
									[variable]
										name=unit.variables.kills
										greater_than_equal_to=$threshold_proven
									[/variable]
									[then]
										{VARIABLE promotion_label proven}
										{VARIABLE promotion_level 2}
										{VARIABLE promotion_def_suffix "/$threshold_notable"}
										{VARIABLE promotion_colour $rank_proven_color}
										{VARIABLE promo_bonus_dmg 20}
									[/then]
									[else]
										[if]
											[variable]
												name=unit.variables.kills
												greater_than_equal_to=$threshold_initiated
											[/variable]
											[then]
												{VARIABLE promotion_label initiated}
												{VARIABLE promotion_level 1}
												{VARIABLE promotion_def_suffix "/$threshold_proven"}
												{VARIABLE promotion_colour $rank_initiated_color}
												{VARIABLE promo_bonus_dmg 10}
											[/then]
										[/if]
									[/else]
								[/if]
							[/else]
						[/if]
					[/else]
				[/if]
			[/else]
		[/if]
		
		[if]
			[variable]
				name=promotion_level
				greater_than=0
			[/variable]
			[or]
				[variable]
					name=unit.variables.items_picked_up
					not_equals=""
				[/variable]
			[/or]
			[then]
				{VARIABLE current_promotion_level $unit.variables.promotion_level}
				{VARIABLE unit_items_info "yet"}
				{VARIABLE items_count "No"}
				[if]
					[variable]
						name=unit.variables.items_picked_up
						not_equals=""
					[/variable]
					[then]
						{VARIABLE unit_items_info " (<span color='$promotion_colour'>$promotion_label</span> $next_promo_label|):"}
						
						[set_variables]
							name=unit_items_ids
							mode=replace
							[split]
								list=$unit.variables.items_picked_up
								key=item
								separator=","
							[/split]
						[/set_variables]
						
						{VARIABLE items_count "$unit_items_ids.length|/$uws_game.max_items_per_unit"}
						
						[for]
							variable=i
							array=unit_items_ids
							[do]
								{VARIABLE array_key $unit_items_ids[$i].item}
								
								[set_variables]
									name=steps_readable
									mode=replace
									[split]
										list=$items_steps[2].$array_key
										key=step
										separator="/"
									[/split]
								[/set_variables]
								
								{VARIABLE step_value_now $steps_readable[$promotion_level].step}
								{VARIABLE step_value_next ""}
								
								[if]
									[variable]
										name=promotion_level
										less_than=5
									[/variable]
									[then]
										{VARIABLE tmp_next_level $promotion_level}
										{VARIABLE_OP tmp_next_level add 1}
										{VARIABLE step_value_next "/ $steps_readable[$tmp_next_level].step"}
									[/then]
								[/if]
								
								{VARIABLE unit_items_names "$items_steps[1].$array_key|, $unit_items_names"}
								{VARIABLE unit_items_info "$unit_items_info
$items_steps[1].$array_key|: <span color='$promotion_colour|'>$step_value_now|</span> $step_value_next"}
							[/do]
						[/for]
					[/then]
				[/if]
				
				{VARIABLE unit_kills_info $unit.variables.kills}
				[if]
					[variable]
						name=unit_kills_info
						equals=""
					[/variable]
					[then]
						{VARIABLE unit_kills_info 0}
					[/then]
				[/if]
				
				{VARIABLE display_rank_info yes}
			[/then]
		[/if]
	[/event]
	
	[event]
		name=promote_unit
		first_time_only=no
		
		{VARIABLE display_rank_info no}
		
		[fire_event]
			name=generate_promotion_rank_variables
			[primary_unit]
				id=$unit.id
			[/primary_unit]
		[/fire_event]
		
		[if]
			[variable]
				name=display_rank_info
				boolean_equals=yes
			[/variable]
			[then]
				[remove_trait]
					id=$unit.id
					trait_id=qquws_promotion_rank_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						promotion_level=$promotion_level
					[/variables]

					[trait]
						id=qquws_promotion_rank_trait
						name="<span color='$promotion_colour'>$promotion_label</span>"
						description="Promotion rank, provides +$promo_bonus_dmg|% dmg and affects item specials ($unit_kills_info|$promotion_def_suffix| kills)
								
$items_count items picked up $unit_items_info"
					[/trait]
				[/modify_unit]
				
				[if]
					[variable]
						name=promotion_level
						greater_than=$current_promotion_level
					[/variable]
					[then]
						[fire_event]
							name=upgrade_item_specials
							[primary_unit]
							    id=$second_unit.id
							[/primary_unit]
						[/fire_event]
					[/then]
				[/if]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=recalculate_items_count_for_unit
		first_time_only=no
		
		{VARIABLE items_count 0}
		{VARIABLE unit_item_list ""}
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				[set_variables]
					name=tmp_unit_items_array
					mode=replace
					[split]
						list=$unit.variables.items_picked_up
						key=item
						separator=","
					[/split]
				[/set_variables]
				
				{VARIABLE items_count $tmp_unit_items_array.length}
				{VARIABLE unit_item_list $unit.variables.items_picked_up}
			[/then]
		[/if]
	[/event]
	
	[event]
		name=append_item_variables
		first_time_only=no
		
		{VARIABLE already_applied ""}
		{VARIABLE current_promotion_level $unit.variables.promotion_level}
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				{VARIABLE already_applied "$unit.variables.items_picked_up|,"}
			[/then]
		[/if]
		
		{VARIABLE items_count $unit_items_ids.length}
		
		[if]
			[variable]
				name=unit.variables.promotion_level
				equals=""
			[/variable]
			[then]
				{VARIABLE current_promotion_level 0}
			[/then]
		[/if]
		
		[modify_unit]
			[filter]
				id=$unit.id
			[/filter]
			
			[variables]
				items_picked_up="$already_applied|$item_append_id"
				promotion_level=$current_promotion_level
			[/variables]
		[/modify_unit]
		
		{VARIABLE item_key $item_append_id}
		[set_variables]
			name=current_item_steps
			mode=replace
			[split]
				list=$items_steps[0].$item_key
				key=step_value
				separator="/"
			[/split]
		[/set_variables]
		
		[for]
			variable=use_promotion_level
			start=0
			end=$current_promotion_level
			step=1
			[do]
				{VARIABLE item_step $current_item_steps[$use_promotion_level].step_value}
				
				[fire_event]
					name=upgrade_single_item_promotion
					[primary_unit]
					    id=$unit.id
					[/primary_unit]
				[/fire_event]
			[/do]
		[/for]
	[/event]
	
	[event]
		name=upgrade_item_specials
		first_time_only=no

		[remove_trait]
			id=$unit.id
			trait_id=qquws_promotion_effect_trait
		[/remove_trait]

		[if]
			[variable]
				name=promo_bonus_dmg
				greater_than=0
			[/variable]
			[then]
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_promotion_effect_trait

						[effect]
						    apply_to=attack
						    increase_damage="$promo_bonus_dmg|%"
						[/effect]
					[/trait]
				[/modify_unit]
			[/then]
		[/if]		
		
		[if]
			[variable]
				name=unit.variables.items_picked_up
				not_equals=""
			[/variable]
			[then]
				[set_variables]
					name=current_unit_items_set
					mode=replace
					[split]
						list=$unit.variables.items_picked_up
						key=item_id
						separator=","
					[/split]
				[/set_variables]
				
				[for]
					variable=i
					array=current_unit_items_set
					[do]
						{VARIABLE item_key $current_unit_items_set[$i].item_id}
						[set_variables]
							name=current_item_steps
							mode=replace
							[split]
								list=$items_steps[0].$item_key
								key=step_value
								separator="/"
							[/split]
						[/set_variables]
						
						{VARIABLE item_step $current_item_steps[$unit.variables.promotion_level].step_value}
						{VARIABLE use_promotion_level $unit.variables.promotion_level}
						[fire_event]
							name=upgrade_single_item_promotion
							[primary_unit]
							    id=$unit.id
							[/primary_unit]
						[/fire_event]
					[/do]
				[/for]
			[/then]
		[/if]
	[/event]
	
	[event]
		name=upgrade_single_item_promotion
		first_time_only=no
		
		[switch]
			variable=item_key
			[case]
				value=magic_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							arcane=-$item_step
							cold=-$item_step
							fire=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE negates_magic_value 5}
					[/case]
					[case]
						value=4
						{VARIABLE negates_magic_value 10}
					[/case]
					[case]
						value=5
						{VARIABLE negates_magic_value 20}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=negates_magic_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								negates_magic_value=$negates_magic_value
							[/variables]
						[/modify_unit]
					
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_negates_magic
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_negates_magic
										name="negates magic $negates_magic_value"
										description="All allied units receive $negates_magic_value|% bonus to magic resistances."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_magic_negation_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=cold_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							cold=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes

							[effect]
								apply_to=new_attack
								name=qquws_w_time_dilation
								description="time dilation"
								type=cold
								range=ranged
								icon="attacks/staff-magic.png"
								damage=6
								number=2
								[specials]
									{WEAPON_SPECIAL_SLOW}
									{WEAPON_SPECIAL_MAGICAL}
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_time_dilation
								increase_damage=1
								increase_attacks=1
								[set_specials]
									mode=append
									[dummy]
										id=qquws_time_lock
										name="time lock"
										description="When this weapon is used on offense, upon successful hit, both the attacker and defender go into the time lock. For a duration of one turn the defender gets all defenses set to 25% and strikes on all weapons to 1. In addition to that, all adjacent enemies to the attacked unit receive 4 cold damage and get slowed. The attacker gets all defenses set to 25% and all weapons removed. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_time_dilation
								increase_damage=4
								remove_specials=qquws_time_lock
								[set_specials]
									mode=append
									[dummy]
										id=qquws_infinity_lock
										name="infinity lock"
										description="When this weapon is used on offense, upon successful hit, both the attacker and defender go into the infinity lock. For a duration of one turn the defender can't move, gets all defenses set to 15% and all weapons removed. In addition to that, all enemies within radius 5 from the attacked unit receive 8 cold damage and get slowed. The attacker gets all weapons removed. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_cold_mastery_aura
										name="cold mastery"
										description="Improves cold resistance of all allied units by 15% and increases their cold damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=phys_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
							impact=-$item_step
							pierce=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE res_reduction_value 5}
					[/case]
					[case]
						value=4
						{VARIABLE res_reduction_value 10}
					[/case]
					[case]
						value=5
						{VARIABLE res_reduction_value 20}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=res_reduction_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								armor_science_value=$res_reduction_value
							[/variables]
						[/modify_unit]
					
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_armor_science
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_armor_science
										name="armor science $res_reduction_value"
										description="Reduces physical resistances of all enemies within the vision range from the scientist by $res_reduction_value|%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=impact_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							impact=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_crush_their_souls
								description="crush their souls"
								type=impact
								range=melee
								icon="attacks/hammer-troll.png"
								damage=16
								number=2
								[specials]
									[dummy]
										id=qquws_stun
										name="stun"
										description="This attack puts enormous pressure on the enemy, disrupting his ZOC if a hit is landed. Not active on defense."
										active_on=offense
									[/dummy]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_crush_their_souls
								increase_damage=8
								remove_specials=qquws_stun
								[set_specials]
									mode=append
									[dummy]
										id=qquws_crushing_blow
										name="crushing blow"
										description="When this weapon is used on offense and a hit lands, the enemy gets one strike removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_crush_their_souls
								increase_damage=12
								remove_specials=qquws_crushing_blow
								[set_specials]
									mode=append
									[dummy]
										id=qquws_shatter_the_bones
										name="shatter the bones"
										description="When this weapon is used on offense and a hit lands, the enemy gets 50% of strikes removed from all weapons for a duration of one turn. Zone of Control is also disrupted. Can be applied only once per unit. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_impact_mastery_aura
										name="impact mastery"
										description="Improves impact resistance of all allied units by 15% and increases their impact damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=fire_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							fire=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_wrath_of_fire
								description="wrath of fire"
								type=fire
								range=melee
								icon="attacks/claws-fire-elemental.png"
								damage=9
								number=3
								[specials]
									[chance_to_hit]
										id=magical
										name="magical"
										description="This attack has a 70% chance to hit regardless of the defensive ability of the unit being attacked."
										value=70
										cumulative=no
									[/chance_to_hit]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_wrath_of_fire
								increase_damage=1
								increase_attacks=1
								[set_specials]
									mode=append
									[dummy]
										id=qquws_burning_passion
										name="burning passion"
										description="When this weapon is used on offense, after killing an enemy this unit gets possessed by burning passion, gets damage increased by 1 points and a chance to attack another enemy. After the turn is finished, all attacks get disabled and all resistances(except fire) and movement drop to 0 for a duration of one turn."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_wrath_of_fire
								increase_damage=1
								increase_attacks=1
								remove_specials=qquws_burning_passion
								[set_specials]
									mode=append
									[dummy]
										id=qquws_burning_possession
										name="burning possession"
										description="When this weapon is used on offense, after killing an enemy this unit gets possessed by infernal passion, receives extra 2 movement points, gets damage increased by 2 points and a chance to attack another enemy. After the turn is finished, all attacks get disabled, all resistances(except fire) drop to 0 and movement is reduced to 3 points for a duration of one turn."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_fire_mastery_aura
										name="fire mastery"
										description="Improves fire resistance of all allied units by 15% and increases their fire damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=arcane_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							arcane=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								mind_tricks_factor=0.2
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=new_attack
									name=qquws_w_unknown_force
									description="unknown force"
									type=arcane
									range=melee
									icon="attacks/touch-faerie.png"
									damage=12
									number=2
									[specials]
										[chance_to_hit]
											id=magical
											name="magical (attack-only)"
											description="This attack has a 70% chance to hit offensively regardless of the defensive ability of the unit being attacked."
											value=70
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[dummy]
											id=qquws_block_specials
										[/dummy]
									[/specials]
								[/effect]
								
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_mind_tricks
											name="mind tricks 20%"
											description="Once a fight is finished if both units are still alive then 20% of the damage received is reflected back onto the enemy as arcane damage and 20% of the wounds are healed up. Champions and The Butcher of Wesnoth are immune. Active only on offense."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								mind_tricks_factor=0.35
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=attack
									name=qquws_w_unknown_force
									increase_damage=2
									remove_specials=magical
									[set_specials]
										mode=append
										[dummy]
											id=qquws_reversed_polarity
											name="reversed polarity"
											description="When this weapon is used on offense, once a successful hit lands, the attacker and the defender swap their locations. This stops the attack. Champions and The Butcher of Wesnoth are immune."
											active_on=offense
										[/dummy]
										[chance_to_hit]
											id=magical
											name="precision (attack-only)"
											description="This attack has a 80% chance to hit offensively regardless of the defensive ability of the unit being attacked."
											value=80
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[drains]
											id=qquws_drains
											name="drains 50%"
											description="This unit drains health from living units, healing itself for 50% the amount of damage it deals (rounded down)."
											value=50
										[/drains]
									[/set_specials]
								[/effect]
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_mind_tricks
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_mind_tricks
											name="mind tricks 35%"
											description="Once a fight is finished if both units are still alive then 35% of the damage received is reflected back onto the enemy as arcane damage and 35% of the wounds are healed up. Champions and The Butcher of Wesnoth are immune. Active only on offense."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								mind_tricks_factor=0.5
							[/variables]
							
							[object]
								silent=yes
								
								[effect]
									apply_to=attack
									name=qquws_w_unknown_force
									increase_damage=2
									remove_specials=magical,qquws_drains
									[set_specials]
										mode=append
										[chance_to_hit]
											id=magical
											name="unavoidable (attack-only)"
											description="This attack has a 90% chance to hit offensively regardless of the defensive ability of the unit being attacked."
											value=90
											cumulative=no
											active_on=offense
										[/chance_to_hit]
										[drains]
											id=qquws_drains
											name="drains 100%"
											description="This unit drains health from living units, healing itself for 100% the amount of damage it deals."
											value=100
										[/drains]
									[/set_specials]
								[/effect]
								
								[effect]
								    apply_to=remove_ability
								    [abilities]
									[dummy]
										id=qquws_mind_tricks
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
									[dummy]
										id=qquws_mind_tricks
										name="mind tricks 50%"
										description="Once a fight is finished if both units are still alive then 50% of the damage received is reflected back onto the enemy as arcane damage and 50% of the wounds are healed up. Champions and The Butcher of Wesnoth are immune. Active only on offense."
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_arcane_mastery_aura
											name="arcane mastery"
											description="Improves arcane resistance of all allied units by 15% and increases their arcane damage by 15%."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=blade_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							silent=yes
							 
							[effect]
								apply_to=new_attack
								name=qquws_w_berserkers_fury
								description="berserker's fury"
								type=blade
								range=melee
								icon="attacks/battleaxe-undead.png"
								damage=6
								number=5
								[specials]
									{WEAPON_SPECIAL_MARKSMAN}
									[berserk]
										id=berserk_duel2
										name="duel 2"
										description="When attacking this unit presses the engagement and can fight for an extra round."
										value=2
										active_on=offense
									[/berserk]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_berserkers_fury
								increase_damage=1
								increase_attacks=1
								[set_specials]
									mode=append
									[dummy]
										id=qquws_battle_trance
										name="battle trance"
										description="When this weapon is used on offense each landing hit increases the damage by 1. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_berserkers_fury
								increase_damage=1
								increase_attacks=1
								remove_specials=qquws_battle_trance
								[set_specials]
									mode=append
									[dummy]
										id=qquws_overwhelm
										name="overwhelm"
										description="When this weapon is used on offense each landing hit increases the damage by 1, while simultaneously decreases opponent's damage by 2(1) if current damage is above 67%(33%). After the attack, opponent's defense and attack accuracy are reduced by 10% for one turn. Champions and The Butcher of Wesnoth are immune."
										active_on=offense
									[/dummy]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_blade_mastery_aura
										name="blade mastery"
										description="Improves blade resistance of all allied units by 15% and increases their blade damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=pierce_res
				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							pierce=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[object]
							 silent=yes
							 
							 [effect]
								apply_to=new_attack
								name=qquws_w_atrocious_impalement
								description="atrocious impalement"
								type=pierce
								range=melee
								icon="attacks/trident2-pierce.png"
								damage=13
								number=2
								[specials]
									[damage]
										id=charge
										name="charge"
										description="When used offensively, this attack deals double damage to the target. It also causes this unit to take double damage from the targetâ€™s counterattack."
										multiply=2
										apply_to=both
										active_on=offense
									[/damage]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								impale_armor_reduce=25
							[/variables]
							
							[object]
								 silent=yes
								 
								 [effect]
									apply_to=attack
									name=qquws_w_atrocious_impalement
									increase_damage=3
									[set_specials]
										mode=append
										[dummy]
											id=qquws_impale
											name="impale"
											description="When this weapon is used on offense and a hit lands, it permanently decreases enemy's pierce resistance by 25 once per engagement. Furthermore the opponent's damage and movement points are reduced by 33% for one turn. Champions and The Butcher of Wesnoth are immune. Reduced resistance cannot go below -15%."
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[object]
							 silent=yes

							 [effect]
								apply_to=attack
								name=qquws_w_atrocious_impalement
								increase_damage=2
								[set_specials]
									mode=append
									[attacks]
										id=AE_mag_nocounter
										name="no counter-attack"
										description="The opponent has a 0% chance of retaliation when this unit is attacking. Champions and The Butcher of Wesnoth are immune and so are opponents with berserker frenzy."
										value=0
										cumulative=no
										active_on=offense
										apply_to=opponent

										[filter_opponent]
											[filter_weapon]
												[not]
													special_id=berserk
												[/not]
											[/filter_weapon]
			
											[not]
												trait=immune_to_specials
											[/not]
										[/filter_opponent]
									[/attacks]
								[/set_specials]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_pierce_mastery_aura
										name="pierce mastery"
										description="Improves pierce resistance of all allied units by 15% and increases their pierce damage by 15%."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_low

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_low_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_low_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[trait]
								id=qquws_unpoisonable_trait
								name="immune to poison"
								description="This unit cannot be poisoned."

								[effect]
									apply_to=status
									add=unpoisonable
								[/effect]
							[/trait]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[object]
				 			silent=yes
				 			
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_unpoisonable_aura
										name="poison immunity aura"
										description="All allied units receive poison immunity."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_unpoisonable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[object]
				 			silent=yes
				 			
				 			[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_unpoisonable_aura
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										# id must stay the same
										id=qquws_unpoisonable_aura
										name="poison mastery"
										description="This unit and all allies become immune to poison. In addition to that at the beginning of it's turn this unit deals 8 damage and poisons all surrounding enemies. Champions, the Butcher of Wesnoth and non-living units are immune."
									[/dummy]
									[dummy]
										id=qquws_poison_mastery_aoe
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_med
				
				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_med_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_med_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[trait]
								id=qquws_undrainable_trait
								name="immune to drain"
								description="This unit's health cannot be drained."

								[effect]
									apply_to=status
									add=undrainable
								[/effect]
							[/trait]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[object]
				 			silent=yes
				 			
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_undrainable_aura
										name="drains immunity aura"
										description="All allied units receive drains immunity."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_undrainable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[object]
				 			silent=yes
				 			
							[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_undrainable_aura
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										# id must stay the same
										id=qquws_undrainable_aura
										name="draining mastery"
										description="This unit and all allies become immune to drains. In addition to that at the beginning of it's turn this unit drains 4hp while dealing 8dmg to all surrounding enemies. Champions, the Butcher of Wesnoth and non-living units are immune."
									[/dummy]
									[dummy]
										id=qquws_drains_mastery_aoe
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=hp_high
				
				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_hp_high_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_hp_high_trait

						[effect]
							apply_to=hitpoints
						    increase=$item_step|%
						    increase_total=$item_step|%
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=2
								heals_restore_statuses=no
							[/variables]
						[/modify_unit]
						
						[object]
				 			silent=yes
				 			
				 			[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_global_heals
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_global_heals
										name="heals all +2"
										description="At the beginning of it's turn, this unit heals all ally units on the map. Healing amount is 2 hitpoints."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=4
								heals_restore_statuses=no
							[/variables]
						[/modify_unit]
						
						[object]
				 			silent=yes
				 			
				 			[effect]
							    apply_to=remove_ability
							    [abilities]
								[dummy]
									id=qquws_global_heals
								[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_global_heals
										name="heals all +4"
										description="At the beginning of it's turn, this unit heals all ally units on the map. Healing amount is 4 hitpoints."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[status]
							     heals_all=yes
							[/status]
							
							[variables]
								heals_all_amount=8
								heals_restore_statuses=yes
							[/variables]
						[/modify_unit]
						
						[object]
				 			silent=yes
				 			
				 			[effect]
							    apply_to=remove_ability
							    [abilities]
								[dummy]
									id=qquws_global_heals
								[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_global_heals
										name="restores all +8"
										description="At the beginning of it's turn, this unit not only heals all ally units on the map, but also cures, removes slow and unpetrifies them. Healing amount is 8 hitpoins."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=steadfast
				
				{VARIABLE impenetrable_value 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE steadfast_factor 1.5}
					[/case]
					[case]
						value=1
						{VARIABLE steadfast_factor 1.75}
					[/case]
					[case]
						value=2
						{VARIABLE steadfast_factor 2}
					[/case]
					[case]
						value=3
						{VARIABLE steadfast_factor 2}
						{VARIABLE impenetrable_value 20}
					[/case]
					[case]
						value=4
						{VARIABLE steadfast_factor 2.25}
						{VARIABLE impenetrable_value 30}
					[/case]
					[case]
						value=5
						{VARIABLE steadfast_factor 2.5}
						{VARIABLE impenetrable_value 40}
					[/case]
				[/switch]
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
						[resistance]
							id=steadfast
						[/resistance]
					    [/abilities]
					[/effect]
					 [effect]
					    apply_to=new_ability
					    [abilities]
						[resistance]
							id=steadfast
							multiply=$steadfast_factor
							max_value=$item_step
							[filter_base_value]
							    greater_than=0
							    less_than=$item_step
							[/filter_base_value]
							name="steadfast"
							description="This unitâ€™s resistances are multiplied by a factor of $steadfast_factor|, up to a maximum of $item_step|%, when defending. Vulnerabilities are not affected."
							affect_self=yes
							active_on=defense
						[/resistance]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=impenetrable_value
						greater_than=0
					[/variable]
					[then]
						[object]
							 silent=yes

							[effect]
							    apply_to=remove_ability
							    [abilities]
								[resistance]
									id=qquws_impenetrable
								[/resistance]
							    [/abilities]
							[/effect]
							 [effect]
							    apply_to=new_ability
							    [abilities]
								[resistance]
									id=qquws_impenetrable
									multiply=2
									max_value=$impenetrable_value
									[filter_base_value]
									    greater_than=0
									    less_than=$impenetrable_value
									[/filter_base_value]
									name="shielded wall"
									description="This unit helps adjacent allies to form an impenetrable wall by doubling their resistances up to specific value. Vulnerabilities are not affected."
									affect_enemies=no
									affect_allies=yes
									affect_self=no
									[affect_adjacent]
									[/affect_adjacent]
									active_on=defense
								[/resistance]
							    [/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=regen
				
				{VARIABLE village_regen 0}
				{VARIABLE extra_description ""}
				{VARIABLE extra_info ""}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE village_regen 14}
						{VARIABLE extra_info "/14"}
						{VARIABLE extra_description " (14hp when stationing in a village)"}
						{VARIABLE fight_regen 2}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 2 hit points."}
					[/case]
					[case]
						value=4
						{VARIABLE village_regen 20}
						{VARIABLE extra_info "/20"}
						{VARIABLE extra_description " (20hp when stationing in a village)"}
						{VARIABLE fight_regen 4}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 4 hit points."}
					[/case]
					[case]
						value=5
						{VARIABLE village_regen 28}
						{VARIABLE extra_info "/28"}
						{VARIABLE extra_description " (28hp when stationing in a village)"}
						{VARIABLE fight_regen 8}
						{VARIABLE fight_r_description " Additionally, each time this unit completes a fight, it regenerates 8 hit points."}
					[/case]
				[/switch]
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[regenerate]
								id=regenerates
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates6
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates8
							[/regenerate]
							[regenerate]
								id=AE_mag_regenerates10
							[/regenerate]
							[regenerate]
								id=eoma_regenerates6
							[/regenerate]
							[regenerate]
								id=eoma_regenerates8
							[/regenerate]
							[regenerate]
								id=eoma_regenerates10
							[/regenerate]
							[regenerate]
								id=qquws_regenerates
							[/regenerate]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[regenerate]
								value=$item_step
								id=qquws_regenerates
								name="regenerates $item_step|$extra_info"
								description="The unit will heal itself $item_step HP per turn$extra_description|. If it is poisoned, it will remove the poison instead of healing.$fight_r_description"
								affect_self=yes
								poison=cured
							[/regenerate]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=village_regen
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								qquws_fight_regen_amount=$fight_regen
							[/variables]
							
							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[regenerate]
											id=qquws_village_regen
										[/regenerate]
										[dummy]
											id=qquws_fight_regen
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[regenerate]
											value=$village_regen
											id=qquws_village_regen
											affect_self=yes
											poison=cured
											[filter_self]
												[filter_location]
													terrain=*^V*
												[/filter_location]
											[/filter_self]
										[/regenerate]
										[dummy]
											id=qquws_fight_regen
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
				
				{CLEAR_VARIABLE extra_description,extra_info,village_regen,fight_r_description,fight_regen}
			[/case]
			[case]
				value=melee_dmg

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_melee_dmg_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_melee_dmg_trait

						[effect]
						    apply_to=attack
						    range=melee
						    increase_damage="$item_step|%"
						[/effect]
					[/trait]
				[/modify_unit]
				
				{VARIABLE fury_amount 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE fury_amount 10}
					[/case]
					[case]
						value=4
						{VARIABLE fury_amount 15}
					[/case]
					[case]
						value=5
						{VARIABLE fury_amount 22}
						
						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=fury_amount
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								fury_amount=$fury_amount
							[/variables]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_battle_fury
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_battle_fury
											name="battle fury +$fury_amount|%"
											description="With each successful hit the damage increases by $fury_amount|%. If the unit misses, the counter is reset."
											active_on=offense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=ranged_dmg

				[remove_trait]
					id=$unit.id
					trait_id=qquws_item_ranged_dmg_trait
				[/remove_trait]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[trait]
						id=qquws_item_ranged_dmg_trait

						[effect]
						    apply_to=attack
						    range=ranged
						    increase_damage="$item_step|%"
						[/effect]
					[/trait]
				[/modify_unit]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    [set_specials]
								    	mode=append
										[attacks]
											id=qquws_ruthless
											name="ruthless"
											description="Adds 1 strike against enemies with no ranged attacks. Attack only."
											active_on=offense
											add=1
											[filter_opponent]
												[not]
													[has_attack]
														range=ranged
													[/has_attack]
												[/not]
											[/filter_opponent]
										[/attacks]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_ruthless
								    [set_specials]
								    	mode=append
									[attacks]
										id=qquws_merciless
										name="merciless"
										description="Adds 3 strikes against enemies with no ranged attacks. Attack only."
										active_on=offense
										add=3
										[filter_opponent]
											[not]
												[has_attack]
													range=ranged
												[/has_attack]
											[/not]
										[/filter_opponent]
									[/attacks]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=ranged_acc
				[object]
					 silent=yes

					[effect]
					    apply_to=attack
					    range=ranged
					    [not]
					    	special_id=qquws_block_specials,magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
					    [/not]
					    increase_accuracy=$item_step
					[/effect]
				[/object]
				
				{VARIABLE concentration 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3
						{VARIABLE concentration 3}
					[/case]
					[case]
						value=4
						{VARIABLE concentration 6}
					[/case]
					[case]
						value=5
						{VARIABLE concentration 9}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=concentration
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								concentration_amount=$concentration
							[/variables]
								
							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials,magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
								    [/not]
								    remove_specials=qquws_concentration
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_concentration
											name="concentration +$concentration"
											description="With each successful hit, the accuracy of the next shot improves by $concentration|%. No effect on magical attacks. Attack only."
											active_on=offense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_parry

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[object]
						 silent=yes

						[effect]
						    apply_to=attack
						    range=melee
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    increase_parry=$item_step
						[/effect]
					[/object]
				[/modify_unit]

				{VARIABLE counterbalance_settings ""}
				[switch]
					variable=use_promotion_level

					[case]
						value=3

						{VARIABLE counterbalance_settings "70,90"}
						{VARIABLE counterbalance_info 30}
					[/case]
					[case]
						value=4

						{VARIABLE counterbalance_settings "60,85,95"}
						{VARIABLE counterbalance_info 40}
					[/case]
					[case]
						value=5

						{VARIABLE counterbalance_settings "50,80,90,95"}
						{VARIABLE counterbalance_info 50}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								 silent=yes

								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_peaceful_warrior
											name="peaceful warrior"
											description="When defending this unit will never deal the fatal blow and kill the enemy. Instead it will disarm them by leaving 1hp and removing all weapons for a duration of one turn."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]

				[if]
					[variable]
						name=counterbalance_settings
						not_equals=""
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								counterbalance_list=$counterbalance_settings
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_counterbalance
								    [set_specials]
								    	mode=append
										[dummy]
											id=qquws_counterbalance
											name="counterbalance $counterbalance_info"
											description="When defending, each time this unit dodges a melee attack it has $counterbalance_info|% chance to retaliate multiple times before enemy can attack again. Retaliations deal 50% of the base damage and all weapon specials are disabled."
											active_on=defense
										[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_poison
				
				{VARIABLE backstab_factor 0}
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	[poison]
								        id=poison
								        name="poison (lower level only)"
								        description="This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit. Affects only enemies of lower level."
								    	[filter_opponent]
								    		formula="if(level < other.level, 1, 0)"
								    	[/filter_opponent]
								    [/poison]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	[poison]
								        id=poison
								        name="poison (same and lower level only)"
								        description="This attack poisons living targets. Poisoned units lose 8 HP every turn until they are cured or are reduced to 1 HP. Poison cannot, of itself, kill a unit. Affects only enemies of the same or lower level."
								    	[filter_opponent]
								    		formula="if(level <= other.level, 1, 0)"
								    	[/filter_opponent]
								    [/poison]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						[object]
							 silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=poison
							    [set_specials]
							    	mode=append
							    	{WEAPON_SPECIAL_POISON}
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						{VARIABLE backstab_factor 1.25}
						{VARIABLE acc_increase 1}
					[/case]
					[case]
						value=4
						{VARIABLE backstab_factor 1.5}
						{VARIABLE acc_increase 2}
					[/case]
					[case]
						value=5
						{VARIABLE backstab_factor 2}
						{VARIABLE acc_increase 2}
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=backstab_factor
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=backstab
							    increase_accuracy=$acc_increase
							    [set_specials]
							    	mode=append
							        [damage]
										id=backstab
										name="backstab x$backstab_factor"
										description="When used offensively, this attack deals x$backstab_factor damage if there is an enemy of the target on the opposite side of the target."
										multiply=$backstab_factor
										active_on=offense
										[filter_opponent]
										    formula="
											enemy_of(self, flanker) and not flanker.petrified
										    where
											flanker = unit_at(direction_from(loc, other.facing))
										    "
										[/filter_opponent]
									[/damage]
							    [/set_specials]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=melee_slow
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
										id=slow
										name="slows (day only)"
										description="This attack slows the target until it ends a turn. Active only during a day."
										[filter_self]
											[filter_location]
												time_of_day_id=morning,midday,afternoon
											[/filter_location]
										[/filter_self]
									[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
									id=slow
									name="slows (day, dawn and dusk)"
									description="This attack slows the target until it ends a turn. Active only during a day, dawn and dusk."
									[filter_self]
										[filter_location]
											time_of_day_id=dawn,morning,midday,afternoon,dusk
										[/filter_location]
									[/filter_self]
								[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    range=melee
							   	[not]
							    	special_id=qquws_block_specials
							    [/not]
							    remove_specials=slow
							    [set_specials]
							    	mode=append
							    	[slow]
										id=slow
										name="slows"
										description="This attack slows the target until it ends a turn."
									[/slow]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							silent=yes
							
							[effect]
							    apply_to=new_ability
							    [abilities]
									[dummy]
										id=qquws_stillness_aura
										name="stillness aura"
										description="When defending against melee attacks, the opponent is slowed automatically when it hits. Champions and The Butcher of Wesnoth are immune."
									[/dummy]
							    [/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes
							
							[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_stillness_aura
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
									[dummy]
										id=qquws_lesser_chronosphere
										name="lesser chronosphere"
										description="When defending against melee attacks, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."
									[/dummy]
							    [/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes
							
							[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_lesser_chronosphere
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
									[dummy]
										id=qquws_chronosphere
										name="chronosphere"
										description="When defending, the opponent is slowed automatically before the first hit. Champions and The Butcher of Wesnoth are immune."
									[/dummy]
							    [/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=mp
				[object]
					 silent=yes

					[effect]
					    apply_to=movement
					    increase=$item_step
					[/effect]
				[/object]
				
				[switch]
					variable=use_promotion_level
					
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[trait]
								id=qquws_unslowable_trait
								name="slow immunity"
								description="This unit can not be slowed."

								[effect]
									apply_to=status
									add=unslowable
								[/effect]
							[/trait]
						[/modify_unit]
					[/case]
					[case]
						value=4
						
						[object]
				 			silent=yes
				 			
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_unslowable_aura
										name="slow immunity aura"
										description="All allied units receive slow immunity."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_unslowable_aura_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[object]
				 			silent=yes
				 			
							[effect]
							    apply_to=remove_ability
							    [abilities]
									[dummy]
										id=qquws_unslowable_aura
									[/dummy]
							    [/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										# id must stay the same
										id=qquws_unslowable_aura
										name="motility mastery"
										description="This unit and all allies become immune to slow. In addition to that at the beginning of this unit's turn all surrounding enemies become immobilised. Affected units lose their zone of control. Champions, the Butcher of Wesnoth and unslowable units are immune."
									[/dummy]
									[dummy]
										id=qquws_motility_aoe
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=feeding
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 5}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[object]
								silent=yes
								
								[effect]
								    apply_to=halo
								    halo="halo/uws/deluminates.png"
								[/effect]
								[effect]
									apply_to=alignment
									set=chaotic
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=1
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 15}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=2
						{VARIABLE summons_enabled no}
						{VARIABLE deluminates_value 25}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 0}
					[/case]
					[case]
						value=3
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 15}
						{VARIABLE summons_lvl 0}
						{VARIABLE summons_ageless "Walking Corpse,AE_arc_phantom_Mummy,AE_arc_despair_Wisp"}
						{VARIABLE summons_default "Walking Corpse"}
						{VARIABLE deluminates_value 25}
						{VARIABLE deluminates_limit 25}
						{VARIABLE feeding_cap 1}
					[/case]
					[case]
						value=4
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 17}
						{VARIABLE summons_lvl 1}
						{VARIABLE summons_ageless "Skeleton,Ghost,QQ_enslaved_soul,AE_arc_despair_Spearman,AE_arc_despair_Fright,AE_mrc_Blight_Charred_Zombie"}
						{VARIABLE summons_default "Skeleton,Ghost,QQ_enslaved_soul"}
						{VARIABLE deluminates_value 30}
						{VARIABLE deluminates_limit 30}
						{VARIABLE feeding_cap 2}
					[/case]
					[case]
						value=5
						{VARIABLE summons_enabled yes}
						{VARIABLE summons_chance 19}
						{VARIABLE summons_lvl 2}
						{VARIABLE summons_ageless "Shadow,Wraith,Revenant,AE_mrc_Blight_Dismembered,AE_arc_despair_Black_Shadow"}
						{VARIABLE summons_default "Shadow,Wraith,Revenant"}
						{VARIABLE deluminates_value 35}
						{VARIABLE deluminates_limit 35}
						{VARIABLE feeding_cap 3}
					[/case]
				[/switch]
				
				{VARIABLE summons_list $summons_default}
				[if]
					[variable]
						name=random_pool.allow_ae
						boolean_equals=yes
					[/variable]
					[then]
						{VARIABLE summons_list $summons_ageless}
					[/then]
				[/if]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[object]
						silent=yes
						
						[effect]
						    apply_to=remove_ability
						    [abilities]
								[illuminates]
									id=qquws_delumination
								[/illuminates]
						    [/abilities]
						[/effect]
						[effect]
						    apply_to=new_ability
						    [abilities]
								[illuminates]
							        id=qquws_delumination
							        value=-$deluminates_value
							        min_value=-$deluminates_limit
							        max_value=0
							        cumulative=no
							        name="deluminates $deluminates_value"
							        description="This unit obscures the surrounding area, making chaotic units fight better, and lawful units fight worse."
							        affect_self=yes
							    [/illuminates]
						    [/abilities]
						[/effect]
					[/object]
				[/modify_unit]
				
				[if]
					[variable]
						name=summons_enabled
						boolean_equals=yes
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							[variables]
								feeding_cap=$feeding_cap
								summons_chance=$summons_chance
								summons_list=$summons_list
							[/variables]

							[object]
								silent=yes
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_raises_undead
										[/dummy]
										[dummy]
											id=qqas_feeding
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
									[dummy]
										id=qquws_raises_undead
										name="raises the undead"
										description="At the beginning of it's turn, this unit has $summons_chance|% chance to summon a level $summons_lvl undead minion. The strength of the summoned units varies."
									[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
									[dummy]
										id=qqas_feeding
										name="magical feeding"
										description="This unit gains extra hitpoints whenever it kills a unit. The number added depends on the level of the unit killed (cap $feeding_cap|)."
									[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=leadership

				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE leadership_amount 15}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=1
						{VARIABLE leadership_amount 20}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=2
						{VARIABLE leadership_amount 25}
						{VARIABLE leads_by_example_value 0}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=3
						{VARIABLE leadership_amount 25}
						{VARIABLE leads_by_example_value 15}
						{VARIABLE great_leader_value 0}
					[/case]
					[case]
						value=4
						{VARIABLE leadership_amount 30}
						{VARIABLE leads_by_example_value 25}
						{VARIABLE great_leader_value 25}
					[/case]
					[case]
						value=5
						{VARIABLE leadership_amount 35}
						{VARIABLE leads_by_example_value 35}
						{VARIABLE great_leader_value 50}

						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]

				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[leadership]
								id=leadership
							[/leadership]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[leadership]
								id=leadership
								value=$leadership_amount
								cumulative=no
								name="leadership"
								description="This unit can lead your own units that are next to it, making them fight better. Affects units of the same or lower level increasing their damage by $leadership_amount|% regardless of their level difference."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
								    [filter]
									formula="level <= other.level"
								    [/filter]
								[/affect_adjacent]
							[/leadership]
					    [/abilities]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=leads_by_example_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								qquws_leads_by_example_buff=$leads_by_example_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_leads_by_example
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_leads_by_example
											name="leads by example $leads_by_example_value|%"
											description="Whenever this unit attacks a champion, or a regular enemy of the same or higher level with more than 50% hitpoints, then all units of the same side that haven't made a move yet receive +1mp and a $qquws_leads_by_example|% damage bonus until the end of the turn."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]

				[if]
					[variable]
						name=great_leader_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								qquws_great_leader_teaching_rate=$great_leader_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_great_leader
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_great_leader
											name="great leader $great_leader_value|%"
											description="Whenever this unit kills an enemy all surrounding allied units receive $great_leader_value|% experience points of the kill as teachings and explanations from the leader."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=drain

				{VARIABLE drains_extra_label ""}
				{VARIABLE drains_extra_text ""}
				{VARIABLE drains_non_living_percentage 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=ranged
								[not]
							    	special_id=qquws_block_specials
							    [/not]

								[set_specials]
									 mode=append
									[damage]
										id=qquws_evil
										name="wicked"
										description="When used offensively at nighttime, this attack deals 15% more damage to living units."
										multiply=1.15
										active_on=offense
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
									[dummy]
										id=qquws_non_living_drains
									[/dummy]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/20%"}
						{VARIABLE drains_non_living_percentage 20}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 20% of the damage dealt."}
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=ranged
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_evil
								[set_specials]
									 mode=append
									 [damage]
										id=qquws_evil
										name="wicked"
										description="When used offensively at nighttime, this attack deals 25% more damage to living units."
										multiply=1.25
										active_on=offense
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/30%"}
						{VARIABLE drains_non_living_percentage 30}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 30% of the damage dealt."}
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_evil
								[set_specials]
									 mode=append
									 [damage]
										id=qquws_evil
										name="unholy"
										description="When used at nighttime, this attack deals 35% more damage to living units."
										multiply=1.35
										apply_to=self
										[filter_opponent]
											[filter_location]
												time_of_day=chaotic
											[/filter_location]
											
											[not]
												status=not_living
										    [/not]
										[/filter_opponent]
									[/damage]
								[/set_specials]
							[/effect]
						[/object]

						{VARIABLE drains_extra_label "/40%"}
						{VARIABLE drains_non_living_percentage 40}
						{VARIABLE drains_extra_text " Additionally it drains energy from non-living units equal to 40% of the damage dealt."}
					[/case]
				[/switch]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]

					[variables]
						non_living_drains=$drains_non_living_percentage
					[/variables]

					[object]
						silent=yes

						[effect]
						    apply_to=attack
						    range=ranged
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    remove_specials=drains,qquws_drains
						    [set_specials]
						    	mode=append
						    	[drains]
									id=qquws_drains
									name="drains $item_step|%$drains_extra_label"
									description="This unit drains health from living units, healing itself for $item_step|% the amount of damage it deals (rounded down).$drains_extra_text"
									value=$item_step
								[/drains]
						    [/set_specials]
						[/effect]
					[/object]
				[/modify_unit]
			[/case]
			[case]
				value=defense
				[object]
					 silent=yes

					[effect]
					    apply_to=movement_costs
					    replace=no
					    [movement_costs]
							flat=-$item_step
							frozen=-$item_step
							forest=-$item_step
							hills=-$item_step
							mountains=-$item_step
							village=-$item_step
							swamp_water=-$item_step
							shallow_water=-$item_step
							deep_water=-$item_step
							reef=-$item_step
							castle=-$item_step
							cave=-$item_step
							sand=-$item_step
							fungus=-$item_step
					    [/movement_costs]
					[/effect]
				[/object]
				
				{VARIABLE improve_defense 0}
				[switch]
					variable=use_promotion_level

					[case]
						value=0
						{VARIABLE improve_defense 1}
					[/case]
					[case]
						value=1
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=2
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=3
						{VARIABLE improve_defense 1}
					[/case]
					[case]
						value=4
						{VARIABLE improve_defense 2}
					[/case]
					[case]
						value=5
						{VARIABLE improve_defense 2}
						
						[object]
							silent=yes

							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=qquws_terrain_mastery
										name="terrain mastery"
										description="This unit mastered the different terrains to perfection. All allied units receive +5% defense everywhere and movement costs are improved by 1."
									[/dummy]
								[/abilities]
							[/effect]
						[/object]

						[fire_event]
							name=apply_terrain_mastery_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=improve_defense
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
								apply_to=defense
								replace=no
								[defense]
									flat=-$improve_defense
									frozen=-$improve_defense
									forest=-$improve_defense
									hills=-$improve_defense
									mountains=-$improve_defense
									village=-$improve_defense
									swamp_water=-$improve_defense
									shallow_water=-$improve_defense
									deep_water=-$improve_defense
									reef=-$improve_defense
									castle=-$improve_defense
									cave=-$improve_defense
									sand=-$improve_defense
									fungus=-$improve_defense
								[/defense]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=skirm
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher (nighttime only)"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control. Active only during nighttime."
										affect_self=yes
										[filter_self]
											[filter_location]
												time_of_day_id=first_watch,midnight,second_watch
											[/filter_location]
										[/filter_self]
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher (dusk, nighttime and dawn)"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control. Active only during dusk, nighttime and dawn."
										affect_self=yes
										[filter_self]
											[filter_location]
												time_of_day_id=dusk,first_watch,midnight,second_watch,dawn
											[/filter_location]
										[/filter_self]
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[skirmisher]
										id=skirmisher
									[/skirmisher]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[skirmisher]
										id=skirmisher
										name="skirmisher"
										description="This unit is skilled in moving past enemies quickly, and ignores all enemy Zones of Control."
										affect_self=yes
									[/skirmisher]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
							    apply_to=movement
							    increase=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								battle_fervor_mp=1
							[/variables]
							
							[object]
								silent=yes

								[effect]
								    apply_to=movement
								    increase=1
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
											name="battle fervor +1"
											description="Increases movement points of all ally units by 1."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
						
						[fire_event]
							name=apply_battle_fervor_to_all_allies
						[/fire_event]
					[/case]
					[case]
						value=5
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								battle_fervor_mp=2
							[/variables]
							
							[object]
								silent=yes

								[effect]
									apply_to=remove_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
										[/dummy]
									[/abilities]
								[/effect]
								[effect]
									apply_to=new_ability
									[abilities]
										[dummy]
											id=qquws_battle_fervor
											name="battle fervor +2"
											description="Increases movement points of all ally units by 2."
										[/dummy]
										[dummy]
											id=qquws_enemy_control
											name="enemy control"
											description="All allied units learn how to ignore enemies' zones of control."
										[/dummy]
									[/abilities]
								[/effect]
							[/object]
						[/modify_unit]
						
						[fire_event]
							name=apply_battle_fervor_to_all_allies
						[/fire_event]
						
						[fire_event]
							name=apply_enemy_control_to_all_allies
						[/fire_event]
					[/case]
				[/switch]
			[/case]
			[case]
				value=first_strike
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 [firststrike]
								        id=firststrike
								        name="first strike (lower levels only)"
								        description="This unit always strikes first with this attack against enemies of lower level."
								        [filter_opponent]
								    		formula="if(level < other.level, 1, 0)"
								    	[/filter_opponent]
								    [/firststrike]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 {WEAPON_SPECIAL_FIRSTSTRIKE}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=2
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=firststrike
								[set_specials]
									 mode=append
									 {WEAPON_SPECIAL_FIRSTSTRIKE}
								[/set_specials]
							[/effect]
						[/object]
					[/case]
					[case]
						value=3

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								preemptive_strike_chance=50
								preemptive_strike_damage=50
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									[set_specials]
										 mode=append
										 
										 [dummy]
										 	id=qquws_preemptive_strike
											name="preemptive strike 50%"
											description="When attacking you strike twice before the enemy can retaliate. The first strike deals 50% normal damage, has always 50% chance to hit and all specials disabled. Champions and the Butcher of Wesnoth are immune."
											active_on=offense
										 [/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								preemptive_strike_chance=60
								preemptive_strike_damage=75
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_preemptive_strike
									[set_specials]
										 mode=append
										 
										 [dummy]
										 	id=qquws_preemptive_strike
											name="preemptive strike 75%"
											description="When attacking you strike twice before the enemy can retaliate. The first strike deals 75% normal damage, has always 60% chance to hit and all specials disabled. Champions and the Butcher of Wesnoth are immune."
											active_on=offense
										 [/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5
						[object]
							silent=yes

							[effect]
								apply_to=attack
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_preemptive_strike
								[set_specials]
									 mode=append
									 [dummy]
									 	id=qquws_initiative
										name="initiative"
										description="when attacking and defending you strike twice before the enemy. The first strike deals 125% normal damage, has always 70% chance to hit and all specials disabled. Champions and the Butcher of Wesnoth are immune."
									 [/dummy]
								[/set_specials]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
							    	[firststrike]
										id=qquws_eagerness_aura
										name="eagerness aura"
										description="All surrounding allies gain first strike on all weapons."
										affect_enemies=no
										affect_allies=yes
										affect_self=no
										[affect_adjacent]
										[/affect_adjacent]
									[/firststrike]
							    [/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=fear

				{VARIABLE fear_reduction 0}
				{VARIABLE fear_radius 0}
				{VARIABLE fear_heal_on_hit 0}
				{VARIABLE fear_max_lvl 0}
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE fear_reduction 0}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 5}
						{VARIABLE fear_radius 1}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=1
						{VARIABLE fear_reduction 5}
						{VARIABLE fear_kill_reduction 5}
						{VARIABLE fear_attack_reduction 5}
						{VARIABLE fear_radius 1}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=2
						{VARIABLE fear_reduction 5}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 10}
						{VARIABLE fear_radius 2}
						{VARIABLE fear_heal_on_hit 0}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=3
						{VARIABLE fear_reduction 10}
						{VARIABLE fear_kill_reduction 10}
						{VARIABLE fear_attack_reduction 15}
						{VARIABLE fear_radius 3}
						{VARIABLE fear_heal_on_hit 1}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=4
						{VARIABLE fear_reduction 10}
						{VARIABLE fear_kill_reduction 15}
						{VARIABLE fear_attack_reduction 20}
						{VARIABLE fear_radius 4}
						{VARIABLE fear_heal_on_hit 2}
						{VARIABLE fear_lvl_inc 0}
					[/case]
					[case]
						value=5
						{VARIABLE fear_reduction 15}
						{VARIABLE fear_kill_reduction 15}
						{VARIABLE fear_attack_reduction 25}
						{VARIABLE fear_radius 5}
						{VARIABLE fear_heal_on_hit 3}
						{VARIABLE fear_lvl_inc 0}
						
						[modify_unit]
							[filter]
								id=$unit.id
								
								[not]
									trait=fearless
								[/not]
							[/filter]
							
							{TRAIT_FEARLESS}
						[/modify_unit]
					[/case]
				[/switch]
				
				{VARIABLE fear_kill_total_reduction $fear_reduction}
				{VARIABLE_OP fear_kill_total_reduction add $fear_kill_reduction}
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						fear_reduction=$fear_reduction
						fear_kill_reduction=$fear_kill_reduction
						fear_radius=$fear_radius
						fear_increase_max_level=$fear_lvl_inc
					[/variables]
					
					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_necromancers_bane
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_necromancers_bane
									name="necromancer's bane"
									description="Each time this unit attacks, the defender retaliates with $fear_attack_reduction|% damage reduction. Furthermore all enemies level of the unit killed + 1 and less within range $fear_radius from this unit receive $fear_reduction|% damage reduction ($fear_kill_total_reduction|% if the unit is killed) at the end of the fight for a duration of one turn. Champions, Butcher of Wesnoth, fearless units, and leaders receive half of the reduction."
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
						    apply_to=attack
						    remove_specials=qquws_necro_bane_dmg
						    [set_specials]
					    	  	mode=append
					     		[damage]
									id=qquws_necro_bane_dmg
									name=""
									description=""
									active_on=offense
									apply_to=opponent
									multiply="( (100.0 - if(defender.traits.immune_to_specials or defender.traits.fearless or defender.canrecruit, $fear_attack_reduction / 2.0, $fear_attack_reduction)) / 100.0 )"
								[/damage]
						    [/set_specials]
						 [/effect]
					[/object]
				[/modify_unit]
				
				[if]
					[variable]
						name=fear_heal_on_hit
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								remove_specials=qquws_heals_on_hit
								[set_specials]
								  mode=append
									  [heal_on_hit]
										id=qquws_heals_on_hit
										name="heals on hit +$fear_heal_on_hit"
										description="Each landing hit causes this unit to heal $fear_heal_on_hit hitpoint(s)."
										value=$fear_heal_on_hit
										apply_to=self
									  [/heal_on_hit] 
								[/set_specials]
							 [/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=discouragement
				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     range=melee
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 10%"
										description="When used defensively this attack reduces the opponent's damage by 10%."
										multiply=0.9
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=1

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     range=melee
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 15%"
										description="When used defensively this attack reduces the opponent's damage by 15%."
										multiply=0.85
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=2

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 20%"
										description="When used defensively this attack reduces the opponent's damage by 20%."
										multiply=0.8
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=3

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     range=melee
							     [set_specials]
							    		mode=append
							     	  	[attacks]
											id=qqas_discouragement
											name="discourage"
											description="When used in defense, this attack reduces the opponent's number of strikes by 1."
											sub=1
											active_on=defense
											apply_to=opponent
									 	[/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=4

						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten,qqas_discouragement
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 25%"
										description="When used defensively this attack reduces the opponent's damage by 25%."
										multiply=0.75
										apply_to=opponent
										active_on=defense
								    [/damage]
								    [attacks]
										id=qqas_discouragement
										name="discourage"
										description="When used in defense, this attack reduces the opponent's number of strikes by 1."
										sub=1
										active_on=defense
										apply_to=opponent
								 	[/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_dishearten
							     [set_specials]
							    	mode=append
								    [damage]
										id=qquws_dishearten
										name="dishearten 30%"
										description="When used defensively this attack reduces the opponent's damage by 30%."
										multiply=0.7
										apply_to=opponent
										active_on=defense
								    [/damage]
							     [/set_specials]
							 [/effect]
							 [effect]
								apply_to=new_attack
								name=qquws_w_corruption
								description="corruption"
								type=corruption
								range=corruption
								icon="attacks/wail.png"
								damage=1
								number=1
								[specials]
									[dummy]
										id=qquws_corruption
										name="corrupts"
										description="When used the enemy unit will either change sides or become enraged and it's damage will increase by 40%. The chance of conversion depends on the difference in levels between the corrupting and the corrupted unit. If the levels are the same it's 50% - 50%. Each point of difference in levels affects the chances by 20%. Champions, the Butcher of Wesnoth and recruiting units are immune. Available only on offense. Number of owned corrupted units is limited to 1."
										active_on=offense
									[/dummy]
									[chance_to_hit]
										id=magical
										name="always hits"
										description="This attack has always a 100% chance to hit regardless of the defensive ability of the unit being attacked."
										value=100
										cumulative=no
									[/chance_to_hit]
									[dummy]
										id=qquws_block_specials
									[/dummy]
								[/specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=burns

				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[object]
							silent=yes

							[effect]
							    apply_to=halo
							    halo="halo/uws/burns.png"
							[/effect]
						[/object]

						{VARIABLE secret_fire_adjacent 2}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "2"}
						{VARIABLE fire_vision_bonus 0}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-5
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1

						{VARIABLE secret_fire_adjacent 4}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "4"}
						{VARIABLE fire_vision_bonus 0}
					[/case]
					[case]
						value=2

						{VARIABLE secret_fire_adjacent 8}
						{VARIABLE secret_fire_defending 0}
						{VARIABLE secret_fire_message " Passively increses fire resisitance by 5%."}
						{VARIABLE secret_fire_name_info "8"}
						{VARIABLE fire_vision_bonus 0}
					[/case]
					[case]
						value=3

						{VARIABLE secret_fire_adjacent 8}
						{VARIABLE secret_fire_defending 8}
						{VARIABLE secret_fire_message " Additionally it deals 8 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 15%."}
						{VARIABLE secret_fire_name_info "8(8)"}
						{VARIABLE fire_vision_bonus 1}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4

						{VARIABLE secret_fire_adjacent 12}
						{VARIABLE secret_fire_defending 12}
						{VARIABLE secret_fire_message " Additionally it deals 12 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 15%."}
						{VARIABLE secret_fire_name_info "12(12)"}
						{VARIABLE fire_vision_bonus 2}
					[/case]
					[case]
						value=5
						
						{VARIABLE secret_fire_adjacent 16}
						{VARIABLE secret_fire_defending 16}
						{VARIABLE secret_fire_message " Additionally it deals 16 fire damage to all melee attackers when defending. Champions and ranged attackers receive half the damage. Passively increses fire resisitance by 25%."}
						{VARIABLE secret_fire_name_info "16(16)"}
						{VARIABLE fire_vision_bonus 3}

						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									fire=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
				[/switch]

				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						secret_fire_adjacent=$secret_fire_adjacent
						secret_fire_defending=$secret_fire_defending
					[/variables]

					[object]
						 silent=yes

						[effect]
						    apply_to=remove_ability
						    [abilities]
								[dummy]
									id=qquws_secret_fire
								[/dummy]
						    [/abilities]
						[/effect]
						[effect]
						    apply_to=new_ability
						    [abilities]
								[dummy]
									id=qquws_secret_fire
									name="secret fire $secret_fire_name_info"
									description="Burns adjacent enemies at the beginning of each turn dealing $secret_fire_adjacent base fire damage (affected by time of day bonus according to the unit's alignment).$secret_fire_message"
								[/dummy]
						    [/abilities]
						[/effect]
					[/object]
				[/modify_unit]

				[if]
					[variable]
						name=fire_vision_bonus
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								fire_vision_bonus=$fire_vision_bonus
							[/variables]

							[object]
								 silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_fire_vision
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_fire_vision
											name="fire vision +$fire_vision_bonus"
											description="All allied units receive +$fire_vision_bonus bonus vision points."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]

						[fire_event]
							name=apply_fire_vision_to_all_allies
						[/fire_event]
					[/then]
				[/if]
			[/case]
			[case]
				value=golden_armor
				
				{VARIABLE reflects_value 0}
				[switch]
					variable=use_promotion_level
					[case]
						value=3
						{VARIABLE reflects_value 15}
						{VARIABLE golden_armour_value 12}
					[/case]
					[case]
						value=4
						{VARIABLE reflects_value 30}
						{VARIABLE golden_armour_value 15}
					[/case]
					[case]
						value=5
						{VARIABLE reflects_value 50}
						{VARIABLE golden_armour_value 20}
					[/case]
				[/switch]

				[object]
					 silent=yes

					 [effect]
					    apply_to=resistance
					    replace=no
					    [resistance]
							blade=-$item_step
							impact=-$item_step
							pierce=-$item_step
							arcane=-$item_step
							cold=-$item_step
							fire=-$item_step
					    [/resistance]
					[/effect]
				[/object]
				
				[if]
					[variable]
						name=reflects_value
						greater_than=0
					[/variable]
					[then]
						[object]
							 silent=yes

							[effect]
							    apply_to=remove_ability
							    [abilities]
								[dummny]
									id=qquws_reflects_damage
								[/dummny]
							    [/abilities]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
								[dummny]
									id=qquws_reflects_damage
									name="reflects damage"
									description="When defending, $reflects_value|% of received damage is reflected back to the attacker. Passively increases all resistances by $golden_armour_value|%."
								[/dummny]
							    [/abilities]
							[/effect]
						[/object]
						
						{VARIABLE_OP reflects_value divide 100}
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								reflects_factor=$reflects_value
							[/variables]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=heal

				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[heals]
								id=healing
							[/heals]
							[heals]
								id=curing
							[/heals]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[heals]
								value=$item_step
								id=healing
								affect_allies=yes
								name="heals +$item_step"
								description="This unit combines herbal remedies with magic to heal units more quickly than is normally possible on the battlefield."
								affect_self=no
								poison=cured
								[affect_adjacent]
									adjacent=n,ne,se,s,sw,nw
								[/affect_adjacent]
							[/heals]
					    [/abilities]
					[/effect]
				[/object]

				[switch]
					variable=use_promotion_level

					[case]
						value=0

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[object]
								silent=yes

								[effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-5
								    [/resistance]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]

					[case]
						value=3
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								treats_wounded_hospital_cost=40
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-10
								    [/resistance]
								[/effect]
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
											name="treats wounded 40"
											description="Any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow. The cost of recalling is then 40 gold. Pasively increases arcane resistance by 5%. Units sent to the recall list do NOT drop items."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=4

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								treats_wounded_hospital_cost=30
							[/variables]
							
							[object]
								silent=yes

								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
											name="treats wounded 30"
											description="Any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow. The cost of recalling is then 30 gold. Pasively increases arcane resistance by 15%. Units sent to the recall list do NOT drop items."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
					[case]
						value=5

						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]

							[variables]
								treats_wounded_hospital_cost=20
							[/variables]

							[trait]
								id=qquws_distinguished
								name=distinguished
								description="Distinguished units can assume the role of a new leader in an unfortunate situation where one dies."
							[/trait]
							
							[object]
								 silent=yes

								 [effect]
								    apply_to=resistance
								    replace=no
								    [resistance]
										arcane=-10
								    [/resistance]
								[/effect]
								[effect]
								    apply_to=remove_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
										[/dummy]
								    [/abilities]
								[/effect]
								[effect]
								    apply_to=new_ability
								    [abilities]
										[dummy]
											id=qquws_treats_wounded
											name="treats wounded 20"
											description="Any surrounding ally of level 1 or higher is sent to the recall list instead of dying upon receiving a fatal blow. The cost of recalling is then 20 gold. Pasively increases arcane resistance by 25%. Units sent to the recall list do NOT drop items."
										[/dummy]
								    [/abilities]
								[/effect]
							[/object]
						[/modify_unit]
					[/case]
				[/switch]
			[/case]
			[case]
				value=freezing_gem
				
				{VARIABLE freezing_touch_amount 0}
				{VARIABLE freezing_touch_cold 5}
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE freezing_touch_amount 1}
						{VARIABLE freezing_touch_cold 5}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-5
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						{VARIABLE freezing_touch_amount 2}
						{VARIABLE freezing_touch_cold 5}
					[/case]
					[case]
						value=2
						{VARIABLE freezing_touch_amount 3}
						{VARIABLE freezing_touch_cold 5}
					[/case]
					[case]
						value=3
						{VARIABLE freezing_touch_amount 4}
						{VARIABLE freezing_touch_cold 15}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						{VARIABLE freezing_touch_amount 5}
						{VARIABLE freezing_touch_cold 15}
					[/case]
					[case]
						value=5
						{VARIABLE freezing_touch_amount 6}
						{VARIABLE freezing_touch_cold 25}
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									cold=-10
							    [/resistance]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=freezing_touch_amount
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								freezing_touch_amount=$freezing_touch_amount
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=melee
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qqas_freezing_gem
								    [set_specials]
										mode=append
										[dummy]
											id=qqas_freezing_gem
											name="freezing touch $freezing_touch_amount"
											description="Each landing hit of this weapon decreases enemy's defense ability by $freezing_touch_amount for 1 turn. Passively increases cold resistance by $freezing_touch_cold"
										[/dummy]
								    [/set_specials]
								 [/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=field_disruption

				{VARIABLE half_value "$( floor($item_step * 0.5) )"}
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[resistance]
								id=qquws_field_disruption
							[/resistance]
							[resistance]
								id=qquws_field_disruption_champions
							[/resistance]
					    [/abilities]
					[/effect]
					[effect]
					    apply_to=new_ability
					    [abilities]
							[resistance]
								id=qquws_field_disruption
								sub=$item_step
								max_value=100
								apply_to=arcane,cold,fire
								name="field disruption"
								description="Enemies standing next to this unit have their arcane, cold and fire resistances reduced by $item_step|. Champions receive half the effect."
								affect_self=no
								affect_allies=no
								affect_enemies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
									[filter]
										[not]
											trait=immune_to_specials
										[/not]
									[/filter]
								[/affect_adjacent]
							[/resistance]
							[resistance]
								id=qquws_field_disruption_champions
								sub=$half_value
								max_value=100
								apply_to=arcane,cold,fire
								affect_self=no
								affect_allies=no
								affect_enemies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
									[filter]
										trait=immune_to_specials
									[/filter]
								[/affect_adjacent]
							[/resistance]
					    [/abilities]
					[/effect]
				[/object]

				{VARIABLE phase_disruption 0}
				
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						{VARIABLE phase_disruption 5}
					[/case]
					[case]
						value=4
						{VARIABLE phase_disruption 10}
					[/case]
					[case]
						value=5
						{VARIABLE phase_disruption 15}
					[/case]
				[/switch]

				[if]
					[variable]
						name=phase_disruption
						greater_than=0
					[/variable]
					[then]
						[object]
							silent=yes

							[effect]
							    apply_to=remove_ability
							    [abilities]
									[chance_to_hit]
										id=qquws_phase_disruption
									[/chance_to_hit]
									[chance_to_hit]
										id=qquws_phase_disruption_ally
									[/chance_to_hit]
							    [/abilities]
							[/effect]
							[effect]
							    apply_to=new_ability
							    [abilities]
									[chance_to_hit]
										id=qquws_phase_disruption
										sub=$phase_disruption
										name="phase disruption"
										description="Surrounding non-champion enemies have their magical chance to hit reduced by $phase_disruption|%. Conversely surrounding ally units have their magical chance to hit increased by the same amount."
										affect_self=no
										affect_allies=no
										affect_enemies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_student]
									[/chance_to_hit]
									[chance_to_hit]
										id=qquws_phase_disruption_ally
										add=$phase_disruption
										affect_self=no
										affect_allies=yes
										affect_enemies=no
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_student]
											[filter_weapon]
												special_id=magical,AE_mag_magical_defensive,AE_mag_magical_offensive,AE_mag_precision,AE_mag_enchanted,AE_mag_precision_offensive,AE_fut_ubiquitous,eoma_precision,eoma_enchanted,eoma_magical_offensive,eoma_magical_defensive,eoma_precision_offensive
											[/filter_weapon]
										[/filter_student]
									[/chance_to_hit]
							    [/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=armor_destruction

				{VARIABLE damage_increase_txt 1}
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						{VARIABLE damage_increase_txt 1}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						{VARIABLE damage_increase_txt 1}
					[/case]
					[case]
						value=2
						
						{VARIABLE damage_increase_txt 1}
					[/case]
					[case]
						value=3
						
						{VARIABLE damage_increase_txt 2}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						{VARIABLE damage_increase_txt 2}
					[/case]
					[case]
						value=5
						
						{VARIABLE damage_increase_txt 3}
						
						[object]
							silent=yes

							[effect]
								apply_to=attack
								range=melee
								[not]
							    	special_id=qquws_block_specials
							    [/not]
								increase_damage=1
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=item_step
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								armor_destruction_amount=$item_step
							[/variables]

							[object]
								silent=yes

								[effect]
									apply_to=attack
									range=melee
									[not]
								    	special_id=qquws_block_specials
								    [/not]
									remove_specials=qquws_armor_destruction
									[set_specials]
										mode=append
										[dummy]
											id=qquws_armor_destruction
											name="armor destruction $item_step"
											description="Each landing hit permanently decreases enemy's resistance to this weapon's damage type by $item_step|. Resistance cannot go lower than -15. Works only on offense. Passively increases melee damage by $damage_increase_txt"
											active_on=offense
										[/dummy]
									[/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=protection
				
				[object]
					 silent=yes

					[effect]
					    apply_to=remove_ability
					    [abilities]
							[resistance]
								id=qquws_protection
							[/resistance]
					    [/abilities]
					[/effect]
					 [effect]
					    apply_to=new_ability
					    [abilities]
							[resistance]
								id=qquws_protection
								add=$item_step
								max_value=75
								apply_to=blade,impact,pierce
								name="protection"
								description="Friendly warriors standing next to this unit have their blade, impact and pierce resistances increased by $item_step up to maximum of 75."
								affect_self=no
								affect_allies=yes
								[affect_adjacent]
									adjacent="n,ne,se,s,sw,nw"
								[/affect_adjacent]
							[/resistance]
					    [/abilities]
					[/effect]
				[/object]

				[switch]
					variable=use_promotion_level

					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
										multiply=1.15
										active_on=defense
										name="defensive wall"
										description="Friendly warriors standing next to this unit deal 15% more melee damage when defending."
										affect_self=no
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_defender]
											[filter_weapon]
												range=melee
											[/filter_weapon]
										[/filter_defender]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
										multiply=1.3
										active_on=defense
										name="defensive wall"
										description="Friendly warriors standing next to this unit deal 30% more melee damage when defending."
										affect_self=no
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
										[filter_defender]
											[filter_weapon]
												range=melee
											[/filter_weapon]
										[/filter_defender]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[damage]
										id=qquws_defensive_wall
									[/damage]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[damage]
										id=qquws_impenetrable_wall
										multiply=1.5
										active_on=defense
										name="impenetrable wall"
										description="Friendly warriors standing next to this unit deal 50% more damage when defending."
										affect_self=no
										affect_allies=yes
										[affect_adjacent]
											adjacent="n,ne,se,s,sw,nw"
										[/affect_adjacent]
									[/damage]
								[/abilities]
							[/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=double_attack
				
				{VARIABLE attacks_done $unit.variables.double_attack_bank}
				{VARIABLE is_second_attack $unit.variables.is_second_attack}
				[if]
					[variable]
						name=attacks_done
						equals=""
					[/variable]
					[then]
						{VARIABLE attacks_done 0}
						{VARIABLE is_second_attack no}
					[/then]
				[/if]

				[remove_object]
					find_in=unit
					object_id=qquws_double_attack_item_object
				[/remove_object]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						double_attack_required=$item_step
						double_attack_bank=$attacks_done
						is_second_attack=$is_second_attack
					[/variables]

					[object]
						id=qquws_double_attack_item_object
						take_only_once=no
						silent=yes

						[effect]
						    apply_to=attack
						    range=ranged
						    [not]
						    	special_id=qquws_block_specials
						    [/not]
						    [set_specials]
						    	mode=append
						     	[dummy]
									id=qquws_double_attack
									name="double attack ($attacks_done|\$item_step|)"
									description="When charged, this unit can attack twice in a single turn."
									active_on=offense
							 	[/dummy]
						    [/set_specials]
						[/effect]
					[/object]
				[/modify_unit]

				{VARIABLE sharpshooter_value 0}
				[switch]
					variable=use_promotion_level

					[case]
						value=3
						{VARIABLE sharpshooter_value 30}
						{VARIABLE sharpshooter_chance 50}
					[/case]
					[case]
						value=4
						{VARIABLE sharpshooter_value 50}
						{VARIABLE sharpshooter_chance 60}
					[/case]
					[case]
						value=5
						{VARIABLE sharpshooter_value 70}
						{VARIABLE sharpshooter_chance 70}
					[/case]
				[/switch]

				[if]
					[variable]
						name=sharpshooter_value
						greater_than=0
					[/variable]
					[then]
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								sharpshooter_chance=$sharpshooter_chance
								sharpshooter_fraction=$sharpshooter_value
							[/variables]

							[object]
								silent=yes

								[effect]
								    apply_to=attack
								    range=ranged
								    [not]
								    	special_id=qquws_block_specials
								    [/not]
								    remove_specials=qquws_sharpshooter
								    [set_specials]
								    	mode=append
								     	[dummy]
											id=qquws_sharpshooter
											name="sharpshooter"
											description="When used offensively, this attack has $sharpshooter_chance|% chance to pierce through the enemy and deal $sharpshooter_value|% damage to the enemy behind it. It does not deal damage to friendly units. Champions and the Butcher of Wesnoth are immune to the piercing effect, but can still be harmed if behind a regular enemy."
											active_on=offense
									 	[/dummy]
								    [/set_specials]
								[/effect]
							[/object]
						[/modify_unit]
					[/then]
				[/if]
			[/case]
			[case]
				value=hitn_run
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0

						[object]
							 silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=nightstalk
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									{ABILITY_NIGHTSTALK}
								[/abilities]
							[/effect]
						[/object]

						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 0}
					[/case]
					[case]
						value=1
						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run yes}
						{VARIABLE hit_and_run_amount 1}
					[/case]
					[case]
						value=2
						{VARIABLE hit_and_run no}
						{VARIABLE kill_and_run yes}
						{VARIABLE hit_and_run_amount 1}
					[/case]
					[case]
						value=3
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 1}
					[/case]
					[case]
						value=4
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 2}
					[/case]
					[case]
						value=5
						{VARIABLE hit_and_run yes}
						{VARIABLE kill_and_run no}
						{VARIABLE hit_and_run_amount 3}
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=berserk,qquws_block_specials
							    [/not]
							    
							    [set_specials]
							    	mode=append
							    	[attacks]
										id=qq_cover_of_the_night
										name="cover of the night"
										description="If used during the night against a distracted enemy, then the damage is increased by 50% and the enemy cannot retaliate. Champions and the Butcher of Wesnoth are immune and so are opponents with berserker frenzy. This attack to be available requires the move points to be below the maximum move points."
										value=0
										cumulative=no
										active_on=offense
										apply_to=opponent
										
										[filter_self]
											[filter_location]
												time_of_day_id=first_watch,midnight,second_watch
											[/filter_location]
											
											formula="moves < max_moves"
										[/filter_self]
										[filter_opponent]
											formula="
												enemy_of(self, flanker) and not flanker.petrified
											where
												flanker = unit_at(direction_from(loc, other.facing))
											"

											[filter_weapon]
												[not]
													special_id=berserk
												[/not]
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_opponent]
									[/attacks]
									[damage]
										id=qq_cover_of_the_night_dmg
										multiply=1.5
										active_on=offense
										apply_to=self
										
										[filter_self]
											[filter_location]
												time_of_day_id=first_watch,midnight,second_watch
											[/filter_location]
											
											formula="moves < max_moves"
										[/filter_self]
										[filter_opponent]
											formula="
												enemy_of(self, flanker) and not flanker.petrified
											where
												flanker = unit_at(direction_from(loc, other.facing))
											"

											[filter_weapon]
												[not]
													special_id=berserk
												[/not]
											[/filter_weapon]

											[not]
												trait=immune_to_specials
											[/not]
										[/filter_opponent]
									[/damage]
							    [/set_specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[if]
					[variable]
						name=hit_and_run
						boolean_equals=yes
					[/variable]
					[or]
						[variable]
							name=kill_and_run
							boolean_equals=yes
						[/variable]
					[/or]
					[then]
						[if]
							[variable]
								name=hit_and_run
								boolean_equals=yes
							[/variable]
							[then]
								{VARIABLE ability_id "qquws_hit_and_run"}
								{VARIABLE ability_name "hit and run +$hit_and_run_amount"}
								{VARIABLE ability_description "This unit gains additional moves back after attacking, but cannot attack again."}
							[/then]
							[else]
								{VARIABLE ability_id "qquws_kill_and_run"}
								{VARIABLE ability_name "kill and run +$hit_and_run_amount"}
								{VARIABLE ability_description "This unit gains additional moves back after eliminating an opponent, but cannot attack again."}
							[/else]
						[/if]
						
						[modify_unit]
							[filter]
								id=$unit.id
							[/filter]
							
							[variables]
								hit_and_run=$hit_and_run
								kill_and_run=$kill_and_run
								hit_and_run_amount=$hit_and_run_amount
							[/variables]
							
							moves=1 # fixes issue when kill and run gets replaced with hit and run
						[/modify_unit]
						
						[object]
							 silent=yes

							[effect]
								apply_to=remove_ability
								[abilities]
									[dummy]
										id=qquws_hit_and_run
									[/dummy]
									[dummy]
										id=qquws_kill_and_run
									[/dummy]
								[/abilities]
							[/effect]
							[effect]
								apply_to=new_ability
								[abilities]
									[dummy]
										id=$ability_id
										name=$ability_name
										description=$ability_description
									[/dummy]
								[/abilities]
							[/effect]
						[/object]
					[/then]
				[/if]
			[/case]
			[case]
				value=extra_strikes

				[switch]
					variable=use_promotion_level
					
					[case]
						value=0
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 50%."
										add="( if(hitpoints < 0.5 * max_hitpoints, 1, 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=1
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 65% and another one below 30%."
										add="( if(hitpoints < 0.65 * max_hitpoints, if(hitpoints < 0.3 * max_hitpoints, 2, 1), 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.65 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=2
						
						[object]
							silent=yes

							[effect]
							    apply_to=attack
							    [not]
							    	special_id=qquws_block_specials
							    [/not]
							    increase_attacks=1
							    remove_specials=qquws_extra_strikes
							 [/effect]
						[/object]
					[/case]
					[case]
						value=3
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     increase_accuracy=2
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 50%. Passively increases strikes by 1 and non-magical accuracy by 2."
										add="( if(hitpoints < 0.5 * max_hitpoints, 1, 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=4
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     increase_accuracy=1
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 65% and another one below 30%. Passively increases strikes by 1 and non-magical accuracy by 3."
										add="( if(hitpoints < 0.65 * max_hitpoints, if(hitpoints < 0.3 * max_hitpoints, 2, 1), 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.65 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
					[case]
						value=5
						
						[object]
							silent=yes

							[effect]
							     apply_to=attack
							     [not]
							    	special_id=qquws_block_specials
							    [/not]
							     increase_accuracy=2
							     increase_attacks=1
							     remove_specials=qquws_extra_strikes
							     [set_specials]
							    	  mode=append
							     	  [attacks]
										id=qquws_extra_strikes
										name="extra strikes"
										description="This unit gains 1 strike when it's hp drops below 50%. Passively increases strikes by 2 and non-magical accuracy by 5."
										add="( if(hitpoints < 0.5 * max_hitpoints, 1, 0) )"
										apply_to=self
										cumulative=yes
										[filter_self]
											formula="if(hitpoints < 0.5 * max_hitpoints, 1, 0)"
										[/filter_self]
									 [/attacks]
							     [/set_specials]
							 [/effect]
						[/object]
					[/case]
				[/switch]
			[/case]
			[case]
				value=rat_pack

				{VARIABLE chance_special 0}
				{VARIABLE chance_special_text ""}
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE rats_frequency 6}
					[/case]
					[case]
						value=1
						{VARIABLE rats_frequency 5}
					[/case]
					[case]
						value=2
						{VARIABLE rats_frequency 4}
					[/case]
					[case]
						value=3
						{VARIABLE rats_frequency 4}
						{VARIABLE chance_special 50}
						{VARIABLE chance_special_text " 50% chance to breed a special rat."}
					[/case]
					[case]
						value=4
						{VARIABLE rats_frequency 3}
						{VARIABLE chance_special 75}
						{VARIABLE chance_special_text " 75% chance to breed a special rat."}
					[/case]
					[case]
						value=5
						{VARIABLE rats_frequency 2}
						{VARIABLE chance_special 100}
						{VARIABLE chance_special_text " Always breeds a special rat."}
						
						[object]
							silent=yes
							
							[effect]
								apply_to=attack
								range=melee
								[set_specials]
									mode=append
									[plague]
										id=qquws_rats
										name="pet rat"
										description="When a unit is killed by a Plague attack, that unit is replaced with a unit on the same side as the unit with the Plague attack. This doesnâ€™t work on Undead or units in villages."
										type="Giant Rat"
									[/plague]
								[/set_specials]
							[/effect]
						[/object]
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[status]
					     spawns_rats=yes
					[/status]
					
					[variables]
						rats_frequency=$rats_frequency
						rats_special_chance=$chance_special
						rats_extra_info=$chance_special_text
					[/variables]

					[object]
						silent=yes

						[effect]
							apply_to=remove_ability
							[abilities]
								[dummy]
									id=qquws_breeds_rats
								[/dummy]
							[/abilities]
						[/effect]
						[effect]
							apply_to=new_ability
							[abilities]
								[dummy]
									id=qquws_breeds_rats
									name="breeds rats"
									description="This unit is able to breed tasty rats once every $rats_frequency turn(s) (max 4 bred rats).$chance_special_text"
								[/dummy]
							[/abilities]
						[/effect]
					[/object]
				[/modify_unit]
			[/case]
			[case]
				value=icewind_aura
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						{VARIABLE icewind_radius 1}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=1
						{VARIABLE icewind_radius 2}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=2
						{VARIABLE icewind_radius 3}
						{VARIABLE icewind_damage 0}
						{VARIABLE icewind_defense 0}
						{VARIABLE icewind_text ""}
					[/case]
					[case]
						value=3
						{VARIABLE icewind_radius 5}
						{VARIABLE icewind_damage 2}
						{VARIABLE icewind_defense 2}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
					[case]
						value=4
						{VARIABLE icewind_radius 7}
						{VARIABLE icewind_damage 4}
						{VARIABLE icewind_defense 5}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
					[case]
						value=5
						{VARIABLE icewind_radius 9}
						{VARIABLE icewind_damage 8}
						{VARIABLE icewind_defense 10}
						{VARIABLE icewind_text ", defenses by $icewind_defense and receive $icewind_damage cold damage"}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						icewind_radius=$icewind_radius
						icewind_damage=$icewind_damage
						icewind_defense=$icewind_defense
					[/variables]
				[/modify_unit]
			
				[object]
					silent=yes

					[effect]
						apply_to=remove_ability
						[abilities]
							[dummy]
								id=qquws_icewind_aura
							[/dummy]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_icewind_aura
								name="icewind aura $icewind_defense|,$icewind_damage|/$icewind_radius"
								description="At the beginning of your turn all enemies within $icewind_radius radius from this unit get their mp reduced by 30%$icewind_text. Affects units of the same or lower level as the item keeper. Champions and The Butcher of Wesnoth are immune."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/case]
			[case]
				value=dragon_protection
				
				[switch]
					variable=use_promotion_level
					[case]
						value=0
						
						[object]
							 silent=yes

							 [effect]
							    apply_to=resistance
							    replace=no
							    [resistance]
									blade=-15
									impact=-15
									pierce=-15
									arcane=-15
									cold=-15
									fire=-15
									secret=-35
							    [/resistance]
							[/effect]
						[/object]
						
						{VARIABLE dragon_protection_restore_amount 1}
					[/case]
					[case]
						value=1
						
						{VARIABLE dragon_protection_restore_amount 5}
					[/case]
					[case]
						value=2
						
						{VARIABLE dragon_protection_restore_amount 10}
					[/case]
					[case]
						value=3
						
						{VARIABLE dragon_protection_restore_amount 15}
					[/case]
					[case]
						value=4
						
						{VARIABLE dragon_protection_restore_amount 25}
					[/case]
					[case]
						value=5
						
						{VARIABLE dragon_protection_restore_amount 35}
					[/case]
				[/switch]
				
				[modify_unit]
					[filter]
						id=$unit.id
					[/filter]
					
					[variables]
						dragon_protection_threshold=$item_step
						dragon_protection_counter=1
						dragon_restore_amount=$dragon_protection_restore_amount
					[/variables]
				[/modify_unit]
			
				[object]
					silent=yes

					[effect]
						apply_to=remove_ability
						[abilities]
							[dummy]
								id=qquws_dragon_protection
							[/dummy]
						[/abilities]
					[/effect]
					[effect]
						apply_to=new_ability
						[abilities]
							[dummy]
								id=qquws_dragon_protection
								name="dragon's protection"
								description="When this unit is dying the Dragon's Protection revives it, restoring $dragon_protection_restore_amount|hp. Because of how much magical energy this requires, this can only trigger when the unit's hp is below certain point. A unit can only be revived once per turn (the counter refreshes at the beginning of the player's turn). Passively increases resistance to all common weapon types by 15% and against the secret attacks by 35%."
							[/dummy]
						[/abilities]
					[/effect]
				[/object]
			[/case]
		[/switch]
	[/event]
#enddef

