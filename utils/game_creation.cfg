#define CAMPAIGN_CREATION_OPTIONS
	{VARIABLE awss_map_id 6}
	{VARIABLE allow_predefined yes}
	
	[fire_event]
		name=init_and_replace_map_mask
	[/fire_event]

#	hide the choice since it's only one option
#	[message]
#		speaker=narrator
#		caption="Lord Master of All Wesnoth"
#		image="portraits/uws/razerman.png"
#		message="Welcome to the Quequo's Ultimate Wesnoth Survival Campaign. Before you can begin the game you must choose the campaign first:"
#		[option]
#			message="Return from Captivity - <span color='#37b84c'>5</span> scenarios, total <span color='#37b84c'>164</span> turns"
#			[command]
#				{VARIABLE awss_map_id 6}
#				{VARIABLE allow_predefined yes}
#				
#				[fire_event]
#					name=init_and_replace_map_mask
#				[/fire_event]
#			[/command]
#		[/option]
#	[/message]
	
	{VARIABLE scroll_remove_wall no}
	{VARIABLE maintain_hidden_leaders yes}
	{VARIABLE enable_after_games_copy_handicaps no}
	
	{ENABLED_ERA_CHECKER}
	{VARIABLE enable_weak_enemies no}
	
	[switch]
		variable=game_mode
		
		[case]
			value=scroll
			
			{VARIABLE scroll_type normal}
			{VARIABLE game_mode_readable Scroll}
			{VARIABLE make_everything_loyal yes}
			{VARIABLE is_pvp_game no}
			{VARIABLE is_default_spawn_race no}
			{VARIABLE win_condition "Get all the way to the end and defeat the Butcher of Wesnoth"}
			{VARIABLE objective_notes "You pay no upkeep for your troops, and earn no income from villages.
You can get gold from some enemies or casual treasures.
Letting a unit be reached by the lava means its immediate death.
You will find special areas during your trip, in which you can heal your units or get random upgrades."}
			
			
			[switch]
				variable=difficulty_readable
				
				[case]
					value=Easy
					
					{VARIABLE difficulty 2}
					{VARIABLE penalty_modifier 0.5}
					{VARIABLE enable_weak_enemies yes}
					{VARIABLE starting_gold 100}
					{VARIABLE leader_is_killable yes}
					{VARIABLE lose_condition "Your army is defeated."}
				[/case]
				
				[case]
					value=Normal
					
					{VARIABLE difficulty 2}
					{VARIABLE penalty_modifier 0.75}
					{VARIABLE starting_gold 100}
					{VARIABLE leader_is_killable yes}
					{VARIABLE lose_condition "Your army is defeated."}
				[/case]
				
				[case]
					value=Hard
					
					{VARIABLE difficulty 3}
					{VARIABLE penalty_modifier 1}
					{VARIABLE starting_gold 90}
					{VARIABLE leader_is_killable no}
					{VARIABLE lose_condition "Your leader is defeated."}
				[/case]
				
				[case]
					value=Hardcore
					
					{VARIABLE difficulty 4}
					{VARIABLE penalty_modifier 1.25}
					{VARIABLE starting_gold 85}
					{VARIABLE leader_is_killable no}
					{VARIABLE lose_condition "Your leader is defeated."}
				[/case]
			[/switch]
			
			[message]
				speaker=narrator
				caption="Scholar of Black Fire"
				image="portraits/uws/tineen.png"
				message="Welcome to the Quequo's Ultimate Wesnoth Survival Campaign. Before you can begin the game you must choose some game settings first. Would you like to gamble with wesnoth RNG? (unit levels are always maintained)"
				[option]
					message="No, give me the predefined enemies, always the same"
					[command]
						{VARIABLE randomised_waves no}
						{VARIABLE chaos_random no}
					[/command]
					[show_if]
						[variable]
							name=allow_predefined
							boolean_equals=yes
						[/variable]
					[/show_if]
				[/option]
				[option]
					message="Yes, give me random enemies, mirrored for each player"
					[command]
						{VARIABLE randomised_waves yes}
						{VARIABLE chaos_random no}
					[/command]
				[/option]
				[option]
					message="Full random, each player gets different enemies"
					[command]
						{VARIABLE randomised_waves yes}
						{VARIABLE chaos_random yes}
					[/command]
				[/option]
			[/message]
			
			[message]
				speaker=narrator
				caption="Ancient Oak of Forgotten Age"
				image="portraits/uws/shaman.png"
				message="Choose between helper labels and fog mode."
				[option]
					message="Labels indicating coming enemies without fog"
					[command]
						{VARIABLE fog_mode no}
						{VARIABLE labels_only_levels no}
					[/command]
					
				[/option]
				[option]
					message="Helper labels showing enemy levels with fog"
					[command]
						{VARIABLE fog_mode no}
						{VARIABLE labels_only_levels yes}
						
						[modify_side]
							[filter_side]
								side=8,9
							[/filter_side]
							
							fog=yes
						[/modify_side]
					[/command]
					
				[/option]
				[option]
					message="Full fog mode"
					[command]
						{VARIABLE fog_mode yes}
						
						[modify_side]
							[filter_side]
								side=8,9
							[/filter_side]
							
							fog=yes
						[/modify_side]
					[/command]
				[/option]
			[/message]
			
			[if]
				[variable]
					name=is_single_player_game
					boolean_equals=yes
				[/variable]
				[then]
					{VARIABLE scroll_remove_wall no}
				[/then]
				[else]
					[message]
						speaker=narrator
						caption="Undisputed Jungle Spearmaster"
						image="portraits/uws/saurian-alt.png"
						message="What about the wall in between the players?"
						[option]
							message="Keep the wall"
							[command]
								{VARIABLE scroll_remove_wall no}
							[/command]
						[/option]
						[option]
							message="Remove the wall for a cooperative game"
							[command]
								{VARIABLE scroll_remove_wall yes}
								{SCROLL_REMOVE_WALL_IF_COOP}
							[/command]
						[/option]
					[/message]
				[/else]
			[/if]
		[/case]
		
		[case]
			value=slash
			
			{VARIABLE scroll_type slow}
			{VARIABLE game_mode_readable "Hack'n Slash"}
			{VARIABLE make_everything_loyal yes}
			{VARIABLE is_pvp_game no}
			{VARIABLE is_default_spawn_race yes}
			{VARIABLE win_condition "Get all the way to the end and defeat the Butcher of Wesnoth"}
			{VARIABLE objective_notes "You pay no upkeep for your troops, and earn no income from villages.
You can get gold from some enemies or casual treasures.
Letting a unit be reached by the lava means its immediate death.
You will find special areas during your trip, in which you can heal your units or get random upgrades."}
			
			{VARIABLE starting_gold_easy 65}
			{VARIABLE starting_gold_normal 65}
			{VARIABLE starting_gold_hard 60}
			{VARIABLE starting_gold_hardcore 55}
			
			[if]
				[variable]
					name=is_single_player_game
					boolean_equals=yes
				[/variable]
				[then]
					{VARIABLE starting_gold_easy 120}
					{VARIABLE starting_gold_normal 120}
					{VARIABLE starting_gold_hard 110}
					{VARIABLE starting_gold_hardcore 100}
				[/then]
			[/if]
			
			
			[switch]
				variable=difficulty_readable
				
				[case]
					value=Easy
					
					{VARIABLE difficulty 4}
					{VARIABLE enable_weak_enemies yes}
					{VARIABLE penalty_modifier 0.5}
					{VARIABLE starting_gold $starting_gold_easy}
					{VARIABLE leader_is_killable yes}
					{VARIABLE lose_condition "Your army is defeated."}
				[/case]
				
				[case]
					value=Normal
					
					{VARIABLE difficulty 4}
					{VARIABLE penalty_modifier 0.75}
					{VARIABLE starting_gold $starting_gold_normal}
					{VARIABLE leader_is_killable yes}
					{VARIABLE lose_condition "Your army is defeated."}
				[/case]
				
				[case]
					value=Hard
					
					# hard for slash = 5
					{VARIABLE difficulty 5}
					{VARIABLE penalty_modifier 1}
					{VARIABLE starting_gold $starting_gold_hard}
					{VARIABLE leader_is_killable no}
					{VARIABLE lose_condition "Your leader is defeated."}
				[/case]
				
				[case]
					value=Hardcore
					
					# hardcore for slash = 6
					{VARIABLE difficulty 6}
					{VARIABLE penalty_modifier 1.25}
					{VARIABLE starting_gold $starting_gold_hardcore}
					{VARIABLE leader_is_killable no}
					{VARIABLE lose_condition "Your leader is defeated."}
				[/case]
			[/switch]
			
			{CLEAR_VARIABLE starting_gold_easy}
			{CLEAR_VARIABLE starting_gold_normal}
			{CLEAR_VARIABLE starting_gold_hard}
			{CLEAR_VARIABLE starting_gold_hardcore}
			
			[if]
				[variable]
					name=allow_predefined
					boolean_equals=yes
				[/variable]
				[then]
					[message]
						speaker=narrator
						caption="Guardian of the Temple of the Moon"
						image="portraits/uws/warg.png"
						message="Welcome to the Quequo's Ultimate Wesnoth Survival Campaign. Before you can begin the game you must choose some game settings first. Would you like to gamble with wesnoth RNG? (unit levels are always maintained)"
						[option]
							message="No, give me the predefined enemies, always the same"
							[command]
								{VARIABLE randomised_waves no}
								{VARIABLE fog_mode no}
								{VARIABLE chaos_random no}
							[/command]
						[/option]
						[option]
							message="Yes, give me random enemies"
							[command]
								{VARIABLE randomised_waves yes}
								{VARIABLE fog_mode no}
								{VARIABLE chaos_random no}
							[/command]
						[/option]
					[/message]
				[/then]
				[else]
					{VARIABLE randomised_waves yes}
					{VARIABLE fog_mode no}
					{VARIABLE chaos_random no}
				[/else]
			[/if]
		[/case]
	[/switch]
	
	{GENERATE_RANK_RELATED_VARIABLES}
	{GENERATE_GAME_DESCRIPTION_AFTER_SETTINGS}
#enddef

#define CAMPAIGN_SCENARIO_PREPARE
	{GENERATE_GAME_DESCRIPTION_AFTER_SETTINGS}
#enddef

#define GAME_CREATION_OPTIONS
	{VARIABLE show_random_map_menu no}
		
	[message]
		speaker=narrator
		caption="Lord Master of All Wesnoth"
		image="portraits/uws/razerman.png"
		message="Welcome to the Quequo's Ultimate Wesnoth Survival. Before you can begin the game you must choose the scenario first:"
		[option]
			message="Eastern Shore - <span color='#6cd15c'>22</span> hex turns"
			[command]
				{VARIABLE awss_map_id 12}
				{VARIABLE allow_predefined yes}
				
				[fire_event]
					name=init_and_replace_map_mask
				[/fire_event]
			[/command]
		[/option]
		[option]
			message="Invaded Forests - <span color='#37b84c'>40</span> hex turns"
			[command]
				{VARIABLE awss_map_id 0}
				{VARIABLE allow_predefined yes}
				
				[fire_event]
					name=init_and_replace_map_mask
				[/fire_event]
			[/command]
		[/option]
		[option]
			message="Dwarvish Mountains - <span color='#76a349'>48</span> hex turns"
			[command]
				{VARIABLE awss_map_id 3}
				{VARIABLE allow_predefined yes}
				
				[fire_event]
					name=init_and_replace_map_mask
				[/fire_event]
			[/command]
		[/option]
		[option]
			message="Dimaga Beach - <span color='#c2c938'>55</span> hex turns"
			[command]
				{VARIABLE awss_map_id 5}
				{VARIABLE allow_predefined yes}
				
				[fire_event]
					name=init_and_replace_map_mask
				[/fire_event]
			[/command]
		[/option]
		[option]
			message="Original TSW - <span color='#cfa438'>60</span> hex turns"
			[command]
				{VARIABLE awss_map_id 1}
				{VARIABLE allow_predefined yes}
				
				[fire_event]
					name=init_and_replace_map_mask
				[/fire_event]
			[/command]
		[/option]
		[option]
			message="The Great Waters - <span color='#c96c2e'>69</span> hex turns"
			[command]
				{VARIABLE awss_map_id 2}
				{VARIABLE allow_predefined yes}
				
				[fire_event]
					name=init_and_replace_map_mask
				[/fire_event]
			[/command]
		[/option]
		[option]
			message="Valley of the Necromancer - <span color='#c94f36'>160</span> hex turns"
			[command]
				{VARIABLE awss_map_id 4}
				{VARIABLE allow_predefined no}
				
				[fire_event]
					name=init_and_replace_map_mask
				[/fire_event]
			[/command]
		[/option]
#		[option]
#			message="Random generated map - host selects length"
#			[command]
#				# TODO remove once the generation code is done
#				{VARIABLE awss_map_id 0}
#				# TODO remove once the generation code is done
#				
#				{VARIABLE show_random_map_menu yes}
#			[/command]
#		[/option]
	[/message]
	
	[if]
		[variable]
			name=show_random_map_menu
			boolean_equals=yes
		[/variable]
		[then]
			[message]
				speaker=narrator
				caption="Elf Queen of the Silver Forest"
				image="portraits/uws/elf-mystic.png"
				message="How long you want the mission to be?"
				[option]
					message="Short - 25 turns"
					[command]
						{VARIABLE random_map_length 25}
					[/command]
				[/option]
				[option]
					message="Medium - 40 turns"
					[command]
						{VARIABLE random_map_length 40}
					[/command]
				[/option]
				[option]
					message="Long - 60 turns"
					[command]
						{VARIABLE random_map_length 60}
					[/command]
				[/option]
				[option]
					message="Half-marathon - 80 turns"
					[command]
						{VARIABLE random_map_length 80}
					[/command]
				[/option]
				[option]
					message="Marathon - 160 turns"
					[command]
						{VARIABLE random_map_length 160}
					[/command]
				[/option]
			[/message]
			
			[message]
				speaker=narrator
				caption="Fire Lord of the Black Dune Sultanat"
				image="portraits/uws/tineen.png"
				message="Would you like the Wesnoth RNG to generate the random map seed, or prefer to provide your own?"
				[option]
					message="Generate one for me please"
					[command]
						{VARIABLE generate_random_seed yes}
					[/command]
				[/option]
				[option]
					message="No, I want the map to be generated based on my input"
					[command]
						{VARIABLE generate_random_seed no}
					[/command]
				[/option]
			[/message]
			
			[if]
				[variable]
					name=generate_random_seed
					equals=yes
				[/variable]
				[then]
					# TODO call lua function to generate random seed in sync context
				[/then]
				[else]
					[message]
						speaker=narrator
						caption="Black Bane of Balamour"
						image="portraits/uws/black-cat.png"
						message="Enter 8 alphanumerical characters for the random map seed (case sensitive):"

						[text_input]
							variable=random_map_seed
							label="Seed:"
						[/text_input]
					[/message]
				[/else]
			[/if]
		[/then]
	[/if]
	
	{VARIABLE scroll_remove_wall no}
	{VARIABLE maintain_hidden_leaders yes}
	{VARIABLE enable_after_games_copy_handicaps no}
	
	{ENABLED_ERA_CHECKER}
	{VARIABLE enable_weak_enemies no}
	
	[switch]
		variable=game_mode
		
		[case]
			value=scroll
			
			{VARIABLE scroll_type normal}
			{VARIABLE game_mode_readable Scroll}
			{VARIABLE make_everything_loyal yes}
			{VARIABLE is_pvp_game no}
			{VARIABLE is_default_spawn_race no}
			{VARIABLE win_condition "Get all the way to the end and defeat the Butcher of Wesnoth"}
			{VARIABLE objective_notes "You pay no upkeep for your troops, and earn no income from villages.
You can get gold from some enemies or casual treasures.
Letting a unit be reached by the lava means its immediate death.
You will find special areas during your trip, in which you can heal your units or get random upgrades."}
			
			[if]
				[variable]
					name=is_single_player_game
					boolean_equals=yes
				[/variable]
				[then]
					{VARIABLE scroll_remove_wall no}
				[/then]
				[else]
					[message]
						speaker=narrator
						caption="Undisputed Jungle Spearmaster"
						image="portraits/uws/saurian-alt.png"
						message="What about the wall in between the players?"
						[option]
							message="Keep the wall"
							[command]
								{VARIABLE scroll_remove_wall no}
							[/command]
						[/option]
						[option]
							message="Remove the wall for a cooperative game"
							[command]
								{VARIABLE scroll_remove_wall yes}
								{SCROLL_REMOVE_WALL_IF_COOP}
							[/command]
						[/option]
					[/message]
				[/else]
			[/if]
			
			[message]
				speaker=narrator
				caption="Eternal Bones of the Nameless One"
				image="portraits/uws/cloaked.png"
				message="Choose your challenge now:"
				[option]
					message="<span color='#90d117'>Easy</span> - weaker enemies, no bonus penalty, 100 gold, leader <span color='#42a83e'>can</span> die"
					[command]
						{VARIABLE difficulty_readable Easy}
						{VARIABLE difficulty 2}
						{VARIABLE enable_weak_enemies yes}
						{VARIABLE penalty_modifier 0.5}
						{VARIABLE starting_gold 100}
						{VARIABLE leader_is_killable yes}
						{VARIABLE lose_condition "Your army is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#f5a720'>Normal</span> - standard enemies, 75% bonus penalty, 100 gold, leader <span color='#42a83e'>can</span> die"
					[command]
						{VARIABLE difficulty_readable Normal}
						{VARIABLE difficulty 2}
						{VARIABLE penalty_modifier 0.75}
						{VARIABLE starting_gold 100}
						{VARIABLE leader_is_killable yes}
						{VARIABLE lose_condition "Your army is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#eb6e2a'>Hard</span> - a few extra enemies, 100% bonus penalty, 90 gold, leader <span color='#f02d26'>must not</span> die"
					[command]
						{VARIABLE difficulty_readable Hard}
						{VARIABLE difficulty 3}
						{VARIABLE penalty_modifier 1}
						{VARIABLE starting_gold 90}
						{VARIABLE leader_is_killable no}
						{VARIABLE lose_condition "Your leader is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#853431'>Hardcore</span> - extra enemies, 125% bonus penalty, 85 gold, leader <span color='#f02d26'>must not</span> die"
					[command]
						{VARIABLE difficulty_readable Hardcore}
						{VARIABLE difficulty 4}
						{VARIABLE penalty_modifier 1.25}
						{VARIABLE starting_gold 85}
						{VARIABLE leader_is_killable no}
						{VARIABLE lose_condition "Your leader is defeated."}
					[/command]
				[/option]
			[/message]
			
			[message]
				speaker=narrator
				caption="Scholar of Black Fire"
				image="portraits/uws/tineen.png"
				message="Do you also want to gamble with wesnoth RNG? (unit levels are always maintained)"
				[option]
					message="No, give me the predefined enemies, always the same"
					[command]
						{VARIABLE randomised_waves no}
						{VARIABLE chaos_random no}
					[/command]
					[show_if]
						[variable]
							name=allow_predefined
							boolean_equals=yes
						[/variable]
					[/show_if]
				[/option]
				[option]
					message="Yes, give me random enemies, mirrored for each player"
					[command]
						{VARIABLE randomised_waves yes}
						{VARIABLE chaos_random no}
					[/command]
				[/option]
				[option]
					message="Full random, each player gets different enemies"
					[command]
						{VARIABLE randomised_waves yes}
						{VARIABLE chaos_random yes}
					[/command]
				[/option]
			[/message]
			
			[message]
				speaker=narrator
				caption="Ancient Oak of Forgotten Age"
				image="portraits/uws/shaman.png"
				message="Choose between helper labels and fog mode."
				[option]
					message="Labels indicating coming enemies without fog"
					[command]
						{VARIABLE fog_mode no}
						{VARIABLE labels_only_levels no}
					[/command]
					
				[/option]
				[option]
					message="Helper labels showing enemy levels with fog"
					[command]
						{VARIABLE fog_mode no}
						{VARIABLE labels_only_levels yes}
						
						[modify_side]
							[filter_side]
								side=8,9
							[/filter_side]
							
							fog=yes
						[/modify_side]
					[/command]
					
				[/option]
				[option]
					message="Full fog mode"
					[command]
						{VARIABLE fog_mode yes}
						
						[modify_side]
							[filter_side]
								side=8,9
							[/filter_side]
							
							fog=yes
						[/modify_side]
					[/command]
				[/option]
			[/message]
		[/case]
		
		[case]
			value=slash
			
			{VARIABLE scroll_type slow}
			{VARIABLE game_mode_readable "Hack'n Slash"}
			{VARIABLE make_everything_loyal yes}
			{VARIABLE is_pvp_game no}
			{VARIABLE is_default_spawn_race yes}
			{VARIABLE win_condition "Get all the way to the end and defeat the Butcher of Wesnoth"}
			{VARIABLE objective_notes "You pay no upkeep for your troops, and earn no income from villages.
You can get gold from some enemies or casual treasures.
Letting a unit be reached by the lava means its immediate death.
You will find special areas during your trip, in which you can heal your units or get random upgrades."}
			
			{VARIABLE starting_gold_easy 65}
			{VARIABLE starting_gold_normal 65}
			{VARIABLE starting_gold_hard 60}
			{VARIABLE starting_gold_hardcore 55}
			
			[if]
				[variable]
					name=is_single_player_game
					boolean_equals=yes
				[/variable]
				[then]
					{VARIABLE starting_gold_easy 120}
					{VARIABLE starting_gold_normal 120}
					{VARIABLE starting_gold_hard 110}
					{VARIABLE starting_gold_hardcore 100}
				[/then]
			[/if]
			
			[message]
				speaker=narrator
				caption="Eternal Bones of the Nameless One"
				image="portraits/uws/cloaked.png"
				message="Choose your challenge now:"
				[option]
					message="<span color='#90d117'>Easy</span> - weaker enemies, no bonus penalty, $starting_gold_easy gold, leader <span color='#42a83e'>can</span> die"
					[command]
						{VARIABLE difficulty_readable Easy}
						{VARIABLE difficulty 4}
						{VARIABLE enable_weak_enemies yes}
						{VARIABLE penalty_modifier 0.5}
						{VARIABLE starting_gold $starting_gold_easy}
						{VARIABLE leader_is_killable yes}
						{VARIABLE lose_condition "Your army is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#f5a720'>Normal</span> - standard enemies, 75% handicap, $starting_gold_normal gold, leader <span color='#42a83e'>can</span> die"
					[command]
						{VARIABLE difficulty_readable Normal}
						{VARIABLE difficulty 4}
						{VARIABLE penalty_modifier 0.75}
						{VARIABLE starting_gold $starting_gold_normal}
						{VARIABLE leader_is_killable yes}
						{VARIABLE lose_condition "Your army is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#eb6e2a'>Hard</span> - a few extra enemies, 100% handicap, $starting_gold_hard gold, leader <span color='#f02d26'>must not</span> die"
					[command]
						{VARIABLE difficulty_readable Hard}
						# hard for slash = 5
						{VARIABLE difficulty 5}
						{VARIABLE penalty_modifier 1}
						{VARIABLE starting_gold $starting_gold_hard}
						{VARIABLE leader_is_killable no}
						{VARIABLE lose_condition "Your leader is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#853431'>Hardcore</span> - extra enemies, 125% handicap, $starting_gold_hardcore gold, leader <span color='#f02d26'>must not</span> die"
					[command]
						{VARIABLE difficulty_readable Hardcore}
						# hardcore for slash = 6
						{VARIABLE difficulty 6}
						{VARIABLE penalty_modifier 1.25}
						{VARIABLE starting_gold $starting_gold_hardcore}
						{VARIABLE leader_is_killable no}
						{VARIABLE lose_condition "Your leader is defeated."}
					[/command]
				[/option]
			[/message]
			
			{CLEAR_VARIABLE starting_gold_easy}
			{CLEAR_VARIABLE starting_gold_normal}
			{CLEAR_VARIABLE starting_gold_hard}
			{CLEAR_VARIABLE starting_gold_hardcore}
			
			[message]
				speaker=narrator
				caption="Guardian of the Temple of the Moon"
				image="portraits/uws/warg.png"
				message="Do you also want to gamble with wesnoth RNG? (unit levels are always maintained)"
				[option]
					message="No, give me the predefined enemies, always the same"
					[command]
						{VARIABLE randomised_waves no}
						{VARIABLE fog_mode no}
						{VARIABLE chaos_random no}
					[/command]
					[show_if]
						[variable]
							name=allow_predefined
							boolean_equals=yes
						[/variable]
					[/show_if]
				[/option]
				[option]
					message="Yes, give me random enemies"
					[command]
						{VARIABLE randomised_waves yes}
						{VARIABLE fog_mode no}
						{VARIABLE chaos_random no}
					[/command]
				[/option]
			[/message]
		[/case]
		
		[case]
			value=race
			
			{VARIABLE scroll_type slow}
			{VARIABLE game_mode_readable Race}
			{VARIABLE make_everything_loyal no}
			{VARIABLE is_pvp_game yes}
			{VARIABLE is_default_spawn_race yes}
			{VARIABLE win_condition "Race to the top and be te first to capture the flag"}
			{VARIABLE objective_notes "You receive gold from villages and all recruited units cost upkeep.
You can get additional gold from some enemies or casual treasures.
Letting a unit be reached by the lava means its immediate death.
You will find special areas during your trip, in which you can heal your units or get random upgrades."}
					
			[message]
				speaker=narrator
				caption="Eternal Bones of the Nameless One"
				image="portraits/uws/cloaked.png"
				message="Choose your challenge now:"
				[option]
					message="<span color='#90d117'>Easy</span> - weaker enemies, no bonus penalty, leader <span color='#42a83e'>can</span> die"
					[command]
						{VARIABLE difficulty_readable Easy}
						{VARIABLE difficulty 3}
						{VARIABLE enable_weak_enemies yes}
						{VARIABLE penalty_modifier 0.5}
						{VARIABLE leader_is_killable yes}
						{VARIABLE lose_condition "Your army is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#f5a720'>Normal</span> - standard enemies, 75% handicap, leader <span color='#42a83e'>can</span> die"
					[command]
						{VARIABLE difficulty_readable Normal}
						{VARIABLE difficulty 3}
						{VARIABLE penalty_modifier 0.75}
						{VARIABLE leader_is_killable yes}
						{VARIABLE lose_condition "Your army is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#eb6e2a'>Hard</span> - a few extra enemies, 100% handicap, leader <span color='#f02d26'>must not</span> die"
					[command]
						{VARIABLE difficulty_readable Hard}
						# hard for race = 4
						{VARIABLE difficulty 4}
						{VARIABLE penalty_modifier 1}
						{VARIABLE leader_is_killable no}
						{VARIABLE lose_condition "Your leader is defeated."}
					[/command]
				[/option]
				[option]
					message="<span color='#853431'>Hardcore</span> - extra enemies, 125% handicap, leader <span color='#f02d26'>must not</span> die"
					[command]
						{VARIABLE difficulty_readable Hardcore}
						# hardcore for race = 5
						{VARIABLE difficulty 5}
						{VARIABLE penalty_modifier 1.25}
						{VARIABLE leader_is_killable no}
						{VARIABLE lose_condition "Your leader is defeated."}
					[/command]
				[/option]
			[/message]
			
			[message]
				speaker=narrator
				caption="Elite Marksman of the Royal Hall"
				image="portraits/uws/crossbowman.png"
				message="How much starting gold should both players receive?"
				[option]
					message="<span color='#90d117'>Plenty</span> - 120 starting gold for a fast paced game"
					[command]
						{VARIABLE starting_gold 120}
					[/command]
				[/option]
				[option]
					message="<span color='#f5a720'>Normal</span> - 75 starting gold regular game"
					[command]
						{VARIABLE starting_gold 75}
					[/command]
				[/option]
				[option]
					message="<span color='#eb6e2a'>Low</span> - 30 starting gold challenge"
					[command]
						{VARIABLE starting_gold 30}
					[/command]
				[/option]
			[/message]
			
			[message]
				speaker=narrator
				caption="Guardian of the Temple of the Moon"
				image="portraits/uws/warg.png"
				message="Do you also want to gamble with wesnoth RNG? (unit levels are always maintained)"
				[option]
					message="No, give me the predefined enemies, always the same"
					[command]
						{VARIABLE randomised_waves no}
						{VARIABLE fog_mode no}
						{VARIABLE chaos_random no}
					[/command]
					[show_if]
						[variable]
							name=allow_predefined
							boolean_equals=yes
						[/variable]
					[/show_if]
				[/option]
				[option]
					message="Yes, give me random enemies, mirrored for each player"
					[command]
						{VARIABLE randomised_waves yes}
						{VARIABLE fog_mode no}
						{VARIABLE chaos_random no}
					[/command]
				[/option]
				[option]
					message="Full random, each player gets different enemies"
					[command]
						{VARIABLE randomised_waves yes}
						{VARIABLE fog_mode no}
						{VARIABLE chaos_random yes}
					[/command]
				[/option]
			[/message]
		[/case]
		
		[case]
			value=after_classic
			
			{VARIABLE scroll_type none}
			{VARIABLE game_mode_readable "PvP Survival"}
			{VARIABLE make_everything_loyal no}
			{VARIABLE is_pvp_game yes}
			{VARIABLE is_default_spawn_race no}
			{VARIABLE win_condition "Survive the waves of enemies longer than your opponent"}
			{VARIABLE objective_notes "You receive gold from villages and all recruited units cost upkeep.
Every few turns a new wave of enemies spawn. Survive as long as you can."}
			{VARIABLE lose_condition "Your leader is defeated."}
			{VARIABLE maintain_hidden_leaders no}
			{VARIABLE enable_after_games_copy_handicaps yes}
			{VARIABLE leader_is_killable no}
			{VARIABLE starting_gold 90}
			{VARIABLE game_settings[$awss_map_id].threshold_initiated 4}
			{VARIABLE game_settings[$awss_map_id].threshold_proven 8}
			{VARIABLE game_settings[$awss_map_id].threshold_notable 14}
			{VARIABLE game_settings[$awss_map_id].threshold_significant 22}
			{VARIABLE game_settings[$awss_map_id].threshold_epic 33}
			
			# replace with the message/option below
			{VARIABLE after_games_spawn_patter copies}
			
#			[message]
#				speaker=narrator
#				caption="Swordmaster of the Southern Lands"
#				image="portraits/uws/southern-lord.png"
#				message="Select enemy spawn pattern"
#				[option]
#					message="Copies only"
#					[command]
#						{VARIABLE after_games_spawn_patter copies}
#					[/command]
#				[/option]
#				[option]
#					message="Waves only, mirrored random"
#					[command]
#						{VARIABLE after_games_spawn_patter random}
#					[/command]
#				[/option]
#				[option]
#					message="Waves only, full random"
#					[command]
#						{VARIABLE after_games_spawn_patter random}
#					[/command]
#				[/option]
#				[option]
#					message="Copies and waves, mirrored random"
#					[command]
#						{VARIABLE after_games_spawn_patter random}
#					[/command]
#				[/option]
#				[option]
#					message="Copies and waves, full random"
#					[command]
#						{VARIABLE after_games_spawn_patter random}
#					[/command]
#				[/option]
#				[option]
#					message="Copies and waves, players choose"
#					[command]
#						{VARIABLE after_games_spawn_patter choice}
#					[/command]
#				[/option]
#			[/message]

			[message]
				speaker=narrator
				caption="The All-Seeing Creep"
				image="portraits/uws/watcher.png"
				message="Fog or no fog?"
				[option]
					message="Fog, let's be sneaky"
					[command]
						{VARIABLE fog_mode yes}
					[/command]
				[/option]
				[option]
					message="No fog, full visibility"
					[command]
						{VARIABLE fog_mode no}
						
						[modify_side]
							[filter_side]
								side=8,9
							[/filter_side]
							
						       	fog=no
						[/modify_side]
					[/command]
				[/option]
			[/message]
		[/case]
		
		[case]
			value=after_race
			
			{VARIABLE leader_is_killable no}
			{VARIABLE starting_gold 90}
			
			[message]
				speaker=narrator
				caption="Master Horseman at Royal Stables"
				image="portraits/uws/horse-lancer.png"
				message="Race spawn frequency"
				[option]
					message="Easy, every 9 hexes"
					[command]
						{VARIABLE after_race_frequency 9}
					[/command]
				[/option]
				[option]
					message="Medium, every 7 hexes"
					[command]
						{VARIABLE after_race_frequency 7}
					[/command]
				[/option]
				[option]
					message="Hard, every 5 hexes"
					[command]
						{VARIABLE after_race_frequency 5}
					[/command]
				[/option]
			[/message]
			
			[message]
				speaker=narrator
				caption="Protector of the Cementery Gates"
				image="portraits/uws/dspearman.png"
				message="Select enemy spawn pattern"
				[option]
					message="Copies only"
					[command]
						{VARIABLE after_games_spawn_patter copies}
					[/command]
				[/option]
				[option]
					message="Copies and waves, all random"
					[command]
						{VARIABLE after_games_spawn_patter random}
					[/command]
				[/option]
				[option]
					message="Copies and waves, players choose"
					[command]
						{VARIABLE after_games_spawn_patter choice}
					[/command]
				[/option]
			[/message]
		[/case]
	[/switch]
	
	{GENERATE_RANK_RELATED_VARIABLES}
	{GENERATE_GAME_DESCRIPTION_AFTER_SETTINGS}
#enddef

#define GENERATE_GAME_DESCRIPTION_AFTER_SETTINGS
	[lua]
	    code = <<
	        local version = wesnoth.get_variable('awss_version')
	        local is_campaign = wesnoth.get_variable('uws_is_campaign')
	        local randomised_waves = wesnoth.get_variable("randomised_waves")
	        local fog_mode = wesnoth.get_variable("fog_mode")
	        local labels_only_levels = wesnoth.get_variable("labels_only_levels")
	        local chaos_random = wesnoth.get_variable("chaos_random")
	        local difficulty = wesnoth.get_variable("difficulty_readable")
	        local leader = wesnoth.get_variable("leader_is_killable")
	        local game_mode = wesnoth.get_variable("game_mode")
	        local game_mode_readable = wesnoth.get_variable("game_mode_readable")
	        local map_id = wesnoth.get_variable("awss_map_id")
	        local after_games_spawn_patter = wesnoth.get_variable("after_games_spawn_patter")
	        local after_race_frequency = wesnoth.get_variable("after_race_frequency")
	        local map_info = wesnoth.get_variable("game_settings[" .. map_id .. "].name")
	        local allow_ae = wesnoth.get_variable("qquws_allow_ae_units")
	        local allow_wotg = wesnoth.get_variable("allow_wotg_units")
	        local rol_units = wesnoth.get_variable("allow_rol_units")
	        local eoma_units = wesnoth.get_variable("allow_eoma_units")
	        local info_data = ''
	        local wave_mode_all = { 'Default', }
	        
	        local fog_mode_str = 'no'
	        if fog_mode == true then
	        	fog_mode_str = 'yes'
	        elseif labels_only_levels == true then
	        	fog_mode_str = 'levels only'
	        end
	        
	        local randomised_str = 'no'
	        if randomised_waves == true then
	        	if chaos_random == true then
	 			randomised_str = 'full random'
	 		else
	 			if game_mode == 'slash' then
	 				randomised_str = 'yes'
	 			else
	 				randomised_str = 'mirrored random'
	 			end
	 		end
	        end
	        
	        local leader_str = 'no'
	        if leader == true then
	        	leader_str = 'yes'
	        end
	        
	        if allow_ae then
	        	table.insert(wave_mode_all, 'Ageless')
	       	end
	       	
	        if allow_wotg then
	        	table.insert(wave_mode_all, 'WotG')
	        end
	        
	        if rol_units then
	        	table.insert(wave_mode_all, 'Reign of Lords')
	        end
	        
	        if eoma_units then
	        	table.insert(wave_mode_all, 'EoMa')
	        end
	        
	        local after_spawns_str = ''
	        if after_games_spawn_patter == 'copies' then
	        	after_spawns_str = 'Copies only'
	        elseif after_games_spawn_patter == 'random' then
	        	after_spawns_str = 'Random'
	        else
	        	after_spawns_str = 'Players choice'
	        end
	        
	        if game_mode == 'after_race' then
	        	after_spawns_str = after_spawns_str .. ' (every ' .. after_race_frequency .. ' hexes)'
	        end
	        
	        local mod_name = "Quequo's Ultimate Wesnoth Survival v." .. version
	        local game_settings = 'Map: ' .. map_info .. ' | Game mode: ' .. game_mode_readable .. ' | Spawn: ' .. table.concat(wave_mode_all, ', ')
	        local map_settings = ''
	        if game_mode == 'scroll' or game_mode == 'race' or game_mode == 'slash' then
	        	map_settings = 'Challenge: ' .. difficulty .. ' | Leader can die: ' .. leader_str  .. ' | Randomised waves: ' .. randomised_str
	        	
	        	if game_mode == 'scroll' then
	        		map_settings = map_settings .. ' | Fog mode: ' .. fog_mode_str
	        	end	
	        else
	        	map_settings = 'Leader can die: ' .. leader_str  .. ' | Spawns: ' .. after_spawns_str .. ' | Fog mode: ' .. fog_mode_str
	        end
	        
	        wesnoth.interface.add_chat_message(mod_name, game_settings)
	        wesnoth.interface.add_chat_message(mod_name, map_settings)
	        
	        info_data = game_settings .. '\
' .. map_settings

		if is_campaign then
			wesnoth.interface.add_chat_message(mod_name, "The UWS Campaign is in it's alpha release. Some bugs may be present and things may not work as expected. Please message quequo if things are not working.")
		end
	        
	        wesnoth.set_variable('game_info_data', info_data)
	    >>
	[/lua]
	
	[objectives]
		summary="The lava is going upward, run away from it!"
		[objective]
			description=$win_condition
			condition=win
		[/objective]
		[objective]
			description=$lose_condition
			condition=lose
		[/objective]

		[note]
			description=$objective_notes
		[/note]
		note="
<span color='#9999FF'>Created by quequo  (Version {AWSS_VERSION})</span>
Big thanks to IPS, MasterChi3f, Rudko44 and zen-cat for all the help with testing and balancing."
	[/objectives]
#enddef

